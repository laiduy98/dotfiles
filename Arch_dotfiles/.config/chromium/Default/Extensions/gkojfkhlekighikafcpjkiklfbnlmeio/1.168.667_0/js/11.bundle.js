// LICENSE_CODE ZON
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],[,,,,,function(module,exports,__webpack_require__){"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;// LICENSE_CODE ZON
!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(90),__webpack_require__(23)],__WEBPACK_AMD_DEFINE_RESULT__=((hash,zescape)=>{const E={};const GA_POST_URL="https://www.google-analytics.com/collect";let xhr_send_t;let enabled=true;let proc_msg=ga_msg=>{let t,targs;let defaults={dp:"%2F",dl:"%2F",pa:"checkout"};switch(ga_msg[0]){case"event":t="event";targs=["ec","ea","el","ev"];break;case"ec_checkout":t="event";targs=["ec","ea","el","cos","col","pa"];break;case"ec_impression_view":case"pageview":t="pageview";targs=["dh","dp","dt"];break;default:return}let args=targs.map((v,i)=>{let arg=ga_msg[i+1]||defaults[v];return arg&&v+"="+encodeURIComponent(arg)}).filter(v=>!!v).join("&");let ga_params=Object.assign({v:1,t:t},E.xhr_opt);return zescape.qs(ga_params)+"&"+args};E.inited={};E.init=(id,opt={})=>{if(E.inited[id])return;E.inited[id]=true;E.xhr_opt=Object.assign({tid:id},opt);if(opt.pageview)E.qpush(["pageview"])};E.pageview=(hostname,page,title)=>{E.qpush(["pageview",hostname,page,title])};E.event=(category,action,label,value)=>{E.qpush(["event",category,action,label,value])};E.ec_checkout=(step,option,action,label)=>{action=action||`Checkout step ${step}`;E.qpush(["ec_checkout","Ecommerce",action,label,step,option])};E.ec_impression_view=(list_name,products)=>{let prod_keys={id:"id",name:"nm",category:"ca"};let opt=products.reduce((a,p,i)=>{Object.keys(p).forEach((k,v)=>{a[`il1pi${i+1}${prod_keys[k]||k}`]=v});return a},{il1nm:list_name});E.qpush(["ec_impression_view"],opt)};E.qpush=ar=>{if(!enabled)return;let _gaq=window._gaq=window._gaq||[];_gaq.push(ar);if(!E.xhr_opt)return;if(xhr_send_t)clearTimeout(xhr_send_t);xhr_send_t=setTimeout(E.send_gaq,1)};E.send_gaq=()=>{if(!enabled)return;xhr_send_t=0;let _gaq=window._gaq=window._gaq||[];window._gaq=[];let messages=_gaq.map(proc_msg).filter(msg=>!!msg);if(!messages.length)return;messages.forEach(msg=>{let request=new XMLHttpRequest;request.open("POST",GA_POST_URL,true);request.send(msg)})};E.set_enabled=_enabled=>enabled=_enabled;return E}).apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);(function(__webpack__worker__0){var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(30);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_5__);var _util_url_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(18);var _util_url_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_6__);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(28);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7__);var _util_escape_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(23);var _util_escape_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_escape_js__WEBPACK_IMPORTED_MODULE_8__);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(27);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_util_version_util_js__WEBPACK_IMPORTED_MODULE_9__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(21);var _util_storage_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_10__);var _util_ajax_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(48);var _util_ajax_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_util_ajax_js__WEBPACK_IMPORTED_MODULE_11__);var _util_util_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_12__);var _util_date_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(16);var _util_date_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_13__);var _util_string_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(31);var _util_string_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_util_string_js__WEBPACK_IMPORTED_MODULE_14__);var _bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(5);var _bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15__);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(29);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(35);var _bext_vpn_bg_icon_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(91);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19__);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(40);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(37);var _bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(44);var _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(42);var _bext_vpn_bg_ccgi_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(98);var _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(55);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(38);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(33);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28__);var _bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(50);var _bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(54);var _bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(64);var conf__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(24);var conf__WEBPACK_IMPORTED_MODULE_32___namespace=__webpack_require__.t(24,1);var _bext_vpn_bg_bext_config_js__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(99);var _bext_vpn_bg_bext_config_js__WEBPACK_IMPORTED_MODULE_33___default=__webpack_require__.n(_bext_vpn_bg_bext_config_js__WEBPACK_IMPORTED_MODULE_33__);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(41);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_34___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_34__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(22);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_35___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_35__);var cookie__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(67);var cookie__WEBPACK_IMPORTED_MODULE_36___default=__webpack_require__.n(cookie__WEBPACK_IMPORTED_MODULE_36__);var _bext_vpn_bg_ui_api_js__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__(100);var _bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__(62);var _bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_38___default=__webpack_require__.n(_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_38__);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default.a.assert_bg("be_bg_main");if(!_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.is_mocha())_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.set_zerr(_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a);_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.set_exception_handler("be",(id,info,err)=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr(id,info,{err:err}));_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.on_unhandled_exception=function(err){_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default()("unhandled_exception %s",err&&err.stack);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("unhandled_exception",{},{err:err,rate_limit:{count:2}})};const chrome=window.chrome;const assign=Object.assign;const browser=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.browser();const mem_leak_period=3*_util_date_js__WEBPACK_IMPORTED_MODULE_13___default.a.ms.SEC;let last_use;let new_uuid,reused_uuid;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default.a.model.extend({model_name:"bg_main",_defaults:function(){this.on("install",on_install);this.on("update",on_update);this.on("up",on_up);this.on("destroy",()=>E.uninit());this.set("ver",conf__WEBPACK_IMPORTED_MODULE_32__.version);window.addEventListener("unload",()=>E._destroy())}}));E.be_util=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a;E.zerr=window.hola.zerr=_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a;E.be_browser=_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default.a;E.be_tabs=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default.a;E.tabs=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default.a;E.be_ext=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a;E.be_vpn=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__["a"];E.etask=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a;E.unblocker_lib=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26___default.a;E.be_dev_mode=_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_22__["default"];E.be_info=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_27__["default"];E.pac_engine=_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_38___default.a;E.be_rule=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_20__["a"];E.be_premium=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"];E.be_mode=_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_30__["a"];E.be_trial=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_23__["default"];E.be_tpopup=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_31__["a"];E.be_util.rmt=E;function get_post_install_url(){return _util_escape_js__WEBPACK_IMPORTED_MODULE_8___default.a.uri("https://hola.org/unblock/install",{ext_ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.version(),uuid:E.get("uuid")})}const set_aff_id=val=>{if(!val)return;E.set("aff_id",val);_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.set("aff_id",val)};const send_install_ga=(install_src,www_aj)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function(){E.ga_send("checkout",{step:3,option:install_src});E.ga_send_affiliate_event("Finished Installing Extension");if(www_aj&&www_aj.includes("8")){E.ga_send("event",{cat:"www_aj",act:"www_aj_ext_installed",lab:www_aj})}}));const send_install_perr=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_send_install_perr(){if(!E.install_ts||!E.get("agree_ts")||E.install_perr_ts)return;let info={},now=Date.now(),url=get_post_install_url();let cookies=(yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.cb_apply(chrome.cookies.getAll,[{domain:".hola.org"}]))||[];let get_cookie=name=>(cookies.find(c=>c.name==name)||{}).value;let post_install_cookie=get_cookie("post_install");if(post_install_cookie){try{_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_31__["a"].set("post_install_redirect",JSON.parse(decodeURIComponent(post_install_cookie)).redirect_url)}catch(err){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_post_install_parse_err",{post_install_cookie:post_install_cookie},{err:err})}}E.install_perr_ts=now;_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.notice("open post insall page %s",url);_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].open_hola_tab({url:url,force_active:true});if(_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get(chrome,"runtime.getManifest"))info=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.pick(chrome.runtime.getManifest(),"permissions");_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.if_set(new_uuid,info,"new_uuid");_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.if_set(reused_uuid,info,"reused_uuid");let be_usage=get_cookie("be_usage");if(be_usage){try{info.be_usage=JSON.parse(decodeURIComponent(be_usage))}catch(err){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_usage_parse_err",{},{err:err})}}let aff_id=get_cookie("aff_id");let install_src=get_cookie("install_src");let www_aj=get_cookie("www_aj");set_aff_id(aff_id);send_install_ga(install_src,www_aj);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("install",assign({aff_id:aff_id,install_src:install_src,www_aj:www_aj},info));_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.set("install_perr_ts",now)}));E.t={get_post_install_url:get_post_install_url,send_install_perr:send_install_perr};E.ga_send=(type,opt)=>{if(E.get("ga_failed"))return;let cb=()=>{switch(type){case"event":_bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15___default.a.event(opt.cat,opt.act,opt.lab,opt.val);break;case"checkout":_bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15___default.a.ec_checkout(opt.step,opt.option,opt.act,opt.lab);break;case"impression_view":_bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15___default.a.ec_impression_view(opt.list,opt.products);break;default:return}};if(E.get("ga_inited"))cb();else E.once("change:ga_inited",cb)};E.ga_send_affiliate_event=act=>{let aff_id;if(!(aff_id=E.get("aff_id")))return;E.ga_send("event",{cat:"Affiliates",act:act,lab:aff_id})};function on_install(){E.install_ts=Date.now();_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.set("install_ts",window.hola.t.l_start);_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.set("install_version",_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.version());_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.set("install_version",_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.version());send_install_perr()}function on_update(prev){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("update",prev+" > "+_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.version());_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.set("update_ts",window.hola.t.l_start)}function on_up(){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("up")}function ccgi_init(){_bext_vpn_bg_ccgi_js__WEBPACK_IMPORTED_MODULE_24__["a"].init(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a);chrome.tabs.query({url:conf__WEBPACK_IMPORTED_MODULE_32__.hola_match},tabs=>underscore__WEBPACK_IMPORTED_MODULE_0___default.a.each(tabs,tab=>{chrome.tabs.executeScript(tab.id,{file:"/js/bext/vpn/bg/cs_hola.js",runAt:"document_start"})}))}function get_uuid(){return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"get_uuid",cancel:true},(function*(){try{const ret=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.all({allow_fail:true},{local:_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].storage_local_get("uuid"),localStorage:_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*get_uuid_local_storage_(){return yield localStorage.getItem("uuid")})),cookie:_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){return yield cookie__WEBPACK_IMPORTED_MODULE_36___default.a.get("uuid")})),ccgi:_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.cb_apply(!_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.is_mocha()&&chrome.cookies,".get",[{url:conf__WEBPACK_IMPORTED_MODULE_32__.url_ccgi,name:"uuid"}])});get_uuid.last_error=collect_errors(ret);const uuid=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get(ret,"local.uuid")||ret.localStorage||ret.cookie||_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get(ret,"ccgi.value");if(!uuid)return;_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default.a.assert(typeof uuid=="string"&&uuid.length>=8,new Error("invalid_uuid"));if(uuid!=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get(ret,"local.uuid")||uuid!=ret.localStorage||uuid!=ret.cookie||uuid!=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get(ret,"ccgi.value")){reused_uuid=true;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("uuid_storage_mismatch",{uuid:uuid,ret:ret})}return uuid}catch(err){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("unreachable","get_uuid",{err:err})}}))}function persist_uuid(uuid){return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"persist_uuid"},(function*(){try{const ret=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.all({allow_fail:true},{local:_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].storage_local_set({uuid:uuid}),localStorage:_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*persist_uuid_ls_(){yield localStorage.setItem("uuid",uuid)})),cookie:_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*persist_uuid_cookie_(){yield cookie__WEBPACK_IMPORTED_MODULE_36___default.a.set("uuid",uuid,{expires:36500,path:"/"})}))});persist_uuid.last_error=collect_errors(ret);return underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isEmpty(ret)}catch(err){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("unreachable","persist_uuid",{err:err})}}))}function collect_errors(ret){var arr=[];underscore__WEBPACK_IMPORTED_MODULE_0___default.a.each(ret,(v,k)=>{if(!_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.is_err(v))return;var e={};e[k]=""+v.error;arr.push(e)});return arr}E.gen_uuid=()=>{var buf=new Uint8Array(16),uuid="";window.crypto.getRandomValues(buf);for(var i=0;i<buf.length;i++)uuid+=(buf[i]<=15?"0":"")+buf[i].toString(16);return uuid};function ensure_uuid(){let uuid;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"ensure_uuid",cancel:true},(function*ensure_uuid_(){let _uuid=yield get_uuid();if(_uuid){E.sp.spawn(persist_uuid(_uuid));return this.return(_uuid)}new_uuid=true;_uuid=yield E.gen_uuid();_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.assert(_uuid,"gen_uuid() returned: "+_uuid);const ret=yield persist_uuid(uuid=_uuid);if(ret){uuid="t."+uuid.substr(2);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("init_tmp_uuid",{uuid:uuid},{err:true});return this.return(uuid)}_uuid=yield get_uuid();if(uuid!=_uuid)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("uuid_storage_set_err",{uuid:uuid,_uuid:_uuid});return uuid}))}const handle_install=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*handle_install_(){try{if(!E.get("install_reason"))yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.sleep(1e3);const reason=E.get("install_reason");_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.notice("bg_main startup "+reason);if(new_uuid&&reason!="install")_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("switch_uuid_err",{reason:reason});if(!["install","update"].includes(reason))return;E.trigger(reason,_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get("ver"));_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.set("ver",_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.version())}catch(err){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("handle_install_err",{},{err:err})}}));E.set_rule_use=(rule,is_mitm)=>{var name=rule.name||rule.host,now=Date.now();var d=now-E.uninstall_url_cb.ts;var update=!last_use||last_use&&last_use.name!=name||d>15*_util_date_js__WEBPACK_IMPORTED_MODULE_13___default.a.ms.MIN;last_use={name:name,ts:now,is_mitm:is_mitm};if(update||d>_util_date_js__WEBPACK_IMPORTED_MODULE_13___default.a.ms.HOUR)E.uninstall_url_cb()};E.uninstall_url_cb=function uninstall_url_cb(){var now=Date.now();E.uninstall_url_cb.ts=now;var qs={perr:1,uuid:E.get("uuid"),browser:browser,version:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.version()};if(last_use&&now-last_use.ts<15*_util_date_js__WEBPACK_IMPORTED_MODULE_13___default.a.ms.MIN){qs.last=btoa(last_use.name);if(last_use.is_mitm)qs.mitm=1}var ms;if(ms=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.get_install_ms())qs.inst_ms=ms;var url=conf__WEBPACK_IMPORTED_MODULE_32__.url_ccgi+"/uninstall?"+_util_escape_js__WEBPACK_IMPORTED_MODULE_8___default.a.qs(qs);url=url.substr(0,255);if(_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get(chrome,"runtime.setUninstallURL"))chrome.runtime.setUninstallURL(url)};E.get_agree_ts=()=>{if(!conf__WEBPACK_IMPORTED_MODULE_32__.check_agree_ts)return 1;var ver_install=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("install_version");if(ver_install&&_util_version_util_js__WEBPACK_IMPORTED_MODULE_9___default.a.cmp(ver_install,"1.131.737")<0)return 1;return _util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get("agree_ts")};E.set_agree_ts=val=>{E.set("agree_ts",val);_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.set("agree_ts",val)};function set_upgrade_ext_interval(){_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default.a.clear_interval(set_upgrade_ext_interval.interval);_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].upgrade_ext();set_upgrade_ext_interval.interval=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default.a.set_interval(_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].upgrade_ext,24*_util_date_js__WEBPACK_IMPORTED_MODULE_13___default.a.ms.HOUR,{sp:E.sp})}function ajax_do_op(o){var op=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get(o,"op");if(!op)return;switch(op){case"reload_ext":_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.notice("do_op_reload_ext "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.json(o));_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_reload_ext_ajax_op");_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default.a.set_timeout(()=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.reload_ext_native(),500);break;case"upgrade_ext":_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.notice("do_op_upgrade_ext "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.json(o));_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].upgrade_ext();break;default:_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default()("unknown op "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.json(o));break}}function dev_mode_cb(){const level=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("dev_mode")?"NOTICE":"WARN";_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].set_dbg_conf("debug.zerr",{level:level});_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.set_level(level)}function debug_cb(){_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.set_level(_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("debug.zerr"),"level"))}const no_log_cb=enabled=>_bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15___default.a.set_enabled(!enabled);const add_hola_ext_cookie=()=>chrome.cookies.set({url:"https://hola.org",name:"ext_ver",domain:".hola.org",value:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.version()});const del_hola_ext_cookie=()=>chrome.cookies.remove({url:"https://hola.org",name:"ext_ver"});E.init=function(opt){if(E.inited)return;opt=opt||{};assert_no_listeners();E.inited=(E.inited||0)+1;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.set_bext_config_cb(()=>_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("bext_config"));_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.set("install_version",_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get("install_version"));E.set("agree_ts",E.get_agree_ts());E.set("aff_id",_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get("aff_id"));E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default.a.new_etask("be_bg_main");_util_ajax_js__WEBPACK_IMPORTED_MODULE_11___default.a.do_op=ajax_do_op;_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default.a.init();_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default.a.init();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.init();ccgi_init();_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].init(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_20__["a"]);_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_23__["default"].init(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_20__["a"]);_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_22__["default"].init();_bext_vpn_bg_ui_api_js__WEBPACK_IMPORTED_MODULE_37__["a"].init(E);add_hola_ext_cookie();_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.clr("ajax_timeout");_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.clr("be_ajax_simulator");E.on("change:inited",inited_cb);E.on("change:ga_failed",ga_failed_cb);E.on_init("change:agree_ts",send_install_perr);if(_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get(chrome,"runtime.setUninstallURL"))E.on_init("change:uuid change:cid",E.uninstall_url_cb);E.on("change:agree_ts",active_cb);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a,"change:session_key change:enabled "+"change:ext.conflict change:uuid",active_cb);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a,"change:ext.suspended",suspend_cb);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a,"change:debug.zerr",debug_cb);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a,"change:dev_mode",dev_mode_cb);_bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_29__["default"].set_status_cb(no_log_cb);start_monitor_worker();_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__["a"].set_bext_config(_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get_json("bext_config_last")||_bext_vpn_bg_bext_config_js__WEBPACK_IMPORTED_MODULE_33___default.a);const install_reason=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get(opt,"install_details.reason","");if(install_reason)E.set("install_reason",install_reason);E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*init_(){try{const uuid=yield ensure_uuid();_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.notice("uuid: "+uuid);E.set("uuid",uuid);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.set("uuid",uuid);E.sp.spawn(handle_install());E.trigger("up");E.set("inited",true)}catch(err){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("init_err",{},{err:err})}finally{const get=get_uuid.last_error||[];const set=persist_uuid.last_error||[];if(!get.length&&!set.length)return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("uuid_storage_err",_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.json({get:get,set:set}))}})));set_upgrade_ext_interval()};E.uninit=function(){if(!E.inited)return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("bg_main_uninit",{stack:new Error("bg_uninit").stack,reload_ext:_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get_json("reload_ext")});_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("bg_main_uninit_log",{stack:new Error("bg_uninit").stack,reload_ext:_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get_json("reload_ext")},{with_log:true});E.sp.return();E.off();E.stopListening();del_hola_ext_cookie();set_upgrade_ext_interval.interval=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default.a.clear_interval(set_upgrade_ext_interval.interval);if(monitor_active.sp)monitor_active.sp.return();if(monitor_suspended.sp)monitor_suspended.sp.return();if(_util_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.is_mocha()){_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__["a"].uninit();_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].uninit();_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_23__["default"].uninit();_bext_vpn_bg_icon_js__WEBPACK_IMPORTED_MODULE_18__["a"].uninit();_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].uninit();_bext_vpn_bg_ccgi_js__WEBPACK_IMPORTED_MODULE_24__["a"].uninit();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.uninit();_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default.a.uninit();_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_22__["default"].uninit();_bext_vpn_bg_ui_api_js__WEBPACK_IMPORTED_MODULE_37__["a"].uninit();_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default.a.uninit()}else{_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__["a"]._destroy();_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"]._destroy();_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_23__["default"]._destroy();_bext_vpn_bg_icon_js__WEBPACK_IMPORTED_MODULE_18__["a"]._destroy();_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"]._destroy();_bext_vpn_bg_ccgi_js__WEBPACK_IMPORTED_MODULE_24__["a"]._destroy();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a._destroy();_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default.a._destroy();_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_22__["default"]._destroy();_bext_vpn_bg_ui_api_js__WEBPACK_IMPORTED_MODULE_37__["a"]._destroy();_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default.a._destroy()}E.inited=false;E.clear();assert_no_listeners()};function assert_no_listeners(){_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__["a"].assert_no_listeners();_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].assert_no_listeners();_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_23__["default"].assert_no_listeners();_bext_vpn_bg_icon_js__WEBPACK_IMPORTED_MODULE_18__["a"].assert_no_listeners();_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].assert_no_listeners();_bext_vpn_bg_ccgi_js__WEBPACK_IMPORTED_MODULE_24__["a"].assert_no_listeners();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.assert_no_listeners();_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default.a.assert_no_listeners();_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_22__["default"].assert_no_listeners();_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_20__["a"].assert_no_listeners()}function ga_failed_cb(){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_bg_main_ga_init_failed")}function inited_cb(){if(!E.get("inited"))return;E.off("change:inited",inited_cb);_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*inited_cb_(){try{const state=yield _util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get("ext_state");E.set("enabled",state!="disabled");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.set("enabled",state!="disabled");_bext_vpn_bg_icon_js__WEBPACK_IMPORTED_MODULE_18__["a"].init();_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].init(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_34___default.a);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a,"change:uuid change:session_key",background_init);E.on("recover",background_init);if(yield _util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get("suspended_ext_ts"))_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.set("ext.suspended",true)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_bg_main_init_err",{},{err:e})}}))}const monitor_active=()=>{E.sp.spawn(monitor_active.sp=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*monitor_active_(){this.finally(()=>delete monitor_active.sp);yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.sleep(mem_leak_period);let prev_ps=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.ps()||"";let a=_util_string_js__WEBPACK_IMPORTED_MODULE_14___default.a.split_nl(prev_ps).length;yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.sleep(mem_leak_period);let ps=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.ps(),b=_util_string_js__WEBPACK_IMPORTED_MODULE_14___default.a.split_nl(ps).length;if(b>a){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_ext_off_leak",{before_n:a,after_n:b,reason:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("ext.conflict")?"conflict":"disable"},{rate_limit:{count:1},filehead:"before: "+prev_ps+"\nafter: "+ps})}})))};function active_cb(){let uuid=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("uuid");let active=!!(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("enabled")&&!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("ext.conflict")&&!(conf__WEBPACK_IMPORTED_MODULE_32__.check_agree_ts&&!E.get("agree_ts"))&&uuid&&_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("session_key"));_bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_29__["default"].set_uuid(uuid);let prev=!!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("ext.active");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.safe_set({"ext.active":active});if(prev==active)return;if(active){if(monitor_active.sp)monitor_active.sp=void monitor_active.sp.return();_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].init(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_20__["a"])}else{if(!monitor_active.sp)monitor_active();_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].uninit()}}E.suspend_client=()=>{if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("ext.suspended"))return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("suspend_client");_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.set("suspended_ext_ts",Date.now());_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.set("ext.suspended",true);_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].refresh_user();let url=_util_url_js__WEBPACK_IMPORTED_MODULE_6___default.a.qs_add("https://hola.org/signin",{force_signin:1,signin_redirect:true,next:"/cp"});_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].open_hola_tab({url:url,force_active:true})};E.check_suspend_status=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_check_suspend_status(){if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("ext.suspended"))return;try{let location=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_27__["default"].get("location");let qs=assign({ip:location&&location.ip},_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.auth());let res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_32__.url_ccgi+"/user_status",qs:qs});if(res&&res.active){_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.clr("suspended_ext_ts");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.set("ext.suspended",false);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("suspend_restore");background_init()}}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("suspend_status_check_fail",{},{err:e,rate_limit:{count:2}})}}));const monitor_suspended=()=>{E.sp.spawn(monitor_suspended.sp=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_monitor_suspended(){let check_rl=underscore__WEBPACK_IMPORTED_MODULE_0___default.a.throttle(E.check_suspend_status,2*_util_date_js__WEBPACK_IMPORTED_MODULE_13___default.a.ms.SEC);this.finally(()=>{delete monitor_suspended.sp;E.stopListening(_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"],"user_updated",check_rl);E.stopListening(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a,"change:uuid change:session_key",check_rl)});E.listen_to(_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"],"user_updated",check_rl);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a,"change:uuid change:session_key",check_rl);yield this.wait()})))};let suspend_cb=()=>{if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("ext.suspended")){if(!monitor_suspended.sp)monitor_suspended()}else{if(monitor_suspended.sp)monitor_suspended.sp=void monitor_suspended.sp.return()}};E.set_enabled=on=>{if(!!E.get("enabled")==!!on)return;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*set_enabled_(){try{E.set("enabled",!!on);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.set("enabled",!!on);return yield _util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.set("ext_state",on?"enabled":"disabled")}catch(err){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_bg_main_set_enable_err",{},{err:err})}}))};const background_init_ajax=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_background_init_ajax(){let req={retry:1,method:"POST",data:{login:1,ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.version()},qs:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.qs_ajax({uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("uuid")}),url:conf__WEBPACK_IMPORTED_MODULE_32__.url_ccgi+"/background_init",with_credentials:true};try{return yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].ccgi_ajax(req)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_background_init_ccgi_failed",{req:req},{err:e})}req.url="https://client.svd-cdn.com/client_cgi/background_init";try{return yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].ccgi_ajax(req)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_background_init_svd_cdn_failed",{req:req},{err:e})}req.url="https://perr.hola.org/background_init";try{return yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].ccgi_ajax(req)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_background_init_perr_init_failed",{req:req},{err:e})}req.method="GET";try{return yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].ccgi_ajax(req)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_background_init_get_ccgi_failed",{req:req},{err:e})}req.url="https://client.svd-cdn.com/client_cgi/background_init";try{return yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].ccgi_ajax(req)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_background_init_get_svd_cdn_failed",{req:req},{err:e})}req.url="https://perr.hola.org/background_init";try{return yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].ccgi_ajax(req)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_background_init_get_perr_init_failed",{req:req},{err:e})}if(!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.CG("disable_background_init_agent_test")){req={url:"http://104.131.143.163:22222/myip"};try{let res=yield _util_ajax_js__WEBPACK_IMPORTED_MODULE_11___default()(req);if(res.ip)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_background_init_agent_ok")}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_background_init_agent_err",{req:req},{err:e})}}throw new Error("background_init_ajax failed")}));const background_init=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_background_init(){let req;try{_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.notice("background_init called %s",E.get("status"));if(E.get("status")=="busy"||E.get("status")=="ready")return;if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("uuid"))return void _util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.notice("background_init no uuid");E.set("status","busy");req={retry:1,method:"POST",data:{login:1,ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.version()},qs:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.qs_ajax({uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("uuid")}),url:conf__WEBPACK_IMPORTED_MODULE_32__.url_ccgi+"/background_init",with_credentials:true};let info=yield background_init_ajax(),t=window.hola.t;if(info.blocked){E.suspend_client();throw new Error("background_init_ajax blocked")}E.stopListening(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a,"change:uuid change:session_key",background_init);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.set("session_key",info.key);_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__["a"].init();E.set("status","ready");t.r_init=Date.now();let start=t.new_ver||t.l_start,diff=t.r_init-start;_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a[diff>2e3?"err":"notice"](diff>2e4?"rmt_init_slow":"background_init %sms",diff);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_background_init_ok",{diff:diff,req:req});if(_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get("reload_ext_ts")){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_recover_ok",{ts:_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get("reload_ext_ts")});_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.clr("reload_ext_ts")}}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_background_init_err",{req:req},{err:e});E.set("status","error");if(_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get("reload_ext_ts")){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_recover_failed",{ts:_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.get("reload_ext_ts")},{err:e});_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default.a.clr("reload_ext_ts")}}}));let dumped_errors={};E.dump_errors=(tab_id,errors)=>dumped_errors[tab_id]=errors;E.get_dumped_errors=tab_id=>dumped_errors[tab_id];E.set_bug_id=bug_id=>{_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.warn("VPN BUG REPORT: http://web.hola.org/vpn_debug?id="+bug_id)};function start_monitor_worker(){var worker=new Worker(__webpack__worker__0,{});worker.onmessage=e=>{let data=e.data||{};switch(data.type){case"ping":var opt={val:data.val,url:conf__WEBPACK_IMPORTED_MODULE_32__.url_perr,perr:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr_opt("be_main_thread_stuck",{},{level:_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.L.ERR,rate_limit:{count:1}})};var config=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("bext_config");if(config&&config.monitor_worker)assign(opt,config.monitor_worker);worker.postMessage({type:"pong",opt:opt});break;case"push_event":_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_35___default.a.push_event(data.name,{duration:data.duration,ts:data.ts});break;default:break}}}__webpack_exports__["default"]=E}).call(this,__webpack_require__(89))},,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;// LICENSE_CODE ZON
!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(17),__webpack_require__(28),__webpack_require__(14),__webpack_require__(13)],__WEBPACK_AMD_DEFINE_RESULT__=((be_backbone,B,be_util,be_vpn_util)=>{be_vpn_util.assert_bg("be_ext");const assign=Object.assign;const E=new(be_backbone.model.extend({model_name:"ext",_defaults:function(){this.on("destroy",()=>E.uninit())}}));E.init=()=>{if(E.inited)return;E.inited=true};E.uninit=()=>{if(!E.inited)return;E.stopListening();E.clear();E.inited=false};E.auth=o=>{const info=be_util.qs_ajax();info.uuid=E.get("uuid");info.session_key=E.get("session_key")||0;return assign(info,o)};E.is_disabled=()=>!E.get("ext.active")||E.get("ext.suspended");return E}).apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},,,,,,,,,function(module,exports,__webpack_require__){"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;// LICENSE_CODE ZON
!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(15),__webpack_require__(11),__webpack_require__(17),__webpack_require__(28),__webpack_require__(12),__webpack_require__(22),__webpack_require__(16),__webpack_require__(18),__webpack_require__(20),__webpack_require__(14),__webpack_require__(13),__webpack_require__(10)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,etask,be_backbone,B,zerr,vpn_util,date,zurl,be_ext,be_util,be_vpn_util,zutil){be_vpn_util.assert_bg("be_tabs");const chrome=window.chrome;const E=new(be_backbone.model.extend({model_name:"tabs",_defaults:function(){this.on("destroy",()=>{E.uninit()})}}));const max_redirects=10;function active_cb(){etask({name:"active_cb",cancel:true},(function*active_cb_(){try{const tab=yield E.get_tab(E.get("active.real.id"));if(tab&&chrome){if((tab.url||"").startsWith("chrome-devtools://devtools/bundled/devtools.html")){return}}E.set({"active.id":tab?tab.id:undefined,"active.url":tab?tab.url:"","active.status":tab?tab.status:"","active.incognito":tab?tab.incognito:false})}catch(err){zerr("be_tabs_active_cb_err: "+err)}}))}function is_active(id){return id==E.get("active.real.id")}var tab_trace={};function page_trace(details,msg,clear){if(!details)return;var is_main=chrome?!details.frameId&&(!details.type||details.type=="main_frame"):details.is_main;if(!is_main&&msg!="autoreload")return;var tab_id=details.tabId;if(clear)page_trace_del(tab_id);var trace=tab_trace[tab_id]=tab_trace[tab_id]||[];var ts=details.timeStamp;var from_start=trace[0]?ts-trace[0].ts:0;var prev=trace.length?trace[trace.length-1]:null;if(prev)prev.duration=ts-prev.ts;var status=details.statusCode||prev&&prev.status||"0";trace.push({ts:ts,real_ts:Date.now(),from_start:from_start,msg:msg,status:status,error:details.error});zerr.debug("tab:%d navigation %s %s",tab_id,msg,details.url.slice(0,200))}function page_trace_del(tab_id){delete tab_trace[tab_id]}E.page_trace=page_trace;E.get_trace=tab_id=>{var trace=tab_trace[tab_id];if(!trace||!trace.length)return trace;trace[trace.length-1].duration=Date.now()-trace[trace.length-1].real_ts;return trace};function on_created(tab){set_url(tab.id,tab.url);E.trigger("created",{tab:tab})}function on_updated(id,info,tab){if(!info.url&&!info.status)return;set_url(id,info.url);if(is_active(id))E.sp.spawn(active_cb());E.trigger("updated",{id:id,info:info,tab:tab})}function on_activated(info){E.set("active.real.id",info.tabId)}function on_removed(id,info){del_tab(id);track_redirect_del(id);page_trace_del(id);E.trigger("removed",{id:id,info:info})}function on_replaced(added,removed){del_tab(removed);track_redirect_del(removed);page_trace_del(removed);if(is_active(removed))E.set("active.real.id",added);E.trigger("replaced",{added:added,removed:removed})}var chrome_error_list=["ACCESS_DENIED","BLOCKED_BY_ADMINISTRATOR","CONNECTION_REFUSED","CONNECTION_FAILED","NAME_NOT_RESOLVED","ADDRESS_UNREACHABLE","CERT_ERROR_IN_SSL_RENEGOTIATION","NAME_RESOLUTION_FAILED","NETWORK_ACCESS_DENIED","SSL_HANDSHAKE_NOT_COMPLETED","SSL_SERVER_CERT_CHANGED","CERT_COMMON_NAME_INVALID","CERT_AUTHORITY_INVALID","CERT_CONTAINS_ERRORS","CERT_INVALID","INVALID_RESPONSE","EMPTY_RESPONSE","INSECURE_RESPONSE","DNS_MALFORMED_RESPONSE","DNS_SERVER_FAILED","DNS_SEARCH_EMPTY","TIMED_OUT","CONNECTION_CLOSED","ABORTED","CONNECTION_RESET"];function on_error_occured(info){if(info.frameId!=0)return;var err=info.error||"";err=err.split("::ERR_")[1];if(chrome&&(!err||!chrome_error_list.includes(err)))return;info.http_status_code=0;E.trigger("error_occured",{id:info.tabId,info:info})}const WINDOW_ID_NONE=chrome?-1:null;function on_focused(id){if(id===WINDOW_ID_NONE)return;E.set("active.window.id",id);chrome.tabs.query({active:true,windowId:id},tabs=>{if(tabs.length)E.set("active.real.id",tabs[0].id)})}var nav_tabs={};function on_before_navigate(info){if(!info.frameId)nav_tabs[info.tabId]=info.url;var trace,clear=true;if(!info.frameId&&(trace=tab_trace[info.tabId])){var i,now=Date.now();for(i=trace.length-1;i>=0&&trace[i].msg!="autoreload";i--);if(i>=0&&now-trace[i].real_ts<2*date.ms.SEC)clear=false}page_trace(info,"before_navigate",clear);if(!info.frameId&&is_active(info.tabId))active_cb();E.trigger("before_navigate",info)}function on_completed(info){page_trace(info,"completed");if(is_active(info.tabId))active_cb();E.trigger("completed",info)}function on_committed(details){page_trace(details,"committed");E.trigger("committed",{id:details.tabId,info:details});if(!details.frameId&&details.tabId&&details.url){var qualifiers=details.transitionQualifiers;if(qualifiers&&qualifiers.includes("client_redirect")){track_redirect({id:details.tabId,url:details.url,info:details})}else if(!qualifiers.includes("server_redirect"))delete tabs_redirect[details.tabId];last_committed[details.tabId]=get_root_url(details.url)}if(false){}}function get_root_url(url){url=zurl.parse(url);if(!url.hostname||!url.protocol)return;url=url.protocol+"//"+url.hostname+"/";return vpn_util.get_root_url(url)}var tabs_redirect={},last_committed={};function track_redirect(tab){let url;if(!chrome||!tab||tab.id===undefined||!(url=tab.url||E.urls[tab.id])){return}let list=tabs_redirect[tab.id]=tabs_redirect[tab.id]||{redirects:[]};let last_url=last_committed[tab.id],from_url=get_root_url(url);let to_url,headers;if(headers=tab.info&&tab.info.responseHeaders){let h;if(h=headers.find(e=>e.name.toLowerCase()=="location"))to_url=h.value;to_url=to_url&&get_root_url(to_url)}if(!to_url&&tab.info&&tab.info.transitionQualifiers){to_url=get_root_url(url);from_url=last_url}const redirects=list.redirects;if(!from_url||!to_url||from_url==to_url||redirects.length&&redirects[redirects.length-1].from==from_url){return}redirects.push({to:to_url,from:from_url,url:url,ts:Date.now()});if(redirects.length==max_redirects){if(!list.is_max&&E.get_redirect_list(tab.id,max_redirects,true).length==max_redirects){let urls=list.redirects.map(e=>e.url);be_util.perr("be_max_redirect_sequence",{urls:urls},{err:true,rate_limit:{count:1}});E.trigger("max_redirect_sequence",from_url,to_url,urls);list.is_max=true}redirects.shift()}if(list.to)be_vpn_util.clear_timeout(list.to);list.to=be_vpn_util.set_timeout(()=>list.redirects=[],2*date.ms.MIN)}function get_redirect_sequence(tab_id,url,ts_limit,limit){var list;if(!(list=tabs_redirect[tab_id]))return[];list=ts_limit?list.redirects.filter(e=>e.ts>ts_limit):list.redirects;if(!list.length||list.some(e=>e.from=="hola.org"))return[];var ts,parent_url,i,root_urls=[];for(i=0,parent_url=list.find(e=>e.to==url);parent_url&&i<max_redirects;i++){if(ts&&ts<=parent_url.ts)break;root_urls.unshift(parent_url.from);if(!ts)ts=parent_url.ts;list.splice(0,list.indexOf(parent_url)+1);parent_url=list.find(e=>e.to==parent_url.from)}return root_urls.splice(0,limit||4)}function track_redirect_del(tab_id){if(tab_id===undefined)return;if(last_committed[tab_id])delete last_committed[tab_id];if(tabs_redirect[tab_id]){if(tabs_redirect[tab_id].to)be_vpn_util.clear_timeout(tabs_redirect[tab_id].to);delete tabs_redirect[tab_id]}}E.track_redirect=track_redirect;E.get_redirect_list=(tab_id,limit)=>{var time_limit=Date.now()-120*date.ms.SEC;var active_url=E.get("active.url");active_url=active_url&&get_root_url(active_url);return get_redirect_sequence(tab_id,active_url,time_limit,limit)};E.init=()=>{if(E.inited)return;E.sp=be_vpn_util.new_etask("be_tabs");E.listen_to(be_ext,"change:ext.active change:ext.suspended",update_state);E.urls={};chrome.tabs.query({},tabs=>{if(!tabs)return;for(var i=0;i<tabs.length;i++)set_url(tabs[i].id,tabs[i].url)});chrome.windows.getLastFocused({},win=>{if(win)on_focused(win.id)});chrome.tabs.onCreated.addListener(on_created);chrome.tabs.onUpdated.addListener(on_updated);chrome.tabs.onActivated.addListener(on_activated);chrome.tabs.onRemoved.addListener(on_removed);chrome.tabs.onReplaced.addListener(on_replaced);chrome.windows.onFocusChanged.addListener(on_focused);set_navigation_listeners();E.on_init("change:active.real.id",active_cb);E.inited=true};E.uninit=()=>{if(!E.inited)return;E.sp.return();chrome.tabs.onCreated.removeListener(on_created);chrome.tabs.onUpdated.removeListener(on_updated);chrome.tabs.onActivated.removeListener(on_activated);chrome.tabs.onRemoved.removeListener(on_removed);chrome.tabs.onReplaced.removeListener(on_replaced);chrome.windows.onFocusChanged.removeListener(on_focused);E.off("change:active.real.id",active_cb);del_navigation_listeners();E.stopListening();E.inited=false;E.urls=undefined;E.clear()};function set_navigation_listeners(){if(E.nav_listening)return;E.nav_listening=true;if(zutil.get(chrome,"webNavigation.onBeforeNavigate"))chrome.webNavigation.onBeforeNavigate.addListener(on_before_navigate);if(zutil.get(chrome,"webNavigation.onCompleted"))chrome.webNavigation.onCompleted.addListener(on_completed);if(zutil.get(chrome,"webNavigation.onErrorOccurred"))chrome.webNavigation.onErrorOccurred.addListener(on_error_occured);if(zutil.get(chrome,"webNavigation.onCommitted"))chrome.webNavigation.onCommitted.addListener(on_committed)}function del_navigation_listeners(){if(!E.nav_listening)return;E.nav_listening=false;if(zutil.get(chrome,"webNavigation.onBeforeNavigate")){chrome.webNavigation.onBeforeNavigate.removeListener(on_before_navigate)}if(zutil.get(chrome,"webNavigation.onCompleted"))chrome.webNavigation.onCompleted.removeListener(on_completed);if(zutil.get(chrome,"webNavigation.onErrorOccurred"))chrome.webNavigation.onErrorOccurred.removeListener(on_error_occured);if(zutil.get(chrome,"webNavigation.onCommitted"))chrome.webNavigation.onCommitted.removeListener(on_committed)}E.get_tab=tab_id=>{if(!tab_id)return null;return etask.cb_apply(chrome.tabs,".get",[tab_id])};E.get_nav_tab_url=id=>nav_tabs[id];E.get_nav_tabs=()=>nav_tabs;function del_tab(id){delete nav_tabs[id];if(!E.urls[id])return;delete E.urls[id];E.trigger("url_updated",id)}function set_url(id,url){if(!url||url==E.urls[id])return;E.urls[id]=url;E.trigger("url_updated",id,url)}function update_state(){let is_active=!be_ext.is_disabled();if(E.is_active==is_active)return;E.is_active=is_active;del_navigation_listeners();if(!E.is_active)return;set_navigation_listeners()}E.has_root_url=root_url=>Object.values(E.urls||{}).some(url=>get_root_url(url)==root_url);E.get_url=tab_id=>E.urls&&E.urls[tab_id];E.active=()=>E.get_tab(E.get("active.id"));E.update=(tab_id,url)=>etask((function*update(){try{yield etask.cb_apply(chrome.tabs.update,[tab_id,{url:url}])}catch(e){be_util.perr("be_tab_update_err",{},{err:e,rate_limit:{count:1}})}}));E.reload=tab_id=>etask((function*reload(){try{yield etask.cb_apply(chrome.tabs.reload,[tab_id,{bypassCache:true}])}catch(e){be_util.perr("be_tab_reload_err",{},{err:e,rate_limit:{count:1}})}}));var tabs_suggestions={};E.set_force_suggestion=(tab_id,val)=>{tabs_suggestions[tab_id]=val};E.is_force_suggestion=tab_id=>tabs_suggestions[tab_id];E.t={get_redirect_sequence:get_redirect_sequence,tabs_redirect:tabs_redirect};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _util_util_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_1__);var _util_url_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(18);var _util_url_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_2__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_3__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(21);var _util_storage_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_4__);var _util_date_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(16);var _util_date_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_5__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_6__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(22);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7__);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(38);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(28);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11__);
// LICENSE_CODE ZON
const E={};const chrome=window.chrome,assign=Object.assign;E.is_vpn_allowed=(_url,is_main,is_in_net,rule)=>{let protocol,hostname,url=_util_url_js__WEBPACK_IMPORTED_MODULE_2___default.a.parse(_url),port=url.port;if(!(protocol=url.protocol)||!(hostname=url.hostname))return false;if(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.is_all_browser(rule))return true;if(!hostname.includes("."))return false;const protocols={"http:":1,"https:":1,"wss:":1,"ws:":1};if(!protocols[protocol])return false;if(port&&!{"http:80":1,"https:443":1,"ws:80":1,"wss:443":1}[protocol+port]){return false}if(_util_url_js__WEBPACK_IMPORTED_MODULE_2___default.a.is_ip(hostname)){if(is_main||!is_in_net)return false;if(is_in_net(hostname,"10.0.0.0","255.0.0.0")||is_in_net(hostname,"172.16.0.0","255.240.0.0")||is_in_net(hostname,"192.168.0.0","255.255.0.0")||is_in_net(hostname,"127.0.0.0","255.0.0.0")){return false}}if(_util_url_js__WEBPACK_IMPORTED_MODULE_2___default.a.get_top_level_domain(hostname)=="localhost"||_util_url_js__WEBPACK_IMPORTED_MODULE_2___default.a.is_hola_domain(hostname)){return false}return true};E.get_root_link=(rule,href)=>href&&_util_url_js__WEBPACK_IMPORTED_MODULE_2___default.a.add_proto(_util_url_js__WEBPACK_IMPORTED_MODULE_2___default.a.get_host(href))||rule.link;const add_rule_ratings=opt=>{const proxy_country=opt.proxy_country,rules=opt.rules;const rule_ratings=opt.rule_ratings||[];const groups=opt.groups;const country_ratings=underscore__WEBPACK_IMPORTED_MODULE_0___default.a.find(rule_ratings,cr=>cr.proxy_country==proxy_country);if(country_ratings){_util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.forEach(country_ratings.rules,r=>{if(r.rating<=0)return;let r_rule=_util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.clone(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.find_rule(rules,r)||_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.find_rule(groups&&groups.unblocker_rules,r));if(!r_rule){r_rule=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_8___default.a.gen_rule({name:r.name,type:r.type,country:r.country,supported:true})}let rule=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.find_rule(rules,r_rule);if(!rule){if(!r_rule.root_url)return;rule=_util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.clone(r_rule);rules.push(rule)}rule.ratings=r})}rules.forEach(r=>{if(!r.ratings)r.ratings={rating:0,vote_up:0,vote_down:0}});rules.sort((r1,r2)=>r1.ratings.rating-r2.ratings.rating>0?-1:1);return rules};E.get_all_rules=opt=>{const proxy_country=opt.proxy_country.toLowerCase();const rule_ratings=opt.rule_ratings;const all_rules=opt.rules,url=opt.url,root_url=opt.root_url;let rules=_util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.clone(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.get_rules(all_rules,url)||[]);rules=underscore__WEBPACK_IMPORTED_MODULE_0___default.a.filter(rules,r=>r.country==proxy_country);rules=add_rule_ratings({proxy_country:proxy_country,rules:rules,root_url:root_url,url:url,rule_ratings:rule_ratings,groups:opt.groups});if(!underscore__WEBPACK_IMPORTED_MODULE_0___default.a.find(rules,r=>r.type=="url"&&r.name==root_url&&r.md5!="premium")){rules.push(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_8___default.a.gen_rule({name:root_url,country:proxy_country,supported:true,ratings:{rating:0,vote_up:0,vote_down:0}}))}return rules};E.is_conf_allowed=(on,id)=>{let random;if(!on)return false;id=id||"ext_rand_id";if(!(random=+_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(id)))_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.set(id,random=Math.random());return random<on};const open_tab=opt=>{const create_tab=url=>chrome.tabs.create({url:url,active:!!opt.force_active});const url=opt.url;if(opt.force_new)return create_tab(url);chrome.tabs.query(assign({lastFocusedWindow:true},opt.tab_match),tabs=>{if(!tabs||!tabs.length)return create_tab(url);if(opt.exclude_re&&opt.exclude_re.exec(tabs[0].url)){chrome.tabs.create({url:url,active:opt.force_active||false});return chrome.tabs.reload(tabs[0].id)}chrome.tabs.update(tabs[0].id,{url:url,active:true},tab=>{if(!tab)create_tab(url)})})};E.update_tab=(tab_id,url)=>chrome.tabs.update(tab_id,{url:url,active:true});E.open_new_tab=opt=>{const _opt=_util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.clone(opt);_opt.force_new=1;return open_tab(_opt)};E.open_hola_tab=opt=>{const _opt=_util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.clone(opt);_opt.tab_match=chrome?{url:"*://hola.org/*"}:{url_re:"^https?:\\/\\/hola\\.org\\/"};_opt.exclude_re=/hola\.org\/unblock\/([^/]*)\/using\/vpn-([^?/]*)$/gi;if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.browser()=="chrome"){_opt.tab_match.url=[_opt.tab_match.url,"*://chrome.google.com/*/"+chrome.runtime.id+"*"]}return open_tab(_opt)};E.open_be_tab=opt=>{opt=_util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.clone(opt);const url=chrome.runtime.getURL("").slice(0,-1);opt.tab_match={url:url+"/*"};if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.browser()!="firefox")opt.url="js/"+opt.url;return open_tab(opt)};E.Rules_set=class Rules_set{constructor(host,invert){this._data={};this._invert=!!invert;if(!host)return;this.add(host);let id,sets_map=_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.get_json("be_rules_sets")||{};if(!(id=sets_map[host]))return;Object.entries(sets_map).forEach(e=>{if(e[1]==id)this.add(e[0])})}add(host){if(!host)return;this._data[host]=1}to_array(){let data=this._data;return Object.keys(data).filter(k=>data[k])}save(){let sets_map=_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.get_json("be_rules_sets")||{};let id=+_util_date_js__WEBPACK_IMPORTED_MODULE_5___default()();Object.keys(this._data).forEach(host=>{if(!!this._data[host]^this._invert)sets_map[host]=id;else delete sets_map[host]});_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.set_json("be_rules_sets",sets_map)}};E.tabid2api=tabid=>{if(chrome&&typeof tabid=="string")tabid=+tabid;return tabid};E.upgrade_ext=function upgrade_ext(){_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.notice("upgrade_ext");if(!_util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.get(chrome,"runtime.requestUpdateCheck"))return;chrome.runtime.requestUpdateCheck(status=>_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.notice("update check: "+status))};const storage_get_fn=area=>items=>_util_etask_js__WEBPACK_IMPORTED_MODULE_6___default()((function*_storage_get_fn(){try{const data=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_6___default.a.cb_apply(chrome.storage[area],".get",[items]);if(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9___default.a.runtime.last_error||!data)storage_err("storage_"+area+"_get",data,_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9___default.a.runtime.last_error);return data}catch(e){storage_err("storage_"+area+"_get_catch",items,e)}}));const storage_set_fn=area=>items=>_util_etask_js__WEBPACK_IMPORTED_MODULE_6___default()((function*_storage_set_fn(){try{yield _util_etask_js__WEBPACK_IMPORTED_MODULE_6___default.a.cb_apply(chrome.storage[area],".set",[items]);if(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9___default.a.runtime.last_error)storage_err("storage_"+area+"_set",items,_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9___default.a.runtime.last_error);return items}catch(e){storage_err("storage_"+area+"_set_catch",items,e)}}));const storage_remove_fn=area=>items=>_util_etask_js__WEBPACK_IMPORTED_MODULE_6___default()((function*_storage_remove_fn(){yield _util_etask_js__WEBPACK_IMPORTED_MODULE_6___default.a.cb_apply(chrome.storage[area],".remove",[items]);if(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9___default.a.runtime.last_error)storage_err("storage_"+area+"_remove",items,_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9___default.a.runtime.last_error)}));let perr_sent;const storage_err=(name,items,err)=>{const s=_util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.get(err,"message");const msg=name+" "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.json(items)+" failed "+s+" "+(err&&err.stack);if(!perr_sent){perr_sent=true;const id=s=="The browser is shutting down."?"storage_browser_shutdown":"storage_lib_err";_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.perr(id,{name:name,items:items,err_str:err instanceof Error?_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.e2s(err):_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.json(err)},{err:err})}_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default()(msg);throw new Error(msg)};E.storage_local_get=storage_get_fn("local");E.storage_local_set=storage_set_fn("local");E.storage_local_remove=storage_remove_fn("local");E.get_site_storage=(root_url,path,def)=>{const key=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.get_site_key(root_url)||root_url;const data=_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.get_json("site_storage")||{};return _util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.get(data[key],path,def)};E.set_site_storage=(root_url,path,val)=>{const key=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.get_site_key(root_url)||root_url;const data=_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.get_json("site_storage")||{};data[key]=data[key]||{};_util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.set(data[key],path,val);_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.set_json("site_storage",data)};E.set_dbg_conf=(path,value)=>{const conf=_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.get_json("hola_conf")||{};_util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.set(conf,path,value);_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.set_json("hola_conf",conf)};E.get_dbg_conf=path=>_util_util_js__WEBPACK_IMPORTED_MODULE_1___default.a.get(_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.get_json("hola_conf"),path);const status_regex=/^HTTP\/(\d\.\d) (0|\d{3})( (.*))?$/;E.http_status_to_node=(code,line)=>{let n=(line||"").match(status_regex);if(!n){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.perr("bad_status_line",{code:code,line:line},{rate_limit:{count:2}});n=[null,"1.1",code," ",""]}return{httpVersion:n[1],statusCode:+n[2]||0,reasonPhrase:n[4]||"",headers:{}}};E.nodify_res=details=>{let ret=E.http_status_to_node(details.statusCode,details.statusLine);if(!details.responseHeaders)return ret;try{details.responseHeaders.forEach(hdr=>{ret.headers[hdr.name.toLowerCase()]=hdr.value})}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.perr("response_headers_error",{statusLine:details.statusLine,url:details.url,method:details.method,statusCode:details.statusCode},{rate_limit:{count:2}})}return ret};E.Bw_perr_acc=class Bw_perr_acc{constructor(){this.data={}}_send(bw_rule,acc){acc.id=bw_rule.id;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.perr("req_bw",{len:acc.len,ms:acc.ms,bw:acc.len*1e3/acc.ms,id:acc.id,country:acc.rule&&acc.rule.country});delete this.data[bw_rule.id]}push(bw_rule,req){let acc=this.data[bw_rule.id];if(acc&&acc.rule!=req.opt.rule)this._send(bw_rule,acc);acc=this.data[bw_rule.id]=this.data[bw_rule.id]||{len:0,ms:0,rule:req.opt.rule};acc.len+=+req.proxy_resp.len;acc.ms+=Date.now()-req.start_ts;if(acc.len>(bw_rule.sample_size||10*1024*1024))this._send(bw_rule,acc)}};E.create_window=({url:url,width:width,height:height})=>_util_etask_js__WEBPACK_IMPORTED_MODULE_6___default()((function*(){let cur_win=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_6___default.a.cb_apply(chrome.windows,".getCurrent",[]);if(!cur_win)return;if(cur_win.state=="fullscreen"&&_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.os_mac()){yield _util_etask_js__WEBPACK_IMPORTED_MODULE_6___default.a.cb_apply(chrome.windows,".update",[cur_win.id,{state:"normal"}]);yield _util_etask_js__WEBPACK_IMPORTED_MODULE_6___default.a.sleep(1e3);cur_win=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_6___default.a.cb_apply(chrome.windows,".getCurrent",[])}let opt={url:url,top:Math.round((cur_win.height-height)/2+cur_win.top),left:Math.round((cur_win.width-height)/2+cur_win.left),width:width,height:height,type:"popup",state:"normal"};if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.browser()!="firefox")opt.focused=true;return yield _util_etask_js__WEBPACK_IMPORTED_MODULE_6___default.a.cb_apply(chrome.windows,".create",[opt])}));__webpack_exports__["default"]=E},,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__);var _util_util_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_5__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_6__);var _util_date_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(16);var _util_date_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_7__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(35);var _util_storage_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(21);var _util_storage_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(36);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11__);var _svc_hola_pub_svc_ipc_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(63);var _svc_hola_pub_svc_ipc_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_svc_hola_pub_svc_ipc_js__WEBPACK_IMPORTED_MODULE_12__);var _util_url_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(18);var _util_url_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_13__);var conf__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(24);var conf__WEBPACK_IMPORTED_MODULE_14___namespace=__webpack_require__.t(24,1);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.assert_bg("be_info");const chrome=window.chrome;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default.a.task_model.extend({model_name:"info",_defaults:function(){this.on("destroy",()=>E.uninit())}}));const on_location=underscore__WEBPACK_IMPORTED_MODULE_0___default.a.debounce(()=>{const location=E.get("location");E.set("country",location?location.country:null);_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.set("src_country",E.get("country"))});E.init=()=>{if(E.get("inited"))return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.set_perr_cb(perr_res_cb);E.set("inited",true);E.set("vpn_work_yes",_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.get_int("vpn_work_yes"));E.set("vpn_last_rating",_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.get_int("vpn_last_rating"));E.set("rate_on_store",_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.get_int("rate_on_store"));E.set("location",_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.get_json("location"));E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.new_etask("be_info");E.on("recover",E.fetch_info);E.on_init("change:location",on_location);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a,"change:ext.active change:uuid change:ext.suspended",E.fetch_info);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a,"change:user_id",E.set_user_id);E.set("settings",_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.get_json("settings")||{});E.trigger("inited")};E.uninit=()=>{if(!E.get("inited"))return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.set_perr_cb();E.sp.return();E.off("change:location",on_location);E.off("recover",E.fetch_info);E.stopListening();E.clear()};const perr_res_cb=res=>{if(res&&res.ip&&res.country&&!(_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__["a"].is_active()&&_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__["a"].get_agent_fallback("perr"))){set_location(res)}};const set_location=opt=>{if(!opt)return;let{ip:ip,country:country}=opt;const location=E.get("location");if(location&&location.ip==ip&&location.country==country)return;E.set("location",{ip:ip,country:country});_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.set_json("location",{ip:ip,country:country})};const set_settings=settings=>{settings=settings||{};_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.set_json("settings",settings);E.set("settings",settings)};E.get_unblocking_rate_url=(limit,src_country)=>{src_country=(src_country||"").toLowerCase();const url=conf__WEBPACK_IMPORTED_MODULE_14__.url_ccgi+"/unblocking_rate";return _util_url_js__WEBPACK_IMPORTED_MODULE_13___default.a.qs_add(url,{src_country:src_country,limit:limit})};E.get_unblocking_rate=(limit,src_country)=>{src_country=(src_country||E.get("country")||"").toLowerCase();if(!src_country)return;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"get_unblocker_rate",cancel:true},(function*get_unblocking_rate_(){let err;for(let i=0;i<=1;i++){try{return yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__["a"].ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_14__.url_ccgi+"/unblocking_rate",data:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.qs_ajax({src_country:src_country,limit:limit})})}catch(e){err=e}}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_unblocking_rate_err",{},{err:err})}))};E.fetch_info=()=>E.trigger("fetch_info");E.on("fetch_info",()=>{if(!E.set_busy({desc:"Configuring..."}))return E.schedule_clr(["fetch_info"]);return E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"fetch_info",cancel:true},(function*(){try{_util_zerr_js__WEBPACK_IMPORTED_MODULE_6___default.a.notice("be_info: fetch_info");set_location(yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__["a"].get_location());E.clr_busy()}catch(err){E.set_err();_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_info_fetch_info_err",{},{err:err,rate_limit:{count:3}})}})))});E.set_user_id=()=>{E.trigger("set_user_id")};E.on("set_user_id",()=>{var user_id=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("user_id"),is_premium=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium");if(user_id===undefined)return;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()("set_user_id",(function*set_user_id_(){try{yield _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__["default"].update_info();const sync_data=!_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("info")?{missing_svc:true}:yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.all({token:get_user_sync_token()});const sync_token=sync_data.token;const missing_svc=sync_data.missing_svc;yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.all({allow_fail:true},{client:user_id&&_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__["a"].ccgi_ajax({qs:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.auth(),method:"POST",url:conf__WEBPACK_IMPORTED_MODULE_14__.url_ccgi+"/set_user_client.json",data:{user_id:user_id}}),svc:!missing_svc&&_svc_hola_pub_svc_ipc_js__WEBPACK_IMPORTED_MODULE_12___default.a.ajax({cmd:"user_token_update.json?token="+user_id+(is_premium?"&premium":"")+(sync_token?"&sync="+sync_token:"")})});if(user_id)E.trigger("user_id_set")}catch(err){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_info_set_user_id_err",{},{err:err})}}))});function fix_dont_show(data,root_url){var val=data[root_url];if(val&&val.period){data[root_url]={};data[root_url][val.type||"default"]=val;delete val.type}}const dont_show_count={};E.set_dont_show_again=opt=>{opt=_util_util_js__WEBPACK_IMPORTED_MODULE_5___default.a.clone(opt);const root_url=opt.root_url;if(!root_url)return;const type=opt.type||"default";if(opt.period=="session"){if(opt.src=="outside_click"){dont_show_count[root_url]=(dont_show_count[root_url]||0)+1;if(dont_show_count[root_url]<2)return}opt.period="1h"}if(opt.period=="default")opt.period=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get_dont_show_def_period();var settings=E.get("settings")||{};var data=settings.dont_show=settings.dont_show||{};fix_dont_show(data,root_url);if(opt.unset){if(data[root_url])delete data[root_url][type]}else{data[root_url]=data[root_url]||{};data[root_url][type]={ts_user:_util_date_js__WEBPACK_IMPORTED_MODULE_7___default.a.to_sql(new Date),period:opt.period,src:opt.src}}set_settings(settings);E.trigger("change:settings");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_set_dont_show_again",opt)};function _is_dont_show(val,type){if(val&&!val.period)val=val[type];if(!val)return false;if(val.period=="never")return true;const dur=val.period=="default"?_util_date_js__WEBPACK_IMPORTED_MODULE_7___default.a.ms.WEEK:_util_date_js__WEBPACK_IMPORTED_MODULE_7___default.a.str_to_dur(val.period);if(dur)return new Date-_util_date_js__WEBPACK_IMPORTED_MODULE_7___default.a.from_sql(val.ts_user)<dur;return false}E.is_dont_show=(root_url,type)=>{type=type||"default";const settings=E.get("settings");const data=settings&&settings.dont_show;return!!data&&(_is_dont_show(data.all,type)||_is_dont_show(data[root_url],type))};E.get_dont_show_rules=type=>{const res=[];type=type||"default";const settings=E.get("settings");const data=settings&&settings.dont_show||{};Object.keys(data).forEach(url=>{if(_is_dont_show(data[url],type))res.push(url)});return res};E.set_force_tpopup=(root_url,type)=>{var force=E.get("force_tpopup")||_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.get_json("force_tpopup")||{};force[root_url]={ts:_util_date_js__WEBPACK_IMPORTED_MODULE_7___default.a.to_sql(new Date),type:type};E.set("force_tpopup",force);_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.set_json("force_tpopup",force)};E.unset_force_tpopup=root_url=>{const force=E.get("force_tpopup")||_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.get_json("force_tpopup")||{};delete force[root_url];E.set("force_tpopup",force);_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.set_json("force_tpopup",force)};E.is_force_tpopup=root_url=>{const force=E.get("force_tpopup")||_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.get_json("force_tpopup")||{};if(!force||!force[root_url])return false;const _ts=force[root_url].ts;const type=force[root_url].type;if(!_ts)return false;const ts=_util_date_js__WEBPACK_IMPORTED_MODULE_7___default.a.from_sql(_ts);if(Date.now()-ts>30*_util_date_js__WEBPACK_IMPORTED_MODULE_7___default.a.ms.MIN)return false;return type||true};E.increment_vpn_work_yes=()=>{const counter=E.get("vpn_work_yes")+1;_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.set("vpn_work_yes",counter);E.set("vpn_work_yes",counter)};E.set_vpn_last_rating=rating=>{_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.set("vpn_last_rating",rating);E.set("vpn_last_rating",rating)};E.set_rate_on_store=ts=>{_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.set("rate_on_store",ts);E.set("rate_on_store",ts)};E.reset_rate_us=()=>{E.set_vpn_last_rating(0);E.set_rate_on_store(0);_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default.a.set("vpn_work_yes",0);E.set("vpn_work_yes",0)};var join_sessions_etask;function join_sessions(user){if(user.disable_account_changes)return;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()("join_sessions",(function*join_sessions_(){this.finally(()=>join_sessions_etask=undefined);join_sessions_etask=this;yield _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__["default"].update_info();let sync_token;try{if(!(sync_token=_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("sync_token")))return;return yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__["a"].hola_api_call("users/auth/token/join?token="+sync_token)}catch(e){}}))}function get_user_sync_token(){return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()("get_user_sync_token",(function*get_user_sync_token_(){yield join_sessions_etask;try{const data=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__["a"].hola_api_call("users/auth/token/generate");return data.token}catch(e){return""}}))}E.get_user_data=query=>{var last_res;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()("get_user_data",(function*get_user_data_(){const res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__["a"].hola_api_call("users/get_user",query);last_res=res||{};if(last_res.user){join_sessions(last_res.user);return last_res}yield _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__["default"].update_info();let sync_token;try{if(!(sync_token=_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("sync_token")))return last_res;yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__["a"].hola_api_call("users/auth/token/login?token="+sync_token,{method:"POST"})}catch(e){return last_res}const data=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__["a"].hola_api_call("users/get_user",query);return data||last_res}))};E.is_verified=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*is_verified_(){let res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__["a"].hola_api_call("users/is_verified");return res&&res.verified}));E.resend_verification_email=()=>_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__["a"].hola_api_call("users/send_email_verification",{method:"POST"});E.set_login_redirect=value=>chrome.cookies.set({value:value,url:"https://hola.org",name:"bext_login_origin",expirationDate:(Date.now()+5*_util_date_js__WEBPACK_IMPORTED_MODULE_7___default.a.ms.MIN)/1e3});E.set_email_verify_url=value=>chrome.cookies.set({value:value,url:"https://hola.org",name:"email_verify_next_url",expirationDate:(Date.now()+_util_date_js__WEBPACK_IMPORTED_MODULE_7___default.a.ms.HOUR)/1e3});__webpack_exports__["default"]=E},,function(module,__webpack_exports__,__webpack_require__){"use strict";var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(28);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4__);var _util_ajax_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(48);var _util_ajax_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_ajax_js__WEBPACK_IMPORTED_MODULE_5__);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(38);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_7__);var _util_escape_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(23);var _util_escape_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_escape_js__WEBPACK_IMPORTED_MODULE_8__);var _util_url_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(18);var _util_url_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10__);var _util_date_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(16);var _util_date_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_11__);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(27);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_util_version_util_js__WEBPACK_IMPORTED_MODULE_12__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13__);var _util_util_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_14__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(21);var _util_storage_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_15__);var _util_rand_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(61);var _util_rand_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_util_rand_js__WEBPACK_IMPORTED_MODULE_16__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(30);var conf__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(24);var conf__WEBPACK_IMPORTED_MODULE_18___namespace=__webpack_require__.t(24,1);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13___default.a.assert_bg("be_bg_ajax");let chrome=window.chrome;const assign=Object.assign;let bg_ajax,rand_subset=_util_rand_js__WEBPACK_IMPORTED_MODULE_16___default.a.rand_subset;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default.a.task_model.extend({model_name:"bg_ajax",_defaults:function(){this.on("destroy",()=>E.uninit())}}));let bext_config={},cloud_agents={url:"",agents:[]};const cookies={hola:{name:"connect.sid",url:"https://hola.org/"},svd:{name:"connect.sid",url:"https://svd-cdn.com/"},hvpn:{name:"connect.sid",url:"https://h-vpn.org/"}};const tests=["ccgi","hola","perr"];const ZG=_util_util_js__WEBPACK_IMPORTED_MODULE_14___default.a.get,ZS=_util_util_js__WEBPACK_IMPORTED_MODULE_14___default.a.set;function CGA(path,def){return ZG(bext_config.bg_ajax,path,def)}function CSA(path,val){return ZS(bext_config.bg_ajax,path,val)}_util_ajax_js__WEBPACK_IMPORTED_MODULE_5___default.a.events.on("timeout",()=>{_util_storage_js__WEBPACK_IMPORTED_MODULE_15___default.a.set("ajax_timeout",_util_storage_js__WEBPACK_IMPORTED_MODULE_15___default.a.get_int("ajax_timeout")+1)});function BgAjax(){}BgAjax.prototype.init=function(){var copy=opt=>{opt.mem_agents=(opt.mem_agents||[]).map(a=>({port:22224,ip:a.ip}));opt.build_agents=(opt.build_agents||[]).map(a=>underscore__WEBPACK_IMPORTED_MODULE_0___default.a.pick(a,"ip","port"));return opt};var perr=opt=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.perr(opt.id,opt.info,opt);var def={ignore:[],api:{perr:perr,ajax_via_proxy:E.be_tab_unblocker.ajax_via_proxy},dbg_logs:CGA("dbg_logs")};var agents_opt={mem_agents:E.be_tab_unblocker.get_all_agents(),build_agents:rand_subset(conf__WEBPACK_IMPORTED_MODULE_18__.agents,conf__WEBPACK_IMPORTED_MODULE_18__.agents.length),cloud_agents:this.load_agents.bind(this)};var agents=Object.keys(agents_opt),direct=["hola","svd","hvpn"];direct.concat(agents).forEach(name=>{if(CGA("disable_"+name))def.ignore.push(name)});if(CGA("disable_agents"))def.ignore=def.ignore.concat(agents).concat("common_agents");var client_uri=CGA("client_uri","");var opt=assign({def_url:conf__WEBPACK_IMPORTED_MODULE_18__.url_ccgi,hola:"client.hola.org"+client_uri,svd:"client.svd-cdn.com"+client_uri,hvpn:"client.h-vpn.org"+client_uri},def,agents_opt,{ignore:def.ignore.concat(direct).concat("common_agents")});this.agents_check=new _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default.a.ConnectivityCheck(copy(opt));def.common_agents=this.agents_check;opt=assign({def_url:conf__WEBPACK_IMPORTED_MODULE_18__.url_ccgi,hola:"client.hola.org"+client_uri,svd:"client.svd-cdn.com"+client_uri,hvpn:"client.h-vpn.org"+client_uri},def);this.ccgi_check=new _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default.a.ConnectivityCheck(copy(opt));opt=assign({def_url:"https://hola.org/",hola:"hola.org",svd:"svd-cdn.com",hvpn:"h-vpn.org"},def);this.hola_check=new _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default.a.ConnectivityCheck(copy(opt));opt=assign({def_url:conf__WEBPACK_IMPORTED_MODULE_18__.url_perr,hola:"perr.hola.org/perr",svd:"perr.svd-cdn.com/perr",hvpn:"perr.h-vpn.org/perr"},def);this.perr_check=new _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default.a.ConnectivityCheck(copy(opt));this.inited=true};BgAjax.prototype.uninit=function(){var _this=this;this.inited=false;tests.forEach((function(name){name+="_check";if(_this[name])_this[name]=_this[name].uninit()}));if(this.agents_check)this.agents_check=this.agents_check.uninit();if(cloud_agents.et)cloud_agents.et.return();if(this.cookies_et)this.cookies_et.return();E.be_tab_unblocker.uninit_ajax_via_proxy();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default.a.set("bg_ajax.is_active",false)};BgAjax.prototype.load_agents=function(){var url=CGA("agents_url","https://www.dropbox.com/s/gax1dzeite0b2x7/cloud_agents.conf?dl=1");if(!url||url==cloud_agents.url&&!cloud_agents.et)return cloud_agents.agents;return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()({name:"load_agents",cancel:true,async:true},(function*load_agents_(){this.finally(()=>delete cloud_agents.et);let res;if(cloud_agents.et)res=yield this.wait_ext(cloud_agents.et);else{assign(cloud_agents,{agents:[],url:url,et:this});res=yield _util_ajax_js__WEBPACK_IMPORTED_MODULE_5___default()({url:url,text:1})}if(!res||cloud_agents.agents.length)return cloud_agents.agents;try{res=res.substr(res.length-4)+res.substr(0,res.length-4);res=JSON.parse(atob(res));res=res instanceof Array?res:res.agents;cloud_agents.agents=rand_subset(res,res.length)}catch(e){}return cloud_agents.agents}))};const get_query_params=qs=>{if(!qs)return;let res={};qs=typeof qs=="object"?qs:_util_url_js__WEBPACK_IMPORTED_MODULE_9___default.a.qs_parse(qs);for(let p in qs){if(qs[p]===undefined)continue;res[p]=qs[p]}return res};BgAjax.prototype._ajax=function(bg_info,req){var burl=_util_url_js__WEBPACK_IMPORTED_MODULE_9___default.a.parse(bg_info.url),rurl=_util_url_js__WEBPACK_IMPORTED_MODULE_9___default.a.parse(req.url);var url="https://"+burl.hostname+rurl.path;if(req.qs)url=_util_url_js__WEBPACK_IMPORTED_MODULE_9___default.a.qs_add(url,get_query_params(req.qs));if(!bg_info.agent){req=underscore__WEBPACK_IMPORTED_MODULE_0___default.a.omit(req,"url","qs");req.url=url;return _util_ajax_js__WEBPACK_IMPORTED_MODULE_5___default()(req)}var opt=assign({always:true,ignore_redir:true,hdrs:{"Cache-Control":"no-cache,no-store,must-revalidate,"+"max-age=-1"},force_headers:true,fix_307:true,src:"bg_ajax",agent:bg_info.agent,force:"proxy",prot:"proxy"},underscore__WEBPACK_IMPORTED_MODULE_0___default.a.pick(req,"data","with_credentials"));var method=req.method||"GET";if(opt.data){if(method=="GET"){url=_util_url_js__WEBPACK_IMPORTED_MODULE_9___default.a.qs_add(url,get_query_params(opt.data));delete opt.data}else{if(typeof opt.data=="object")opt.data=_util_escape_js__WEBPACK_IMPORTED_MODULE_8___default.a.qs(opt.data);opt.hdrs["Content-Type"]="application/x-www-form-urlencoded; "+"charset=UTF-8"}}var t=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13___default.a.set_timeout(()=>et.throw(new Error(bg_info.agent.ip+" timeout")),req.timeout||20*_util_date_js__WEBPACK_IMPORTED_MODULE_11___default.a.ms.SEC);var et=_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()({cancel:true},(function*ajax_via_proxy_(){this.finally(()=>_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13___default.a.clear_timeout(t));let res=yield E.be_tab_unblocker.ajax_via_proxy({url:url,type:method},opt);res=res||{};let err;if(err=res.orig_res&&res.orig_res.error){if(opt.no_throw)return{err:err,status:res.status||0};throw new Error(bg_info.agent.ip+" "+err)}try{res=res.data&&req.json?JSON.parse(res.data):res.data}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default()(_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default.a.e2s(e))}return res}));return et};BgAjax.prototype.update_cookies=function(){var _this=this;return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()({name:"update_cookies",cancel:true},(function*(){if(_this.cookies_et)return yield this.wait_ext(_this.cookies_et);_this.cookies_et=_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*cookies_et_(){try{const res=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default.a.all({allow_fail:true},{hola:_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default.a.cb_apply(chrome.cookies,".get",[cookies.hola]),svd:_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default.a.cb_apply(chrome.cookies,".get",[cookies.svd]),hvpn:_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default.a.cb_apply(chrome.cookies,".get",[cookies.hvpn])});if(!res.hola&&!res.svd&&!res.hvpn||res.hola&&res.svd&&res.hvpn&&res.hola.value==res.svd.value&&res.hola.value==res.hvpn.value){return this.return()}let exp=[];for(let c in cookies){if(res[c]&&res[c].expirationDate)exp.push({name:c,date:res[c].expirationDate})}exp=exp.sort((a,b)=>b.date-a.date)[0];for(let c in cookies){if(res[c]&&res[c].expirationDate==exp.date)continue;yield _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default.a.cb_apply(chrome.cookies,".set",[assign(_util_util_js__WEBPACK_IMPORTED_MODULE_14___default.a.pick(res[exp.name],"expirationDate","sameSite","value","httpOnly"),cookies[c])])}}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default()(_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default.a.e2s(e))}finally{delete _this.cookies_et}}));return yield _this.cookies_et}))};BgAjax.prototype.make_ajax=function(e,req){if(e.selected)return this._ajax(e.get_backend_link(),req);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default.a.set("bg_ajax.is_active",true);var _this=this;return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*make_ajax_(){if(e.run_et)yield this.wait_ext(e.run_et);else{this.finally(()=>e.run_et=undefined);yield E.be_tab_unblocker.init_ajax_via_proxy();e.run_et=e.run();yield e.run_et}return yield _this._ajax(e.get_backend_link(),req)}))};BgAjax.prototype.ccgi_ajax=function(req){return this.make_ajax(this.ccgi_check,req)};BgAjax.prototype.hola_ajax=function(req){const _this=this,hc=this.hola_check;return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*hola_ajax_(){let link;if(hc.selected&&(link=hc.get_backend_link())&&!link.agent)yield _this.update_cookies();return yield _this.make_ajax(hc,req)}))};BgAjax.prototype.perr_ajax=function(req){return this.make_ajax(this.perr_check,req)};BgAjax.prototype.reset=function(type){let c=type+"_check",now=Date.now();if(!this[c]||this[c].error_ts&&now-this[c].error_ts<5*_util_date_js__WEBPACK_IMPORTED_MODULE_11___default.a.ms.MIN)return;this[c].reset();this[c].error_ts=now};const ajax_slow_perr=opt=>{if(CGA("disable_slow_perr"))return;try{let{duration:duration,url:url}=opt;let item,items=performance&&performance.getEntriesByType?performance.getEntriesByType("resource"):[];for(let i=items.length-1;i>=0;i--){if(items[i].name==url){item=items[i];break}}let timing=item?underscore__WEBPACK_IMPORTED_MODULE_0___default.a.omit(item.toJSON(),"name"):{duration:duration};_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.perr("be_bg_ajax_slow",{url:url,timing:timing})}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default()(_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default.a.e2s(e))}};function _ajax(req,type){req=assign({json:!req.text},req);return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*_ajax_(){try{let t0=Date.now();const name=type+"_ajax";let res=bg_ajax&&bg_ajax.inited&&bg_ajax[name]?yield bg_ajax[name](req):yield _util_ajax_js__WEBPACK_IMPORTED_MODULE_5___default()(req);let duration=Date.now()-t0;if(duration>(req.slow||2*_util_date_js__WEBPACK_IMPORTED_MODULE_11___default.a.ms.SEC)&&(type!="perr"||type=="perr"&&_util_util_js__WEBPACK_IMPORTED_MODULE_14___default.a.get(req,"qs.id")!="be_bg_ajax_slow")){let url=req.qs?_util_url_js__WEBPACK_IMPORTED_MODULE_9___default.a.qs_add(req.url,req.qs):req.url;ajax_slow_perr({duration:duration,url:url})}return res}catch(e){let is_on=CGA("enable");if(is_on&&bg_ajax){if(E.get_agent_fallback(type)){bg_ajax.reset("agents");for(let t of tests){if(t!=type&&E.get_agent_fallback(t))bg_ajax.reset(t)}}bg_ajax.reset(type)}else if(!is_on&&bg_ajax)bg_ajax=bg_ajax.uninit();throw e}}))}const get_myip=proxy=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*_get_myip(){try{return yield _util_ajax_js__WEBPACK_IMPORTED_MODULE_5___default()({url:`http://${proxy.ip}:${proxy.port}/myip`,retry:3,expect:200,json:true})}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default()("failed to detect location - "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default.a.e2s(e))}}));E.is_agent_fallback=()=>{for(let t of tests){if(E.get_agent_fallback(t))return true}};E.get_agent_fallback=name=>{name=name||"ccgi";let e=bg_ajax&&bg_ajax[name+"_check"];return e&&e.selected&&e.get_backend_link().agent};E.get_location=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*get_location(){let info,agent;if(agent=E.get_agent_fallback())return yield get_myip(agent);try{info=yield E.ccgi_ajax({qs:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default.a.auth(),url:conf__WEBPACK_IMPORTED_MODULE_18__.url_ccgi+"/fetch_info",retry:1})}catch(e){}if(agent=E.get_agent_fallback())return yield get_myip(agent);return(info||{}).req}));E.is_active=()=>_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default.a.get("bg_ajax.is_active");E.ccgi_ajax=req=>_ajax(req,"ccgi");E.hola_ajax=req=>_ajax(req,"hola");E.perr_ajax=req=>_ajax(req,"perr");E.ajax=(req,type)=>{type=type||(_util_url_js__WEBPACK_IMPORTED_MODULE_9___default.a.parse(req.url).hostname||"").split(".")[0];if(type=="client")type="ccgi";return _ajax(req,type)};function update_config(){bext_config=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default.a.get("bext_config")||{};var s;if((s=CGA("on"))&&_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__["default"].is_conf_allowed(s))CSA("enable",true);if((s=CGA("min_version"))&&_util_version_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.cmp(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.version(),s)<0)CSA("enable",false);if(CGA("enable"))init();else uninit()}E.init=function(be_tab_unblocker){E.uninit();chrome=window.chrome;if(E.be_tab_unblocker=be_tab_unblocker)E.be_tab_unblocker.be_bg_ajax=this;E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default.a,"change:bext_config",update_config);update_config()};E.reset=function(force){if(!bg_ajax&&!force)return;if(bg_ajax)bg_ajax.uninit();bg_ajax=new BgAjax;bg_ajax.init()};function init(){if(bg_ajax||!CGA("enable"))return;bg_ajax=new BgAjax;bg_ajax.init();_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.set_ajax_cb(req=>E.perr_ajax(req))}function is_dev_build(){return _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.browser()=="chrome"&&_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2___default.a.runtime.id!="gkojfkhlekighikafcpjkiklfbnlmeio"||_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.browser()=="opera"&&_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2___default.a.runtime.id!="ekmmelpnmfdegjhnmadddcfjcahpajnm"||_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.browser()=="edge"&&_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2___default.a.runtime.id!="nfjgmgjhcihmkobljembcfodkajehoej"}E.hola_api_call=(path,opt)=>{opt=opt||{};opt.method=opt.method||"GET";const xsrf_header=(conf__WEBPACK_IMPORTED_MODULE_18__.firefox_web_ext||is_dev_build())&&!["GET","HEAD","OPTIONS"].includes(opt.method);return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*hola_api_call_(){const c=!xsrf_header?undefined:yield _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default.a.cb_apply(chrome.cookies,".get",[{url:"https://hola.org/",name:"XSRF-TOKEN"}]);return yield E.hola_ajax({url:"https://hola.org/"+path,data:opt.data,method:opt.method,headers:c&&{"x-xsrf-token":c.value},text:opt.text,json:!opt.text,with_credentials:true})}))};function uninit(){if(bg_ajax)bg_ajax=bg_ajax.uninit();_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.set_ajax_cb()}E.uninit=()=>{uninit();E.stopListening()};if(_util_util_js__WEBPACK_IMPORTED_MODULE_14___default.a.is_mocha())E.t={BgAjax:BgAjax};__webpack_exports__["a"]=E},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_1__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__);var _util_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_4__);var underscore__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(15);var underscore__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_5__);var _util_date_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(16);var _util_date_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_6__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_7__);var _svc_hola_pub_svc_ipc_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(63);var _svc_hola_pub_svc_ipc_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_svc_hola_pub_svc_ipc_js__WEBPACK_IMPORTED_MODULE_8__);var _svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(92);var _svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_9__);var _util_escape_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(23);var _util_escape_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_util_escape_js__WEBPACK_IMPORTED_MODULE_10__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(35);var conf__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(24);var conf__WEBPACK_IMPORTED_MODULE_12___namespace=__webpack_require__.t(24,1);
// LICENSE_CODE ZON
const chrome=window.chrome;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default.a.task_model.extend({model_name:"svc",_defaults:function(){this.on("destroy",()=>E.uninit())}}));function firefox_origin_fix(details){if(details.requestHeaders.find(h=>h.name.toLowerCase()=="origin"))return;var fix={name:"Origin",value:"resource://ff_ext-at-hola-dot-org"};return{requestHeaders:[fix].concat(details.requestHeaders)}}E.init=be_vpn=>{if(E.inited)return;E.inited=true;if(conf__WEBPACK_IMPORTED_MODULE_12__.firefox_web_ext){chrome.webRequest.onBeforeSendHeaders.addListener(firefox_origin_fix,{urls:["*://127.0.0.1/*","*://localhost.h-local.org/*"]},["blocking","requestHeaders"])}E.svc_mon.init();E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a,"change:bext_config",()=>{let bext_config=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("bext_config");let use_new_monitor=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(bext_config,"svc.use_new_monitor");if(use_new_monitor&&E.svc_mon!=E.svc_mon_new||!use_new_monitor&&E.svc_mon!=E.svc_mon_old){E.svc_mon.uninit();E.svc_mon=use_new_monitor?E.svc_mon_new:E.svc_mon_old;E.svc_mon.init()}});if(!(E.be_vpn=be_vpn))return;E.listenTo(E.be_vpn,"change:protect_pc",()=>{if(!E.be_vpn.get("protect_pc"))return E.svc_mon.stop_watch_vpn_status();E.svc_mon.reset()})};E.uninit=()=>{E.inited=false;if(conf__WEBPACK_IMPORTED_MODULE_12__.firefox_web_ext){chrome.webRequest.onBeforeSendHeaders.removeListener(firefox_origin_fix)}E.stopListening();E.svc_mon.uninit();E.clear()};E.svc_mon=E.svc_mon_old=(EE=>{EE.init=()=>{if(EE.inited)return;EE.monitor=_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()("svc_init",(function*svc_init_(){while(true){yield E.update_info();yield _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.sleep(10*_util_date_js__WEBPACK_IMPORTED_MODULE_6___default.a.ms.MIN)}}));EE.inited=true};EE.reset=()=>{EE.uninit();EE.init()};EE.watch_vpn_status=()=>{if(EE.vs_sp)return;return EE.vs_sp=_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({name:"watch_vpn_status",cancel:true},(function*watch_vpn_status_loop_(){this.finally(()=>{set_status("ready",undefined);EE.stop_watch_vpn_status()});while(true){let status=yield EE.query_api("vpn_status",undefined,{timeout:30*_util_date_js__WEBPACK_IMPORTED_MODULE_6___default.a.ms.SEC});status=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(status,"ret")||{};yield parse_vpn_status(status);yield _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.sleep(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium")?1*_util_date_js__WEBPACK_IMPORTED_MODULE_6___default.a.ms.SEC:10*_util_date_js__WEBPACK_IMPORTED_MODULE_6___default.a.ms.SEC)}}))};EE.stop_watch_vpn_status=()=>{if(!EE.vs_sp)return;EE.vs_sp=void EE.vs_sp.return()};EE.query_api=(cmd,params,opt)=>{params=params?`?${_util_escape_js__WEBPACK_IMPORTED_MODULE_10___default.a.qs(params)}`:"";cmd=`${cmd}.json${params}`;return _svc_hola_pub_svc_ipc_js__WEBPACK_IMPORTED_MODULE_8___default.a.ajax(Object.assign({cmd:cmd},opt))};EE.uninit=()=>{if(!EE.inited)return;if(EE.monitor){EE.monitor.return();EE.monitor=null}EE.stop_watch_vpn_status();EE.inited=false};return EE})({});E.svc_mon_new=(EE=>{EE.init=()=>{if(EE.inited)return;_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_9___default.a.init({components:["vpn","client"],detecting_start_interval:1,detecting_start_retries:10,detecting_interval:600,monitoring_interval:60,log:str=>_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default.a.notice("svc_monitor: "+str),perr:(id,info)=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2___default.a.perr(id,info),watch:data=>E.update_info(()=>transform_callback_data(data))});EE.inited=true};EE.reset=()=>_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_9___default.a.refresh_info();EE.watch_vpn_status=()=>{if(EE.vs_watching)return;let monitoring_interval=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium")?1:10;_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_9___default.a.reconf({monitoring_interval:monitoring_interval});EE.vs_watching=true};EE.stop_watch_vpn_status=()=>{if(!EE.vs_watching)return;_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_9___default.a.reconf({monitoring_interval:60});EE.vs_watching=false};EE.query_api=(cmd,params)=>_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_9___default.a.exec(cmd,params);EE.uninit=()=>{if(!EE.inited)return;_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_9___default.a.uninit();EE.inited=false};return EE})({});const transform_callback_data=data=>{if(!data)throw"no data";let ret={status:{}};ret.raw=data;if(data.connected_js)ret.proxyjs_connected=true;if(data.full_vpn)ret.status.full_vpn=data.full_vpn;return Object.assign(ret,{cid_js:data.cid_js||"",version:data.ver||"0.0.0",os_ver:data.os_ver,session_key_js:data.session_key_js,user_token:data.user_token,sync_token:data.sync_token||"",svc:1})};E.update_info=provider=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()("update_info",(function*update_info_(){try{const info=provider?provider():yield E.callback();if(info&&E.be_vpn&&E.be_vpn.get("protect_pc")){if(info.svc){if(info.status.full_vpn)parse_vpn_status(info.status.full_vpn);E.svc_mon.watch_vpn_status()}else E.svc_mon.stop_watch_vpn_status()}if(underscore__WEBPACK_IMPORTED_MODULE_5___default.a.isEqual(info,E.get("info")))return info;let change={};change.info=info;change.cid_js=info.cid_js;change.proxyjs_connected=info.proxyjs_connected;change.version=info.version;change.session_key_cid_js=info.session_key_js;change.user_token=info.user_token;change.sync_token=info.sync_token||"";change.callback_raw=info.raw;change.callback_ts=_util_date_js__WEBPACK_IMPORTED_MODULE_6___default()();E.safe_set(change);return info}catch(e){E.safe_set({info:null,cid_js:"",session_key_cid_js:0,sync_token:"",callback_raw:null,callback_ts:null,version:null})}}));E.callback=function(opt){opt=opt||{};window.disable_svc_polling=window.disable_svc_polling||0;return _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()("callback",[function try_catch$(){if(window.disable_svc_polling||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.is_disabled())return this.return(_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.err("not running"));return E.svc_mon.query_api("callback",opt.full_vpn&&{vpn:1})},function(ret){let data=ret&&ret.ret;if(this.error||!data){console.log("Use window.disable_svc_polling = 1 to stop polling");return this.return(_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.err("not running"))}if(opt.raw)return this.return(data);data=transform_callback_data(data);return this.return(data)}])};const ensure_vpn_info=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({name:"ensure_vpn_info"},[function try_catch$(){return _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_11__["a"].hola_api_call("users/ensure_vpn_info")},function(info){if(this.error||!info){return void _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2___default.a.perr("ensure_vpn_info_fail",{},{err:this.error})}var vpn_info=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.pick(info,"login","password");E.set("vpn_info",vpn_info);return vpn_info}]);const parse_vpn_status=status=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*_parse_vpn_status(){let connecting=!!status.connecting_to;let connected=!!status.connected_to;let country=status.connecting_to||status.connected_to||"";let active=(connecting||status.disconnecting)&&!connected;if(E.get("status")!="ready"&&connected)yield update_location();set_status(active?"busy":"ready",country.toLowerCase())}));const set_status=(status,country)=>{if(country!==undefined){if(country=="uk")country="gb";E.set("vpn_country",country)}E.set("status",status||"ready");E.trigger("update_vpn_status")};E.vpn_connect=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*vpn_connect_(){try{opt=opt||{};const country=(opt.country||"").toLowerCase();const vpn_info=E.get("vpn_info")||(yield ensure_vpn_info());if(!vpn_info)return void set_status("ready","");set_status("busy",country,"vpn_connect");return yield E.svc_mon.query_api("vpn_connect",{host:country+".vpn.hola.org",username:vpn_info.login,password:vpn_info.password,country:country})}catch(e){set_status("ready","");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2___default.a.perr("vpn_connect",{},{err:e})}}));E.vpn_disconnect=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*vpn_disconnect_(){this.finally(()=>set_status());try{set_status("busy","");return yield E.svc_mon.query_api("vpn_disconnect")}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2___default.a.perr("vpn_disconnect",{},{err:e})}}));E.vpn_change_agent=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*vpn_change_agent_(){this.finally(()=>set_status());try{set_status("busy");return yield E.svc_mon.query_api("vpn_change_agent")}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2___default.a.perr("vpn_change_agent",{},{err:e})}}));let ul_sp;function update_location(){if(ul_sp)return ul_sp;return ul_sp=_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({name:"update_location"},(function*call_myip_(){let res;for(let i=0;i<5;i++){try{res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_11__["a"].hola_api_call("myip.json",{timeout:5*_util_date_js__WEBPACK_IMPORTED_MODULE_6___default.a.ms.SEC});break}catch(e){yield _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.sleep(_util_date_js__WEBPACK_IMPORTED_MODULE_6___default.a.ms.SEC)}}ul_sp=undefined;return res}))}__webpack_exports__["default"]=E},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_1__);var _util_date_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(16);var _util_date_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_2__);var _util_escape_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(23);var _util_escape_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_escape_js__WEBPACK_IMPORTED_MODULE_3__);var _svc_account_pub_membership_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(60);var _svc_account_pub_membership_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_svc_account_pub_membership_js__WEBPACK_IMPORTED_MODULE_4__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_6__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(35);var _util_util_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(50);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(27);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_util_version_util_js__WEBPACK_IMPORTED_MODULE_11__);var _bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(76);var _bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_12__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(33);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(30);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_15__);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9___default.a.assert_bg("be_premium");const chrome=window.chrome,assign=Object.assign;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default.a.task_model.extend({model_name:"premium",_defaults:function(){this.on("destroy",()=>E.uninit())}}));let membership_timeout,daily_refresh_timer;const test_users=["deploy@hola.org","qa.hola@gmail.com","qa.hola2@gmail.com","yulia@hola.org","holaplus.payment@gmail.com","holavpntests@gmail.com","deploy.vpnext@gmail.com","nikita+2@hola.org","nikita+vpn@hola.org"];E.is_active=()=>_svc_account_pub_membership_js__WEBPACK_IMPORTED_MODULE_4___default.a.is_active(E.get("membership"));E.is_paid=()=>_svc_account_pub_membership_js__WEBPACK_IMPORTED_MODULE_4___default.a.is_paid(E.get("membership"));E.logout_user=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*logout_user(){E.be_rule.disable_premium();yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_7__["a"].hola_api_call("users/logout/inline",{method:"POST",text:true});set_user(null);E.set("membership",null);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.set("is_premium",false)}));const set_user=user=>{let email;if(user&&user.user)email=_util_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get(user.user.emails,"0.value");E.set("is_test_user",+test_users.includes(email));_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.set("user_id",_util_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get(user,"user._id",""));_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.set("hola_uid",_util_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get(user,"user.hola_uid"));E.set("user",user&&user.user)};var last_refreshed=0;E.refresh_user=opt=>{opt=assign({},opt);let user_id=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("user_id");var now;_util_zerr_js__WEBPACK_IMPORTED_MODULE_15___default.a.notice("be_premium: refresh_user %O",opt);if((now=Date.now())-last_refreshed<300){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.perr("refresh_user_multiple",{user_id:user_id},{rate_limit:{count:2},err:new Error,with_log:true})}last_refreshed=now;if(refresh_user_et)refresh_user_et.return();return _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({name:"refresh_user",cancel:true},(function*(){try{const _user=yield _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_13__["default"].get_user_data({data:{uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("uuid"),source:"be_premium"}});set_user(_user);let _membership;if(user_id!=_util_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get(_user,"user._id")||opt.force_premium){_membership=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_7__["a"].hola_api_call("users/payment/get_membership?ver="+_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.version())}else _membership=yield E.get("membership");const old_is_active=E.is_active();E.set("membership",_membership);let is_active=E.is_active();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.set("is_premium",is_active);_bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_10__["default"].set_plus(is_active);if(!is_active&&old_is_active)E.be_rule.disable_premium();return _membership}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.perr("refresh_user_fail",{},{err:e});_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9___default.a.clear_timeout(membership_timeout);membership_timeout=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9___default.a.set_timeout(()=>E.sp.spawn(E.refresh_user(opt)),Math.random()*_util_date_js__WEBPACK_IMPORTED_MODULE_2___default.a.ms.HOUR)}finally{E.trigger("user_updated")}}))};let refresh_user_et;E.schedule_refresh_user=opt=>{if(refresh_user_et)refresh_user_et.return();_util_zerr_js__WEBPACK_IMPORTED_MODULE_15___default.a.notice("be_premium: schedule_refresh_user %O",opt);E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*schedule_refresh_user_(){refresh_user_et=this;this.finally(()=>{refresh_user_et=null});yield _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.sleep(1e3);yield E.refresh_user(opt)})))};function is_blacklist(root_url){if(!root_url)return false;if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("is_premium"))return false;const blacklist=(E.be_rule.get("rules")||{}).blacklist||{};return blacklist[root_url]}E.get_force_premium_rule=(root_url,opt)=>{let rule;if(is_blacklist(root_url)){rule={id:root_url,domain:new RegExp(root_url),blacklist:true};return rule}opt=opt||{};rule=_bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.find_rule(root_url,_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("bext_config"),"force_premium",_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_13__["default"].get("country"));if(!rule)return false;const install_ver=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("install_version");if(!opt.ignore_install_version&&rule.install_ver_min&&install_ver&&_util_version_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.cmp(install_ver,rule.install_ver_min)<0){return false}if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.get_site_conf(root_url,"trial"))return false;return rule};E.get_force_premium_rules=(root_urls,opt)=>root_urls.map(root_url=>E.get_force_premium_rule(root_url,opt));const info_inited_cb=()=>{if(_util_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.is_mocha()&&last_refreshed)return;E.sp.spawn(E.refresh_user())};let login_popup_id;E.open_login_popup=({method:method,signup:signup,root_url:root_url})=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*(){try{let next=chrome.runtime.getURL("")+"js/login_done.html";let qs=method=="email"?_util_escape_js__WEBPACK_IMPORTED_MODULE_3___default.a.qs({next:next,hide_social:1,signup:signup?1:undefined,uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("uuid"),root_url:root_url,ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.version()}):_util_escape_js__WEBPACK_IMPORTED_MODULE_3___default.a.qs({next:next});let url=method=="email"?`https://hola.org/bext_login?${qs}`:`https://hola.org/users/auth/${method}/popup?${qs}`;_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_13__["default"].set_login_redirect(new URL(next).hostname);yield close_login_popup();let win=yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_14__["default"].create_window({width:500,height:500,url:url});login_popup_id=win.id}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.perr("be_open_login_popup_err",{method:method,signup:signup,root_url:root_url},{err:e})}}));const close_login_popup=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*(){if(!login_popup_id)return;yield _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.cb_apply(chrome.windows,".remove",[login_popup_id]);login_popup_id=null}));E.login_popup_done=()=>{E.refresh_user({reason:"login_popup_done"});close_login_popup()};E.init=be_rule=>{if(E.inited)return;E.inited=true;E.be_rule=be_rule;E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9___default.a.new_etask("be_premium");if(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_13__["default"].get("inited"))info_inited_cb();else _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_13__["default"].on("inited",info_inited_cb);daily_refresh_timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9___default.a.set_interval(E.refresh_user.bind(E,{force_premium:true}),_util_date_js__WEBPACK_IMPORTED_MODULE_2___default.a.ms.DAY,{sp:E.sp,name:"refresh_user"})};E.uninit=()=>{E.inited=false;_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_13__["default"].off("inited",info_inited_cb);E.sp.return();_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9___default.a.clear_timeout(membership_timeout);_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9___default.a.clear_interval(daily_refresh_timer);last_refreshed=0;close_login_popup();E.clear()};__webpack_exports__["default"]=E},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){let is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(16),__webpack_require__(73),__webpack_require__(23),__webpack_require__(18),__webpack_require__(10),__webpack_require__(12),__webpack_require__(11),__webpack_require__(22),__webpack_require__(27),__webpack_require__(43),__webpack_require__(26),__webpack_require__(46),__webpack_require__(61)],__WEBPACK_AMD_DEFINE_RESULT__=function(date,zbrowser,zescape,zurl,zutil,zerr,etask,svc_vpn_util,version_util,events,array,rate_limit,rand){const E=new events.EventEmitter;const assign=Object.assign,ms=date.ms;const CACHE_TTL=ms.MIN,POLICY_TTL=5*ms.MIN,SEC=ms.SEC;const gen_ping_id=id=>id||(zutil.is_mocha()?"1111":Math.random());const ctx=[];const extensions={archive:zutil.bool_lookup("7z apk arj bin bz deb dmg exe gz iso msi rar rpm tbz tgz xz zip"),media:zutil.bool_lookup("3gp avi f4v flv h264 m4a m4s m4v mkv mov mp3 mp4 ogg ogv swf ts wav "+"webm wmv"),static:zutil.bool_lookup("css eot gif ico jar jpeg jpg png svg svgz ttf webp woff")};const expected_types={archive:/^application\/(?!json$)/,media:/^((audio|video)\/|application\/octet-stream$)/};const CG=(s,def)=>api.conf_get&&api.conf_get(s,def);let cache={};let peer_domain_re;let user_plus=false;let _app_trial_mode=false;let active_reqs=[];let conf_rand_id;let hola_uid;let proxy_rules_engine;function ext_ver(){return(api.get_prod_info()||{}).ext_ver}function product_ver(){let info=api.get_prod_info()||{};return info.ext_ver||info.apk_ver||info.svc_ver}function get_strategy(strategy,ex,opt){opt=opt||{};if(!ex)return strategy;if(opt.country){ex=ex.replace(new RegExp("\\b"+zescape.regex(opt.country)+"\\b"),"XX")}let m;if(m=ex.match(/PROXY XX\.POOL_(\w+)/)){m=m[1];ex="PROXY XX.POOL"}switch(ex){case"DIRECT":strategy={name:"direct"};break;case"PROXY XX":strategy.name="proxy";break;case"PROXY XX.direct_first":strategy.name="direct_first";break;case"PROXY XX.PEER":strategy.name="proxy";strategy.peer=true;break;case"PROXY XX.POOL":strategy.name="proxy";strategy.pool=m||true;break}return strategy}E.get_rule_strategy=(s,url,opt)=>{if(!url&&(opt.root_url||opt.src_country))url={orig:"",hostname:""};else if(!url||!url.hostname)return s;let ex=null;if(proxy_rules_engine){ex=proxy_rules_engine.find_proxy_for_url_exception(url.orig,url.hostname,opt)}return get_strategy(s,ex,opt)};E.handle_request=(url,opt)=>{opt=opt||{};if(opt.premium===undefined)opt.premium=user_plus||_app_trial_mode;if(typeof url=="string")url=zurl.parse(url,true);let top_url=typeof opt.top_url=="string"?zurl.parse(opt.top_url,true):opt.top_url;let strategy,centry=E.cache_access(url.hostname);let policy_key="policy:"+opt.country;let policy=centry.get(policy_key);if(policy=="blocked")strategy={name:"direct"};else if(opt.force=="peer"&&opt.strict)strategy={name:"proxy",peer:true};else if(opt.premium)strategy=E.get_rule_strategy({name:"proxy",peer:false},url,opt);else if(opt.force=="peer")strategy={name:"proxy"};else if(opt.force)strategy={name:opt.force,peer:false};else{strategy=opt.full_vpn?{name:"proxy"}:choose_strategy(url,opt);if(strategy&&strategy.name!="direct")strategy=E.get_rule_strategy(strategy,url,opt)}if(strategy.cache){let cached=centry.get(strategy.cache);if(cached)strategy={name:cached,peer:strategy.peer}}let peer=strategy.peer===true||strategy.peer===undefined&&peer_domain_re&&(peer_domain_re.test(url.hostname)||top_url&&peer_domain_re.test(top_url.hostname));let res=strategies[strategy.name].bind(null,{cache:centry,cache_key:strategy.cache,policy:policy,policy_key:policy_key,peer:peer,expect_type:strategy.expect_type,strict:opt.strict,pool:strategy.pool,country:opt.country});res.desc=strategy.name;if(strategy.cache)res.desc+=" cache "+strategy.cache;if(peer&&strategy.name!="direct")res.desc+=" peer";if(strategy.name=="proxy"&&strategy.pool){res.desc+=" pool"+(typeof strategy.pool=="string"?"_"+strategy.pool:"")}return res};function choose_strategy(url,opt){let ext=url.ext&&url.ext.toLowerCase();if(opt.method&&opt.method!="GET")return{name:"proxy"};if(opt.type=="stylesheet"||opt.type=="image")return{name:"parallel",cache:"static",peer:false};if(url.query&&zurl.qs_parse(url.query,0,1).callback)return{name:"parallel"};if(extensions.archive[ext]){return{name:"direct_first",cache:"archive",peer:false,expect_type:expected_types.archive}}if(extensions.media[ext]||/=\d+-\d+\.dash/.test(url.file)||/Seg\d+-?Frag\d+/.test(url.pathname)||/\/QualityLevels\(\d+\)\/Fragments\(.+=\d+(,format=.+)?\)/.test(url.pathname)){return{name:"direct_first",cache:"media",peer:false,expect_type:expected_types.media}}if(extensions.static[ext])return{name:"parallel",cache:"static",peer:false};if(!user_plus&&!_app_trial_mode&&ext=="m3u8"){return{name:"direct_first",cache:"media",peer:false,expect_type:/mpegurl/i}}if(opt.type=="main_frame")return{name:"proxy"};if(url.protocol=="https:")return{name:"proxy"};return{name:"parallel"}}let last_user_type_set;E.set_user_plus=flag=>{if(user_plus==flag||Date.now()-last_user_type_set<2*ms.SEC)return;user_plus=flag;last_user_type_set=Date.now();return Object.keys(agents).map(a=>agents[a].reinit())};E.set_app_trial_mode=mode=>{_app_trial_mode=mode};E.resp_match=(a,b)=>{if(a.code!=b.code)return{match:false,basis:"response code"};if(a.type!=b.type)return{match:false,basis:"content type"};if(a.etag||b.etag)return{match:a.etag==b.etag,basis:"etag"};if(a.len||b.len)return{match:a.len==b.len,basis:"content-length"}};E.unblocker_json_set=function(json,opt){proxy_rules_engine=new Proxy_rules_engine(json.unblocker_rules,{free:json.unblocker_globals,plus:json.unblocker_plus},opt||{ext:true});if(json.exceptions)E.set_peer_sites(json.exceptions.peer)};E.set_peer_sites=list=>{if(!list)return;peer_domain_re=new RegExp("(^|\\.)("+list.map(zescape.regex).join("|")+")$","i")};E.gen_rule=opt=>{let rule={name:opt.name,country:opt.country.toLowerCase(),peer:peer_domain_re&&peer_domain_re.test(opt.name)||opt.peer,force_peer:opt.force_peer,link:opt.name,description:opt.country.toUpperCase()+" VPN",type:opt.type||"url",enabled:opt.enabled!==undefined?!!opt.enabled:true,supported:true,root_url_orig:["**."+opt.name],root_url:[zurl.http_glob_url("**."+opt.name,1)],ts:opt.ts||Date.now(),mode:opt.mode||"unblock"};zutil.if_set(opt.src,rule,"src");zutil.if_set(opt.src_country,rule,"src_country");zutil.if_set(opt.ratings,rule,"ratings");rule.id=rule.name+"_"+rule.country+"_vpn";return rule};class Cache_entry{constructor(){this.timers={}}get(key){return this[key]}put(key,value,ttl){this[key]=value;if(this.timers[key])clearTimeout(this.timers[key]);this.timers[key]=ttl&&setTimeout(()=>{delete this[key];delete this.timers[key]},ttl);return this}put_weak(key,value,ttl){if(!this[key])this.put(key,value,ttl);return this}del(key){delete this[key];delete this.timers[key];return this}}E.cache_access=domain=>{let entry=cache[domain];if(!entry)entry=cache[domain]=new Cache_entry;return entry};E.cache_purge=()=>{cache={}};let strategies={direct:(opt,direct,proxy)=>{let res={direct:{}};if(!direct){res.direct.start=true;return res}if(direct.code||direct.error)res.direct.serve=true;return res},proxy:(opt,direct,proxy)=>{if(opt.policy=="blocked"&&!opt.strict)return strategies.direct(opt,direct,proxy);let res={direct:{},proxy:{country:opt.country}};if(!proxy){res.proxy.start=true;res.proxy.peer=opt.peer;res.proxy.pool=opt.pool;res.proxy.allowed=opt.policy=="allowed";return res}if(opt.strict){res.proxy.abort=true;return res}if(handle_policy(proxy.policy,opt)=="blocked"){res.direct.start=true;return res}if(proxy.code||proxy.error)res.proxy.serve=true;zutil.if_set(opt.peer,res.proxy,"peer");zutil.if_set(opt.pool,res.proxy,"pool");return res},parallel:(opt,direct,proxy)=>{if(opt.policy=="blocked")return strategies.direct(opt,direct,proxy);let res={direct:{},proxy:{country:opt.country}};function serve_proxy(){if(proxy.hdrs_only){res.proxy.start=true;res.proxy.peer=opt.peer;res.proxy.pool=opt.pool;res.proxy.allowed=opt.policy=="allowed"}else res.proxy.serve=true;return!proxy.hdrs_only}if(!direct){res.direct.start=true;res.direct.timeout=true}if(!proxy){res.proxy.start=true;res.proxy.peer=opt.peer;res.proxy.pool=opt.pool;res.proxy.allowed=opt.policy=="allowed";res.proxy.hdrs_only=true}if(!direct||!proxy)return res;if(handle_policy(proxy.policy,opt)=="blocked")return strategies.direct(opt,direct,proxy);if(proxy.error){if(direct.code||direct.error)res.direct.serve=true;if(direct.error)res.proxy.serve=true;return res}if(!proxy.code)return res;if(!direct.code){if(!serve_proxy())return res;if(opt.cache_key&&direct.slow&&is_ok(proxy,opt.expect_type)){res.log="cache put weak proxy";opt.cache.put_weak(opt.cache_key,"proxy",CACHE_TTL)}else if(!opt.cache_key)res.direct.abort=true;return res}let m=E.resp_match(direct,proxy);if(!m){serve_proxy();return res}res.log=m.basis+(m.match?" match":" mismatch");if(m.match){res.direct.serve=true;if(!proxy.hdrs_only)res.proxy.serve=true;if(opt.cache_key){res.log+="; cache put direct";opt.cache.put(opt.cache_key,"direct",CACHE_TTL)}}else{if(!serve_proxy())return res;if(opt.cache_key){res.log+="; cache put proxy";opt.cache.put(opt.cache_key,"proxy",CACHE_TTL)}}return res},direct_first:(opt,direct,proxy)=>{if(opt.policy=="blocked")return strategies.direct(opt,direct,proxy);let res={direct:{},proxy:{country:opt.country}};if(!direct){res.direct.start=true;res.direct.timeout=true;return res}if(is_ok(direct,opt.expect_type)){res.direct.serve=true;if(opt.cache_key){res.log="cache del";opt.cache.del(opt.cache_key)}return res}if(!proxy){if(direct.slow||direct.code||direct.error){res.proxy.start=true;res.proxy.peer=opt.peer;res.proxy.pool=opt.pool;res.proxy.allowed=opt.policy=="allowed"}return res}if(handle_policy(proxy.policy,opt)=="blocked")return strategies.direct(opt,direct,proxy);if(proxy.code){if(opt.cache_key&&(is_ok(proxy,opt.expect_type)||!direct.code)){res.log="cache put proxy";opt.cache.put(opt.cache_key,"proxy",CACHE_TTL)}else if(proxy.code==302&&direct.code==302){if(proxy.location==direct.location)res.direct.serve=true;else{let p=zurl.parse(proxy.location,true);let d=zurl.parse(direct.location,true);if(p.path==d.path)res.direct.serve=true}}if(!res.direct.serve)res.proxy.serve=true;return res}if(proxy.error&&!direct.slow){res.direct.serve=true;if(direct.error)res.proxy.serve=true;return res}}};function is_ok(resp,expect_type){var res=resp.code>=200&&resp.code<300||resp.code==304;if(res&&expect_type)res=expect_type.test(resp.type);return res}function handle_policy(policy,opt){var m=/^(allowed|blocked)( domain)?$/.exec(policy);if(!m)return"allowed";opt.policy=m[1];if(opt.policy_key&&m[2])opt.cache.put(opt.policy_key,opt.policy,POLICY_TTL);return opt.policy}E.is_conf_allowed=on=>{if(!on)return;if(!conf_rand_id)api.storage.set("conf_rand_id",conf_rand_id=Math.random());return conf_rand_id<on};var api={},agents={},mem_storage={};var def_api={perr:opt=>{zerr("agent.perr not set, discarding "+opt.id)},ajax:opt=>{zerr("agent.ajax not set, discarding "+opt.url)},storage:{get:id=>mem_storage[id],set:(id,val)=>mem_storage[id]=val},get_auth:()=>void zerr("agent.get_auth not set"),get_prod_info:()=>({}),get_user_info:()=>({}),suspend_client:()=>({}),url_ccgi:"https://client.hola.org/client_cgi",get_url_ccgi:suffix=>api.url_ccgi+suffix,trigger:(ev,val)=>{},conf_get:(s,def)=>def,get_rule_routes:rule=>{var routes=[],s=zutil.pick(rule,"country");routes.push(s);if(rule.peer)routes.push(assign({peer:true},s));if(rule.pool)routes.push(assign({pool:rule.pool},s));return routes},get_fallback_agent:()=>{}};let lib_sp;E.init=set=>{E.sp=etask((function*unblocker_lib(){yield this.wait()}));return etask("init",(function*init(){assign(api,def_api,set);lib_sp=etask("lib_sp",(function*(){conf_rand_id=yield api.storage.get("conf_rand_id");hola_uid=yield api.storage.get("hola_uid");yield this.wait()}));E.sp.spawn(lib_sp);yield init_rules();const key=yield api.storage.get("agent_key");if(key)E.emit("lib_event",{id:"set_agent_key",data:key});E.on("not_working",on_not_working)}))};E.reset=()=>{active_reqs.forEach(e=>e.return());active_reqs=[];Object.keys(agents).forEach(a=>agents[a].uninit());agents={}};E.trigger=E.emit;E.uninit=()=>{lib_sp.return();E.reset();E.removeAllListeners();api={};rules=null};function Agent(o,parent,opt){opt=opt||{};if(!(this instanceof Agent))return new Agent(o,parent);this.host=o.host;this.ip=o.ip;this.port=o.port;this.vendor=o.vendor;if(o.pool)this.pool=o.pool;if(o.port_list)this.port_list=o.port_list;this.parents=[];this.last_traffic=0;this.last_verified=0;this.err_timer=500;this.auth_err_timer=500;this.waiting=[];this.add_parent(parent);this.verify();this.proxy_auth()}Agent.prototype.is_verified=function(period){if(this.last_verified&&get_verify_conf("disable_verify"))return true;const ts=Math.max(this.last_traffic,this.last_verified);period=period||get_verify_conf("period_ms",10*ms.MIN)+5*ms.MIN;return Date.now()-ts<period};Agent.prototype.is_verify_err=function(){return this.error&&(this.error.err||"").startsWith("verify_")};Agent.prototype.parent_to_ctx=function(parent){return this.parents.find(p=>p.up==parent)};Agent.prototype.is_usable=function(parent){return!this.is_not_usable(parent)};Agent.prototype.err_ts=function(parent){parent=parent&&this.parent_to_ctx(parent);return this.error&&this.error.ts||parent&&parent.error&&parent.error.ts};Agent.prototype.is_not_usable=function(parent){parent=parent&&this.parent_to_ctx(parent);return this.error&&"error"||this.busy&&"busy"||this.bw_busy&&"bw_busy"||!this.is_verified()&&!this.is_verify_running()&&"unverified"||!this.proxy_authed&&(!this.proxy_auth_sp||!this.proxy_auth_sp.auth_running)&&"not_authed"||parent&&parent.error&&"parent error"};Agent.prototype.to_string=function(parent){return this.host+":"+this.port+"\t"+(this.pool||"reg")+"\t"+(this.is_not_usable(parent)||"usable")};Agent.prototype.is_verify_running=function(){return this.verify_sp&&this.verify_sp.verify_running};Agent.prototype.reverify=function(period){if(period&&(this.is_verify_running()||this.last_verified&&Date.now()-this.last_verified<=period)){return}this.last_verified=this.last_traffic=0;if(this.verify_sp)this.verify_sp.return();this.verify()};Agent.prototype.reauth=function(period){if(!this.last_proxy_authed||Date.now()-this.last_proxy_authed<=period)return;this.last_proxy_authed=0;if(this.proxy_auth_sp)this.proxy_auth_sp.return();this.proxy_auth()};Agent.prototype.add_parent=function(parent){this.parents.push({up:parent})};Agent.prototype.unset_error=function(){var _this=this;this.error=undefined;this.err_timer=500;this.verify_error_n=0;this.parents.forEach((function(p){if(!p.error)p.up.unset_exclude(_this)}))};Agent.prototype.set_error=function(err,desc,rule,forget){var _this=this;if(rule)rule=zutil.pick(rule,"name","country");else this.error={err:err,desc:desc,ts:Date.now()};if(this.is_verify_err())this.verify_error_n++;this.parents.forEach((function(p){if(rule&&!svc_vpn_util.find_rule(p.up.rules,rule))return;if(rule)p.error={err:err,desc:desc,ts:Date.now()};let c=get_verify_conf("verify_err",{period:2*ms.HOUR,count:10});if(forget||!_this.is_verified(c.period)&&_this.verify_error_n>c.count){p.up.forget(_this,forget?"disabled":"verify_err")}else p.up.set_exclude(_this)}))};Agent.prototype.info=function(){var ret={host:this.host,ip:this.ip,port:this.port,vendor:this.vendor};zutil.if_set(this.version,ret,"version");zutil.if_set(this.bw_available,ret,"bw_available");zutil.if_set(this.rtt,ret,"rtt");zutil.if_set(this.country,ret,"country");zutil.if_set(this.pool,ret,"pool");zutil.if_set(this.error,ret,"error");zutil.if_set(this.port_list,ret,"port_list");return ret};Agent.prototype.wait_verified=function(){var _this=this;return etask((function*_wait_verified(){this.finally(()=>array.rm_elm(_this.waiting,this));_this.waiting.push(this);return yield this.wait()}))};Agent.prototype.next_verify=function(){return this._next_verify};Agent.prototype.next_auth=function(){return this._next_auth};Agent.prototype.get_rule=function(){return this.parents[0].up.rules[0]};Agent.prototype.verify=function(){let _this=this,rule=this.get_rule();let ping_id=this.ip+"_"+gen_ping_id();let qs=assign({proxy_country:this.parents[0].up.country,ping_id:ping_id,root_url:rule.link||rule.name},api.get_prod_info());let url=api.get_verify_url?api.get_verify_url(this):"https://"+(this.host||this.ip)+":"+this.port+"/verify_proxy";this.verify_error_n=0;E.sp.spawn(etask({name:"verify_"+(this.host||this.ip)},(function*(){qs.key=yield api.storage.get("agent_key");let verify_err=(err,desc)=>{let info={host:_this.host,ip:_this.ip,err:err,err_desc:desc};unittest_resp_by_route(_this.parents.map(p=>p.up.route),"ea",`<resp(fail=${err})`,this.req_id);svc_vpn_util.push_event("<verify_err",info);_this.perr("verify_err",info);_this.err_timer=Math.min(_this.err_timer*4,15*ms.MIN);_this.set_error("verify_"+err,desc,undefined,err=="agent_err");_this.waiting.forEach(et=>et.continue())};this.finally(()=>{delete _this.verify_sp});for(;;){if(this.verify_running){svc_vpn_util.push_event("<verify",{host:_this.host,ip:_this.ip,rtt:_this.rtt})}this.verify_running=false;_this.verify_sp=this;if(_this.error){_this._next_verify=Date.now()+_this.err_timer;yield etask.sleep(_this.err_timer)}if(_this.last_verified&&get_verify_conf("disable_verify"))return;let ts=Math.max(_this.last_traffic||0,_this.last_verified||0);let now=Date.now();let period=get_verify_conf("period_ms",10*ms.MIN);if(ts&&now-ts<period){let timer=ts+period-now;_this._next_verify=now+timer;yield etask.sleep(timer);continue}this.verify_running=true;svc_vpn_util.push_event(">verify",{host:_this.host,ip:_this.ip});_this._next_verify=0;this.req_id=unittest_req_by_route(_this.parents.map(p=>p.up.route),"ea",">req(url="+url+")");let ret,t0=Date.now();try{if(api.be_dev_mode&&api.be_dev_mode.get("verify_ajax_fail")){yield etask.sleep(SEC);svc_vpn_util.push_event(">verify_ajax_fail");throw new Error("DEBUG_FORCE_FAIL")}ret=yield api.ajax({timeout:7*SEC,url:url,qs:qs})}catch(e){verify_err(/timeout/.test(e)?"timeout":"unknown",""+e);continue}if(!ret||!ret.version){verify_err("empty","empty ret");continue}if(ret.error){verify_err("agent_err",ret.error);continue}_this.bw_available=ret.bw_available;_this.rtt=Date.now()-t0;_this.country=ret.country;_this.busy=ret.busy;_this.bw_busy=ret.bw_busy;_this.version=ret.version;_this.last_verified=Date.now();_this.unset_error();if(_this.busy||_this.bw_busy)_this.parents.forEach(p=>p.up.set_busy());unittest_resp_by_route(_this.parents.map(p=>p.up.route),"ea","<resp(data="+JSON.stringify(ret)+")",this.req_id);_this.waiting.forEach(et=>et.continue());if(get_verify_conf("disable_periodic"))return}})))};Agent.prototype.proxy_auth=function(){if(!api.ajax_via_proxy||get_proxy_auth_conf("disable"))return void(this.proxy_authed=true);let _this=this,rule=this.get_rule();let auth=api.get_auth()||{};let ping_id=this.ip+"_"+gen_ping_id();let data={ping:"proxy_auth",proxy_country:this.parents[0].up.country,uuid:auth.uuid,root_url:rule.link||rule.name,ping_id:ping_id};let url="http://"+this.ip.replace(/\./g,"_")+".proxy_auth.trigger.hola.org/hola_trigger?"+zurl.qs_str(data);let on_auth_error=(err,desc)=>{_this.perr("proxy_auth_err",{host:_this.host,ip:_this.ip,err:err,err_desc:desc});_this.auth_err_timer=Math.min(_this.auth_err_timer*4,15*ms.MIN);_this.auth_error={err:err,desc:desc}};return etask({name:"proxy_auth_"+(this.host||this.ip)},(function*(){this.finally(()=>{delete _this.proxy_auth_sp});this.auth_running=false;_this.proxy_auth_sp=this;while(true){if(_this.auth_error){_this._next_auth=Date.now()+_this.auth_err_timer;yield etask.sleep(_this.auth_err_timer)}let now=Date.now(),ts=_this.last_proxy_authed;let period=get_proxy_auth_conf("period_ms",4*ms.HOUR);if(ts&&now-ts<period){let timer=ts+period-now;_this._next_auth=now+timer;yield etask.sleep(timer);continue}this.auth_running=true;_this._next_auth=0;this.req_id=unittest_req_by_route(_this.parents.map(p=>p.up.route),"ea",">req(url="+url+")");let ret;try{ret=yield api.ajax_via_proxy({url:url,type:"GET"},{timeout:7*SEC,rule:rule,agent:_this,force:"proxy",src:"proxy_auth"})}catch(e){on_auth_error(/timeout/.test(e)?"timeout":"unknown",""+e);continue}if(!ret||ret.status!=200){unittest_resp_by_route(_this.parents.map(p=>p.up.route),"ea","<resp(fail=empty)",this.req_id);on_auth_error("fail","empty ret");continue}_this.proxy_authed=true;_this.last_proxy_authed=Date.now();_this.auth_error=undefined;unittest_resp_by_route(_this.parents.map(p=>p.up.route),"ea","<resp(status="+ret.status+")",this.req_id);if(get_proxy_auth_conf("disable_periodic"))return}}))};Agent.prototype.perr=function(id,info,err){let rule=zutil.pick(this.get_rule(),"name","country");info=assign({rule:rule,proxy_country:rule.country,hola_uid:hola_uid},info);api.perr({info:info,id:id,err:err,rate_limit:{count:2}})};Agent.prototype.to_str=function(){let s=zutil.pick(this,"host","bw","bw_busy","busy","error","last_verified","last_traffic","ip","pool");return JSON.stringify(s)};Agent.prototype.uninit=function(){if(this.verify_sp)this.verify_sp.return();if(this.proxy_auth_sp)this.proxy_auth_sp.return()};function Agents(rule,route){if(!(this instanceof Agents))return new Agents(rule);this.rule=rule;this.rules=[rule];this.route=route.toLowerCase();var m;if(m=this.route.match(/\.pool_?(\w+)?/))this.pool=m[1]||true;this.exclude=[];this.agents=[];this.deselect={};this.deselected={};this._log=[];this.limit=CG("verify_proxy.agent_num",3);this.country=rule.country;this.get_best_agent_waiting=[];this.rl={};agents[this.route]=this;this.init_key_monitor(12*ms.HOUR)}Agents.prototype.init_key_monitor=function(monitor_interval){if(!CG("enable_agent_key_monitor"))return;if(this.agent_key_monitor_sp)this.agent_key_monitor_sp.return();let _this=this;this.agent_key_monitor_sp=E.sp.spawn(etask((function*agent_key_monitor_sp(){yield etask.sleep(monitor_interval);for(;;){try{let ts=yield api.storage.get("agent_key_ts");let diff=Date.now()-ts;if(ts&&diff<monitor_interval){yield etask.sleep(monitor_interval-diff);continue}let{agent_key:agent_key}=yield _this.zgettunnels(null,{agent_key_only:1});if(!agent_key)throw new Error("missing agent_key");yield api.storage.set("agent_key",agent_key);E.emit("lib_event",{id:"set_agent_key",data:agent_key});yield api.storage.set("agent_key_ts",Date.now())}catch(e){api.perr({id:"agent_key_update_err",rate_limit:{count:2}},e);yield etask.sleep(10*ms.MIN)}}})))};Agents.prototype.reverify=function(period){this.agents.forEach(a=>a.reverify(period));this.exclude.forEach(a=>a.reverify(period))};Agents.prototype.reauth=function(period){this.agents.forEach(a=>a.reauth(period));this.exclude.forEach(a=>a.reauth(period))};Agents.prototype.uninit=function(){if(this.agent_key_monitor_sp)this.agent_key_monitor_sp.return();this.uninited=true;this.agents.forEach((function(a){a.uninit()}));this.agents=[];this.exclude.forEach((function(a){a.uninit()}));this.exclude=[];this.deselect={};this.deselected={};delete agents[this.route];if(this.load_agents_info_et)this.load_agents_info_et=void this.load_agents_info_et.return()};Agents.prototype.zgettunnels=function(ping_id,opt){opt=opt||{};let _this=this,fa;if(fa=api.be_dev_mode&&api.be_dev_mode.get("force_agent")){zerr.info("using force_agent %O instead of /zgettunnels req",fa);return{ip_list:{[fa.host]:fa.ip},protocol:{[fa.host]:"https"},vendor:{[fa.host]:"force_agent"},ztun:{[this.route]:[`HTTP ${fa.host}:${fa.port}`]},agent_types:{[this.route]:"hola"}}}let exclude=array.unique(this.exclude.concat(opt.exclude||[]).map(e=>e.host));let ex_limit;if(ex_limit=CG("exclude_limit",9)){if(this.country=="us")ex_limit+=3;if(exclude.length>ex_limit)exclude=rand.rand_subset(exclude,ex_limit)}let deselect=[];for(let host in this.deselect){if(!this.deselected[host]){deselect.push(host);this.deselected[host]=true}}const auth=api.get_auth()||{};let data=zutil.pick(auth,"uuid","session_key");zutil.if_set(ping_id,data,"ping_id");let qs=assign({country:this.route,limit:opt.limit||this.limit},zutil.omit(auth,["uuid","session_key"]));zutil.if_set(opt.agent_key_only,qs,"agent_key_only");let params={exclude:exclude,deselect:deselect};for(let p in params){if(params[p].length>1){data[p]=params[p].join(",");qs[p]=1}else if(params[p].length)qs[p]=params[p][0]}return etask((function*_zgettunnels(){this.on("uncaught",e=>{api.perr({id:"zgettunnel_err",info:{country:_this.route,exclude:exclude,ping_id:ping_id,hola_info:(e||{}).hola_info},rate_limit:{count:2}},e);throw e});this.req_id=unittest_req_by_route(_this.route,"ec",">req(url="+api.get_url_ccgi("/zgettunnels?"+zurl.qs_str(assign({},qs,data))+")"));svc_vpn_util.push_event(">zgettunnels",{country:qs.country,exclude:exclude});if(api.be_dev_mode&&api.be_dev_mode.get("zgettunnel_ajax_slow")){svc_vpn_util.push_event(">zgettunnel_ajax_slow");yield etask.sleep(15*SEC)}if(api.be_dev_mode&&api.be_dev_mode.get("zgettunnel_ajax_fail")){svc_vpn_util.push_event(">zgettunnel_ajax_fail");throw new Error("DEBUG_FORCE_FAIL")}if(zutil.is_mocha())api.perr({id:"zgettunnel_req"});let res=yield api.ajax({url:api.get_url_ccgi("/zgettunnels"),method:CG("is_zgettunnels_post4")?"POST":"GET",qs:qs,data:data,retry:1});svc_vpn_util.push_event("<zgettunnels",{country:qs.country,ip_list:res.ip_list});try{unittest_resp_by_route(_this.route,"ec","<resp(data="+JSON.stringify(res)+")",this.req_id)}catch(e){zerr("failed to generate test %s",e&&e.stack)}return res}))};Agents.prototype.add_agents=function(_agents,exclude,zgettunnels,opt){this.type=zgettunnels.agent_types[this.route];for(let proxy_str of _agents){let[,host,port]=proxy_str.match(/^.* (.*):(.*)$/);let a={host:host,port:port,ip:zgettunnels.ip_list[host],vendor:zgettunnels.vendor&&zgettunnels.vendor[host]};zutil.if_set(zgettunnels.pool&&zgettunnels.pool[host],a,"pool");zutil.if_set(zgettunnels.port,a,"port_list");if(!a.pool)this.push(a,opt);else if(this.pool==true){let route=svc_vpn_util.gen_route_str({country:this.country,pool:a.pool});let route_agent=set_agent_route(assign({},this.rule,{pool:a.pool}),route);route_agent.push(a,opt);this.push(route_agent.find(a),opt)}else this.push(E.find_agents(a)[0]||a,opt)}};Agents.prototype.reinit=function(){this.rl={};this.uninited=undefined;this.agents.forEach((function(a){a.uninit()}));this.agents=[];this.exclude.forEach((function(a){a.uninit()}));this.exclude=[];this.deselect={};this.deselected={};if(this.load_agents_info_et)this.load_agents_info_et=void this.load_agents_info_et.return();return this.load_agents_info(null,"reset")};Agents.prototype.load_agents_info=function(ping_id,reason,opt){let _this=this;return etask((function*_load_agents_info(){if(_this.load_agents_info_et)return yield this.wait_ext(_this.load_agents_info_et);let usable=_this.agents.filter(a=>!_this.should_replace(a));if(usable.length>=_this.limit){zerr.info("load_agents_info %s use existing %O",_this.route,_this.agents);return}let since_last_no_agents=Date.now()-_this.last_no_agents_ts;if(_this.last_no_agents_ts&&since_last_no_agents<CG("no_agents_period",5*ms.MIN)){zerr.info("load_agents_info %s - ignore zgettunnels, no agents",_this.route);return}let rl=CG("get_agents_rl",{count:2,period:ms.MIN});if(rl.count&&!rate_limit(_this.rl,rl.period,rl.count)){zerr.info("load_agents_info %s - ignore zgettunnels, max rate",_this.route);return}let exclude=_this.agents.concat(_this.exclude);_this.load_agents_info_et=this;this.finally(()=>{delete _this.load_agents_info_et});let zgettunnels=yield _this.zgettunnels(ping_id,{exclude:exclude,limit:_this.limit-usable.length});zerr.info("zgettunnels %s ret %O",_this.route,zgettunnels);if(zgettunnels.blocked)return void api.suspend_client();if(zgettunnels.agent_key){api.storage.set("agent_key",zgettunnels.agent_key);E.emit("lib_event",{id:"set_agent_key",data:zgettunnels.agent_key})}else{api.perr({id:"agent_key_miss",info:{ret:zgettunnels},rate_limit:{count:2}})}if(!zgettunnels.ztun)return;if(!_this.agents.length&&_this.exclude.length&&_this.exclude.every(a=>a.is_verify_err())){api.perr({id:"verify_all_failed",info:{agents:_this.exclude.map(a=>a.info()),route:_this.route},rate_limit:{count:1}})}let new_agents=zgettunnels.ztun[_this.route]||[];zerr.info("%s agents set, reason %s, %O",_this.route,reason,new_agents);delete _this.last_no_agents_ts;if(!new_agents.length){_this.last_no_agents_ts=Date.now();if(!exclude.length)zerr.info("zgettunnels no agents for %s",_this.route)}else _this.add_agents(new_agents,exclude,zgettunnels,opt)}))};Agents.prototype.usable=function(){let count=0;for(let agent of this.agents)count+=agent.is_usable(this);return count};Agents.prototype.dump_agents=function(){console.log(this.route+" Agents:");this.agents.forEach(a=>console.log(a.to_string(this)));console.log(this.route+" Excludes:");this.exclude.forEach(a=>console.log(a.to_string(this)))};Agents.prototype.set_busy=function(){if(this.usable()<=1)this.load_agents_info(gen_ping_id())};Agents.prototype.remove=function(s,agent){let i=s.findIndex(a=>a.host==agent.host);if(i<0)return;s.splice(i,1);return true};Agents.prototype.move=function(s,d,agent){if(!this.remove(s,agent))return;d.push(agent);return true};Agents.prototype.unset_exclude=function(agent){this.move(this.exclude,this.agents,agent);delete this.deselect[agent.host];delete this.deselected[agent.host]};Agents.prototype.set_exclude=function(agent){let moved=this.move(this.agents,this.exclude,agent);this.deselect[agent.host]=true;if((moved||!moved&&!CG("disable_get_agents_on_exclude"))&&this.usable()<=1){this.load_agents_info(gen_ping_id())}};Agents.prototype.forget=function(agent,reason){this.remove(this.exclude,agent);this.remove(this.agents,agent);delete this.deselect[agent.host];delete this.deselected[agent.host];api.perr({id:"forget_agent",info:{agent:agent.info(),route:this.route,reason:reason},rate_limit:{count:1}});if(this.usable()<=1)this.load_agents_info(gen_ping_id())};Agents.prototype.log=function(s){this._log.push(s)};Agents.prototype.has_rule=function(rule){return this.rules.some(r=>r.name==rule.name)};Agents.prototype.add_rule=function(rule){if(this.has_rule(rule))return;this.rules.push(rule)};Agents.prototype.should_replace=function(agent){return(!agent||!Object.keys(agent).length)&&"empty"||agent.is_not_usable(this)};Agents.prototype.get_best_agent=function(ping_id,opt){let _this=this;return etask({async:true},(function*get_best_agent(){if(_this.uninited)return;this.finally(()=>{delete _this.get_best_agent_sp;for(let sp of _this.get_best_agent_waiting)sp.return(this.retval);_this.get_best_agent_waiting=[]});try{if(_this.get_best_agent_sp){_this.get_best_agent_waiting.push(this);return yield this.wait()}_this.get_best_agent_sp=this;let _agents=_this.get_chosen();if(!_agents.length){yield _this.load_agents_info(ping_id,"missing agents",opt);_agents=_this.get_chosen();if(!_agents.length)return}let verified_agent=_agents.find(a=>a.is_verified());if(verified_agent)return{chosen:verified_agent};for(let a of _agents){this.spawn(etask((function*wait_verify(){yield a.wait_verified();return a})))}let res=yield this.wait_child("any",a=>a&&a.is_verified());if(res)return{chosen:res.child.retval}}catch(e){return{error:""+e}}}))};Agents.prototype.get_all_agents=function(){const ret=this.agents.filter(a=>!this.should_replace(a));return!ret.length?this.agents:ret};Agents.prototype.get_chosen=function(){let ret=[];let add=cond=>{let _agents=this.agents.filter(cond);if(!_agents.length)return;_agents.sort((a,b)=>a.rtt-b.rtt);ret=ret.concat(_agents.slice(0,3-ret.length))};add(a=>!this.should_replace(a));if(ret.length==3)return ret;add(a=>this.should_replace(a));if(ret.length==3)return ret;this.exclude.sort((a,b)=>a.err_ts(this)-b.err_ts(this));ret=ret.concat(this.exclude.slice(0,3-ret.length));return ret};Agents.prototype.get_fallback=function(){if(CG("disable_fallback_aagents"))return;return this.fallback_agent=this.fallback_agent||api.get_fallback_agent(this.country.toUpperCase())};Agents.prototype.push=function(agent,opt){if(this.find(agent))return-1;if(agent instanceof Agent)agent.add_parent(this);else agent=new Agent(agent,this,opt);return this.agents.push(agent)};Agents.prototype.find=function(agent){function cmp_agents(a,b){return(a.host==b.host||a.ip==b.ip)&&(!a.port||a.port==b.port)}return this.agents.find(a=>cmp_agents(agent,a))||this.exclude.find(a=>cmp_agents(agent,a))};Agents.prototype.to_str=function(){let s='"'+this.route+'":{"agents":[';this.agents.forEach((a,i)=>{s+=(i?",":"")+a.to_str()});s+='],"exclude":[';this.exclude.forEach((a,i)=>{s+=(i?",":"")+a.to_str()});return s+"]}"};E.find_agents=function(agent){let res=[];if(!agent.host&&!agent.ip)return res;for(let route in agents){let a=agents[route].find(agent);if(a)res.push(a)}return res};E.is_agent=o=>!!E.find_agents({ip:o,host:o})[0];E.update_chosen=agent=>{for(agent of E.find_agents(agent))agent.last_traffic=Date.now()};E.get_agents_by_route=route=>agents[route]?agents[route].get_all_agents():[];E.get_agents_type=route=>agents[route]&&agents[route].type;E.get_rule_routes=function(rule,raw){let routes=rule&&api.get_rule_routes?api.get_rule_routes(rule):[];return raw?routes:routes.map(r=>svc_vpn_util.gen_route_str(r))};function set_agent_route(rule,route_str){if(agents[route_str])agents[route_str].add_rule(rule);else agents[route_str]=new Agents(rule,route_str);return agents[route_str]}E.get_agents=(ping_id,rule,opt)=>etask((function*_get_agents(){let succ,res={rule:rule,proxy_country:rule.country,verify_proxy:{}};ping_id=gen_ping_id(ping_id);active_reqs.push(this);this.finally(()=>array.rm_elm(active_reqs,this));for(let route_str of E.get_rule_routes(rule)){let route_agents=set_agent_route(rule,route_str);this.spawn(etask((function*get_best_agent_child(){let ret=yield route_agents.get_best_agent(ping_id,opt);if(!ret)return;if(ret.error){res.verify_proxy[route_str]=[];return}succ=true;let a={host:ret.chosen.host,port:ret.chosen.port,ip:ret.chosen.ip,type:route_agents.type,verified:true};zutil.if_set(ret.chosen.pool,a,"pool");zutil.if_set(ret.chosen.port_list,a,"port_list");let r={agent:a,res:{version:ret.chosen.version,ip:ret.chosen.ip,bw_available:ret.chosen.bw_available,country:ret.chosen.country},t:ret.chosen.t};zutil.if_set(ret.chosen.bw_busy,r.res,"bw_busy");zutil.if_set(ret.chosen.busy,r.res,"busy");res.verify_proxy[route_str]=[r]})))}try{yield this.wait_child("all",CG("get_agents_timeout",10*SEC));if(!succ)throw new Error("not_found")}catch(e){api.perr({id:"get_agents_err",rate_limit:{count:2}},e);res.info={error:"catch",err:""+e}}return res}));E.replace_agents=(rule,replace,opt)=>etask((function*_change_agents(){opt=opt||{};for(let agent_obj of replace){for(let agent of E.find_agents(agent_obj))agent.set_error("force_change","by change agents",rule)}return yield E.get_agents(null,rule,zutil.pick(opt,"type","src_rule"))}));let def_cc_states={wait:{wait:ms.MIN,next:"hola"},hola:{next:"svd"},svd:{next:"hvpn"},hvpn:{next:"connectivity"},connectivity:{urls:["google.com","microsoft.com","wikipedia.org"],next:"wait",next_success:"common_agents"},common_agents:{next:"mem_agents",agents:"common_agents",retries:1},mem_agents:{next:"build_agents",agents:"mem_agents",retries:1},build_agents:{next:"cloud_agents",agents:"build_agents",retries:1},cloud_agents:{agents:"cloud_agents",retries:1}};let def_cc_api={ajax_via_proxy:undefined,perr:function(opt){zerr("cc.perr not set, discarding "+opt.id)}};function ConnectivityCheck(opt){this.api={};assign(this.api,def_cc_api,opt.api);this.states={};assign(this.states,def_cc_states,opt.states);for(let name in this.states){let state=this.states[name]=assign({urls:[]},this.states[name]);state.name=name;if(opt.ignore){state.ignore=opt.ignore instanceof RegExp?opt.ignore.test(name):opt.ignore.includes(name)}if(!state.urls||state.urls.length)continue;let is_agent_state=name.endsWith("_agents");let use_urls=!opt[name]||is_agent_state?opt.hola:opt[name];if(typeof use_urls=="string")use_urls=[use_urls];if(is_agent_state)use_urls=use_urls.slice(0,1);state.urls=use_urls}this.opt=opt;this.logs=[];this.perrs={}}ConnectivityCheck.prototype.reset=function(){if(this.et)this.et=this.et.return();this.selected=this.state=undefined};ConnectivityCheck.prototype.uninit=function(){this.reset()};ConnectivityCheck.prototype.log=function(log,state){this.logs.push({log:log,state:state})};ConnectivityCheck.prototype.perr=function(opt){let path=opt.info.name+"."+opt.id;if(zutil.get(this.perrs,path))return;zutil.set(this.perrs,path,true);if(opt.info&&this.opt.dbg_logs)opt.info.logs=this.logs.map((function(o){return o.log}));return this.api.perr(opt)};ConnectivityCheck.prototype.check=function(state,loop_et){let _agents=this.opt[state.agents]||[],ret={error:"check failed"};let et_timeout,ts,_this=this,next=0;let send_next=()=>{if(_agents[next])delete _agents[next].timeout;if(!_agents.length||next+1==_agents.length)return;if(_agents[++next])state.urls.forEach(url=>et.spawn(send_ajax(url)));else et_timeout=setTimeout(()=>et.return(ret),3e3)};let ajax_via_proxy=(url,type,opt)=>etask((function*ajax_wrapper(){let resp=yield _this.api.ajax_via_proxy({url:url,type:type},opt);if(resp)resp.test_url=url;return resp}));let send_ajax=url=>{url=url.startsWith("http")?url:"https://"+url+(url.includes("/")?"":"/");let agent=_agents.length?_agents[next]:null;let opt={always:true,hdrs_abort:true,ignore_redir:true,hdrs:{"Cache-Control":"no-cache,no-store,must-revalidate,"+"max-age=-1"},force_headers:true,fix_307:true,agent:agent,force:agent?"proxy":"direct",src:"bg_ajax"};if(opt.force=="proxy")opt.prot="proxy";_this.log("ajax "+(_agents.length?"proxy ":"")+url);ts=Date.now();let _et=ajax_via_proxy(url,"GET",opt);if(agent)agent.timeout=setTimeout(send_next,3e3);else{et_timeout=setTimeout(()=>_et.return({orig_res:{error:"timeout"}}),5e3)}return _et};let et=etask((function*connectivity_check(){this.finally(()=>{clearTimeout(et_timeout);if(_agents.length)_agents.forEach(a=>clearTimeout(a.timeout));if(!ret.error){if(state.next_success){_this.state=assign({},state);_this.retries=0;_this.state.next=state.next_success}else{_this.selected=assign({success_url:ret.url},state);if(_agents.length)_this.selected.agent=_agents[next];_this.perr({id:"connectivity_check_success",rate_limit:{count:5},info:{name:state.name,urls:state.urls,success:ret.url}})}}else{_this.perr({id:"connectivity_check_failed",rate_limit:{count:15},info:{name:state.name,urls:state.urls,error:ret.error}})}loop_et.continue()});if(typeof _agents=="function")_agents=yield _agents();_agents=_agents||[];if(state.agents&&!_agents.length)return;state.urls.forEach(url=>this.spawn(send_ajax(url)));yield this.wait_child("any",resp=>{if(!ret.error)return;clearTimeout(et_timeout);let _ret=resp&&resp.orig_res?resp.orig_res:{error:"ajax failed"};_ret.url=resp&&resp.test_url;_ret.statusCode=_ret.statusCode!=undefined?_ret.statusCode:_ret.code;if(_ret.statusCode>=400)_ret.error="bad status code "+_ret.statusCode;delete _ret.body;if(resp&&resp.agent&&resp.agent.timeout)clearTimeout(resp.agent.timeout);let proxy_err=_agents.length&&/ERR_PROXY_CONNECTION_FAILED/.test(_ret.error);_this.log("resp "+(_ret.error||_ret.statusCode)+" after "+(Date.now()-ts)+"ms",state);if(_ret.error||proxy_err){ret.error=_ret.error;return void send_next()}if(next){_this.perr({id:"connectivity_check_failed_agent",rate_limit:{count:2},info:{name:state.name}})}return ret=_ret})}));return et};ConnectivityCheck.prototype.get_state=function(){return this.state?this.states[this.state.next]:this.states.hola};ConnectivityCheck.prototype.run=function(opt){if(this.error_sent&&Date.now()-this.error_sent<10*ms.MIN)return;opt=opt||{};let _this=this;return etask({async:true},(function*run(){this.finally(()=>{_this.et=undefined});if(_this.et)return yield this.wait_ext(_this.et);_this.retries=0;_this.et=this;_this.error_sent=false;_this.perrs={};while(!_this.selected){let state=_this.get_state();if(!state)break;let max=state.retries||_this.opt.retries||3;if(_this.retries==max||state.ignore){_this.retries=0;_this.state=state;continue}_this.retries++;let _agents=_this.opt[state.agents];if(_agents&&_agents instanceof ConnectivityCheck){if(!_agents.selected)yield _agents.run();if(_agents.selected){_this.perr({id:"connectivity_check_success",rate_limit:{count:5},info:{name:state.name,urls:state.urls}});var success_url=_this.opt.def_url||_agents.selected.success_url;return _this.selected=assign({success_url:success_url,agent:_agents.selected.agent},state)}continue}let wait_et;if(state.wait)wait_et=etask.sleep(state.wait);else if(_this.check(state,this))wait_et=this.wait();if(!wait_et)break;if(opt.on_state)opt.on_state(state);yield wait_et}if(!_this.selected&&!_this.error_sent){_this.perr({id:"connectivity_check_all_failed",rate_limit:{count:5},info:{url:_this.opt.hola}});_this.error_sent=Date.now()}return _this.selected||{error:"all_failed"}}))};ConnectivityCheck.prototype.is_completed=function(){return!!this.selected};ConnectivityCheck.prototype.get_selected_state=function(){return this.selected?this.selected.name:undefined};ConnectivityCheck.prototype.get_backend_link=function(){const s=this.selected;return s?{url:s.success_url,agent:s.agent}:{url:this.opt.def_url}};E.ConnectivityCheck=ConnectivityCheck;E.get_chosen_agent=function(route_opt,rule){route_opt=route_opt||{};const route_str=svc_vpn_util.gen_route_str(route_opt,{no_algo:true});let chosen,route_agent=set_agent_route(rule,route_str);if(!(chosen=route_agent.get_chosen())||!chosen.length||chosen[0].replace){route_agent.get_best_agent(Math.random());return route_agent.get_fallback()}return chosen[0].info()};E.get_active_agents=function(rule){let _agents=[];E.get_rule_routes(rule,true).forEach(r=>{let a;if(a=E.get_chosen_agent(r,rule))_agents=_agents.concat(a)});return _agents};E.resolve_agents=(rules,opt)=>etask((function*_resolve_agents(){let ping_id=gen_ping_id();for(let rule of rules)this.spawn(E.get_agents(ping_id,rule,opt));yield this.wait_child("all")}));E.verify_agents=(period,wait)=>etask((function*_verify_agents(){let unverified=new Set,ts=Date.now();for(let a in agents)agents[a].agents.forEach(ag=>unverified.add(ag));for(let agent of unverified){if(!agent.last_verified||ts-agent.last_verified>period)agent.reverify(period);else unverified.delete(agent)}if(!wait)return;for(;;){for(let agent of unverified){if(ts-agent.last_verified<=period)unverified.delete(agent)}if(!unverified.size)return;yield etask.sleep(wait)}}));let gen_stamp=()=>Math.floor(Math.random()*4294967295);function commit_rules(update){rules.stamp=gen_stamp();if(update)gen_rules(rules.set);api.storage.set("rules",rules)}E.has_rule=function(o){if(!o)return;if(typeof o=="function"){for(let i in rules.set){if(o(rules.set[i]))return true}return}return svc_vpn_util.find_rule(rules.set,o)};function rules_fixup(){let change,now=Date.now();let country=api.get_user_info().country;for(let i in rules.set){let r=rules.set[i];let diff=now-(r.ts||0);if(!r.enabled)continue;if(r.country==country&&diff>ms.DAY&&r.mode!="protect"&&r.src_country&&r.src_country!=country){zerr.notice("disabled rule after country change site %s %s -> %s",r.name,r.src_country,r.country);api.perr({id:"disable_rule_country_changed",info:{rule:{name:r.name,country:r.country,src_country:r.src_country},src_country:country}});change=true;r.enabled=false}}if(change)commit_rules(true)}function _set_rule(opt,pair){let r,i;svc_vpn_util.push_event("set_rule",{name:opt.name,src:opt.src,pair:pair,country:opt.country,enabled:opt.enabled,mode:opt.mode,del:opt.del});if(!opt.name||!opt.country)return;if(!rules.generated)rules.generated={};if(!rules.set)rules.set={};for(i in rules.set){r=rules.set[i];if(r.name!=opt.name||opt.src&&opt.src!=r.src)continue;delete rules.generated[i];delete rules.set[i]}if(!opt.del){if(opt.name.match(/^https?:\/\//))opt.name=svc_vpn_util.get_root_url(opt.name);r=E.gen_rule(opt);rules.generated[r.id]=r;rules.set[r.id]={name:r.name,country:r.country,enabled:r.enabled,ts:r.ts,mode:r.mode,src:r.src,src_country:r.src_country||""}}if(pair)return;let root_urls=get_root_urls(opt.name);for(i=1;i<root_urls.length;i++)_set_rule(assign({},opt,{name:root_urls[i]}),true)}E.get_site_key=root_url=>{let sites=CG("sites",{});for(let k in sites){let v=sites[k];let urls=Array.isArray(v.root_url)?v.root_url:[v.root_url];if(urls.includes(root_url)&&v.min_ver&&version_util.cmp(ext_ver(),v.min_ver)>=0){return k}}};E.get_site_conf=root_url=>CG("sites."+E.get_site_key(root_url));function get_root_urls(domain){let site=E.get_site_conf(domain);return site?[...new Set([domain].concat(site.root_url))]:[domain]}E.set_rule=function(opt){opt=assign({ts:Date.now()},opt);unittest_set_rule(opt);E.emit("lib_event",{id:"before_rule_set",data:opt.name});_set_rule(opt);commit_rules()};function gen_rules(set){if(!set)return;rules.generated=null;rules.set=null;for(let i in set)_set_rule(set[i])}function is_supported_country(op,rule){if(!rule.country)return true;let c=rule.country;if(!c.list||!c.type||!(c.list instanceof Array))return true;if(c.type=="in"&&(!op.country||!c.list.includes(op.country))||c.type=="not_in"&&op.country&&c.list.includes(op.country)){return false}return true}function get_filtered_rules(urules,op){if(!urules)return;var m,res={};for(var i in urules){if(!is_supported_country(op,urules[i]))continue;res[i]=urules[i];if((m=urules[i].match)&&m.min_ver&&version_util.cmp(product_ver(),m.min_ver)<0){delete urules[i].match}}return res}E.set_rules=_rules=>{let opt={country:api.get_user_info().country};if(rules.enable!=_rules.enable||!zutil.equal_deep(rules.blacklist,_rules.blacklist)||["globals","plus","trial"].some(e=>!zutil.equal_deep(rules[e],get_filtered_rules(_rules["unblocker_"+e],opt)))){rules.globals=get_filtered_rules(_rules.unblocker_globals,opt);rules.plus=get_filtered_rules(_rules.unblocker_plus,opt);rules.trial=get_filtered_rules(_rules.unblocker_trial,opt);rules.blacklist=_rules.blacklist;rules.enable=_rules.enable;api.storage.set("rules",rules)}};E.get_rules=()=>{if(!rules)return null;rules_fixup();if(!rules.globals)return null;let json={unblocker_rules:rules.generated||{},stamp:rules.stamp,enable:rules.enable,blacklist:rules.blacklist};["globals","plus","trial"].forEach(e=>json["unblocker_"+e]=rules[e]);return zutil.clone_deep(json)};E.get_groups=groups=>{let ret={unblocker_rules:{}};for(let group of groups){let r=E.gen_rule(group);ret.unblocker_rules[r.id]=r}return zutil.clone_deep(ret)};function agents_to_unittest_str(rule){let routes=E.get_rule_routes(rule);let _s='"def":{';for(let route in agents){if(!rule||routes.includes(route))_s+=agents[route].to_str()}return"{"+_s+"}}"}E.reauth_country_agents=(country,period)=>{if(CG("reauth.disable"))return;period=period||CG("reauth.period",5*ms.MIN);for(let route in agents){let agent=agents[route];if(agent.country==country)agent.reauth(period)}};E.reverify_country_agents=country=>{let period=get_verify_conf("reverify_period_ms",5*ms.MIN);for(let a in agents){let agent=agents[a];if(agent.country==country)agent.reverify(period)}};let get_ctx=id=>ctx.find(c=>c.id==id);E.add_ctx=function(id,rule,data){try{E.del_ctx(id);ctx.push({id:id,rule:rule,data:data,ts:Date.now(),ids:{ew:0,bw:0,ea:0,ec:0},reqs:{},routes:E.get_rule_routes(rule),unittest:[],src:data.src});if(!gen_auto_unittest())return;c_unittest_push(id,"open(country="+api.get_user_info().country+' date="'+date.to_sql(new Date)+'" auto user_plus='+user_plus+" set_agents="+agents_to_unittest_str(rule)+")");c_unittest_push(id,"set_rule(raw="+JSON.stringify(rule)+")");c_unittest_push(id,"nav(url="+data.src+")");if(ctx.length>20)ctx.splice(0,10)}catch(e){console.error(e)}};E.del_ctx=id=>array.rm_elm(ctx,get_ctx(id));let agent_num=host=>host.match(/[a-z]+([0-9]+)/)[1];E.on_before=(url,req_id,ctx_id,data)=>{if(!gen_auto_unittest())return;try{let c=get_ctx(ctx_id);if(!c)return;c_unittest_push(ctx_id,"bw",">req(url="+url+" "+(data.strategy?'strategy="'+data.strategy+(data.agent?".z"+agent_num(data.agent):"")+'"':"")+")",req_id)}catch(e){console.error(e)}};E.on_completed=(req_id,ctx_id,data)=>{if(!gen_auto_unittest())return;try{let c=get_ctx(ctx_id);if(!c)return;let req=c.unittest.find(u=>u.req_id==req_id);if(!req)return;c_unittest_push(ctx_id,"bw",'<resp(status="'+(data.status||0)+'"'+(data.hdrs?" hdrs="+JSON.stringify(zutil.pick(data.hdrs,"content-length","x-hola-response","x-hola-error","location")):"")+")",req_id,req.roles_id)}catch(e){console.error(e)}};E.dump_unittest=ctx_id=>{let c=get_ctx(ctx_id);if(c)c.unittest.forEach(u=>console.log(u.s))};class Proxy_exceptions{constructor(){this.ips=[];this.match_root_url={};let rule_props=["hosts","root_urls","src_country","proxy_country"];for(let name of rule_props){this[name]={};this[name+"_cache"]={};this[name+"_counter"]=0}}}let regex_ip2=/^((\d{1,3}\.){3}\d{1,3})(\/(\d+))?$/;class Proxy_rules_engine{constructor(unblocker_rules,proxy_rules,opt){proxy_rules=proxy_rules||{};opt=opt||{};this.opt={redir_direct:opt.redir_direct===undefined||opt.redir_direct,proxy_port:opt.proxy_port||6857,redir_port:opt.redir_port||6850,ext:opt.ext||0,by_rules:opt.by_rules||0,do_redir:opt.do_redir||0};this.hosts={hosts:{},ips:[],hosts_cache:{},hosts_counter:0};if(!this.opt.by_rules){for(let i in unblocker_rules){let rule=unblocker_rules[i];if(rule.internal||this.opt.ext&&!rule.enabled)continue;this.parse_cmds(i,rule,unblocker_rules,this.hosts)}}else{this.rules={};for(let i in unblocker_rules){let rule=unblocker_rules[i];if(rule.internal||this.opt.ext&&!rule.enabled)continue;if(!rule.root_url){this.parse_cmds(i,rule,unblocker_rules,this.hosts);continue}if(!rule.cmds)continue;this.rules[i]={hosts:{},ips:[],hosts_cache:{},hosts_counter:0};this.parse_cmds(i,rule,unblocker_rules,this.rules[i],1)}}this.exceptions=this.parse_exceptions(proxy_rules.free);this.exceptions_plus=this.parse_exceptions(proxy_rules.plus)}find_proxy_for_url_exception(url,host,opt){opt=opt||{};let rules=opt.is_trial||opt.premium?this.exceptions_plus:this.exceptions;let ret;if(!(ret=this.find_proxy_for_match(url,host,rules,opt)))ret=this.find_proxy_for_url_exception_int(url,host,rules,opt);return ret&&ret.str}find_proxy_for_val(url,host,hosts,opt){opt=opt||{};if(!opt.name||!opt.val)return;let do_redir=this.opt.do_redir;let cname=opt.name+"_cache",counter=opt.name+"_counter";if(hosts[cname]){let c=hosts[cname][opt.val];if(c&&c.func)return c.func(url,host,do_redir,opt);if(c)return this.pac_redir(url,host,do_redir)}if(hosts[counter]>5e3){hosts[counter]=0;hosts[cname]={}}let func;if(!(func=hosts[opt.name][opt.val]))return;hosts[cname][opt.val]={func:func};hosts[counter]++;return func(url,host,do_redir,opt)}find_proxy_for_url_exception_int(url,host,rules,opt){let ret=this.find_proxy_for_url(url,host,rules,{exception:1});if(!ret&&opt.root_url){ret=this.find_proxy_for_val(url,host,rules,{name:"root_urls",val:opt.root_url,exception:1})}if(!ret&&opt.src_country){ret=this.find_proxy_for_val(url,host,rules,{name:"src_country",val:opt.src_country,exception:1})}if(!ret&&opt.proxy_country){ret=this.find_proxy_for_val(url,host,rules,{name:"proxy_country",val:opt.proxy_country,exception:1})}return ret}find_pac_proxy(url,host){let ret=this.find_proxy_for_url(url,host,this.hosts);if(ret.proxy){let ex=this.find_proxy_for_url(url,host,this.exceptions,{exception:1,orig_proxy:ret.str});if(ex)ret=ex}return ret.str}find_proxy_for_url(url,host,hosts,opt){opt=opt||{};let do_redir=this.opt.do_redir;if(hosts.hosts_cache){let c=hosts.hosts_cache[host];if(c&&c.func)return c.func(url,host,do_redir,opt);if(c)return this.pac_redir(url,host,do_redir)}if(hosts.hosts_counter>5e3){hosts.hosts_counter=0;hosts.hosts_cache={}}if(zurl.is_ip(host)){let ip=zurl.ip2num(host);let ips=hosts.ips;for(let i=0;i<ips.length;i++){let _ip=ips[i];if(ip>>>_ip.bits<<_ip.bits^_ip.mask)continue;hosts.hosts_cache[host]={func:_ip.func};hosts.hosts_counter++;return _ip.func(url,host,do_redir,opt)}}let index=-1;for(;;){let func=hosts.hosts["*"]||hosts.hosts[host.substr(index+1)];if(func){hosts.hosts_cache[host]={func:func};hosts.hosts_counter++;return func(url,host,do_redir,opt)}if((index=host.indexOf(".",index+1))<0)break}if(opt.exception)return null;hosts.hosts_cache[host]={};hosts.hosts_counter++;return this.pac_redir(url,host,do_redir)}find_proxy_for_match(url,host,rules,opt){opt=opt||{};let mr,mrules;if(!rules.match_root_url||!opt.root_url||!(mrules=rules.match_root_url[opt.root_url])){return opt.orig_proxy}mr=mrules.find(r=>{if(r.fsrc_country&&!r.fsrc_country.includes(opt.src_country))return false;if(r.fproxy_country&&!r.fproxy_country.includes(opt.proxy_country)){return false}return true});if(mr)return this.find_proxy_for_url_exception_int(url,host,mr,opt)}parse_exceptions(rules){if(!rules)rules={};let exceptions=new Proxy_exceptions;for(let name in rules){let rule=rules[name];if(rule.match)this.parse_match(name,rule,exceptions);else this.parse_cmds(name,rule,rules,exceptions)}return exceptions}pac_redir(url,host,do_redir){if(!do_redir||!this.opt.redir_direct)return{proxy:false,str:"DIRECT"};if(zbrowser.isPlainHostName(host))return{proxy:false,str:"DIRECT"};let m=url.match(/^.+:([0-9]+)\/.*$/);if(m&&m.length==2&&m[1]!="80")return{proxy:false,str:"DIRECT"};if(url.match(/^https:.*$/))return{proxy:false,str:"DIRECT"};return{proxy:false,str:"PROXY 127.0.0.1:"+this.opt.redir_port+"; DIRECT"}}handle_then(value,url,host,do_redir,exception,orig_proxy){if(value=="DIRECT")return this.pac_redir(url,host,do_redir);let n=value.split(" ");if(exception&&n[0]=="PROXY"){if(n.length==1)return null;if(n[1].startsWith("XX")&&orig_proxy){let c=orig_proxy.split(" ")[1].split(".")[0];return{proxy:true,str:"PROXY "+n[1].replace("XX",c)}}}if(n.length<2)return this.pac_redir(url,host,do_redir);else if(!{PROXY:1,SOCKS:1,SOCKS5:1,HTTPS:1}[n[0]])return this.pac_redir(url,host,do_redir);if(this.opt.ext)return{proxy:true,str:value};return{proxy:true,str:"PROXY 127.0.0.1:"+this.opt.proxy_port}}static get_ext(url){let ext="",index=url.indexOf("?");if(index>=0)url=url.slice(0,index);let ext_index=url.lastIndexOf(".",url.length);let _ext_index=url.lastIndexOf("/",url.length);if(ext_index>=0&&ext_index>_ext_index)ext=url.slice(ext_index+1);else if(_ext_index>=0)ext=url.slice(_ext_index+1);return ext}host_cb(name,rule,cmd,url,host,do_redir,opt){if(!cmd["if"]){if(cmd.dst_dns){return this.handle_then(cmd.then,url,host,do_redir,opt.exception,opt.orig_proxy)}cmd["if"]=[]}let ext=Proxy_rules_engine.get_ext(url);for(let i=0;i<cmd["if"].length;i++){let _if=cmd["if"][i];let arg=null,value=null;let type="==";if(!_if.then)continue;if(_if.type)type=_if.type;if(_if.host){arg=host;value=_if.host}else if(_if.url){arg=url;value=_if.url}else if(_if.ext){arg=ext;value=_if.ext}else if(_if.main){arg=opt.is_main;value=_if.main}else continue;let cmp;switch(type){case"==":cmp=arg==value;break;case"!=":cmp=arg!=value;break;case"=~":cmp=arg.match(value);break;case"!~":cmp=!arg.match(value);break;case"=a":case"in":cmp=value.includes(arg);break;case"!a":case"not_in":cmp=!value.includes(arg);break;case"=o":cmp=!!value[arg];break;case"!o":cmp=!value[arg];break;default:continue}if(cmp){return this.handle_then(_if.then,url,host,do_redir,opt.exception,opt.orig_proxy)}if(_if["else"]){return this.handle_then(_if["else"],url,host,do_redir,opt.exception,opt.orig_proxy)}}return this.handle_then(cmd.then,url,host,do_redir,opt.exception,opt.orig_proxy)}set_rule(name,rule,cmd,hosts){let add=prop=>{if(!cmd[prop])return;for(let i=0;i<cmd[prop].length;i++){let val=cmd[prop][i];hosts[prop][val]=(url,host,do_redir,opt)=>this.host_cb(prop,rule,cmd,url,host,do_redir,opt)}return true};let _cif=cmd["if"];if(_cif){for(let i=0;i<_cif.length;i++){let _if=_cif[i];if(_if.type=="=~"||_if.type=="!~"){if(_if.host)_if.host=new RegExp(_if.host);else if(_if.url)_if.url=new RegExp(_if.url);else if(_if.ext)_if.ext=new RegExp(_if.ext)}}}if(!cmd.hosts){if(add("root_urls"))return;if(add("src_country"))return;if(add("proxy_country"))return;hosts.hosts["*"]=(url,host,do_redir,opt)=>this.host_cb(name,rule,cmd,url,host,do_redir,opt);return}for(let i=0;i<cmd.hosts.length;i++){let _host=cmd.hosts[i],n;if(n=_host.match(regex_ip2)){if(!cmd.ips)cmd.ips=[];let bits=32-(n[4]?+n[4]:32);if(bits<0)bits=0;let mask=zurl.ip2num(n[1])>>>bits<<bits;hosts.ips.push({mask:mask,bits:bits,func:(url,host,do_redir,exception)=>this.host_cb(name,rule,cmd,url,host,do_redir,exception)});continue}hosts.hosts[_host]=(url,host,do_redir,opt)=>this.host_cb(name,rule,cmd,url,host,do_redir,opt)}}parse_cmds(name,rule,rules,exceptions,by_rules){let cmds=rule.cmds;if(!cmds)return;for(let i=0;i<cmds.length;i++){let cmd=cmds[i];if(cmd.rule){let _name=cmd.rule;return this.parse_cmds(_name,rules[_name],rules,exceptions)}if(!cmd.hosts&&!by_rules&&!cmd.root_urls&&!cmd.src_country&&!cmd.proxy_country||!cmd.then){continue}this.set_rule(name,rule,cmd,exceptions)}}parse_match(name,rule,exceptions){let match=rule.match;if(!match||!match.rules||!match.root_urls)return;let res=[];for(let r of match.rules){let ex=new Proxy_exceptions;res.push(ex);this.parse_cmds(name,r,match,ex);ex.fsrc_country=r.src_country;ex.fproxy_country=r.proxy_country}match.root_urls.forEach((function(root_url){exceptions.match_root_url[root_url]=res}))}push(bw_rule,req){let acc=this.data[bw_rule.id];if(acc&&acc.rule!=req.opt.rule)this._send(bw_rule,acc);acc=this.data[bw_rule.id]=this.data[bw_rule.id]||{len:0,ms:0,rule:req.opt.rule};acc.len+=+req.proxy_resp.len;acc.ms+=Date.now()-req.start_ts;if(acc.len>(bw_rule.sample_size||10*1024*1024))this._send(bw_rule,acc)}}function c_unittest_push(ctx_id,roles,req,req_id,roles_id){if(arguments.length==2){req=roles;roles=null}let c;if(!(c=get_ctx(ctx_id)))return;if(!roles)return void c.unittest.push({s:req,req_id:req_id});roles_id=roles_id||++c.ids[roles];c.unittest.push({s:roles+roles_id+req,req_id:req_id,roles_id:roles_id})}function on_not_working(id,e){let c;if(gen_auto_unittest()&&(c=get_ctx(id)))e.unittest=c.unittest.map(u=>u.s).slice(0,300);api.perr({id:"be_not_working_trigger",info:e,rate_limit:{count:5,ms:date.ms.MIN}},true)}function unittest_req_by_route(routes,roles,req){if(!gen_auto_unittest())return;try{if(!Array.isArray(routes))routes=[routes];let req_id=gen_stamp();ctx.forEach(c=>{if(c.routes.some(r=>routes.includes(r)))c_unittest_push(c.id,roles,req,req_id)});return req_id}catch(e){console.error(e)}}function unittest_resp_by_route(route,roles,resp,req_id){if(!gen_auto_unittest())return;try{ctx.forEach(c=>{if(!c.routes.includes(route))return;let req=c.unittest.find(u=>u.req_id==req_id);if(req)c_unittest_push(c.id,roles,resp,req_id,req.roles_id)})}catch(e){console.error(e)}}function unittest_set_rule(opt){if(!gen_auto_unittest())return;try{c_unittest_push(opt.tab_id,"set_rule("+JSON.stringify(opt)+")")}catch(e){console.error(e)}}function gen_auto_unittest(){let conf=CG("auto_unittest",{});return conf&&conf.enable&&ext_ver()&&version_util.cmp(ext_ver(),conf.min_ver||"0.0.0")>=0&&E.is_conf_allowed(conf.on||100)}function get_conf(root,name,def){let conf=CG(root);if(conf&&conf.min_ver&&product_ver()&&version_util.cmp(product_ver(),conf.min_ver)>=0&&E.is_conf_allowed(conf.on||100)){return zutil.get(conf,name,def)}return def}let get_verify_conf=(name,def)=>get_conf("verify_proxy",name,def);let get_proxy_auth_conf=(name,def)=>get_conf("proxy_auth",name,def);let rules;let init_rules=()=>etask((function*init_rules_(){rules=yield api.storage.get("rules");if(!rules){rules={ver:ext_ver()};commit_rules()}if(rules.set)gen_rules(rules.set);if(zutil.is_mocha())E.t.rules=rules;E.emit("local_rules_set",rules.set)}));if(zutil.is_mocha()){E.t={Cache_entry:Cache_entry,choose_strategy:choose_strategy,expected_types:expected_types,extensions:extensions,strategies:strategies,Agents:Agents,get_api:()=>api,ConnectivityCheck:ConnectivityCheck,find_agents:E.find_agents,rules_fixup:rules_fixup,rules:rules,get_strategy:get_strategy,Proxy_rules_engine:Proxy_rules_engine};E.init()}return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},,function(module,__webpack_exports__,__webpack_require__){"use strict";var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_5__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6__);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(41);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7__);var _util_url_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(18);var _util_url_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(35);var _util_array_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(26);var _util_array_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_util_array_js__WEBPACK_IMPORTED_MODULE_10__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(22);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11__);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(38);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12__);var _bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(54);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(29);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14__);var _util_date_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(16);var _util_date_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_15__);var _util_util_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_16__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(33);var _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(42);var _util_storage_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(21);var _util_storage_js__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_19__);var conf__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(24);var conf__WEBPACK_IMPORTED_MODULE_20___namespace=__webpack_require__.t(24,1);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(37);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.assert_bg("be_rule");const SEC=_util_date_js__WEBPACK_IMPORTED_MODULE_15___default.a.ms.SEC,chrome=window.chrome,assign=Object.assign;let be_bg_main,tab_state={},bext_config={};const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default.a.task_model.extend({model_name:"rule",rules:undefined,_defaults:function(){this.on("destroy",()=>E.uninit())}}));let stamp;const CG=(path,def)=>_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.get(bext_config,path,def);_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default.a.be_rule=E;E.tasks=[];E.task_cancel_all=()=>_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.forEach(E.tasks,task=>task.return());E.task_insert=task=>E.tasks.push(task);E.task_remove=task=>_util_array_js__WEBPACK_IMPORTED_MODULE_10___default.a.rm_elm(E.tasks,task);E.uninit=()=>{if(!E.get("inited"))return;E.sp.return();E.off("recover",on_recover);E.off("fetch_rules",fetch_rules);E.off("set_rule",set_rule);E.stopListening();E.clear();E.task_cancel_all();E.rules=undefined};const on_max_redirects=(from,to,urls)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_on_max_redirects(){if(CG("disable_max_redirects"))return;let urules,rules=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_rules();if(!rules||!(urules=rules.unblocker_rules))return;let update;for(let name in urules){let r=urules[name];if(!r.enabled||r.name!=from&&r.name!=to)continue;r.enabled=false;E.set_rule({name:r.name,country:r.country,enabled:r.enabled});update=true}if(!update)return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("max_redirect_rule_disable",{from:from,to:to,urls:urls},{rate_limit:{count:1}});yield E.update_rules(rules)}));E.init=()=>{if(E.get("inited"))return;be_bg_main=window.be_bg_main;E.set("inited",true);E.set("tabs_stub_rules",{});E.set("enable_ts",_util_storage_js__WEBPACK_IMPORTED_MODULE_19___default.a.get("enable_ts"));E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.new_etask("be_rule");E.on("recover",on_recover);E.on("fetch_rules",fetch_rules);E.on("set_rule",set_rule);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a,"change:ext.active change:ext.suspended change:session_key",underscore__WEBPACK_IMPORTED_MODULE_0___default.a.debounce(()=>{set_rules()}));E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a,"completed error_occured",info=>{if(!_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.get(info,"tabId"))return;var fix_task=fix_tasks[info.tabId];if(!fix_task)return;if(!fix_task.fix_waiting)return;fix_task.continue()});E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a,"created",o=>{var tab=o.tab;var stub_rule=E.get_stub_rule(tab.openerTabId);if(tab.openerTabId&&!_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.is_new_tab(tab.url)&&stub_rule)E.set_stub_rule(tab.id,stub_rule)});E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a,"max_redirect_sequence",on_max_redirects);_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.on("local_rules_set",()=>E.update_rules(undefined,{resolve:true}));const set_rules=resolve=>{E.update_rules(bext_config.proxy_rules||null,{resolve:resolve});stamp=bext_config.stamp};E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a,"change:bext_config",()=>{bext_config=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("bext_config")||{};if(bext_config.proxy_rules&&(!stamp||stamp!=bext_config.stamp))set_rules(!stamp)});E.listen_to(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_17__["default"],"change:country",()=>{if(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_17__["default"].get("country"))set_rules()});if(_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.is_mocha())E.update_rules(undefined,{resolve:true})};function on_recover(){E.trigger("fetch_rules")}E.get_rules=(url,ignore)=>_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.get_rules(E.rules,url,ignore);E.get_rule_ratings=args=>_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__["a"].ccgi_ajax({slow:2*SEC,url:conf__WEBPACK_IMPORTED_MODULE_20__.url_ccgi+"/rule_ratings",data:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.qs_ajax(args),perr:opt=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr(opt.id,opt.info,opt)});E.get_groups_from_ratings=ratings=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"get_groups_from_ratings",cancel:true},(function*(){let groups=[];ratings.forEach(cr=>{cr.rules.forEach(r=>{if(r.rating<=0)return;groups.push(underscore__WEBPACK_IMPORTED_MODULE_0___default.a.pick(r,"name","type","country"))})});if(!groups.length)return;groups=yield _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_groups(groups);if(!_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.get(groups,"unblocker_rules"))return groups;_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.forEach(groups.unblocker_rules,r=>delete r.enabled);return groups}));E.update_rules=(rules,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*update_rules(){if(rules)_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.set_rules(rules);if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.is_disabled()||!rules&&rules!==undefined)E.rules=undefined;else{E.rules=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_rules();E.set("rules",E.rules)}yield _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default.a.update_rule_urls(E.rules,opt);E.set("stamp",_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.get(E.rules,"stamp",0))}));function fetch_rules(){if(!E.get("inited"))return;E.task_cancel_all();if(!E.set_busy({desc:"Changing country..."}))return E.schedule_clr(["fetch_rules"]);var auth=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.auth();if(!auth.uuid||!auth.session_key)return E.clr_busy();E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*fetch_rules_(){this.finally(()=>{if(E.get("status")=="busy")E.clr_busy()});try{yield E.update_rules()}catch(e){E.set_err();_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_script_fetch_rules_err",{},{err:e})}})))}E.set_rule=(opt,update)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_set_rule(){if(!opt)return;if(opt.stub)return void E.set_stub_rule(opt.tab_id,opt);if(opt.tab_id)E.set_stub_rule(opt.tab_id,null);if(opt.enabled)opt.src_country=(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_17__["default"].get("country")||"").toLowerCase();if(_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].get_trial_active(opt.name))opt.src="trial";_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.set_rule(opt);E.trigger("rule_set",opt);if(update){yield E.update_rules(undefined,{resolve:opt.enabled,rule:opt,reload:true})}}));function set_tab_state(tab_id,state){if(!tab_id||tab_id==-1)return;var s=tab_state[tab_id]=tab_state[tab_id]||{};if(s.state==state)return;var prev=s.state||"idle";s.state=state;E.trigger("set_tab_state",{tab_id:tab_id,prev:prev,curr:s.state})}const get_tab_id=tab_id=>tab_id===undefined?_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a.get("active.id"):tab_id;E.get_tab_state=tab_id=>(tab_state[get_tab_id(tab_id)]||{}).state||"idle";const set_enable_ts=ts=>{E.set("enable_ts",ts);_util_storage_js__WEBPACK_IMPORTED_MODULE_19___default.a.set("enable_ts",ts)};const set_rule_tasks={};function set_rule(opt){_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.assert(E.get("inited"),new Error("set_rule failed, be_rule not inited"));opt=assign({},opt);const{tab_id:tab_id}=opt;E.task_cancel_all();if(fix_tasks[tab_id])fix_tasks[tab_id].return();if(set_rule_tasks[tab_id])set_rule_tasks[tab_id].return();if(!E.set_busy({desc:opt.enabled?"Finding peers...":"Stopping peer routing..."})){return E.schedule(["set_rule",opt])}E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_set_rule(){set_rule_tasks[tab_id]=this;set_tab_state(opt.tab_id,opt.enabled?"enable_rule":"disable_rule");this.finally(()=>{delete set_rule_tasks[tab_id];E.clr_busy();set_tab_state(tab_id,"idle")});const hola_uid=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("hola_uid");try{if(_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.is_mocha())E.t.set_rule_sp=this;set_tab_state(tab_id,"update_rules");E.update_progress({desc:"Changing country..."});if(!opt.stub&&opt.enabled){_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.reverify_country_agents(opt.country);let to=_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.get(bext_config,"set_rule_timeout",10*SEC);if(to)this.alarm(to,{throw:new Error("timeout")})}yield E.set_rule(opt,true);if(!opt.stub){let r=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.find_rule(E.rules&&E.rules.unblocker_rules,opt);let is_enabled=r&&r.enabled;if(!!is_enabled!=!!opt.enabled)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_set_rule_mismatch",{opt:opt,r:r,hola_uid:hola_uid})}set_tab_state(tab_id,"rule_set");const info={name:opt.name,type:opt.type,country:opt.country,enabled:opt.enabled,hola_uid:hola_uid};if(!E.get("enable_ts")){const ts=Date.now();set_enable_ts(ts);info.first_enable=ts;info.aff_id=be_bg_main.get("aff_id");be_bg_main.ga_send_affiliate_event("Enable Rule")}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_set_rule_ok",info)}catch(e){set_tab_state(tab_id,"set_rule_err");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_script_set_rule_err",{hola_uid:hola_uid},{err:e})}})))}E.is_enabled=rule=>{if(!rule)return true;if(rule.is_mitm&&_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default.a.is_mitm_active(rule.tab_id))return true;if(!E.rules||!E.rules.unblocker_rules)return false;var r=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.find_rule(E.rules.unblocker_rules,rule);return r&&r.enabled};E._change_proxy=opt=>{if(!E.get("inited")||opt.rule.changing_proxy||!E.is_enabled(opt.rule))return;opt.rule.changing_proxy=true;set_tab_state(opt.tab_id,"change_proxy");return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*change_proxy(){this.finally(()=>{opt.rule.changing_proxy=false;E.task_remove(this)});E.task_insert(this);E.update_progress({desc:"Trying another peer..."});const exclude=opt.exclude||_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_active_agents(opt.rule);return yield _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.replace_agents(opt.rule,exclude,assign({src_rule:underscore__WEBPACK_IMPORTED_MODULE_0___default.a.pick(opt.rule,"name","country","force_peer")},underscore__WEBPACK_IMPORTED_MODULE_0___default.a.pick(opt,"user_not_working","agent_not_working")))}))};function get_report(opt){let tab_id=get_tab_id(opt.tab_id),rule=opt.rule||{};let req_errors,user=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].get("user");if(opt.send_logs&&be_bg_main)req_errors=be_bg_main.get_dumped_errors(tab_id);let page_load,trace;if((trace=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a.get_trace(tab_id))&&trace.length)page_load=trace[trace.length-1].duration;let tu=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_tab_unblocker(tab_id)||{};return assign({src_country:opt.src_country||(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_17__["default"].get("country")||"").toLowerCase(),hola_uid:user&&user.hola_uid,url:opt.url||_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a.get("active.url"),root_url:opt.root_url||get_root_url(tab_id),premium:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium"),proxy_country:rule.country&&rule.country.toLowerCase(),tab_id:tab_id,callback_raw:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_13__["a"].get("svc.callback_raw"),callback_ts:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_13__["a"].get("svc.callback_ts"),mode_change_count:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_13__["a"].get("mode_change_count"),multiple_mode_changes:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_13__["a"].get("mode_change_count")>2,real_url:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a.get("active.url"),status:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a.get("active.status"),agent:_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_active_agents(opt.rule),agents:tu.agents,mitm_active:_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default.a.is_mitm_active(tab_id),req_errors:req_errors,src:opt.src,page_load:page_load},underscore__WEBPACK_IMPORTED_MODULE_0___default.a.pick(rule,"name","type"))}E.send_fix_it_report=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*send_fix_it_report_(){if(!E.get("inited"))return;let log,info=get_report(opt);if(opt.send_logs&&be_bg_main){let root_url=get_root_url(info.tab_id);if(CG("debug_logs.domains",[]).includes(root_url)||Math.random()*100<CG("debug_logs.all_domains_perc",0)){log=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get_log()}}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_ui_vpn_click_no_fix_it_multi",info,{err:true});const res=yield _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_ui_vpn_click_no_fix_it",info,{err:true,filehead:log,rate_limit:{count:10}});if(be_bg_main&&_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.get(res,"bug_id"))be_bg_main.set_bug_id(res.bug_id)}));E.send_vpn_work_report=function(opt){var tab_id=get_tab_id(),rule=opt.rule||{};var user=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].get("user");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_vpn_ok",assign({src_country:(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_17__["default"].get("country")||"").toLowerCase(),url:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a.get("active.url"),root_url:get_root_url(tab_id),proxy_country:rule.country&&rule.country.toLowerCase(),hola_uid:user&&user.hola_uid,mitm_active:rule.is_mitm,src:opt.src},underscore__WEBPACK_IMPORTED_MODULE_0___default.a.pick(rule,"name","type")))};var fix_tasks={};E.fix_vpn=opt=>{if(!E.get("inited"))return;opt=_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.clone(opt||{});let ts=Date.now(),tab_id=opt.tab_id;if(fix_tasks[tab_id])fix_tasks[tab_id].return();set_tab_state(tab_id,"fix_vpn");return fix_tasks[tab_id]=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true,async:true},(function*fix_vpn_(){this.finally(()=>{delete fix_tasks[tab_id];set_tab_state(tab_id,"idle")});try{let agent;let tu=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_tab_unblocker(tab_id);if(tu&&(agent=tu.last_agent)&&agent.pool){yield _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default.a._set_req_err("fix_vpn",agent,{url:opt.url,tab_id:tab_id,status:-1})}_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default.a.reauth_rule_agents(opt.rule);yield E.change_proxy_wait({rule:opt.rule,desc:"not_working",root_url:opt.root_url,user_not_working:true,tab_id:tab_id});_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.notice("tab:%d reloading tab on fix_vpn",tab_id);_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a.reload(tab_id);if(_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.is_mocha()||Date.now()-ts>=10*SEC)return;while(true){const trace=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a.get_trace(tab_id);const last_trace=trace&&trace.length&&trace[trace.length-1];const status=_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.get(last_trace,"status");if(status){let page_load=_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.get(last_trace,"duration");return page_load<20*SEC&&!["4","5"].includes(status[0])}this.fix_waiting=true;yield this.wait(20*SEC);this.fix_waiting=false}}catch(e){set_tab_state(tab_id,"fix_vpn_err");this.fix_waiting=false;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_fix_vpn_err",opt,{err:e})}}))};function get_root_url(tab_id){var url;return tab_id>=0&&(url=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a.get_url(tab_id))&&_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.get_root_url(url)}E.change_proxy=(details,reason,route_opt)=>{if(!E.get("inited"))return;var tu=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_tab_unblocker(details.tabId);var exclude=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_chosen_agent(route_opt,tu.rule);var root_url=get_root_url(details.tabId);if(!exclude){var route=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.gen_route_str(route_opt,{no_algo:true});_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.debug("tab:%d no agents for %s route, root_url: %s",details.tabId,route,root_url);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("debug_null_agents",{agents:_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_active_agents(tu.rule),details:details},{err:true})}exclude=_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.omit(exclude,"rtt");const host=exclude&&exclude.host;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("change_proxy_on_err",{reason:reason,bad_agent:host});_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default.a.debug("tab:%d change agent on %s, bad agents: [%s], root_url: %s",details.tabId,reason,host,root_url);return E._change_proxy({rule:tu.rule,exclude:exclude?[exclude]:[],root_url:root_url||"",agent_not_working:true})};E.disable_premium=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*disable_premium(){E.set_rule({name:"all_browser",country:"us",del:true,enabled:false});let urules,rules=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_rules();if(!rules||!(urules=rules.unblocker_rules))return;for(let name in urules){let site_conf,r=urules[name];if(!r.enabled||!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].get_force_premium_rule(r.name)&&!((site_conf=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get_site_conf(r.name))&&site_conf.require_plus)){continue}r.enabled=false;E.set_rule({name:r.name,country:r.country,enabled:r.enabled})}yield E.update_rules(rules)}));E.disable_trial=domains=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*disable_trial(){let update,rules=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_rules();if(!rules)return;domains.forEach(domain=>{let rule=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.get_rules(rules,"http://"+domain+"/",true);if(!(rule=rule&&rule[0])||!rule.enabled||rule.src!="trial")return;let unblockers=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default.a.tab_unblockers||{};for(let tabid in unblockers){let uri,u=unblockers[tabid];if(!u.rule||u.rule.name!=rule.name||!(tabid=+tabid))continue;if(uri=_util_url_js__WEBPACK_IMPORTED_MODULE_8___default.a.parse(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default.a.get_url(tabid))){chrome.tabs.update(tabid,{url:uri.protocol+"//"+uri.hostname})}}rule.enabled=false;E.set_rule({name:domain,country:rule.country,enabled:rule.enabled,src:"trial"});update=true});if(update)yield E.update_rules(rules)}));E.change_proxy_wait=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*change_proxy_wait_(){this.finally(()=>set_tab_state(opt.tab_id,"idle"));if(E.get("status")!="busy")return yield E._change_proxy(opt);E.once("change:status",()=>this.continue(E._change_proxy(opt)));return yield this.wait()}));E.set_stub_rule=(tab_id,rule)=>{let tabs_stub_rules=assign({},E.get("tabs_stub_rules"));if(_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.get(rule,"enabled"))tabs_stub_rules[tab_id]=rule;else delete tabs_stub_rules[tab_id];E.set("tabs_stub_rules",tabs_stub_rules)};E.get_stub_rule=tab_id=>(E.get("tabs_stub_rules")||{})[tab_id];if(_util_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.is_mocha())E.t={on_max_redirects:on_max_redirects};__webpack_exports__["a"]=E},function(module,exports,__webpack_require__){"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;// LICENSE_CODE ZON
!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(15),__webpack_require__(17),__webpack_require__(11),__webpack_require__(14),__webpack_require__(29),__webpack_require__(20),__webpack_require__(28),__webpack_require__(22),__webpack_require__(23),__webpack_require__(18),__webpack_require__(16),__webpack_require__(12),__webpack_require__(73),__webpack_require__(13),__webpack_require__(10),__webpack_require__(74),__webpack_require__(26),__webpack_require__(94),__webpack_require__(31),__webpack_require__(38),__webpack_require__(21),__webpack_require__(48),__webpack_require__(33),__webpack_require__(75),__webpack_require__(36),__webpack_require__(37),__webpack_require__(42),__webpack_require__(27),__webpack_require__(46),__webpack_require__(95),__webpack_require__(30),__webpack_require__(62),__webpack_require__(44),__webpack_require__(24)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,be_backbone,etask,be_util,be_tabs,be_ext,B,svc_vpn_util,zescape,zurl,date,zerr,browser,be_vpn_util,zutil,be_pac,array,attrib,string,unblocker_lib,storage,ajax,be_info,mitm_lib,be_svc,be_premium,be_trial,version_util,rate_limit,match,bg_util,pac_engine,be_dev_mode,conf){be_trial=be_trial.default;be_dev_mode=be_dev_mode.default;be_info=be_info.default;be_pac=be_pac.default;be_svc=be_svc.default;be_premium=be_premium.default;bg_util=bg_util.default;be_vpn_util.assert_bg("be_tab_unblocker");function get_bg_main(){return window.be_bg_main}const assign=Object.assign;let chrome=window.chrome;let proxy_debug,debug_hooks;let requests_handler;let host_tracker;const E=new(be_backbone.model.extend({model_name:"tab_unblocker",tab_unblockers:{},requests:{},agent_requests:{},internal_reqs:{},routing_reqs:{},_defaults:function(){this.on("destroy",()=>E.uninit())}}));const CG=(path,def)=>zutil.get(bext_config,path,def);const TUNNEL_ERR="net::ERR_TUNNEL_CONNECTION_FAILED";const cb_wrapper=zerr.catch_unhandled_exception;function ff_cb_wrapper(){const args=array.slice(arguments,1);return zerr.catch_unhandled_exception.apply(zerr,args)}let bext_config={};const is_chrome=be_util.browser_guess.browser=="chrome";const is_firefox=be_util.browser_guess.browser=="firefox";const force_strategy=storage.get("be_force_strategy");const load_errors={},tab_loads={};const bw_perr_acc=new bg_util.Bw_perr_acc;const mitm_tab_hooks=[{l:"onBeforeRequest",cbname:"on_before_request",extra_opt:true},{l:"onCompleted",cbname:"on_completed"},{l:"onErrorOccurred",cbname:"on_error_occurred"}];const err_logs_len=20;const req_types={media:{chrome:{min_ver:58},opera:{min_ver:45}}};const ff_webext=conf.firefox_web_ext2;let request_errors={},proxy_req_slow={agents:{}},pages={};const main_frame_errors={ERR_DNS_FAILED:true,ERR_AUTH_REQUIRED:true,[TUNNEL_ERR]:true};const is_main_frame=d=>!d.frameId&&d.type=="main_frame";let hola_req_id=0;function make_internal_request(url,hdrs,opt){let req_url;req_url=opt.no_redirect?url:"http://internal.hola/"+ ++hola_req_id;E.internal_reqs[req_url]={url:url,hdrs:hdrs,opt:opt};return req_url}function hola_XMLHttpRequest(url,method,hdrs,opt){const xhr=new XMLHttpRequest;const req_url=make_internal_request(url,hdrs,opt);xhr.hola_url=req_url;xhr.open(method,req_url);return xhr}function hdrs_arr_to_obj(hdrs){const _hdrs={};hdrs.forEach(e=>_hdrs[e.name]=e.value);return _hdrs}function routing_reqs_set(details,req){let url=req.url;if(!E.routing_reqs[url])E.routing_reqs[url]={req:req};E.routing_reqs[url].to=be_vpn_util.set_timeout(()=>delete E.routing_reqs[url],1e4,{sp:E.sp,name:"del_routing_reqs"})}function send_direct_ajax(req){if(req.direct_req)return;req.hdrs=hdrs_arr_to_obj(req.hdrs);req.hdrs["Cache-Control"]="no-cache";try{const xhr=req.direct_req=hola_XMLHttpRequest(req.url,req.method,req.hdrs,{force:"direct",ignore_redir:true,no_routing:true});xhr.onreadystatechange=cb_wrapper(()=>{let cmd;if(xhr.readyState===xhr.DONE){let ir=E.internal_reqs[req.url]||{};if(!req.direct_resp&&ir.res)req.direct_resp={code:ir.res.code,error:ir.res.error};cmd=req.strategy(req.direct_resp,req.proxy_resp)||{};delete E.internal_reqs[req.url];delete E.internal_reqs[xhr.hola_url]}if(xhr.readyState!=xhr.HEADERS_RECEIVED)return;req.direct_resp={code:xhr.status,len:xhr.getResponseHeader("Content-Length"),te:xhr.getResponseHeader("Transfer-Encoding"),lmod:xhr.getResponseHeader("Last-Modified"),etag:xhr.getResponseHeader("Etag"),type:xhr.getResponseHeader("Content-Type")};function direct_req_abort(){if(req.direct_req.abort)return req.direct_req.abort()}req.direct_timeout=be_vpn_util.clear_timeout(req.direct_timeout);cmd=req.strategy(req.direct_resp,req.proxy_resp)||{};if(cmd.proxy.serve&&!cmd.direct.serve)return void direct_req_abort();const cc=xhr.getResponseHeader("Cache-Control");if(cc&&(/no-store/.test(cc)||/(no-cache|must-revalidate|max-age)/.test(cc)&&!req.direct_resp.lmod&&!req.direct_resp.etag)){direct_req_abort()}});xhr.send()}catch(e){}}function hdrs_add(hdrs,name,value){hdrs.push({name:name,value:value});return true}function get_site_verify_conf(req,rule){if(!req||!req.proxy_resp||!rule)return false;if(req.method!="GET")return false;return be_util.get_site_verify_conf(rule.name,req.url,rule.country)}const is_trial=root_url=>!be_premium.is_active()&&(!!be_trial.get_trial_active(root_url)||be_trial.is_trial_grace_period(root_url));function is_force_proxy(country,opt){opt=opt||{};const r=opt.rule,tu=opt.tab_unblocker||{};if(!r||!r.name||!be_ext.get("is_premium")&&(!E.rules||(E.rules.blacklist||{})[r.name]||tu.force_premium)){return}return is_trial(r.name)||be_premium.is_active()&&(r.mode=="protect"||tu.force_premium||be_ext.get("is_premium"))}const is_direct_on_tab_laod_err=tab_id=>!CG("disable_direct_on_err")&&E.get_tab_load_err(tab_id);function get_forced_strategy(details,rule,mitm_rule,strict,opt){let force;if(force=strict||opt.force)return force;if(opt.no_rule||is_direct_on_tab_laod_err(details.tabId)||!be_ext.get("is_premium")&&rule.name&&be_util.is_google(rule.name)&&(!mitm_rule||mitm_rule.cmd=="ignore")){return"direct"}}function on_hooks_err(id,err){be_util.perr(id,{},{err:err,rate_limit:{count:1}});zerr("on_hooks_err %s %s",err,err&&err.stack);if(zutil.is_mocha())process.exit(1)}function is_redir_status(status,tmp_only){return{302:1,303:1,307:1}[status]||!tmp_only&&+status==301}function is_auth_done_url(url){return/^https?:\/\/hola\.org\/users\/auth\/\w+\/done/.test(url)}const debug_bw_req={};function debug_bw(event,d){switch(event){case"headers_received":debug_bw_req[d.requestId]={url:d.url,ts:Date.now()};break;case"completed":let t=Date.now();let headers=d.responseHeaders;let len_o=headers&&headers.find(o=>o.name=="Content-Length");let len=+zutil.get(len_o,"value");if(len){let dur=t-d.timeStamp;let dur2=t-debug_bw_req[d.requestId].ts;let bw=dur?len/dur2/1e3:0;console.log("XXX on_completed dur %sms dur2 %s len %sb bw "+"%sMB/s %o",dur,dur2,len,parseInt(bw),d)}break;default:zerr("unexpected debug_bw event %s %o",event,d);break}}let debug_pac_interval;function start_debug_pac(){stop_debug_pac();debug_pac_interval=setInterval(()=>{let xhr=new XMLHttpRequest;xhr.open("POST","http://__hola__.pac_get_log.local.hola/?rnd="+Math.random(),true);xhr.send(null)},1e3)}function stop_debug_pac(){debug_pac_interval=clearInterval(debug_pac_interval)}class Base_handler{constructor(){this.listener_opt={urls:["<all_urls>"]};this.listener_extra_opt=["blocking","requestBody"];this.tab_unblocker_end_cb=cb_wrapper(this._unsafe_tab_unblocker_end_cb.bind(this));this.on_before_send_headers=this.wrap("on_before_send_headers",d=>{this.tab_unblocker_cb(d=assign({},d,{handler:this._on_before_send_headers.bind(this),cbname:"on_before_send_headers",ret:{}}));return d.ret},true);this.on_headers_received=this.wrap("on_headers_received",d=>{this.tab_unblocker_cb(d=assign({},d,{handler:this._on_headers_received.bind(this),cbname:"on_headers_received",ret:{}}));return d.ret},true);this.on_completed=this.wrap("on_completed",d=>{this.tab_unblocker_end_cb(d=assign({},d,{cbname:"on_completed",ret:{}}));delete this.cached_reqid[d.requestId];return d.ret},true);this.on_error_occurred=this.wrap("on_error_occurred",d=>{this.tab_unblocker_end_cb(assign(d,{cbname:"on_error_occurred",ret:{}}));return d.ret});this.on_headers_received_cache=cb_wrapper(d=>{let url;if(!E.rules||!(url=be_tabs.get_nav_tab_url(d.tabId)))return;if(_.findWhere(E.rules.unblocker_rules,{enabled:true,link:svc_vpn_util.get_root_url(url)})&&!this.cached_reqid[d.requestId]){this.cached_reqid[d.requestId]=true;return{redirectUrl:zescape.uri(d.url,{ts:Date.now()})}}});this.on_headers_received_page=cb_wrapper(d=>{if(!d||!is_main_frame(d))return;let status=d.statusCode||bg_util.http_status_to_node(d.statusCode,d.statusLine).statusCode;if(!status)return;status=d.statusCode=""+status;be_tabs.page_trace(d,"on_headers_received");on_main_frame_headers(d);if(is_auth_done_url(d.url))be_premium.schedule_refresh_user({reason:"auth_done_url"});const res=bg_util.nodify_res(d);const tu=E.get_tab_unblocker(d.tabId);const req=E.requests[d.requestId],agent=req&&req.agent;if(is_redir_status(status)){be_tabs.track_redirect({id:d.tabId,info:d,url:d.url});const location=res.headers.location;const redir=tu&&agent&&be_util.find_conf_rule_by_url(tu.site_conf,"redirect",location);if(redir&&redir.action=="change_agent"){fix_req_err(tu,agent,assign({error:"redirect"},d),req.route_opt);req.cancel=true}return req&&req.cancel?{cancel:true}:undefined}if(!{4:1,5:1}[status[0]])return;be_tabs.trigger("error_occured",{id:d.tabId,info:{type:d.type,http_status_code:status}});if(!CG("disable_cf_fix")&&tu&&agent&&d.statusCode==403&&res.headers.server=="cloudflare"&&!res.headers["cf-chl-bypass"]){fix_req_err(tu,agent,assign({error:"cf"},d),req.route_opt);req.cancel=true;return{cancel:true}}});this.on_completed_debug_page=this.wrap("on_completed_debug_page",d=>{let rule_info;if(!d||d.fromCache||!d.ip||!is_main_frame(d)||E.requests[d.requestId]||E.get_tab_unblocker(d.tabId)||(rule_info=get_rule_info_from_url(d.url))&&rule_info.tabs[d.tabId]){return}let agents=unblocker_lib.find_agents({ip:d.ip});if(agents.length){be_util.perr("proxy_req_unexpected",{details:d,agent:agents[0].info()},{rate_limit:{count:1}})}});this.on_before_send_headers_debug=ff_cb_wrapper("on_before_send_headers_debug",d=>{d=assign({},d,{ret:{}});const req=E.requests[d.requestId],agent=req&&req.agent;const store=E.tab_unblockers[d.tabId]||this;const last_agent=store.last_agent||{};if(!agent||agent.ip==last_agent.ip&&agent.port==last_agent.port)return d.ret;zerr.notice("tab:%d proxy agent selected %O %s",d.tabId,agent,req.url.slice(0,100));let rule;if(rule=req.opt.rule){zerr.notice("tab:%d rule %O",d.tabId,zutil.pick(rule,"id","name","country","description"))}store.last_agent=agent;return d.ret});this.on_headers_received_debug=ff_cb_wrapper("on_headers_received_debug",d=>{d=assign({},d,{ret:{}});let req,res,tu,host;if((req=E.requests[d.requestId])&&req.agent&&(tu=E.get_tab_unblocker(d.tabId))&&(res=bg_util.nodify_res(d))&&is_hola_agent_auth(res)&&(host=req.agent.host)){host=host.split(".")[0];let rl,debug_auth=tu.debug_auth=tu.debug_auth||{};if(!(rl=debug_auth[host]))rl=debug_auth[host]={total:0};rl.total++}return d.ret});this.on_completed_debug=ff_cb_wrapper("on_completed_debug",d=>{const req=E.requests[d.requestId];if(!req)return;const rule=be_vpn_util.get_rule_min_fmt(req.opt.rule);const limit={count:1,ms:date.ms.MIN};const info={url:req.url,ip:d.ip,method:req.method,agent:req.agent,rule:rule};let verify;if((verify=get_site_verify_conf(req,rule))&&verify.ret&&verify.ret.status==req.proxy_resp.code){be_util.perr("bw_req_err_"+verify.id,assign({error:req.proxy_resp.code},info),{rate_limit:limit})}const tab_unblocker=E.get_tab_unblocker(d.tabId);const is_proxy_req=tab_unblocker&&rule&&req.proxy_req&&req.serving=="proxy"&&req.agent;let min_ver;if(is_proxy_req&&d.ip&&(min_ver=bext_config.ip_check_min_ver)&&version_util.cmp(be_util.version(),min_ver)>=0&&req.agent.ip!=d.ip&&!d.fromCache){let mismatch_perr_id="req_agent_ip_mismatch";if(unblocker_lib.find_agents({ip:d.ip}).length)mismatch_perr_id="req_agent_ip_mismatch_agent";be_util.perr(mismatch_perr_id,info,{rate_limit:{count:1}});svc_vpn_util.push_event("pac_miss",{req_ip:d.ip,agent_ip:req.agent.ip,url:req.url})}let dur=Date.now()-req.start_ts;if(is_proxy_req&&!bext_config.disable_monitor_slow&&dur>10*date.ms.SEC){let s;if(!(s=proxy_req_slow[rule.name])){s=proxy_req_slow[rule.name]={10:0,20:0,60:0,max:0};monitor_proxy_req_slow()}let agent=req.agent.host||req.agent.ip;proxy_req_slow.agents[agent]=(proxy_req_slow.agents[agent]||0)+1;s[dur>60*date.ms.SEC?"60":dur>20*date.ms.SEC?"20":"10"]++;s.max=Math.max(dur,s.max);zerr.debug("tab:%d slow request detected - %d ms, agent %s, "+"url %s",d.tabId,dur,agent,req.url.slice(0,200))}if(!d.error||!tab_unblocker)return;let rl_path="debug_errors."+d.error+"."+!!req.agent,rl;if(!(rl=zutil.get(tab_unblocker,rl_path)))zutil.set(tab_unblocker,rl_path,rl={total:0});rl.total++;if(!rate_limit(rl,limit.ms,limit.count))return;zerr.debug("tab:%d request failed with error %s after %d ms, "+"total cnt %d, rule %s, type %s, method %s, agent %s, url %s",d.tabId,d.error,dur,rl.total,rule&&rule.name,d.type,req.method,req.agent&&req.agent.host,req.url.slice(0,200))});this.on_headers_received_media=ff_cb_wrapper("on_headers_received_media",d=>{let media_failure;if(!(media_failure=get_failure_config("media")))return;let req,tab;if(d.tabId<0||!(tab=E.tab_unblockers[d.tabId])||!(req=E.requests[d.requestId])){return}tab.media_chunks=tab.media_chunks||0;const media_agents=tab.media_agents=tab.media_agents||{};const agent=req.agent&&req.agent.host;if(d.statusCode==200){tab.media_chunks++;if(agent)media_agents[agent]=(media_agents[agent]||0)+1;return}if(!/^(4|5)/.test(d.statusCode)||d.statusCode==407)return;if(agent)tab.media_failures=(tab.media_failures||0)+1;zerr.notice("tab:%d media failure detected: %d, %s %s",d.tabId,d.statusCode,agent,d.url.slice(0,200));this.dump_media_stats(d.tabId,"error");fix_media_req_err(zutil.get(req,"opt.rule"),req.agent,d,tab,req.route_opt,media_failure)})}wrap(name,cb,ff){const cb_wrap=cb=>ff?ff_cb_wrapper(name,cb):cb_wrapper(cb);return cb_wrap(cb)}static get_handler(){if(zutil.get(window,"browser.proxy.onRequest"))return new Ff_new_handler;return new Chrome_handler}init(){if(this.inited)return;this.inited=true;this.cached_reqid={};this.update_hooks();this.init_media_stats();return true}uninit(){if(!this.inited)return;this.inited=false;this.uninit_media_stats();this.update_hooks();this.cached_reqid={};return true}update_hooks(mode){let add_global=()=>{if(!this.global_hooks)this.global_hooks=this.add_hooks("main_frame")};let rm_global=()=>{if(this.global_hooks)this.global_hooks=this.remove_hooks(this.global_hooks)};let add_local=()=>{for(let tabid in E.tab_unblockers){let tab=E.tab_unblockers[tabid];if(!tab.hooks)tab.hooks=this.add_hooks(tabid)}};let rm_local=()=>{for(let tabid in E.tab_unblockers){let tab=E.tab_unblockers[tabid];if(tab.hooks)tab.hooks=this.remove_hooks(tab.hooks)}};let add_debug=()=>{if(!this.debug_hooks)this.debug_hooks=this.add_debug_hooks()};let rm_debug=()=>{if(this.debug_hooks)this.debug_hooks=this.remove_hooks(this.debug_hooks)};if(mode=="all_browser")return rm_local();if(!this.inited){rm_global();rm_debug();rm_local()}else{add_global();add_debug();add_local()}}add_debug_hooks(){if(!bext_config.debug_hooks)return;let hooks={};try{let topt={urls:["<all_urls>"],types:["main_frame"]};hooks.on_completed_debug_page=this.on_completed_debug_page.bind(this);chrome.webRequest.onCompleted.addListener(hooks.on_completed_debug_page,topt)}catch(e){on_hooks_err("be_add_debug_hooks_err",e)}return hooks}add_hooks(tabid){let hooks={},_this=this;try{if(tabid=="main_frame"){let topt={urls:["<all_urls>"],types:["main_frame"]};hooks.on_headers_received_page=this.on_headers_received_page.bind(this);chrome.webRequest.onHeadersReceived.addListener(hooks.on_headers_received_page,topt,["responseHeaders"]);return hooks}tabid=+tabid;assign(hooks,{on_before_send_headers:this.on_before_send_headers.bind(this),on_headers_received:this.on_headers_received.bind(this),on_completed:this.on_completed.bind(this),on_error_occurred:this.on_error_occurred.bind(this)});let opt=tabid>=0?assign({tabId:tabid},this.listener_opt):this.listener_opt;if(debug_hooks){hooks.on_completed_debug=this.on_completed_debug.bind(this);chrome.webRequest.onCompleted.addListener(hooks.on_completed_debug,opt);hooks.on_error_occurred_debug=this.on_completed_debug.bind(this);chrome.webRequest.onErrorOccurred.addListener(hooks.on_error_occurred_debug,opt)}chrome.webRequest.onBeforeSendHeaders.addListener(hooks.on_before_send_headers,opt,["blocking","requestHeaders"]);chrome.webRequest.onHeadersReceived.addListener(hooks.on_headers_received,opt,["blocking","responseHeaders"]);chrome.webRequest.onCompleted.addListener(hooks.on_completed,opt);chrome.webRequest.onErrorOccurred.addListener(hooks.on_error_occurred,opt);let failure_opt;if(failure_opt=_this.get_failure_opt(tabid,"media",opt)){const hname="on_headers_received_media";hooks[hname]=_this[hname].bind(_this);chrome.webRequest.onHeadersReceived.addListener(hooks[hname],failure_opt,["responseHeaders"]);hooks.media_interval=be_vpn_util.set_interval(_this.dump_media_stats.bind(_this,tabid,"interval"),10*date.ms.MIN,{sp:E.sp,name:"dump_media_stats"})}let topt={urls:["*://*/*wor*/*i*/1*.js","*://*/*wor*/*i*/2*.js*"]};if(opt.tabId>=0)topt.tabId=opt.tabId;hooks.on_headers_received_cache=this.on_headers_received_cache.bind(this);chrome.webRequest.onHeadersReceived.addListener(hooks.on_headers_received_cache,topt,["blocking","responseHeaders"]);if(!debug_hooks)return hooks;hooks.on_before_send_headers_debug=this.on_before_send_headers_debug.bind(this);chrome.webRequest.onBeforeSendHeaders.addListener(hooks.on_before_send_headers_debug,opt,["blocking","requestHeaders"]);hooks.on_headers_received_debug=this.on_headers_received_debug.bind(this);chrome.webRequest.onHeadersReceived.addListener(hooks.on_headers_received_debug,opt,["blocking","responseHeaders"])}catch(e){on_hooks_err("be_add_hooks_err",e)}return hooks}get_failure_opt(tabid,name,opt){let failure;if(!(failure=get_failure_config(name)))return;let types,ext=failure.extensions||[];if(types=failure.types){const g=be_util.browser_guess;types=types.filter(t=>{let min;return!(min=zutil.get(req_types[t],g.browser+".min_ver"))||g.version>=min})}let urls=[],root_url;if(root_url=tabid>=0&&be_tabs.get_url(tabid))root_url=svc_vpn_util.get_root_url(root_url);let rules=failure.rules||[];if(root_url)rules=rules.filter(r=>r.domain==root_url);rules.forEach(r=>{if(r.urls)urls=urls.concat(r.urls);if(r.extensions)ext=ext.concat(r.extensions)});ext=array.unique(ext);ext.forEach(e=>urls.push("*://*/*."+e,"*://*/*."+e+"?*"));urls=array.unique(urls);if(urls.length)return assign({},opt,{urls:urls,types:types})}init_media_stats(){if(this.on_video_progress)return;E.on("video_progress",this.on_video_progress=msg=>{const tab=E.get_tab_unblocker(msg.tab_id);if(tab&&msg.progress)tab.video_progress=(tab.video_progress||0)+msg.progress});E.listenTo(be_ext,"change:ui_open",this.on_ui_open=function(c,ui){if(ui&&ui.tab_id)this.dump_media_stats(ui.tab_id,"ui_open")}.bind(this))}uninit_media_stats(){if(this.on_video_progress)E.off("video_progress",this.on_video_progress);this.on_video_progress=null;if(this.on_ui_open)E.stopListening(be_ext,"change:ui_open",this.on_ui_open);this.on_ui_open=null}dump_media_stats(tab_id,reason){const tab=E.get_tab_unblocker(tab_id);if(!tab||!tab.media_agents)return;zerr.debug("tab:%d media stats on %s: %d sec played, %d chunks "+"received, agents %O",tab_id,reason,tab.video_progress||0,tab.media_chunks||0,tab.media_agents||{});tab.media_chunks=0;tab.media_agents={};tab.video_progress=0}remove_hooks(hooks){try{if(hooks.on_completed_debug){chrome.webRequest.onCompleted.removeListener(hooks.on_completed_debug)}if(hooks.on_error_occurred_debug){chrome.webRequest.onErrorOccurred.removeListener(hooks.on_error_occurred_debug)}if(hooks.on_before_send_headers){chrome.webRequest.onBeforeSendHeaders.removeListener(hooks.on_before_send_headers)}if(hooks.on_headers_received){chrome.webRequest.onHeadersReceived.removeListener(hooks.on_headers_received)}if(hooks.on_completed){chrome.webRequest.onCompleted.removeListener(hooks.on_completed)}if(hooks.on_error_occurred){chrome.webRequest.onErrorOccurred.removeListener(hooks.on_error_occurred)}if(hooks.on_headers_received_cache){chrome.webRequest.onHeadersReceived.removeListener(hooks.on_headers_received_cache)}if(hooks.on_headers_received_page){chrome.webRequest.onHeadersReceived.removeListener(hooks.on_headers_received_page)}if(hooks.on_completed_debug_page){chrome.webRequest.onCompleted.removeListener(hooks.on_completed_debug_page)}if(hooks.on_before_send_headers_debug){chrome.webRequest.onBeforeSendHeaders.removeListener(hooks.on_before_send_headers_debug)}if(hooks.on_headers_received_debug){chrome.webRequest.onHeadersReceived.removeListener(hooks.on_headers_received_debug)}if(hooks.on_headers_received_media){chrome.webRequest.onHeadersReceived.removeListener(hooks.on_headers_received_media)}if(hooks.media_interval)be_vpn_util.clear_interval(hooks.media_interval)}catch(e){on_hooks_err("be_rm_hooks_err",e)}}gen_proxy_req(){}_on_first_request(details,opt){const url=details.url,rule=opt.rule||{};let req=E.requests[details.requestId];let country=opt.country||rule.country||"";if(!req){req=E.requests[details.requestId]={id:details.requestId,url:url,method:details.method,type:details.type,opt:opt,route_opt:{direct:1},start_ts:Date.now(),tab_id:details.tabId,ret:details.ret};let strict=!E.internal_reqs[details.url]&&force_strategy;const mitm_rule=mitm_lib.inited&&mitm_lib.get_tab_rule(details.tabId,details.initiator||details.url);const force=get_forced_strategy(details,rule,mitm_rule,strict,opt);const proxy_country=country.toUpperCase();let min_ver;req.strategy=unblocker_lib.handle_request(url,{force:force,top_url:rule.name?zurl.add_proto(rule.name)+"/":opt.int_req&&opt.int_req.hdrs?opt.int_req.hdrs.Referer:null,root_url:rule.name,type:is_main_frame(details)?"main_frame":details.type,method:details.method,country:proxy_country,proxy_country:proxy_country,src_country:be_info.get("country"),premium:force!="direct"&&!!is_force_proxy(country,opt),is_trial:is_trial(rule.name)&&(!(min_ver=bext_config.trial_rules_disable_min_ver)||version_util.cmp(be_util.version(),min_ver)<0),full_vpn:!bext_config.default_strategy,strict:strict});if(mitm_lib.inited&&(be_ext.get("is_premium")||!mitm_rule||mitm_rule.auto_unblock||!be_util.is_google(mitm_rule.name))){req.strategy=mitm_lib.strategy_wrapper(req.strategy,req,details.initiator||url)}const t=E.get_tab_unblocker(details.tabId);if(t){if(proxy_debug){if(t.track.strategy!=req.strategy.desc||Date.now()-t.track.last>30*date.ms.SEC){if(t.track.counter){zerr.info("STRATEGY: %s tab:%d - %d urls - %O",t.track.strategy,details.tabId,t.track.counter,Object.keys(t.track.domains))}zerr.info("STRATEGY: %s tab:%d %s",req.strategy.desc,details.tabId,req.url.slice(0,256));t.track.counter=0;t.track.strategy=req.strategy.desc;t.track.domains={};t.track.last=Date.now()}t.track.counter++;t.track.domains[zurl.get_host(req.url)]=true}t.req_total_n=(t.req_total_n||0)+1;t.req_stats.total_n=(t.req_stats.total_n||0)+1}}req.proxy_req=false;if(req.cancel){unblocker_lib.on_before(req.url,req.id,{err:"cancel"});return void(details.ret.cancel=true)}const cmd=req.cmd=req.strategy(req.direct_resp,req.proxy_resp);if(!cmd){return void unblocker_lib.on_before(req.url,req.id,details.tabId,{err:"no_cmd"})}E.set("activity",Date.now());country=zutil.get(cmd,"proxy.country",country);if(req.serving){if(req.serving=="proxy"){if(cmd.proxy){return void this.gen_proxy_req(req,details,cmd,{country:country})}be_util.perr("be_debug_no_cmd_proxy",{desc:req.strategy.desc,cmd:cmd},{err:true,rate_limit:{count:1}})}}else if(cmd.proxy){if(cmd.direct&&cmd.direct.serve)req.serving="direct";else if(cmd.proxy.serve){req.serving="proxy";this.gen_proxy_req(req,details,cmd,{country:country})}else if(cmd.proxy.start)this.gen_proxy_req(req,details,cmd,{country:country});else if(cmd.direct.start)req.direct_req=true;else if(cmd.proxy.abort)return void(details.ret.cancel=true);if(cmd.direct&&cmd.direct.abort&&req.direct_req)req.direct_req.abort()}else if(cmd.direct){if(cmd.direct.serve)req.serving="direct";else if(cmd.direct.start)req.direct_req=true;else if(cmd.direct.abort)details.ret.cancel=true}unblocker_lib.on_before(req.url,req.id,req.tab_id,{strategy:req.strategy&&req.strategy.desc,agent:req.proxy_req&&req.proxy_req.host})}_on_before_send_headers(details){const url=details.url,req=E.requests[details.requestId];const req_hdrs=details.requestHeaders;let hdrs,modified=0;if(!req||!req.strategy)return;if(be_dev_mode.get("debug_pac")){let proto=zurl.get_proto(url),host=zurl.get_host(url);let _url=proto=="http"?url:proto+"://"+host+"/";let ret=pac_engine.FindProxyForURL(_url,host);let exp=req.proxy_str||"DIRECT";if(ret==exp){zerr.notice("virtual_pac FindProxyForURL OK %s exp %s url %s",ret,exp,url)}else{zerr("virtual_pac FindProxyForURL MISS %s exp %s url %s",ret,exp,url)}}const int_req=req.opt.int_req;if(hdrs=int_req&&int_req.hdrs){for(let h in hdrs)modified|=hdrs_add(req_hdrs,h,hdrs[h])}const cmd=req.strategy(req.direct_resp,req.proxy_resp)||{};if(req.serving);else if(cmd.proxy){if(cmd.direct&&cmd.direct.start&&!req.direct_req){req.hdrs=req_hdrs;send_direct_ajax(req)}if(cmd.proxy.start&&cmd.proxy.hdrs_only&&url.startsWith("http:")&&!url.includes(":443/")){modified|=hdrs_add(req_hdrs,"X-Hola-Headers-Only","1")}}if(modified)details.ret.requestHeaders=req_hdrs}tab_unblocker_cb(details){let url;if(!(url=details.url))return;let tab_unblocker=E.get_tab_unblocker(details.tabId);const is_main=is_main_frame(details);if(!ff_webext&&!be_pac.has_pac)return;let rule_info,req,handler=details.handler;if(req=E.requests[details.requestId])return handler(details,req.opt);if(req=E.routing_reqs[url]){delete E.routing_reqs[url];req.to=be_vpn_util.clear_timeout(req.to);req=req.req;req.id=details.requestId;E.requests[details.requestId]=req;return handler(details,req.opt)}if(req=E.internal_reqs[url]){if(zurl.get_host(url)=="internal.hola"){req.reqid=details.requestId;E.internal_reqs[req.url]=req;delete E.internal_reqs[url];req.is_redirected=true;return void(details.ret.redirectUrl=req.url)}if(req.opt&&req.opt.no_redirect)req.reqid=details.requestId;if(req.reqid==details.requestId)return handler(details,assign({},req.opt,{int_req:req}))}if(details.cbname!="on_before_request"&&details.cbname!="on_proxy_request"){return}if(is_main){rule_info=get_rule_info_from_url(url);if(!tab_unblocker){if(rule_info&&details.tabId!=-1){if(!(tab_unblocker=tab_unblocker_add(details.tabId,rule_info,url))){return}}}else if(!rule_info||rule_info.root_url!=tab_unblocker.root_url){tab_unblocker_del(details.tabId);if(!rule_info||!(tab_unblocker=tab_unblocker_add(details.tabId,rule_info,url))){return}}let site,redir,force_redir;if(tab_unblocker&&rule_info&&rule_info.rule.src=="trial"&&(site=tab_unblocker.site_conf)&&(redir=zutil.get(site,"trial.trial_redirect"))&&(force_redir=zutil.get(site,"trial.trial_force_redirect"))){const now=Date.now();if(tab_unblocker.prev_url==redir&&url!=force_redir&&now-tab_unblocker.prev_url_ts<=5*date.ms.SEC){tab_unblocker.prev_url=tab_unblocker.prev_url_ts=null;unblocker_lib.on_before(url,details.requestId,details.tabId,{force_redir:force_redir});return void(details.ret.redirectUrl=force_redir)}tab_unblocker.prev_url=url;tab_unblocker.prev_url_ts=now}}if(!is_vpn_allowed(url,is_main,details))return;let rule=tab_unblocker&&tab_unblocker.rule;if(!tab_unblocker&&details.tabId==-1&&details.frameId==-1){let tab_id=be_tabs.get("active.id");tab_unblocker=E.get_tab_unblocker(tab_id);if(rule_info||(rule_info=get_rule_info_from_url(url)))rule=rule_info.rule;else if(tab_unblocker)rule=tab_unblocker.rule}let mitm_rule;if(!rule&&(!mitm_lib.inited||mitm_lib.inited&&!(mitm_rule=mitm_lib.get_active_tab_rule(details.tabId,details.initiator||details.url)))){return}if(!be_ext.get("is_premium")&&((tab_unblocker||{}).force_premium||rule_info&&be_vpn_util.is_all_browser(rule_info.rule))){unblocker_lib.on_before(url,details.requestId,details.tabId,{err:(tab_unblocker||{}).force_premium?"force_premium":"all_browser"});return}if(!be_ext.get("agent_key")&&!storage.get("agent_key")){unblocker_lib.on_before(url,details.requestId,details.tabId,{err:"agent_key"});be_util.perr("be_no_agent_key2",{details:details,rule:be_vpn_util.get_rule_min_fmt(rule),mitm_rule:be_vpn_util.get_rule_min_fmt(mitm_rule)},{err:true,rate_limit:{count:2}});return}let r;if((r=rule||mitm_rule)&&get_bg_main().set_rule_use)get_bg_main().set_rule_use(r,!!mitm_rule);rule=rule||mitm_rule;return this._on_first_request(details,{rule:rule,no_rule:!rule,tab_unblocker:tab_unblocker})}_on_headers_received(details){let req;const res=bg_util.nodify_res(details),req_id=details.requestId;if(!(req=E.requests[req_id]))return;unblocker_lib.on_completed(req_id,details.tabId,{status:details.statusLine,hdrs:res.headers});const tu=E.get_tab_unblocker(details.tabId);const hola_warn=res.headers["x-hola-warning"];const proxy_auth_required=is_hola_agent_auth(res);const int_req=req.opt.int_req,url=req.url;if(int_req&&req.opt.ignore_redir&&!int_req.res&&!proxy_auth_required){int_req.res=res;req.cancel=true}if(hola_warn&&tu&&!tu.rule.changing_proxy)E.be_rule.change_proxy(details,hola_warn,req.route_opt);const resp=get_strategy_resp(res);if(req.proxy_req){if(proxy_auth_required){if(res.reasonPhrase=="Auth Failed suspicious")get_bg_main().suspend_client();else if(req.opt.rule&&!bext_config.disable_407_reauth)E.reauth_rule_agents(req.opt.rule,3*date.ms.MIN);return void be_util.perr("req_header_proxy_auth",{url:url,proxy_req:req.proxy_req},{err:true,rate_limit:{count:5}})}req.proxy_resp=resp;if(!req.direct_resp)req.direct_resp={slow:true}}else if(req.direct_req)req.direct_resp=resp;const cmd=req.strategy(req.direct_resp,req.proxy_resp)||{};if(cmd.proxy){if(cmd.proxy.serve){if(req.direct_req)req.direct_req.abort();let location=res.headers.location;if(is_redir_status(res.statusCode)&&location&&/^https?:\/\//.test(location)){if(!zurl.is_valid_url(location)){be_util.perr("req_invalid_redirect",{url:url,redirect:location,status:res.statusCode},{rate_limit:{count:3}})}if(!is_firefox&&!bext_config.disable_redir_fix&&tu){const country=zutil.get(cmd,"proxy.country",tu.country);location+=location.endsWith("/")?"":"/";if(url!=location){this.gen_proxy_req(req,details,cmd,{country:country,location:location})}}}return void(req.serving="proxy")}if(cmd.direct&&cmd.direct.serve){req.serving="direct";if(!req.proxy_req||is_redir_status(res.statusCode,true))return;routing_reqs_set(details,req);return void(details.ret.redirectUrl=url)}if(cmd.proxy.start&&!int_req){req.direct_req=false;routing_reqs_set(details,req);return void(details.ret.redirectUrl=url)}}else if(cmd.direct){if(cmd.direct.serve)return void(req.serving="direct");routing_reqs_set(details,req);return void(details.ret.redirectUrl=url)}if(req.proxy_resp){if(req.direct_req&&!req.direct_resp){req.direct_timeout=be_vpn_util.set_timeout(()=>req.direct_req.abort(),5e3,{sp:E.sp,name:"direct_timeout"})}return void(req.serving="proxy")}}_unsafe_tab_unblocker_end_cb(details){const reqid=details.requestId;const req=E.requests[reqid];const error=get_req_error(req,details);if(req){delete E.requests[reqid];const agent_req=E.agent_requests[req.url];if(agent_req&&agent_req.id==req.id)delete E.agent_requests[req.url];let resp;if(error)resp={code:0,error:error};else{if(details.responseHeaders)resp=get_strategy_resp(bg_util.nodify_res(details))}if(resp&&!req.serving){if(req.proxy_req)req.proxy_resp=resp;else if(req.direct_req)req.direct_resp=resp}req.strategy(req.direct_resp,req.proxy_resp);const int_req=E.internal_reqs[req.url];if(int_req){if(error){int_req.error=error;if(!int_req.res)int_req.res={code:0,error:error}}else if(!int_req.res)int_req.res=bg_util.nodify_res(details)}}let tabid=details.tabId,tab_unblocker=E.get_tab_unblocker(tabid);const is_main=is_main_frame(details);if(tab_unblocker){tab_unblocker.last_req_ts=Date.now();if(req){if(req.proxy_resp&&is_main&&req.proxy_resp.code==200&&!req.proxy_resp.error){inc_not_working("req_main_n",tab_unblocker)}if(req.proxy_req&&!error){tab_unblocker.req_stats.succ_n=(tab_unblocker.req_stats.succ_n||0)+1}}}if(mitm_lib._is_mitm_active(tabid)){const req_info=mitm_lib.tab_get_req_info(tabid)||{};req_info.last_req_ts=Date.now();mitm_lib.tab_set_req_info(tabid,req_info)}let verify;if(req&&(verify=get_site_verify_conf(req,req.opt.rule))&&req.proxy_resp.code==200&&!req.proxy_resp.error){bw_perr_acc.push(verify,req);inc_not_working("bw_media_n",tab_unblocker)}const is_proxy_req=tab_unblocker&&req&&req.opt.rule&&svc_vpn_util.gen_route_str(req.route_opt)!="direct";if(!is_proxy_req||!error){if(is_proxy_req&&tab_unblocker&&is_main)set_tab_load_err(tabid,null);return}const info={url:req.url,type:details.type,method:req.method,error:error,agent:req.agent,rule:be_vpn_util.get_rule_min_fmt(req.opt.rule)};tab_unblocker.err_logs.push({ts:Date.now(),method:req.method,error:error,agent:zutil.get(req.agent,"host"),url:req.url.slice(0,100)});if(tab_unblocker.err_logs.length>err_logs_len)tab_unblocker.err_logs.shift();tab_unblocker.req_err_total_n=(tab_unblocker.req_err_total_n||0)+1;tab_unblocker.req_stats.err_n=(tab_unblocker.req_stats.err_n||0)+1;if(!is_err_handled(error,is_main)){let reported;if(!(reported=load_errors[tabid]))reported=load_errors[tabid]={};if(reported[error])return;reported[error]=true;return void be_util.perr("req_err_unhandled",info,{err:error,rate_limit:{count:5}})}fix_req_err(tab_unblocker,req.agent,details.error?details:assign({},details,{error:error}),req.route_opt)}}const is_err_handled=(err,is_main)=>!is_main&&request_errors[err]||is_main&&(request_errors[err]||main_frame_errors[err]);const get_req_error=(req,details)=>{if(details.error||!is_main_frame(details))return details.error;if(!req||!req.url||!req.url.startsWith("http:"))return;const s=details.statusLine||"";if(details.statusCode==502&&s.includes("DNS Failed"))return"ERR_DNS_FAILED";if(details.statusCode==407&&s.includes("Proxy Authentication"))return"ERR_AUTH_REQUIRED"};class Ff_new_handler extends Base_handler{constructor(){super();this.on_proxy_request=this.wrap("on_proxy_request",d=>{this.tab_unblocker_cb(d=assign({},d,{handler:this._on_first_request.bind(this),cbname:"on_proxy_request",ret:{}}));this._clean_req_to_ret();this.req_to_ret[d.requestId]={ret:d.ret,ts:Date.now()};return d.hola_proxy||{type:"direct"}},true);this.on_before_request=this.wrap("on_before_request",d=>{const data=this.req_to_ret[d.requestId];delete this.req_to_ret[d.requestId];return zutil.get(data,"ret",{})},true)}_clean_req_to_ret(){const clean={},now=Date.now();for(let id in this.req_to_ret){const data=this.req_to_ret[id];if(now-data.ts<5*date.ms.MIN)clean[id]=data}this.req_to_ret=clean}gen_proxy_req(req,details,cmd,opt){opt=opt||{};const prot=opt.prot||"https";req.route_opt={prot:prot,country:opt.country};if(cmd.proxy.pool)req.route_opt.pool=cmd.proxy.pool;const proxy=get_proxy_agent(req,cmd.proxy);if(!proxy){req.proxy_resp={code:0,error:"failed set proxy"};return}req.proxy_req=proxy;let host;if(E.be_bg_ajax&&req.route_opt.prot=="https"&&E.be_bg_ajax.is_agent_fallback()){req.route_opt.prot="proxy";host=proxy.ip}details.hola_proxy={type:req.route_opt.prot,host:host||proxy.host||proxy.ip,port:proxy.port}}init(){if(!super.init())return;this.req_to_ret={};try{window.browser.proxy.onRequest.addListener(this.on_proxy_request,this.listener_opt);chrome.webRequest.onBeforeRequest.addListener(this.on_before_request,this.listener_opt,this.listener_extra_opt)}catch(e){on_hooks_err("be_add_hooks_err",e)}}uninit(){if(!super.uninit())return;try{window.browser.proxy.onRequest.removeListener(this.on_proxy_request);chrome.webRequest.onBeforeRequest.removeListener(this.on_before_request)}catch(e){on_hooks_err("be_rm_hooks_err",e)}}}class Chrome_handler extends Base_handler{constructor(){super();let on_before_request=d=>{this.tab_unblocker_cb(assign(d||{},{cbname:"on_before_request",handler:this._on_first_request.bind(this),ret:{}}));return d.ret};this.on_before_request=this.wrap("on_before_request",on_before_request,true);this.on_before_request_tab=this.wrap("on_before_request_tab",d=>{if(!is_main_frame(d))return on_before_request(d)},true)}gen_proxy_req(req,details,cmd,opt){opt=opt||{};if(req.redirected){req.redirected=false;return void(req.proxy_req=true)}const req_opt=req.opt||{};const prot=(req_opt.prot||"https").toUpperCase();req.route_opt={prot:prot,country:opt.country};if(cmd.proxy.pool)req.route_opt.pool=cmd.proxy.pool;const proxy=get_proxy_agent(req,cmd.proxy);const src=cmd.src||req_opt.rule&&"geo_rule";const _url=opt.location||details.url;if(!proxy){E.set_proxy_for_url(_url,"DIRECT",{tab_id:details.tabId,src:src});req.proxy_resp={code:0,error:"failed set proxy"};return}req.proxy_req=proxy;let host=proxy.host||proxy.ip;if(!req_opt.is_proxy_set){if(E.be_bg_ajax&&req.route_opt.prot=="HTTPS"&&E.be_bg_ajax.is_agent_fallback()){req.route_opt.prot="PROXY";host=proxy.ip}req.proxy_str=req.route_opt.prot+" "+host+":"+proxy.port;E.set_proxy_for_url(_url,req.proxy_str,{src:src,tab_id:details.tabId});if((!bext_config.disable_redir_fix&&is_main_frame(details)||req_opt.fix_307)&&/^http:/.test(details.url)){E.set_proxy_for_url(details.url.replace("http:","https:"),req.proxy_str,{src:src,tab_id:details.tabId})}}details.hola_proxy={type:zutil.get(req,"route_opt.prot"),host:host,port:proxy.port}}add_hooks(tabid){let hooks=super.add_hooks(tabid);try{let extra_opt=this.listener_extra_opt.slice();if(is_extra_headers_supported())extra_opt.push("extraHeaders");if(tabid=="main_frame"){hooks.on_before_request_main=this.on_before_request.bind(this);chrome.webRequest.onBeforeRequest.addListener(hooks.on_before_request_main,assign({types:["main_frame"]},this.listener_opt),extra_opt);return hooks}tabid=+tabid;let opt=tabid>=0?{tabId:tabid}:{};hooks.on_before_request_tab=this.on_before_request_tab.bind(this);chrome.webRequest.onBeforeRequest.addListener(hooks.on_before_request_tab,assign(opt,this.listener_opt),extra_opt);return hooks}catch(e){on_hooks_err("be_add_hooks_err",e)}}remove_hooks(hooks){super.remove_hooks(hooks);try{["","_main","_tab"].forEach(e=>{let cb;if(cb=hooks["on_before_request"+e])chrome.webRequest.onBeforeRequest.removeListener(cb)})}catch(e){on_hooks_err("be_rm_hooks_err",e)}}}const regex_url2host=/^(?:https?|wss?):\/\/([^\/]+)/;const url2host=url=>{let n=url.match(regex_url2host);return n?n[1]:url};class Host_tracker{constructor(){this.host_trackers=new Map;this.clear=this.clear.bind(this);be_ext.on("pac_init",this.clear);be_ext.on("pac_reload",this.clear)}handle_set_proxy_for_host(host,proxy_str,opt){let _this=this;return etask((function*_handle_set_proxy_for_host(){let ht=_this.host_trackers.get(host);if(!ht){if(proxy_str=="DIRECT")return zerr.info(`TRACKER ignore DIRECT for ${host}`);zerr.info(`TRACKER add hook: ${host}`);let listener=_this.get_host_tracker_listener(host);ht={listener:listener,last_proxy_str:proxy_str,last_opt:opt,last_proxy_str_per_tab:{}};_this.host_trackers.set(host,ht);try{chrome.webRequest.onBeforeSendHeaders.addListener(listener,{urls:[`*://${host}/*`]},["blocking"])}catch(e){on_hooks_err("be_add_ht_listener_err",e);_this.host_trackers.delete(host)}}ht.last_proxy_str=proxy_str;if(opt&&opt.tab_id)ht.last_proxy_str_per_tab[opt.tab_id]=proxy_str;ht.last_opt=opt;yield _this.update_pac_proxy(ht,host,proxy_str)}))}get_host_tracker_listener(host){return details=>{let tab_unblocker=E.get_tab_unblocker(details.tabId);let rule=tab_unblocker&&tab_unblocker.rule;if(!tab_unblocker&&details.tabId==-1&&details.frameId==-1){let tab_id=be_tabs.get("active.id");tab_unblocker=E.get_tab_unblocker(tab_id);let rule_info=get_rule_info_from_url(details.url);if(rule_info)rule=rule_info.rule;else if(tab_unblocker)rule=tab_unblocker.rule}let mitm_rule;if(!rule&&mitm_lib.inited){mitm_rule=mitm_lib.get_active_tab_rule(details.tabId,details.initiator||details.url)}let ht=this.host_trackers.get(host);let expected_proxy;if(rule&&rule.enabled&&!is_direct_on_tab_laod_err(details.tabId)||mitm_rule||E.internal_reqs[details.url]){expected_proxy=ht.last_proxy_str_per_tab[details.tabId]||ht.last_proxy_str}if(ht.deadline_ts&&ht.deadline_ts<Date.now())ht.pac_proxy_str=null;this.update_pac_proxy(ht,host,expected_proxy)}}rm_host_tracker_listener(host){let ht=this.host_trackers.get(host);try{chrome.webRequest.onBeforeSendHeaders.removeListener(ht.listener)}catch(e){on_hooks_err("be_rm_ht_listener_err",e)}this.host_trackers.delete(host);zerr.info(`TRACKER remove listener: ${host}`)}update_pac_proxy(ht,host,proxy_str){if(ht.pac_proxy_str==proxy_str){if(!ht.deadline_ts||Date.now()+5*date.ms.SEC<ht.deadline_ts)return}let _this=this;return etask((function*_update_pac_proxy(){zerr.info(`TRACKER send PAC cmd: %s %s`,host,proxy_str);ht.pac_proxy_str=proxy_str;ht.deadline_ts=null;if(!proxy_str)return yield be_pac.unset_proxy_for_host(host,ht.last_opt);if(ht.timeout)clearTimeout(ht.timeout);let timeout_ms=bext_config.pac_rule_lifetime_ms||60*date.ms.SEC;ht.deadline_ts=Date.now()+timeout_ms;ht.timeout=setTimeout(()=>_this.rm_host_tracker_listener(host),timeout_ms);yield be_pac.set_proxy_for_host(host,proxy_str,ht.deadline_ts,ht.last_opt)}))}clear(){for(let[host,ht]of this.host_trackers)ht.pac_proxy_str=null}uninit(){be_ext.off("pac_init",this.clear);be_ext.off("pac_reload",this.clear);for(let[host,ht]of this.host_trackers)this.rm_host_tracker_listener(host)}}E.set_proxy_for_url=(url,proxy_str,opt)=>etask((function*_set_proxy_for_url(){let host=url2host(url);if(!host_tracker)host_tracker=new Host_tracker;yield host_tracker.handle_set_proxy_for_host(host,proxy_str,opt)}));E.get_tab_load_err=tab_id=>(E.get("tab_load_err")||{})[tab_id];function get_strategy_resp(res){let resp;if(res.headers["x-hola-response"]){resp={hdrs_only:true,code:res.headers["x-hola-status-code"],len:res.headers["x-hola-content-length"],te:res.headers["x-hola-transfer-encoding"],lmod:res.headers["x-hola-last-modified"],etag:res.headers["x-hola-etag"],type:res.headers["x-hola-content-type"],error:res.headers["x-hola-error"]}}else{resp={code:res.statusCode,len:res.headers["content-length"],te:res.headers["transfer-encoding"],lmod:res.headers["last-modified"],etag:res.headers.etag,type:res.headers["content-type"],error:res.headers["x-hola-error"]}}resp.policy=res.headers["x-hola-policy"];return resp}function is_vpn_allowed(_url,is_main,details){if(be_svc.get("vpn_country"))return;let protocol,hostname,url=zurl.parse(_url);if(!(protocol=url.protocol)||!(hostname=url.hostname)){if(protocol!="file:")be_util.perr("url_parsing_failed",{url:url});return false}if(is_all_browser_rule_active())return!zurl.is_hola_domain(hostname)||details&&details.tabId!=-1;if(unblocker_lib.is_agent(hostname))return false;return bg_util.is_vpn_allowed(_url,is_main,browser.isInNet)}function get_proxy_agent(req,proxy){const opt=req.opt||{},rule=opt.rule;if(!rule&&!opt.agent){be_util.perr("be_debug_no_rule",{route_opt:req.route_opt,url:req.url},{err:true,rate_limit:{count:1}});return}const route=svc_vpn_util.gen_route_str(req.route_opt,{no_algo:true});let agent=opt.agent||unblocker_lib.get_chosen_agent(req.route_opt,rule);if(!agent){zerr.debug("tab:%d no agents for %s route, rule: %s",req.tab_id,route,zutil.get(rule,"name","unknown"));be_util.perr("be_debug_no_agents",{route_opt:req.route_opt,agents:unblocker_lib.get_active_agents(rule),rule:be_vpn_util.get_rule_min_fmt(rule)},{err:true,rate_limit:{count:2}});return}req.agent=agent;let tab;if((tab=opt.tab_unblocker)&&tab.agents){if(agent.is_fallback&&(!tab.agents[agent.host]||Date.now()-tab.agents[agent.host]>5*date.ms.MIN)){be_util.perr("be_fallback_agent",{route_opt:req.route_opt,agent:agent,rule:be_vpn_util.get_rule_min_fmt(rule)},{err:true,rate_limit:{count:2}})}tab.agents[agent.host]=Date.now()}if(mitm_lib._is_mitm_active(req.tab_id)){const info=mitm_lib.tab_get_req_info(req.tab_id)||{};if(!info.agents)info.agents={};info.agents[agent.host]=Date.now();mitm_lib.tab_set_req_info(req.tab_id,info)}let port,plist;const trial=rule&&is_trial(rule.name);if(rule&&(plist=agent.port_list)){let key=[];if(agent.port==plist.direct){if(trial)key.push("trial");if(proxy.peer)key.push("peer")}port=plist[key.join("_")]||agent.port}port=port||agent.port;if(agent.vendor!="force_agent"&&req.route_opt.pool&&!agent.pool){be_util.perr("be_wrong_agent",{agent:agent,route_opt:req.route_opt,rule:be_vpn_util.get_rule_min_fmt(rule),trial:trial},{rate_limit:{count:1}})}return{ip:agent.ip,port:port,host:agent.host}}function get_rule_info_from_url(url){let rule_info,r;if(E.url_to_rule_infos.all_browser)return E.url_to_rule_infos.all_browser;if(!url)return null;for(r in E.url_to_rule_infos){rule_info=E.url_to_rule_infos[r];if(rule_info.url_re&&rule_info.url_re.test(url))return rule_info}return null}const is_all_browser_rule_active=()=>!!E.url_to_rule_infos.all_browser;E.get_tab_unblocker=tabid=>{if(E.tab_unblockers.all_browser)return E.tab_unblockers.all_browser;return tabid&&E.tab_unblockers[tabid]};const set_tab_load_err=(tab_id,err)=>{let tab_load_err=assign({},E.get("tab_load_err"));const is_all_browser=tab_id=="all_browser";if(err&&tab_load_err[tab_id]||!err&&!tab_load_err[tab_id]&&!is_all_browser){return}if(err)tab_load_err[tab_id]={err:err};else{if(is_all_browser)tab_load_err={};else delete tab_load_err[tab_id]}E.set("tab_load_err",tab_load_err)};function tab_unblocker_del(tabid,refresh){const tab_unblocker=E.tab_unblockers[tabid];zerr.notice("tab:%d tab_unblocker_del: %s",+tabid,zutil.get(tab_unblocker,"country","not_found"));if(!tab_unblocker)return;if(tab_unblocker.not_working)E.send_not_working(tab_unblocker,"unblocker_del");const is_all_browser=tabid=="all_browser";set_tab_load_err(tabid,null);if(requests_handler&&tab_unblocker.hooks)requests_handler.remove_hooks(tab_unblocker.hooks);const rule_info=E.url_to_rule_infos[tab_unblocker.root_url];delete E.tab_unblockers[tabid];delete pages[tabid];unblocker_lib.del_ctx(tabid);if(is_all_browser)requests_handler.update_hooks();if(!rule_info){be_util.perr("be_rule_info_missing",{tabid:tabid,tab_unblocker:tab_unblocker,rule_infos:E.url_to_rule_infos})}else delete rule_info.tabs[tabid];if(refresh&&is_all_browser)tabid=be_tabs.get("active.id");if(!refresh||be_tabs.get("active.id")!=tabid)return;try{chrome.tabs.get(bg_util.tabid2api(tabid),tab=>{if(tab)be_tabs.update(tab.id,tab.url)})}catch(e){on_hooks_err("be_tab_unblocker_del_err",e)}}E.tab_reload=(tabid,tab_url)=>etask((function*tab_reload(){yield be_tabs.update(tabid,tab_url);try{chrome.tabs.get(tabid,tab=>{if(!tab||tab.status!="complete")return;be_tabs.reload(tabid)})}catch(e){on_hooks_err("be_tab_reload_err",e)}}));const get_force_premium_rule=tab_url=>be_premium.get_force_premium_rule(svc_vpn_util.get_root_url(tab_url));const monitor_proxy_req_slow=()=>{if(monitor_proxy_req_slow.et)return;monitor_proxy_req_slow.et=etask({cancel:true,async:true},(function*_monitor_req_slow_proxy(){this.finally(()=>{monitor_proxy_req_slow.et=undefined;proxy_req_slow={agents:{}}});yield etask.sleep(date.ms.HOUR);for(let root in proxy_req_slow){if(proxy_req_slow[root]["20"]||proxy_req_slow[root]["60"])return void be_util.perr("proxy_req_slow",proxy_req_slow)}}))};const monitor_page_load=()=>{if(monitor_page_load.et)return;monitor_page_load.et=etask({cancel:true,async:true},(function*_monitor_page_load(){this.finally(()=>monitor_page_load.et=undefined);for(;;){if(!Object.keys(pages).length)return;let now=Date.now(),slow={};for(let id in pages){if(now-pages[id].start_ts<10*date.ms.SEC)continue;slow[id]=[]}if(Object.keys(slow).length){for(let reqid in E.requests){const req=E.requests[reqid];if(!req||!slow[req.tab_id]||!req.agent||now-req.start_ts<6*date.ms.SEC){continue}slow[req.tab_id].push(req)}for(let id in slow){let tu;if(slow[id].length<3||!(tu=E.get_tab_unblocker(id)))continue;const req=slow[id][0];const d={url:req.url,type:req.type,tabId:+id,error:"slow"};if(track_autoreload(tu,req.agent,d)){delete pages[id];be_util.perr("page_load_slow",d,{rate_limit:{count:5}});yield ext_on_err(tu.rule,req.agent,d,req.route_opt)}}}yield etask.sleep(date.ms.SEC)}}))};const tab_unblocker_add=cb_wrapper((tabid,rule_info,tab_url,opt)=>{if(!rule_info||rule_info.tabs[tabid])return;opt=opt||{};const is_all_browser=be_vpn_util.is_all_browser(rule_info.rule);const id=is_all_browser?rule_info.rule.name:tabid;let tab_unblocker=E.tab_unblockers[id];const root_url=svc_vpn_util.get_root_url(tab_url);if(tab_unblocker&&tab_unblocker.rule)return;tab_unblocker={country:rule_info.rule.country,rule:rule_info.rule,root_url:rule_info.root_url,log:tab_unblocker?tab_unblocker.log:[],force_premium:get_force_premium_rule(tab_url),err_logs:[],agents:{},track:{counter:0,domains:{}},site_conf:be_util.get_site_conf(root_url||rule_info.rule.name)||{},req_stats:{}};E.tab_unblockers[id]=tab_unblocker;zerr.notice("tab:%d tab_unblocker_add: %s %s",tabid,rule_info.rule.name,tab_unblocker.country);if(requests_handler){if(is_all_browser)requests_handler.update_hooks(id);tab_unblocker.hooks=requests_handler.add_hooks(id)}rule_info.tabs[tabid]=true;unblocker_lib.add_ctx(tabid,tab_unblocker.rule,{src:tab_url});if(opt.reload&&!is_all_browser&&be_tabs.get("active.id")==tabid){if(opt.fix_url)tab_url=bg_util.get_root_link(rule_info.rule,tab_url)||tab_url;if(be_trial.get_trial_active(root_url)){let site_conf=be_util.get_site_conf(root_url);tab_url=zutil.get(site_conf,"trial.trial_redirect",tab_url)}if(tab_url){zerr.notice("tab:%d reloading tab",tabid);return E.tab_reload(tabid,tab_url)}}E.set("activity",Date.now());return tab_unblocker});const on_tab_created=cb_wrapper(o=>{const tab=o.tab;if(!tab.url)return;const rule_info=get_rule_info_from_url(tab.url);tab_unblocker_add(tab.id,rule_info,tab.url)});const on_tab_updated=cb_wrapper(o=>{let id=o.id,info=o.info;if(!info)return;let tab_unblocker=E.tab_unblockers[id];if(info.url){const rule_info=get_rule_info_from_url(info.url);if(!tab_unblocker||!rule_info||tab_unblocker.root_url!=rule_info.root_url){if(tab_unblocker)tab_unblocker_del(id);tab_unblocker=tab_unblocker_add(id,rule_info,info.url)}}if(!tab_unblocker||!info.status||CG("disable_slow_load_monitor"))return;switch(info.status){case"complete":delete pages[id];break;case"loading":pages[id]={start_ts:Date.now()};monitor_page_load();break}});const on_tab_removed=cb_wrapper(o=>{if(mitm_lib.inited)mitm_lib.tabs_del(o.id,"on_tab_removed");tab_unblocker_del(o.id)});const on_tab_replaced=cb_wrapper(o=>{let added=o.added,removed=o.removed;tab_unblocker_del(removed);if(mitm_lib.inited)mitm_lib.tabs_del(removed,"on_tab_replaced");try{chrome.tabs.get(added,tab=>{if(!tab||!tab.url)return;if(mitm_lib.inited)mitm_lib.tabs_add(added,tab.url,"on_tab_replaced");const rule_info=get_rule_info_from_url(tab.url);tab_unblocker_add(added,rule_info,tab.url)})}catch(e){on_hooks_err("be_on_tab_replaced_err",e)}});function unset_rule_for_url(root_url,refresh){let rule_info=E.url_to_rule_infos[root_url];if(!rule_info)return;for(let tab in rule_info.tabs)tab_unblocker_del(tab,refresh);if(root_url=="all_browser")tab_unblocker_del(root_url,refresh);delete E.url_to_rule_infos[root_url]}function set_rule_for_url(root_url,rule,opt){let rule_info=E.url_to_rule_infos[root_url];if(rule_info)unset_rule_for_url(root_url,0);rule_info=E.url_to_rule_infos[root_url]={rule:rule,root_url:root_url,tabs:{},url_re:new RegExp(root_url)};try{chrome.tabs.query({url:"*://*."+rule.name+"/*"},cb_wrapper(tabs=>{if(!tabs)return;for(let tab of tabs)tab_unblocker_add(tab.id,rule_info,tab.url,opt)}))}catch(e){on_hooks_err("be_set_rule_for_url_err",e)}}function update_rules(url_to_rule_infos,opt){opt=opt||{};let url,rule;for(url in E.url_to_rule_infos){rule=url_to_rule_infos[url];if(!rule)unset_rule_for_url(url,1);else if(rule.id!=E.url_to_rule_infos[url].rule.id)set_rule_for_url(url,rule,opt)}for(url in url_to_rule_infos){rule=url_to_rule_infos[url];if(!E.url_to_rule_infos[url])set_rule_for_url(url,rule,assign({},opt,{fix_url:1}))}}E.get_rule_route=rule=>{const country=rule.country,proxy_country=country.toUpperCase();return unblocker_lib.get_rule_strategy({},null,{root_url:rule.name,premium:is_force_proxy(country,{rule:rule}),country:proxy_country,proxy_country:proxy_country,src_country:be_info.get("country"),is_trial:is_trial(rule.name)})};E.update_rule_urls=(rules,opt)=>etask((function*update_rule_urls(){if(!E.inited)return;opt=opt||{};be_ext.set("has_active_rules",rules&&_.some(rules.unblocker_rules,rule=>rule.enabled));E.rules=rules;if(!be_ext.is_disabled())requests_handler.init();yield be_pac.update_pac_file_state();let url_to_rule_infos={};if(!rules)return update_rules(url_to_rule_infos);const r=_.omit(E.rules,"unblocker_globals");if((E.rules||{}).unblocker_globals)r.unblocker_globals=assign({},E.rules.unblocker_globals);unblocker_lib.unblocker_json_set(r,{by_rules:1,ext:1});let ag_rules=[],agents={};for(let r in rules.unblocker_rules){let rule=rules.unblocker_rules[r];if(!rule.enabled)continue;if(be_vpn_util.is_all_browser(rule))url_to_rule_infos[rule.name]=rule;else{for(let i=0;i<rule.root_url.length;i++)url_to_rule_infos[rule.root_url[i]]=rule}if(!opt.resolve||opt.rule&&opt.rule.name!=rule.name)continue;const pool=E.get_rule_route(rule).pool;[{peer:false,pool:pool},{peer:false}].forEach(b=>{b=assign({country:rule.country,link:rule.link,name:rule.name},b);let s=svc_vpn_util.gen_route_str(b);if(!agents[s]){ag_rules.push(b);agents[s]=true}})}this.finally(()=>update_rules(url_to_rule_infos,opt));if(ag_rules.length)yield unblocker_lib.resolve_agents(ag_rules)}));E.ajax_via_proxy=(url,_opt,state)=>etask((function*ajax_via_proxy(){if(be_ext.is_disabled()&&(!E.be_bg_ajax||!E.be_bg_ajax.is_active()))return;if(!E.ajax_via_proxy_inited)E.init_ajax_via_proxy();this.finally(()=>{delete E.internal_reqs[opt.url];if(xhr){xhr.abort();xhr.onerror=null;xhr.onreadystatechange=null;delete E.internal_reqs[xhr.hola_url]}if(!{bg_ajax:1,proxy_auth:1}[_opt.src])E.trigger("internal_reqs_update")});_opt=_opt||{};state=state||{};let opt=typeof url=="object"?url:{type:"POST",url:url};let xhr,complete,xhr_resp;const get_result=()=>{let req=E.internal_reqs[opt.url]||{};complete=true;delete E.internal_reqs[xhr.hola_url];if(!req.res){if(xhr_resp)req.res=xhr_resp;else{const headers_s=xhr.getAllResponseHeaders();req.res=xhr_resp={statusCode:xhr.status,reasonPhrase:xhr.statusText,responseURL:xhr.responseURL,headers:attrib.to_obj_lower(attrib.from_str(headers_s,{allow_invalid:true}))}}}else if(!xhr_resp)xhr_resp=req.res;if(_opt.force_headers&&(!req.res.headers||!Object.keys(req.res.headers).length)){req.res.headers=xhr_resp?xhr_resp.headers:attrib.to_obj_lower(attrib.from_str(xhr.getAllResponseHeaders(),{allow_invalid:true}));if(req.res.statusCode==407&&xhr_resp)req.res.statusCode=xhr_resp.statusCode}return{data:xhr.responseText,xhr:xhr,agent:_opt.agent,status:xhr_resp.statusCode,orig_res:req.res,is_redirected:req.is_redirected}};let proxy;try{const rule=opt.rule,agent=_opt.agent;if((rule||_opt.force=="proxy")&&!_opt.country&&!agent){const r=rule||get_rule_info_from_url(opt.url);if(r){_opt.country=r.country;_opt.peer=_opt.peer||r.peer}else throw new Error("proxy rule not found for "+opt.url);_opt.force="proxy"}const req_opts={force:_opt.force,country:_opt.country,no_routing:true,peer:_opt.peer,no_rule:!_opt.country,fix_307:_opt.fix_307};if(_opt.ignore_redir!=false)req_opts.ignore_redir=true;if(_opt.prot)req_opts.prot=_opt.prot;if(agent)req_opts.agent=agent;if(_opt.force=="direct")proxy="DIRECT";const b=be_util.browser_guess;if(is_chrome&&b.version>=76&&(_opt.force=="direct"||_opt.force=="proxy"&&agent)){req_opts.no_redirect=true;if(_opt.force=="proxy")proxy="PROXY "+(agent.host||agent.ip)+":"+agent.port}if(proxy){req_opts.is_proxy_set=true;yield E.set_proxy_for_url(opt.url,proxy,{async:!bext_config.disable_ajax_via_proxy_async})}xhr=hola_XMLHttpRequest(opt.url,opt.type,_opt.hdrs,req_opts);if(_opt.with_credentials)xhr.withCredentials=true;if(_opt.src!="bg_ajax")E.trigger("internal_reqs_update");xhr.onreadystatechange=cb_wrapper(()=>{if(xhr.readyState!=xhr.HEADERS_RECEIVED)return;state.hdrs_received=true;const headers_s=xhr.getAllResponseHeaders();xhr_resp={statusCode:xhr.status,reasonPhrase:xhr.statusText,responseURL:xhr.responseURL,headers:attrib.to_obj_lower(attrib.from_str(headers_s,{allow_invalid:true}))};if(_opt.hdrs_abort)xhr.abort()});xhr.onerror=ev=>{const req=E.internal_reqs[opt.url];if(req)req.et=this};xhr.onload=()=>this.continue();xhr.onabort=()=>this.continue();xhr.send(_opt.data);yield this.wait(_opt.timeout||30*date.ms.SEC);return get_result()}catch(e){if(_opt.always&&xhr&&!complete)return get_result();throw new Error((proxy?proxy+" ":"")+(e.statusText||e))}}));const on_tab_completed=cb_wrapper(o=>{if(o.frameId)return;if(mitm_lib.inited)mitm_lib.tabs_set_complete(o.tabId);let start_ts,load_perr;if(E.get_tab_load_err(o.tabId))set_tab_load_err(o.tabId,null);if(!o.url||!(start_ts=tab_loads[o.tabId])||!(load_perr=zutil.get(bext_config,"load_perr"))){return}const tab=E.get_tab_unblocker(o.tabId);const _url=zurl.parse(o.url),_path=_url.path.toLowerCase();let root_url=svc_vpn_util.get_root_url(o.url),rule,path;if(!(rule=load_perr.find(r=>r.domain==root_url))||(path=rule.paths.find(p=>_path.startsWith("/"+p)))===undefined){return}const info={id:rule.id,path:path||"root",ms:Date.now()-start_ts,loc:zutil.get(be_info.get("location"),"country","").toLowerCase()};if(tab&&(rule=tab.rule))assign(info,{country:rule.country,trial:rule.src=="trial"});else info.local=true;be_util.perr("tab_load_completed",info)});const on_before_navigate=cb_wrapper(o=>{if(o.frameId)return;svc_vpn_util.push_event("navgiate",{tab_id:o.tabId,url:o.url});load_errors[o.tabId]={};tab_loads[o.tabId]=Date.now();if(mitm_lib.inited)mitm_lib.tabs_add(o.tabId,o.url,"on_before_navigate")});function handle_mitm_block(tab_url,tab_id,ret){mitm_lib.trace(tab_id,tab_url,"handle_mitm_block "+(!ret?"no ret":"blocked="+ret.blocked+" handle="+ret.handle+" root="+svc_vpn_util.get_root_url(ret.url)));if(!tab_id||be_ext.is_disabled()||!ret||!ret.blocked||!ret.handle)return;const cur_url=be_tabs.get_url(tab_id);const active_id=be_tabs.get("active.id");const active_url=be_tabs.get("active.url");if(be_vpn_util.is_new_tab(cur_url)&&active_id==tab_id&&active_url==tab_url){be_tabs.update(tab_id,tab_url);mitm_lib.trace(tab_id,tab_url,"tabs.update chrome load")}else if(!cur_url&&is_chrome&&active_id==tab_id-1){return void mitm_lib.trace(tab_id,tab_url,"ignore preload")}else if(!ret.sim&&cur_url!=tab_url){if(cur_url==ret.redir){be_tabs.update(tab_id,ret.tab_url);mitm_lib.trace(tab_id,tab_url,"tabs.update redirect to other domain")}else if(tab_url==active_url&&tab_id==active_id){be_tabs.reload(tab_id);mitm_lib.trace(tab_id,tab_url,"tabs.reload same active url")}else return void mitm_lib.trace(tab_id,tab_url,"ignore mismatch url")}else if(ret.sim){be_tabs.update(tab_id,ret.sim.url);mitm_lib.trace(tab_id,tab_url,"tabs.update sim "+ret.sim.url)}else{be_tabs.reload(tab_id);mitm_lib.trace(tab_id,tab_url,"tabs.reload url match")}mitm_lib.trace(tab_id,tab_url,"trigger mitm_block");E.trigger("mitm_block",tab_id,tab_url,ret.redirect,ret.country)}const test_rules={};function get_enabled_rule(url){const key="http://"+svc_vpn_util.get_root_url(url)+"/";if(zutil.is_mocha()&&test_rules[key])return test_rules[key];const rules=E.be_rule.get_rules(key);const r=rules&&rules[0];return r&&r.enabled?r:undefined}function is_unblock_allowed(tab_id,tab_url){if(be_ext.get("is_premium"))return true;const tab_unblocker=E.tab_unblockers[tab_id];return tab_unblocker?!tab_unblocker.force_premium:!get_force_premium_rule(tab_url)}function has_geo_rule(url){return get_enabled_rule(url)}const init_mitm_check_url=ff_cb_wrapper("init_mitm_check_url",details=>{const url=details.url;if(!url||url.startsWith("https")||!bg_util.is_vpn_allowed(url,is_main_frame(details),browser.isInNet)){return}const tab_id=details.tabId;const tab_url=details.initiator||url;if(!tab_id||tab_id<0||be_ext.is_disabled()||!is_unblock_allowed(tab_id,tab_url)||be_tabs.get("active.id")!=tab_id||tab_url!=url){return}const res=bg_util.nodify_res(details);const geo_rule=get_enabled_rule(tab_url);const hook="fake_resp",rule={country:"us"};details.headers=res.headers;if(force_strategy!="peer"&&geo_rule||!mitm_lib.is_mitm_allowed(tab_id,tab_url,tab_url,details,hook)){return}return etask("init_mitm_check_url",(function*init_mitm_check_url_(){yield be_pac.update_pac_file_state(true);if(!zutil.is_mocha())yield unblocker_lib.get_agents(null,rule);const ret=yield mitm_lib.check_mitm_blocking({url:tab_url,tab_url:tab_url,hook:hook,prev_code:details.statusCode,tab_id:tab_id,headers:details.headers,force_peer:geo_rule&&geo_rule.country,redir:(details.headers||{}).location,agents:unblocker_lib.get_agents_by_route(rule.country)});handle_mitm_block(tab_url,tab_id,ret)}))});E.has_mitm=()=>!!E.mitm;const chrome_error_list=["ACCESS_DENIED","BLOCKED_BY_ADMINISTRATOR","CONNECTION_REFUSED","CONNECTION_FAILED","NAME_NOT_RESOLVED","ADDRESS_UNREACHABLE","CERT_ERROR_IN_SSL_RENEGOTIATION","NAME_RESOLUTION_FAILED","NETWORK_ACCESS_DENIED","SSL_HANDSHAKE_NOT_COMPLETED","SSL_SERVER_CERT_CHANGED","CERT_COMMON_NAME_INVALID","CERT_AUTHORITY_INVALID","CERT_CONTAINS_ERRORS","CERT_INVALID","INVALID_RESPONSE","EMPTY_RESPONSE","INSECURE_RESPONSE","DNS_MALFORMED_RESPONSE","DNS_SERVER_FAILED","DNS_SEARCH_EMPTY","TIMED_OUT","CONNECTION_CLOSED","CONNECTION_RESET","CONNECTION_TIMED_OUT"];const init_mitm_check_err=cb_wrapper(o=>{const tab_id=o.tabId||o.id;if(o.frameId||!tab_id||tab_id==-1||be_ext.is_disabled()||!E.mitm||!o.error||!chrome_error_list.includes(o.error.split("::ERR_")[1])){return}const prev_code=o.statusCode||o.http_status_code||0;const tab_url=o.url||be_tabs.get_url(tab_id);const geo_rule=get_enabled_rule(tab_url);const hook="error",rule={country:"us"};mitm_lib.trace(tab_id,tab_url,"hook error init");if(force_strategy!="peer"&&geo_rule||!is_unblock_allowed(tab_id,tab_url)||!bg_util.is_vpn_allowed(tab_url,true,browser.isInNet)||!mitm_lib.is_mitm_allowed(tab_id,tab_url,tab_url,{statusCode:prev_code},hook)){return void mitm_lib.trace(tab_id,tab_url,"mitm not allowed")}return etask("init_mitm_check_err",(function*init_mitm_check_err_(){yield be_pac.update_pac_file_state(true);mitm_lib.trace(tab_id,tab_url,"get_agents country us");if(!zutil.is_mocha())yield unblocker_lib.get_agents(null,rule);const agents=unblocker_lib.get_agents_by_route(rule.country);mitm_lib.trace(tab_id,tab_url,"call check_mitm_blocking code "+prev_code+" with "+agents.length+" us agents");const ret=yield mitm_lib.check_mitm_blocking({url:tab_url,tab_url:tab_url,hook:hook,prev_code:prev_code,tab_id:tab_id,force_peer:geo_rule&&geo_rule.country,err_str:o.error,agents:agents});handle_mitm_block(tab_url,tab_id,ret)}))});E.uninit=()=>{if(!E.inited)return;E.stopListening(be_ext,"change:ext.active change:ext.suspended",update_state);E.stopListening(be_ext,"change:bext_config",update_config);be_ext.off("not_working",on_not_working);uninit_mitm();E.sp.return();E.update_rule_urls();be_ext.set("has_active_rules",0);E.rules=null;E.inited=0;E.is_enabled=false;if(monitor_proxy_req_slow.et)monitor_proxy_req_slow.et=void monitor_proxy_req_slow.et.return();if(monitor_page_load.et)monitor_page_load.et=void monitor_page_load.et.return();agent_auth_listener_del();requests_handler.uninit();if(host_tracker)host_tracker.uninit();E.uninit_ajax_via_proxy();be_pac.update_pac_file_state();E.requests={};for(let k in E.routing_reqs)E.routing_reqs[k].to=be_vpn_util.clear_timeout(E.routing_reqs[k].to);E.routing_reqs={};E.stopListening();E.clear()};function uninit_mitm(){E.mitm=undefined;uninit_mitm_hooks();mitm_lib.uninit();E.unset("mitm_inited")}const mitm_sim_before_request=ff_cb_wrapper("mitm_sim_before_request",d=>{const rule=mitm_lib.get_tab_rule(d.tabId,d.initiator||d.url);return!rule||rule.cmd=="ignore"?{cancel:true}:null});const mitm_sim_on_headers=ff_cb_wrapper("mitm_sim_on_headers",d=>{const rule=mitm_lib.get_tab_rule(d.tabId,d.initiator||d.url);return!rule||rule.cmd=="ignore"?{redirectUrl:chrome.extension.getURL("/js/bext/vpn/bg/sim_dns_block.html")}:null});function on_before_request_int(d){if(d.tabId==-1&&d.url&&requests_handler&&(E.internal_reqs[d.url]||d.url.startsWith("http://internal.hola/"))){return requests_handler.on_before_request(d)}}function on_completed_request_int(d){if(d.tabId!=-1||!d.url||!E.requests||!E.requests[d.requestId]||d.type!="xmlhttprequest"){return}const reqid=d.requestId,req=E.requests[reqid];delete E.requests[reqid];if(!d.error)return;const resp={statusCode:0,error:d.error};if(!req.serving){if(req.proxy_req)req.proxy_resp=resp;else if(req.direct_req)req.direct_resp=resp}let ireq;if(!(ireq=E.internal_reqs[req.url]))return;ireq.error=d.error;if(!ireq.res)ireq.res=resp;if(ireq.et)ireq.et.continue()}function on_send_headers_int(d){if(!d||d.tabId!=-1)return;const req=E.requests[d.requestId],int_req=req&&req.opt.int_req;if(!req||!int_req||!int_req.hdrs)return;let modified;const hdrs=int_req.hdrs,req_hdrs=d.requestHeaders;for(let h in hdrs)modified|=hdrs_add(req_hdrs,h,hdrs[h]);if(modified)return{requestHeaders:req_hdrs}}const is_hola_agent_auth=res=>res.statusCode==407&&res.headers["proxy-authenticate"]=='Basic realm="Hola Unblocker"';function on_headers_int(d){if(!d||d.tabId!=-1)return;const req=E.requests[d.requestId],int_req=req&&req.opt.int_req;if(!req||!d||!requests_handler||!int_req||!req.opt.ignore_redir)return;const res=bg_util.nodify_res(d);if(is_hola_agent_auth(res))return;int_req.res=res;req.cancel=true}const init_mitm_before_request=ff_cb_wrapper("on_before_request_int",on_before_request_int);const init_mitm_on_req_end=ff_cb_wrapper("on_completed_int",on_completed_request_int);const init_mitm_on_send_headers=ff_cb_wrapper("init_mitm_on_send_headers",on_send_headers_int);const init_mitm_on_headers=ff_cb_wrapper("init_mitm_on_headers",on_headers_int);function uninit_mitm_hooks(){if(!init_mitm_hooks.inited)return;try{chrome.webRequest.onBeforeRequest.removeListener(init_mitm_before_request);chrome.webRequest.onHeadersReceived.removeListener(init_mitm_on_headers);chrome.webRequest.onHeadersReceived.removeListener(init_mitm_on_send_headers);chrome.webRequest.onErrorOccurred.removeListener(init_mitm_on_req_end);chrome.webRequest.onCompleted.removeListener(init_mitm_on_req_end);chrome.webRequest.onBeforeRequest.removeListener(mitm_sim_before_request);chrome.webRequest.onHeadersReceived.removeListener(init_mitm_check_url);chrome.webNavigation.onErrorOccurred.removeListener(init_mitm_check_err)}catch(e){on_hooks_err("be_rm_hooks_err",e)}if(internal_reqs_update_cb)E.off("internal_reqs_update",internal_reqs_update_cb);internal_reqs_update_cb=undefined;init_mitm_hooks.inited=false}let internal_reqs_update_cb;function init_mitm_hooks(){if(!requests_handler||init_mitm_hooks.inited||!mitm_lib.inited||!E.mitm.is_auto_discovery()){return}init_mitm_hooks.inited=true;try{if(mitm_lib.enable_sim){chrome.webRequest.onBeforeRequest.addListener(mitm_sim_before_request,{urls:E.mitm.sim_filters("before_request"),types:["main_frame"]},["blocking"]);chrome.webRequest.onHeadersReceived.addListener(mitm_sim_on_headers,{urls:E.mitm.sim_filters("headers_received"),types:["main_frame"]},["responseHeaders","blocking"])}chrome.webRequest.onHeadersReceived.addListener(init_mitm_check_url,{urls:["<all_urls>"],types:["main_frame"]},["responseHeaders"]);chrome.webNavigation.onErrorOccurred.addListener(init_mitm_check_err);const get_internal_urls=()=>{const ret=["http://internal.hola/*"],urls={};for(let key in E.internal_reqs){key=/^http:\/\/internal.hola/.test(key)?E.internal_reqs[key].url:key;if(urls[key])continue;ret.push(key);urls[key]=true}return ret};E.on("internal_reqs_update",internal_reqs_update_cb=()=>{const urls=get_internal_urls();if(zutil.equal_deep(urls,init_mitm_hooks.int_urls))return;chrome.webRequest.onBeforeRequest.removeListener(init_mitm_before_request);chrome.webRequest.onErrorOccurred.removeListener(init_mitm_on_req_end);chrome.webRequest.onCompleted.removeListener(init_mitm_on_req_end);chrome.webRequest.onHeadersReceived.removeListener(init_mitm_on_headers);chrome.webRequest.onHeadersReceived.removeListener(init_mitm_on_send_headers);init_mitm_hooks.int_urls=urls;if(urls.length==1)return;chrome.webRequest.onBeforeRequest.addListener(init_mitm_before_request,{urls:urls},["requestBody","blocking"]);chrome.webRequest.onHeadersReceived.addListener(init_mitm_on_headers,{urls:urls},["blocking","responseHeaders"]);chrome.webRequest.onBeforeSendHeaders.addListener(init_mitm_on_send_headers,{urls:urls},["blocking","requestHeaders"]);chrome.webRequest.onCompleted.addListener(init_mitm_on_req_end,{urls:urls.slice(1)});chrome.webRequest.onErrorOccurred.addListener(init_mitm_on_req_end,{urls:urls.slice(1)})})}catch(e){on_hooks_err("be_add_hooks_err",e)}}function remove_mitm_unblock_rule(url){E.set_proxy_for_url(url,"DIRECT",{src:"mitm_route"})}function remove_mitm_tab_hook(hooks){try{mitm_tab_hooks.forEach(e=>{if(hooks[e.cbname])chrome.webRequest[e.l].removeListener(hooks[e.cbname])})}catch(e){on_hooks_err("be_rm_hooks_err",e)}}function add_mitm_tab_hook(tab_id){const hooks={};const opt=assign({tabId:+tab_id},requests_handler.listener_opt);try{mitm_tab_hooks.forEach(e=>{hooks[e.cbname]=requests_handler[e.cbname].bind(requests_handler);if(!e.extra_opt){return chrome.webRequest[e.l].addListener(hooks[e.cbname],opt)}chrome.webRequest[e.l].addListener(hooks[e.cbname],opt,requests_handler.listener_extra_opt)})}catch(e){on_hooks_err("be_add_hooks_err",e)}return hooks}function init_mitm(){if(mitm_lib.inited||!mitm_lib.init({ajax_via_proxy:E.ajax_via_proxy,storage:storage,perr:be_util.perr,loc:be_info.get("location"),zerr:zerr,bext_config:bext_config,uuid:be_ext.get("uuid"),add_tab_hook:add_mitm_tab_hook,remove_tab_hook:remove_mitm_tab_hook,version:be_util.version(),remove_unblock_rule:remove_mitm_unblock_rule,connection_type:be_util.get_connection_type()||"eth",device_type:be_util.get_device_type(),has_geo:has_geo_rule,init_proxy:()=>be_pac.update_pac_file_state(true)})){return}E.mitm=mitm_lib;E.mitm.debug.tabs_dump=()=>{console.log("TABS Dump:");chrome.tabs.query({},tabs=>{tabs.forEach(t=>{console.log(t.id+" "+t.url)})})};init_mitm_hooks();E.set("mitm_inited",true)}E.send_not_working=(tab,reason)=>{let rate=be_ext.get("gen.dbg_log_rate");if(rate===undefined)rate=100;const with_log=reason&&!Math.floor(Math.random()*rate)/rate;be_util.perr("be_not_working_stats",assign({reason:reason},tab.not_working),{err:true,with_log:with_log,rate_limit:{count:5,ms:date.ms.MIN}});delete tab.not_working};function monitor_not_working(tab_id){let e,period=2*date.ms.MIN,n=period,now=Date.now();for(let id in E.tab_unblockers){let diff,tab=E.tab_unblockers[id];if(!(e=tab.not_working)||(diff=now-e.ts)<period){if(diff&&id!=tab_id)n=Math.min(n,diff);continue}E.send_not_working(tab)}monitor_not_working.to=be_vpn_util.clear_timeout(monitor_not_working.to);if(n<period||tab_id){monitor_not_working.to=be_vpn_util.set_timeout(monitor_not_working,n,{sp:E.sp,name:"monitor_not_working"})}}function inc_not_working(id,tab){let e;if(!tab||!(e=tab.not_working))return;e.stats[id]=(e.stats[id]||0)+1}function on_not_working(e){let tab;if(!(tab=E.get_tab_unblocker(e.tab_id))){return void be_util.perr("be_not_working_tab_not_found",e,{err:true,rate_limit:{count:1}})}let rule=be_vpn_util.get_rule_min_fmt(tab.rule);zerr.notice("tab:%d not working trigger, src %s, current agent %s, %O",e.tab_id,e.src,tab.last_agent&&tab.last_agent.host,{rule:rule,agents:tab.agents});e=assign({err_logs:tab.err_logs},e);unblocker_lib.trigger("not_working",e.tab_id,e);if(tab.not_working)E.send_not_working(tab,"not_working_"+e.src);tab.not_working={ts:Date.now(),info:e,stats:{},rule:rule};monitor_not_working(e.tab_id);if(!["ui","watermark"].includes(e.src)||!debug_hooks)return;let errors={},total;for(let err in tab.debug_errors){if(total=zutil.get(tab.debug_errors,err+".true.total"))errors[err]=total}if(tab.debug_auth)errors.auth=tab.debug_auth;if(tab.media_failures)errors.media=tab.media_failures;if(tab.browse_failures)errors.browse=tab.browse_failures;get_bg_main().dump_errors(e.tab_id,errors)}const ext_on_err=(rule,agent,details,route_opt,retry)=>etask((function*ext_on_err_(){if(rule.changing_proxy)return;if(!retry&&bext_config.report_tab_load_on)be_tabs.page_trace(details,"autoreload");let curr;if(agent&&(curr=unblocker_lib.get_chosen_agent(route_opt,rule))&&agent.host!=curr.host){zerr.notice("tab:%d ignore agent change: failed %s current %s",details.tabId,agent.host,curr.host)}else{const res=yield E.be_rule.change_proxy(details,details.error||(retry?"retry":"unknown"),route_opt,retry);if(res&&res.error)return}if(!retry&&details.tabId>=0){zerr.notice("tab:%d reloading tab on error %s",details.tabId,details.error);be_tabs.reload(details.tabId)}be_ext.trigger("not_working",{tab_id:details.tabId,src:"agent",agent:agent,rule:be_vpn_util.get_rule_min_fmt(rule)})}));const check_retry=(rule,agent,details,tab,route_opt)=>etask((function*_check_retry(){let retry_conf;if(!agent||!(retry_conf=CG("request_errors.retry")))return;let url=details.url;let retry=reason=>etask((function*(){if(!reason)return;zerr.notice("tab:%d allow retry for %s failed request, %s %s",details.tabId,reason,details.error||details.statusCode,url.slice(0,200));be_util.perr("req_err_retry_"+reason,{url:url,status:details.statusCode,error:details.error,agent:agent,type:details.type,rule:be_vpn_util.get_rule_min_fmt(rule)},{rate_limit:{count:1}});yield ext_on_err(rule,agent,details,route_opt,true);return true}));let m;if(!retry_conf.disable_url_ip_check&&(m=url.match(/=(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/))&&unblocker_lib.find_agents({ip:m[1]}).length){zerr.notice("tab:%d %s ignore retry for url %s, agent ip %s found",details.tabId,details.error,url.slice(0,200),m[1]);be_util.perr("req_err_ignore_retry",{url:url,status:details.statusCode,error:details.error,agent:agent,type:details.type,rule:be_vpn_util.get_rule_min_fmt(rule)},{rate_limit:{count:1}});return}let ret=retry_conf.sporadic_perc&&tab.req_err_total_n/tab.req_total_n*100<retry_conf.sporadic_perc&&"sporadic";let mf=bext_config.media_failure;if(!mf||retry_conf.disable_media_failure)return yield retry(ret);let urls=tab.retry_urls=tab.retry_urls||{};if(urls[url]>=(retry_conf.max||5)){zerr.notice("tab:%d max retry %d for media request failed exceeded, "+"%s, %s",details.tabId,urls[url],details.error,url.slice(0,200));return}let check_ext=ext=>url.includes("."+ext);let verify=be_util.get_site_verify_conf(rule.name,url,rule.country);if(mf.extensions.some(check_ext)||verify&&verify.url){urls[url]=(urls[url]||0)+1;ret="media"}return yield retry(ret)}));E.is_mitm_active=tab_id=>E.mitm&&!!E.mitm._is_mitm_active(tab_id);E.reauth_rule_agents=(rule,period)=>{if(rule&&rule.enabled)unblocker_lib.reauth_country_agents(rule.country,period)};E.reverify_rule_agents=rule=>{if(rule&&rule.enabled)unblocker_lib.reverify_country_agents(rule.country)};const track_autoreload=(tab,agent,d)=>{let now=Date.now(),limit=bext_config.autoreload_limit||3;let per=bext_config.autoreload_ms||date.ms.MIN;if(tab.req_err_n==limit){if(now-tab.req_err_ts<per)return;tab.req_err_sent=tab.req_err_n=0}if(!tab.req_err_n)tab.req_err_ts=now;tab.req_err_n=(tab.req_err_n||0)+1;let info={url:d.url,type:d.type,error:d.error,agent:agent,rule:be_vpn_util.get_rule_min_fmt(tab.rule)};if(tab.req_err_n==limit){be_util.perr("req_err_autoreload_max",info);if(is_main_frame(d)&&is_err_handled(d.error,true)){if(main_frame_errors[d.error])set_tab_load_err(d.tabId,d.error);be_util.perr("req_err_main_frame",info)}}be_util.perr("req_err",info);return true};const fix_req_err=(tab,agent,d,route_opt)=>etask((function*_fix_req_err(){let rule;if(!E.inited||!(rule=tab.rule))return;if(!is_main_frame(d)&&(yield check_retry(rule,agent,d,tab,route_opt))){return}E.reauth_rule_agents(rule);if(track_autoreload(tab,agent,d))yield ext_on_err(rule,agent,d,route_opt)}));E._set_req_err=(id,agent,opt)=>etask((function*_set_req_err_(){let domain=zurl.parse(opt.url).host;zerr.notice("tab:%d %s set_err: %s domain=%s",opt.tab_id,id,agent.host,domain);try{const ret=yield ajax.json({url:zescape.uri("https://"+agent.host+":"+agent.port+"/set_err",{domain:domain,err_code:opt.status})});be_vpn_util.assert(zutil.get(ret,"res"),new Error("empty res"));return ret.res}catch(e){be_util.perr(id+"_set_err_failed",{},{rate_limit:{count:1},err:e});return{err:e}}}));const inc_set_err=(s,agent)=>{if(s.agent==agent)return s.count++;s.count=1;s.agent=agent};let set_err_rl={};const fix_media_req_err=(rule,agent,d,tab,route_opt,opt)=>etask((function*_fix_media_req_err(){opt=opt||{};let host;if(!rule||!(host=agent&&agent.host))return;let verify,root_url,tab_url=d.initiator||d.url;if(tab_url)root_url=svc_vpn_util.get_root_url(tab_url);let set_err=root_url&&agent&&(verify=be_util.get_site_verify_conf(root_url,d.url,rule.country));if(!opt.disable_perr){be_util.perr("media_failure_detected",{url:d.url,code:d.statusCode,page_url:tab_url,root_url:root_url,agent:host,set_err:!!set_err,rule:verify},{rate_limit:{count:1}})}if(!set_err)return;tab.set_err=tab.set_err||{};inc_set_err(tab.set_err,host);if(!agent.pool||tab.set_err.count>3){zerr.debug("tab:%d try agent replacement instead of set err: "+(agent.pool?"limit exceeded":"non-pool agent"));if(yield check_retry(rule,agent,d,tab,route_opt)&&opt.cancel_to_retry){return void(d.ret={cancel:true})}return}if(opt.disable_set_err)return;let limit=assign({ms:5*date.ms.MIN,count:10},opt.set_err_rate_limit);let rl_hash=set_err_rl[root_url]=set_err_rl[root_url]||{};let rl=rl_hash[host]=rl_hash[host]||{};if(!rate_limit(rl,limit.ms,limit.count))return zerr.debug("tab:%d set_err limit exeeded: %s",d.tabId,host);yield E._set_req_err("media_failure",agent,{tab_id:d.tabId,url:d.url,status:d.statusCode})}));function get_credentials(){var _key=be_ext.get("agent_key"),key=_key||storage.get("agent_key");var err=_key?null:key?"be_agent_key_fallback":"be_no_agent_key";if(err)be_util.perr(err,{},{err:true,rate_limit:{count:2}});return{username:"user-uuid-"+be_ext.get("uuid"),password:key||"cccccccccccc"}}const agent_auth_listener=ff_cb_wrapper("agent_auth_listener",details=>{if(details.isProxy&&details.realm=="Hola Unblocker"){if(/Auth Failed suspicious/.test(details.statusLine)){get_bg_main().suspend_client();return{cancel:true}}return{authCredentials:get_credentials()}}be_util.perr("auth_listener_not_proxy",_.pick(details,"url","realm","challenger"),{rate_limit:{count:2}});return{}});function agent_auth_listener_del(){if(!agent_auth_listener.inited)return;try{chrome.webRequest.onAuthRequired.removeListener(agent_auth_listener)}catch(e){on_hooks_err("be_rm_hooks_err",e)}agent_auth_listener.inited=false}function is_extra_headers_supported(){return is_chrome&&be_util.browser_guess.version>=79}function agent_auth_listener_add(){if(zutil.is_mocha()||!chrome.webRequest.onAuthRequired)return;agent_auth_listener_del();try{let extra=["blocking"];if(is_extra_headers_supported())extra.push("extraHeaders");chrome.webRequest.onAuthRequired.addListener(agent_auth_listener,{urls:["<all_urls>"]},extra)}catch(e){on_hooks_err("be_add_hooks_err",e)}agent_auth_listener.inited=true}E.init=function(){if(E.inited)return;chrome=window.chrome;if(!requests_handler)requests_handler=Base_handler.get_handler();E.sp=be_vpn_util.new_etask("be_tab_unblocker");E.url_to_rule_infos=E.url_to_rule_infos||{};agent_auth_listener_add();host_tracker=new Host_tracker;E.inited=1;E.listen_to(be_ext,"change:ext.active change:ext.suspended",update_state);E.listen_to(be_ext,"change:bext_config",update_config);be_ext.on("not_working",on_not_working);if(!zutil.is_mocha())E.listen_to(be_info,"change:location",init_mitm);if(zutil.is_mocha()){hola_req_id=0;E.t.requests_handler=requests_handler}update_config();init_mitm();if(window&&window.hola){window.hola.get_log=()=>be_util.get_log().join("\n");window.hola.dump_unittest=unblocker_lib.dump_unittest}};const init_bg_ajax_on_before_request=ff_cb_wrapper("on_before_bg_ajax",on_before_request_int);const init_bg_ajax_on_req_end=ff_cb_wrapper("on_req_end_bg_ajax",on_completed_request_int);const init_bg_ajax_on_send_headers=ff_cb_wrapper("on_send_headers_bg_ajax",on_send_headers_int);const init_bg_ajax_on_headers=ff_cb_wrapper("on_headers_bg_ajax",on_headers_int);E.init_ajax_via_proxy=function(){if(E.ajax_via_proxy_inited||zutil.is_mocha())return;be_ext.set("ajax_via_proxy_inited",E.ajax_via_proxy_inited=1);E.url_to_rule_infos=E.url_to_rule_infos||{};if(!requests_handler)requests_handler=Base_handler.get_handler();requests_handler.init();be_pac.init();const et=be_pac.update_pac_file_state();const urls=["http://internal.hola/*","https://client.hola.org/*","https://hola.org/*","https://perr.hola.org/*","https://client.svd-cdn.com/*","https://svd-cdn.com/*","https://perr.svd-cdn.com/*","http://*.trigger.hola.org/*","https://client.h-vpn.org/*","https://h-vpn.org/*","https://perr.h-vpn.org/*"];try{chrome.webRequest.onBeforeRequest.addListener(init_bg_ajax_on_before_request,{urls:urls},["requestBody","blocking"]);chrome.webRequest.onHeadersReceived.addListener(init_bg_ajax_on_headers,{urls:urls},["blocking","responseHeaders"]);chrome.webRequest.onBeforeSendHeaders.addListener(init_bg_ajax_on_send_headers,{urls:urls},["blocking","requestHeaders"]);chrome.webRequest.onCompleted.addListener(init_bg_ajax_on_req_end,{urls:urls.slice(1)});chrome.webRequest.onErrorOccurred.addListener(init_bg_ajax_on_req_end,{urls:urls.slice(1)})}catch(e){on_hooks_err("be_add_hooks_err",e)}return et};E.uninit_ajax_via_proxy=function(){if(!E.ajax_via_proxy_inited)return;be_ext.set("ajax_via_proxy_inited",E.ajax_via_proxy_inited=0);try{chrome.webRequest.onBeforeRequest.removeListener(init_bg_ajax_on_before_request);chrome.webRequest.onErrorOccurred.removeListener(init_bg_ajax_on_req_end);chrome.webRequest.onCompleted.removeListener(init_bg_ajax_on_req_end);chrome.webRequest.onHeadersReceived.removeListener(init_bg_ajax_on_headers);chrome.webRequest.onHeadersReceived.removeListener(init_bg_ajax_on_send_headers)}catch(e){on_hooks_err("be_rm_hooks_err",e)}};function update_state(){let is_enabled=!be_ext.is_disabled();if(!is_enabled)E.uninit_ajax_via_proxy();be_pac.update_pac_file_state();if(is_enabled==E.is_enabled)return;E.is_enabled=is_enabled;E.stopListening(be_tabs);if(requests_handler)requests_handler.uninit();if(monitor_proxy_req_slow.et)monitor_proxy_req_slow.et=void monitor_proxy_req_slow.et.return();if(monitor_page_load.et)monitor_page_load.et=void monitor_page_load.et.return();if(monitor_not_working.to){monitor_not_working.to=be_vpn_util.clear_timeout(monitor_not_working.to)}if(!E.is_enabled)return;if(requests_handler)requests_handler.init();E.listenTo(be_tabs,"created",on_tab_created);E.listenTo(be_tabs,"updated",on_tab_updated);E.listenTo(be_tabs,"removed",on_tab_removed);E.listenTo(be_tabs,"replaced",on_tab_replaced);E.listenTo(be_tabs,"completed",on_tab_completed);E.listenTo(be_tabs,"before_navigate",on_before_navigate)}function mitm_config_reset(prev,config){if(_.isEqual(prev.mitm,config.mitm)||storage.get_json("mitm_debug"))return;uninit_mitm();init_mitm()}function update_config(){const prev=bext_config;bext_config=be_ext.get("bext_config")||{};mitm_config_reset(prev,bext_config);proxy_debug=zutil.get(bext_config,"debug.proxy_debug");debug_hooks=!zutil.is_mocha()&&!zutil.get(bext_config,"debug_logs.disable")||zutil.get(bext_config,"debug_logs.enable");request_errors=zutil.bool_lookup(zutil.get(bext_config,"request_errors.handle",[]));if(requests_handler&&prev.debug_hooks!=bext_config.debug_hooks)requests_handler.update_hooks();if(CG("disable_slow_load_monitor")&&monitor_page_load.et)monitor_page_load.et=void monitor_page_load.et.return()}function get_failure_config(type){const failure=be_util.CG(type+"_failure");if(failure&&!failure.disable&&(!failure.min_ver||version_util.cmp(be_util.version(),failure.min_ver)>=0)){return failure}}const on_main_frame_headers=d=>{let failure;if(!(failure=get_failure_config("browse")))return;let req,tab;if(d.tabId<0||!/^(4|5)/.test(d.statusCode)||d.statusCode==407)return;let tab_url=d.url||d.initiator,root_url;if(tab_url)root_url=svc_vpn_util.get_root_url(tab_url);if((!(tab=E.get_tab_unblocker(d.tabId))||!(req=E.requests[d.requestId]))&&!zurl.is_hola_domain(root_url)){return}let agent;if(tab&&req&&(agent=req.agent))tab.browse_failures=(tab.browse_failures||0)+1;zerr.notice("tab:%d browse failure detected: %d %s",d.tabId,d.statusCode,d.url.slice(0,200));if(failure.disable_perr)return;let info={url:d.url,code:d.statusCode,page_url:tab_url,root_url:root_url,agent:agent&&agent.host,details:d};be_util.perr("browse_failure_detected",info,{rate_limit:{count:1}})};E.get_all_agents=function(){let agents=[];if(!E.rules)return agents;for(let r in E.rules.unblocker_rules){let rule=E.rules.unblocker_rules[r];for(let route of unblocker_lib.get_rule_routes(rule))agents=agents.concat(unblocker_lib.get_agents_by_route(route))}return agents};if(zutil.is_mocha()){E.t={Base_handler:Base_handler,is_force_proxy:is_force_proxy,on_not_working:on_not_working,tab_unblocker_del:tab_unblocker_del,url_hook:init_mitm_check_url,err_hook:init_mitm_check_err,get_forced_strategy:get_forced_strategy,test_rules:test_rules,on_before_navigate:on_before_navigate,on_tab_created:on_tab_created,on_tab_updated:on_tab_updated,on_tab_removed:on_tab_removed,requests_handler:requests_handler,is_vpn_allowed:is_vpn_allowed,url2host:url2host,be_pac:be_pac,fix_req_err:fix_req_err,check_retry:check_retry}}return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var conf__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(24);var conf__WEBPACK_IMPORTED_MODULE_0___namespace=__webpack_require__.t(24,1);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_3__);var _util_date_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(16);var _util_date_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_4__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(35);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(29);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_7__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(37);var _util_util_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_10__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11__);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.assert_bg("be_trial");const assign=Object.assign;let handler,is_user_updated;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default.a.task_model.extend({model_name:"trial",_defaults:function(){this.on("destroy",()=>E.uninit())}}));function Trial(){this.trials=[];this.name="remote";this.get_trials=get_trials.bind(this,"/trial_get2")}Trial.prototype.get_trial_active=function(root_url,ignore_ts){if(is_user_updated&&!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("user_id")||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("is_premium"))return;return this.trials.find(t=>{if(root_url&&!t.domain.includes(root_url))return false;return ignore_ts||t.expire_ts>Date.now()})};Trial.prototype.is_trial_available=function(root_url){return this.set_trial(root_url,"start",{dry_run:1})};Trial.prototype.is_trial_expired=function(root_url){return["expired","grace"].includes(this.trial_state(root_url))};Trial.prototype.is_trial_grace_period=function(root_url){return this.trial_state(root_url)=="grace"};Trial.prototype.set_trial=function(root_url,cmd,opt){var site;if(!(site=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get_site_conf(root_url)))return;opt=opt||{};cmd=cmd||"start";var _this=this;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()("trial_start",(function*trial_start_(){try{const qs=assign({url:root_url,opt:cmd},_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.auth());if(opt.dry_run)qs.dry_run=1;if(get_reduced_wait_time(root_url))qs.reduced_wait=1;const be_bg_main=window.be_bg_main;if(be_bg_main){be_bg_main.ga_send("event",{cat:"ppc",act:"trial_start",lab:root_url})}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.perr("be_trial_start",{root_url:root_url,cmd:cmd});let res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_6__["a"].ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_0__.url_ccgi+"/trial_set2",qs:qs,retry:3});if(!_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.get(res,"time_left")){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.perr("be_trial_start_no_trial",{root_url:root_url,cmd:cmd});return}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.perr("be_trial_start_got_trial",{cmd:cmd,root_url:root_url,time_left:res.time_left,grace_ms:res.grace_ms});let domain=site.root_url;if(!Array.isArray(domain))domain=[domain];res={domain:domain,time_left:res.time_left,use:res.use,grace_ms:res.grace_ms,expire_ts:Date.now()+res.time_left,reduced_wait_use_ts:res.reduced_wait_use_ts};if(!opt.dry_run){let t;if(t=_this.get_trial(root_url))_this.trials.splice(_this.trials.indexOf(t),1);_this.trials.push(res);_this.monitor_active_trial();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.trigger("trial_start",root_url)}return res}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.warn("trial_start failed %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.e2s(e));_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.perr("be_trial_start_error",{root_url:root_url,cmd:cmd},{err:_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.omit(e,"etask")});throw new Error(_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.get(e,"hola_info.data.err","unknown"))}}))};Trial.prototype.monitor_active_trial=function(){if(this.trial_monitor)return;const _this=this;_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.notice("monitor_active_trial start");this.trial_monitor=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({async:true},(function*trial_monitor_(){this.finally(()=>{_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.notice("monitor_active_trial finish");_this.trial_monitor=null});return yield monitor_active_trial()}));E.sp.spawn(this.trial_monitor)};Trial.prototype.get_trial=function(root_url){return this.trials.find(t=>t.domain.includes(root_url))};Trial.prototype.trial_state=function(root_url){let t;if(!root_url||!(t=this.get_trial(root_url)))return;if(!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get_site_conf(root_url))return"forbidden";const now=Date.now();if(t.expire_ts>now)return"running";return t.grace_ms&&t.expire_ts<now&&now<t.grace_ms+t.expire_ts?"grace":"expired"};Trial.prototype.set_time_left=function(root_url,value,reset_use){let t,user_id;if(!(t=this.get_trial_active(root_url,true))||!(user_id=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("user_id"))){return}return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()("trial_set_time_left",(function*set_time_left_(){try{_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.perr("set_time_left",{root_url:root_url,value:value});const res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_6__["a"].ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_0__.url_ccgi+"/trial_set_time_left",qs:assign({url:root_url,reset_use:reset_use,time_left:value,user_id:user_id},_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.auth())});if(res.time_left){t.expire_ts=Date.now()+res.time_left;t.time_left=res.time_left}if(res.use)t.use=res.use;_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.trigger("trial_change",root_url,t);return res}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.warn("trial_set_time_left failed %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.e2s(e));throw new Error(_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.get(e,"hola_info.data.err","unknown"))}}))};Trial.prototype.reset=function(root_url){let user_id;if(!(user_id=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("user_id")))return;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*trial_reset(){try{_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.perr("set_time_left_",{root_url:root_url});yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_6__["a"].ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_0__.url_ccgi+"/trial_reset",qs:assign({url:root_url,user_id:user_id},_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.auth())});refresh_trials()}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.warn("trial_reset failed %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.e2s(e));throw new Error(_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.get(e,"hola_info.data.err","unknown"))}}))};Trial.prototype.uninit=function(){if(this.trial_monitor)this.trial_monitor.return()};function update_trials(){if(update_trials.to)return;update_trials.to=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.set_timeout(()=>{delete update_trials.to;if(E.get_trial_active())refresh_trials()},_util_date_js__WEBPACK_IMPORTED_MODULE_4___default.a.ms.HOUR)}const clear_trial=trial=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*clear_trial_(){if(trial.expire_ts<=Date.now()||!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("user_id"))yield E.be_rule.disable_trial(trial.domain)}));function monitor_active_trial(on_active_cb){let trial_usage=0,ended={},cleared={};return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.interval(_util_date_js__WEBPACK_IMPORTED_MODULE_4___default.a.ms.SEC,(function*monitor_active_trial_(){let is_active,is_grace;for(let t of handler.trials){let root_url=t.domain[0];if(E.get_trial_active(root_url)){is_active=true;ended[root_url]=cleared[root_url]=undefined;continue}if(!ended[root_url]){_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.notice("trigger trial_end %s",root_url);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.trigger("trial_end",root_url);const be_bg_main=window.be_bg_main;if(be_bg_main){be_bg_main.ga_send("event",{cat:"ppc",act:"trial_end",lab:root_url})}ended[root_url]=true}if(E.is_trial_grace_period(root_url))is_grace=true;else{if(!cleared[root_url])yield clear_trial(t);cleared[root_url]=true}}if(on_active_cb)on_active_cb(is_active&&!is_grace);if(!is_active){if(trial_usage>0)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.perr("be_site_trial_usage",{sec:trial_usage});trial_usage=0;if(!is_grace)return yield this.break()}if(get_trial_using())trial_usage++}))}function get_trial_using(root_url){var trial;if(!(trial=E.get_trial_active(root_url)))return;for(var rule,rules,i=0;i<trial.domain.length;i++){root_url=trial.domain[i];if(!_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_7___default.a.has_root_url(root_url))return false;rules=E.be_rule.get_rules("http://"+root_url+"/",true);if((rule=rules&&rules[0])&&rule.enabled)return root_url}}function refresh_trials(){handler.get_trials()}function update_trial(trials){var now=Date.now();return trials.map(t=>{let site;if(site=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get_site_conf(t.domain))t.domain=site.root_url;if(!Array.isArray(t.domain))t.domain=[t.domain];if(t.expire_ts>=now&&t.time_left!==undefined||t.time_left>0)t.expire_ts=now+t.time_left;return t})}function get_trials(url){const _this=this;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()("get_trials",(function*get_trials_(){try{const auth=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.auth();if(!auth||!auth.uuid||!auth.session_key){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.perr("be_empty_user_session");return}const trials=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_6__["a"].ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_0__.url_ccgi+url,qs:auth,retry:3});if(!trials||!Array.isArray(trials))return;_this.trials=update_trial(trials);_this.monitor_active_trial()}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.warn("get_trial failed %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.e2s(e))}}))}E.is_trial_grace_period=root_url=>!_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.is_mocha()&&handler.is_trial_grace_period(root_url);E.set_trial=(root_url,cmd,opt)=>handler.set_trial(root_url,cmd,opt);E.is_trial_available=root_url=>!_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.is_mocha()&&handler.is_trial_available(root_url);E.is_trial_expired=root_url=>!_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.is_mocha()&&handler.is_trial_expired(root_url);E.get_trial_active=(root_url,ignore_ts)=>!_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.is_mocha()&&handler.get_trial_active(root_url,ignore_ts);E.get_next_trial_ts=root_url=>{let trial,site;if(!(site=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get_site_conf(root_url))||!site.trial||!(trial=E.get_trial_active(root_url,true))){return}let limits,lperiod;if((limits=site.trial.limits)&&limits.count){lperiod=limits.period||_util_date_js__WEBPACK_IMPORTED_MODULE_4___default.a.ms.DAY;if(trial.use&&trial.use.count>=limits.count)return trial.use.ts+lperiod}const wait=site.trial.wait!==undefined?site.trial.wait:2*_util_date_js__WEBPACK_IMPORTED_MODULE_4___default.a.ms.MIN;return trial.expire_ts+wait};const get_reduced_wait_time=root_url=>{let trial_conf=_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.get(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get_site_conf(root_url),"trial")||{};let trial=E.get_trial_active(root_url,true);let reduced_wait=trial_conf.reduced_wait||{};return trial&&reduced_wait.period&&(!trial.reduced_wait_use_ts||Date.now()-trial.reduced_wait_use_ts<reduced_wait.period)&&reduced_wait.time};E.get_trial_wait=root_url=>{if(!E.get_trial_active(root_url,true))return null;return get_reduced_wait_time(root_url)||_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.get(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get_site_conf(root_url),"trial.wait2")};E.set_time_left=(...args)=>{if(handler.set_time_left)return handler.set_time_left(...args)};E.reset=(...args)=>{if(handler.reset)return handler.reset(...args)};E.need_trial=root_url=>{const site_conf=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get_site_conf(root_url);return site_conf&&site_conf.require_plus&&!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("is_premium")&&site_conf.trial&&!E.get_trial_active(root_url)};E.init=be_rule=>{E.be_rule=be_rule;E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.new_etask("be_trial");E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a,"change:session_key",refresh_trials);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a,"change:user_id",()=>{if(handler.get_trial_active()&&!handler.trial_monitor)handler.monitor_active_trial()});E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a,"change:ui_open",update_trials);E.listenTo(_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_9__["default"],"user_updated",()=>is_user_updated=true);handler=new Trial};E.uninit=()=>{E.sp.return();if(update_trials.to)update_trials.to=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default.a.clear_timeout(update_trials.to);E.stopListening()};__webpack_exports__["default"]=E},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(33);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(29);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_2__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(22);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(30);var _util_etask_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_6__);var _util_util_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_7__);
// LICENSE_CODE ZON
const chrome=window.chrome;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default.a.task_model.extend({model_name:"dev_mode"}));const force_tpopup=type=>{var tab_url=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_2___default.a.get("active.url");var tab_id=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_2___default.a.get("active.id");if(!tab_url||!tab_id)return;var domain=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.get_root_url(tab_url);_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_1__["default"].set_force_tpopup(domain,type);if(type=="suggestion")_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_2___default.a.set_force_suggestion(tab_id,true);chrome.tabs.reload(tab_id)};const on_change_mode=()=>{_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default.a.set("dev_mode",E.get("dev_mode"));_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.enable_events_logging(E.get("dev_mode"));if(!chrome||!chrome.contextMenus)return;chrome.contextMenus.removeAll();if(!E.get("dev_mode"))return;chrome.contextMenus.create({id:"hola-vpn-dev-tpopup",title:"Show tpopup",contexts:["browser_action"],onclick:()=>{force_tpopup()}});chrome.contextMenus.create({id:"hola-vpn-dev-mitm-popup",title:"Show mitm popup",contexts:["browser_action"],onclick:()=>{force_tpopup("mitm_popup")}});chrome.contextMenus.create({id:"hola-vpn-dev-watermark-popup",title:"Show watermark popup",contexts:["browser_action"],onclick:()=>{force_tpopup("watermark")}});chrome.contextMenus.create({id:"hola-vpn-dev-suggestion-popup",title:"Force trial suggestion",contexts:["browser_action"],onclick:()=>{force_tpopup("suggestion")}})};function on_change(e){_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_5__["default"].storage_local_set({dev_mode_conf:e.attributes});E.trigger("change:dev_mode")}E.enable=dev_mode=>E.set("dev_mode",!!dev_mode);E.init=()=>{E.on("change:dev_mode",on_change_mode);return _util_etask_js__WEBPACK_IMPORTED_MODULE_6___default()((function*dev_mod_init(){let o=yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_5__["default"].storage_local_get("dev_mode_conf");_util_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.forEach(o,(name,val)=>E.set(name,val));E.on("change",on_change)}))};E.uninit=()=>{E.off("change",on_change);E.off("change:dev_mode",on_change_mode)};__webpack_exports__["default"]=E},,,,,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_1__);var _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(36);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(21);var _util_storage_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_4__);var _util_date_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(16);var _util_date_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_5__);
// LICENSE_CODE ZON
let be_bg_main=window.be_bg_main;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default.a.task_model.extend({model_name:"mode",_defaults:function(){this.on("destroy",()=>E.uninit())}}));function update_pending(new_mode,change){var last_mode=_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.get("last_mode"),pending;if(new_mode=="ext"&&last_mode)pending=last_mode;if(pending==E.get("pending"))return;change.pending=pending;_util_zerr_js__WEBPACK_IMPORTED_MODULE_1___default.a.info("pending mode set to "+pending)}let disconnections=[],ignore_svc;function maybe_ignore_svc(){if(_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("proxyjs_connected")||E.get("mode")!="exe")return;disconnections.push(_util_date_js__WEBPACK_IMPORTED_MODULE_5___default()());disconnections=disconnections.slice(-2);if(disconnections.length==2&&Date.now()-disconnections[0]<_util_date_js__WEBPACK_IMPORTED_MODULE_5___default.a.ms.SEC*10){_util_zerr_js__WEBPACK_IMPORTED_MODULE_1___default.a.info("Too frequent disconnections - ignoring svc");ignore_svc=true}}function is_svc_connected(){return _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("cid_js")&&_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("session_key_cid_js")&&_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("proxyjs_connected")}function update_mode(){var new_mode=is_svc_connected()&&!ignore_svc?"exe":"ext";var change={},mode_changed;if(new_mode!=E.get("mode"))mode_changed=true;maybe_ignore_svc();update_pending(new_mode,change);Object.assign(change,{mode:new_mode,is_svc:new_mode!="ext",is_ext:new_mode=="ext","svc.detected":!!_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("version"),"svc.version":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("version"),"svc.cid_js":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("cid_js"),"svc.session_key_cid_js":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("session_key_cid_js"),"svc.info":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("info"),"svc.callback_raw":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("callback_raw"),"svc.callback_ts":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("callback_ts")});if(mode_changed)change.ts=Date.now();E.safe_set(change);be_bg_main.safe_set(change);if(!mode_changed)return;if(new_mode!="ext")_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default.a.set("last_mode",new_mode);_util_zerr_js__WEBPACK_IMPORTED_MODULE_1___default.a.info("mode set to "+new_mode);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("mode_change",{new_mode:new_mode,proxyjs_connected:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("proxyjs_connected"),cid_js:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("cid_js"),session_key_cid_js:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("session_key_cid_js")});E.set("mode_change_count",(E.get("mode_change_count")||0)+1)}E.init=()=>{be_bg_main=window.be_bg_main;E.listenTo(_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"],"all",update_mode);update_mode()};E.uninit=()=>{E.stopListening();E.clear()};__webpack_exports__["a"]=E},function(module,__webpack_exports__,__webpack_require__){"use strict";var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__);var _util_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_4__);var _util_array_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(26);var _util_array_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_array_js__WEBPACK_IMPORTED_MODULE_5__);var _util_rand_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(61);var _util_rand_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_rand_js__WEBPACK_IMPORTED_MODULE_6__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(40);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(33);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(29);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(22);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12__);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(27);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_util_version_util_js__WEBPACK_IMPORTED_MODULE_13__);var _bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(64);var _util_url_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(18);var _util_url_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_15__);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(41);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(35);var _util_storage_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(21);var _util_storage_js__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_18__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19__);var _bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(50);var _util_date_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(16);var _util_date_js__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_21__);var _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(36);var _bext_vpn_bg_pac_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(74);var _bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(54);var _bext_vpn_bg_tab_perr_js__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(97);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(37);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(38);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_27___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_27__);var _bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(76);var _bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_28___default=__webpack_require__.n(_bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_28__);var _protocol_pub_countries_js__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(49);var _protocol_pub_countries_js__WEBPACK_IMPORTED_MODULE_29___default=__webpack_require__.n(_protocol_pub_countries_js__WEBPACK_IMPORTED_MODULE_29__);var _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(42);var _bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(75);var _bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_31___default=__webpack_require__.n(_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_31__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(30);var _bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(44);var conf__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(24);var conf__WEBPACK_IMPORTED_MODULE_34___namespace=__webpack_require__.t(24,1);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.assert_bg("be_vpn");function get_bg_main(){return window.be_bg_main}let chrome=window.chrome,assign=Object.assign;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default.a.model.extend({tabs:{},active_tab_id:0,unblocked_urls:{},history:{},_defaults:function(){this.on("destroy",()=>E.uninit())}}));var active_tab_timer_ms=_util_date_js__WEBPACK_IMPORTED_MODULE_21___default.a.ms.HOUR;E.be_tab_unblocker=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a;function is_stub_unblock(domain){return domain&&(!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_26__["default"].is_active()&&_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.is_google(domain)||_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.is_skip_url(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.root2url(domain)))}function on_lib_event(o){switch(o.id){case"set_agent_key":_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.set("agent_key",o.data);break;case"before_rule_set":if(!is_stub_unblock(o.data)&&o.data!="all_browser")clean_cookies(o.data);if(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(chrome,"webRequest.handlerBehaviorChanged"))chrome.webRequest.handlerBehaviorChanged();break}}function get_root_urls(root_url){var site,root_urls=[root_url];if(!(site=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_site_conf(root_url))||!site.root_url)return root_urls;for(var i=0;i<site.root_url.length;i++){if(root_url!=site.root_url[i])root_urls.push(site.root_url[i])}return root_urls}function clean_cookies(domain){if(!_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(chrome,"cookies.getAll")||!_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(chrome,"cookies.remove")){return}var site;if((site=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_site_conf(domain))&&site.keep_cookies)return;E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*clean_cookies_domain_(){const domains=get_root_urls(domain);let cookies=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.all(domains.map(v=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.cb_apply(chrome.cookies.getAll,[{domain:v}])));cookies=_util_array_js__WEBPACK_IMPORTED_MODULE_5___default.a.flatten_shallow(cookies||[]);cookies.forEach(cookie=>{if(!cookie)return;chrome.cookies.remove({name:cookie.name,url:(cookie.secure?"https":"http")+"://"+cookie.domain+cookie.path})})})));E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*clean_cookies_all_(){let cookies=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.all([_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.cb_apply(chrome.cookies.getAll,[{name:"DS"}]),_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.cb_apply(chrome.cookies.getAll,[{name:"DE2"}])]);cookies=_util_array_js__WEBPACK_IMPORTED_MODULE_5___default.a.flatten_shallow(cookies);const filtered=underscore__WEBPACK_IMPORTED_MODULE_0___default.a.filter(cookies,cookie=>cookie&&/^\.g[a-z]{1}\.com$/.test(cookie.domain));filtered.forEach(cookie=>{chrome.cookies.remove({url:"http://yep"+cookie.domain,name:cookie.name})});if(filtered.length){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_clean_cookies2",{rule:domain,cookies:filtered.map(c=>underscore__WEBPACK_IMPORTED_MODULE_0___default.a.pick(c,"domain","name","path"))},{rate_limit:{count:1}})}})))}const on_premium_change=()=>{const tasks=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_27___default.a.set_user_plus(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium"));if(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(tasks,"length")&&E.active_tab_id)_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a.reload(E.active_tab_id)};function CG(id,def){return _util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("bext_config"),id,def)}function uninit_unblocker_lib(){_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_27___default.a.uninit();_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_27___default.a.off("lib_event",on_lib_event);init_unblocker_lib.inited=false;E.stopListening(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a,"change:is_premium",on_premium_change)}const init_unblocker_lib=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_init_unblocker_lib(){if(init_unblocker_lib.inited)return;init_unblocker_lib.inited=true;_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_27___default.a.on("lib_event",on_lib_event);yield _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_27___default.a.init({be_dev_mode:_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_33__["default"],perr:(opt,err)=>err?_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr(opt.id,opt.info,assign({err:err},opt)):_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr(opt.id,opt.info,opt),ajax:_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].ajax,ajax_via_proxy:_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.ajax_via_proxy,storage:{get:id=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*get(){let ret=yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_32__["default"].storage_local_get(id);return ret&&ret[id]})),set:(id,val)=>_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_32__["default"].storage_local_set({[id]:val})},conf_get:(id,def)=>{var v=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get(id);return/^gen\./.test(id)?v!==undefined?v:def:CG(id,def)},get_auth:()=>_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.auth({is_premium:+!!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium")}),get_prod_info:()=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.qs_ajax({uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("uuid")}),get_user_info:()=>({hola_uid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("hola_uid"),country:(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("location"),"country")||"").toLowerCase()}),suspend_client:()=>get_bg_main().suspend_client(),get_verify_url:agent=>(_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].is_agent_fallback()?"http://"+agent.ip:"https://"+agent.host)+":"+agent.port+"/verify_proxy",get_rule_routes:rule=>{let routes=[],s=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.pick(rule,"country");routes.push(s);let route=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.get_rule_route(rule);if(route.pool)routes.push(assign({pool:route.pool},s));return routes},get_fallback_agent:country=>{let a;if(!(a=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(conf__WEBPACK_IMPORTED_MODULE_34__,"fallback_agents.agents."+country)))return;a=_util_rand_js__WEBPACK_IMPORTED_MODULE_6___default.a.rand_element(a);return{host:a.name+".hola.org",port:22222,ip:a.ip,port_list:conf__WEBPACK_IMPORTED_MODULE_34__.fallback_agents.ports,is_fallback:true}}});E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a,"change:is_premium",on_premium_change)}));E.uninit=function(){if(!E.get("inited"))return;E.sp.return();status_cb.timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.clear_timeout(status_cb.timer);E.off("recover",on_recover);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.off("change:is_premium",set_gen_conf_cb);proxy_settings_monitor.uninit();monitor_active_uninit();uninit_unblocker_lib();if(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.is_mocha()){E.be_tpopup.uninit();_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].uninit();_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.uninit();_bext_vpn_bg_tab_perr_js__WEBPACK_IMPORTED_MODULE_25__["a"].uninit();_bext_vpn_bg_pac_js__WEBPACK_IMPORTED_MODULE_23__["default"].uninit();E.be_svc.uninit();E.be_mode.uninit();E.be_info.uninit()}else{E.be_tpopup._destroy();_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"]._destroy();_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a._destroy();_bext_vpn_bg_tab_perr_js__WEBPACK_IMPORTED_MODULE_25__["a"]._destroy();_bext_vpn_bg_pac_js__WEBPACK_IMPORTED_MODULE_23__["default"]._destroy();E.be_svc._destroy();E.be_mode._destroy();E.be_info._destroy()}E.stopListening();E.clear()};var proxy_settings_monitor={};proxy_settings_monitor.init=function(){if(this.inited||!chrome||conf__WEBPACK_IMPORTED_MODULE_34__.firefox_web_ext||_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.is_mocha())return;this.inited=true;try{chrome.proxy.settings.get({},this.changed_cb);chrome.proxy.settings.onChange.addListener(this.changed_cb)}catch(err){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("proxy_settings_init_err",{},{err:err,rate_limit:{count:1}})}};proxy_settings_monitor.uninit=function(){if(!this.inited)return;try{chrome.proxy.settings.onChange.removeListener(this.changed_cb)}catch(err){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("proxy_settings_uninit_err",{},{err:err,rate_limit:{count:1}})}};proxy_settings_monitor.changed_cb=function(details){if(!details)return _util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()("proxy_changed no details");var conflict=details.levelOfControl=="controlled_by_other_extensions";_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a[conflict?"err":"debug"]("proxy changed: %s control: %s",!details.value.pacScript||details.value.pacScript.url?_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.json(details.value):"pacScript-data",details.levelOfControl);let prev=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("ext.conflict");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.set({"proxy.effective.control_level":details.levelOfControl,"proxy.effective.value":details.value,"ext.conflict":conflict});if(!!prev==!!conflict)return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr(conflict?"ext_conflict":"ext_conflict_resolved",{proxy_level:E.get("proxy.effective.control_level"),proxy_value:E.get("proxy.effective.value")},{rate_limit:{count:1,ms:_util_date_js__WEBPACK_IMPORTED_MODULE_21___default.a.ms.DAY}})};function on_recover(){if(E.get("need_recover"))return;E.set("need_recover",true);status_cb()}function update_state(){let is_enabled=!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.is_disabled();if(is_enabled==E.is_enabled)return;E.is_enabled=is_enabled;if(!is_enabled){_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_27___default.a.reset();_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_22__["default"].uninit()}else _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_22__["default"].init(E)}E.init=function(){return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*init(){if(E.get("inited"))return;chrome=window.chrome;E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.new_etask("be_vpn");E.set("inited",true);E.on("recover",on_recover);E.be_rule=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"];E.be_tpopup=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_14__["a"];E.be_info=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"];E.be_svc=_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_22__["default"];E.be_mode=_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_24__["a"];_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].init();_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_22__["default"].init(E);_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_24__["a"].init();_bext_vpn_bg_pac_js__WEBPACK_IMPORTED_MODULE_23__["default"].init();yield init_unblocker_lib();_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.init();_bext_vpn_bg_tab_perr_js__WEBPACK_IMPORTED_MODULE_25__["a"].init(E);_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].init();_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_14__["a"].init();proxy_settings_monitor.init();E.listenTo(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"],"change:status",status_cb);E.listenTo(E.be_info,"change:status",status_cb);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a,"change:active.id",tab_vpn_on_change_active);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a,"change:active.url",update_mitm_state);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a,"change:active.url",update_protect_state);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a,"created",tab_vpn_on_created);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a,"updated",tab_vpn_on_updated);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a,"committed",tab_vpn_on_comitted);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a,"removed",tab_vpn_on_removed);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a,"replaced",tab_vpn_on_replaced);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a,"error_occured",tab_vpn_on_error_occured);E.listen_to(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a,"change:mitm_inited",on_mitm_inited);E.listenTo(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a,"mitm_block",update_mitm_state);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a,"trial_end",trial_end_cb);E.listenTo(_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_26__["default"],"user_updated",E.force_bext_config_update);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a,"change:ext.active change:ext.suspended",update_state);chrome.tabs.query({},tabs=>{for(var i=0;i<tabs.length;i++)tab_vpn_on_created({tab:tabs[i]})});E.sp.spawn(update_vpn_countries());E.sp.spawn(bext_config_init());monitor_active_init();E.set("protected_ui_state",_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.get_json("protected_ui_state")||{});let bump_ts;if(!(bump_ts=_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.get_int("bump_ts")))return;_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.clr("bump_ts");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_bump_done",{bump:_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.get_int("bump"),ms:Date.now()-bump_ts})}))};function update_tests(conf){const is_enabled=(c,key,name)=>c[key][name]>0&&c[key][name]<1;if(!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_26__["default"].get("is_test_user"))return;let key;for(key in conf){if(is_enabled(conf,key,"on"))conf[key].on=1}if(!conf.ws)return;for(key in conf.ws){if(is_enabled(conf.ws,key,"enabled_on"))conf.ws[key].enabled_on=1}}function ts_in_range(begin_ts,ts_ar,end_ts){return ts_ar.some(ts=>ts&&begin_ts<ts&&ts<=end_ts)}function update(info,data,ts,pref,expire_ts){if(!info||!info.last_req_ts)return;ts[pref+"req_ts"]=Math.max(ts[pref+"req_ts"],info.last_req_ts);const to_remove=[];for(let host in info.agents){if(info.agents[host]>expire_ts)data[pref+"agents"][host]=info.agents[host];else to_remove.push(host)}for(let i=0;i<to_remove.length;i++)delete data[pref+"agents"][to_remove[i]];if(!info.req_stats)return;const p=pref+(pref?"_":"")+"req_";for(let n in info.req_stats){if(info.req_stats[n])data[p+n]=(data[p+n]||0)+info.req_stats[n]}info.req_stats={}}function get_active_agents(agents,begin_ts,end_ts){const res=[];for(let host in agents){if(ts_in_range(begin_ts,[agents[host]],end_ts))res.push(host)}return res}var monitor_active={};function monitor_active_init(){const period=_util_date_js__WEBPACK_IMPORTED_MODULE_21___default.a.ms.HOUR;const get_data=()=>{let data=_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.get_json("monitor_active");if(!data||typeof data!="object")data={};return data};E.sp.spawn(monitor_active.sp=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"monitor_active",cancel:true},(function*monitor_active_init_loop_(){this.finally(()=>delete monitor_active.sp);for(let n=1;;n++){if(n>=60){n=0;let data=get_data();let ts=Date.now(),end_ts=ts,begin_ts=end_ts-period;let active_ts_ar=[data.unblocker_tab_ts,data.ui_close_ts,data.ui_open_ts,data.req_ts,data.mitm_tab_ts,data.mitm_req_ts];if(ts_in_range(begin_ts,active_ts_ar,end_ts)){let agents=get_active_agents(data.agents,begin_ts,end_ts);let mitm_agents=get_active_agents(data.mitm_agents,begin_ts,end_ts);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_active",assign({agents:agents,mitm_agents:mitm_agents,begin:begin_ts,end:end_ts},_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.pick(data,"req_ts","unblocker_tab_ts","ui_close_ts","ui_open_ts","mitm_tab_ts","mitm_req_ts","req_total_n","req_succ_n","req_err_n","mitm_req_total_n","mitm_req_succ_n","mitm_req_err_n")))}data.agents={};data.mitm_agents={};["total_n","succ_n","err_n"].forEach(n=>{delete data["req_"+n];delete data["mitm_req_"+n]});_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.set_json("monitor_active",data)}yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.sleep(_util_date_js__WEBPACK_IMPORTED_MODULE_21___default.a.ms.MIN);const tabs=Object.keys(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a.get_nav_tabs());if(!tabs.length)continue;let now=Date.now(),tu=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.tab_unblockers||{};let data=get_data();let expire_ts=now-period,ts={req_ts:0,mitm_req_ts:0};data.agents=data.agents||{};data.mitm_agents=data.mitm_agents||{};tabs.forEach(id=>{let u;if((u=tu[id])&&data.unblocker_tab_ts!=now)data.unblocker_tab_ts=now;update(u,data,ts,"",expire_ts);if(_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_31___default.a._is_mitm_active(id)&&data.mitm_tab_ts!=now)data.mitm_tab_ts=now;update(_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_31___default.a.tab_get_req_info(id),data,ts,"mitm_",expire_ts)});data.req_ts=ts.req_ts||undefined;data.mitm_req_ts=ts.mitm_req_ts||undefined;_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.set_json("monitor_active",data)}})))}function monitor_active_uninit(){if(monitor_active.sp)monitor_active.sp.return();monitor_active={}}function check_bump(bext_config){if(E.bump_active||!bext_config.bump)return;var bump;if(!(bump=_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.get_int("bump"))||config_stats.n==1)return void _util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.set("bump",bext_config.bump);if(bext_config.bump<=bump)return;E.bump_active=true;_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.set("bump",bext_config.bump);if(_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.get_int("bump")!=bext_config.bump)return;E.listen_to(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a,"change:activity",underscore__WEBPACK_IMPORTED_MODULE_0___default.a.debounce((function(){if(_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.get("bump_ts"))return;["agent_key","agent_key_ts","popup_rating_cache"].concat(bext_config.bump_clear||[]).forEach((function(k){_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.clr(k)}));_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.set("bump_ts",Date.now());_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_reload_ext_bump");if(!bext_config.bump_enabled)return _util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.notice("bump reload extension not allowed");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.reload_ext_native()}),bext_config.bump_idle||5*_util_date_js__WEBPACK_IMPORTED_MODULE_21___default.a.ms.MIN))}const set_gen_conf=(_conf,key)=>{const get_conf=(c,k,keys)=>{const res={};keys.forEach(n=>res[n]=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(c,k+"."+n,_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(c,n)));return res};const gen=get_conf(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(_conf,"gen",{}),key,["hide_ip_on","is_zgettunnels_post","name","dbg_log_rate","is_etask_perf_on"]);if(gen.hide_ip_on&&!["opera","chrome"].includes(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.browser()))gen.hide_ip_on=0;const features={};for(let e in gen){if(gen[e]&&e.endsWith("_on"))gen[e]=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_32__["default"].is_conf_allowed(gen[e]);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.set("gen."+e,gen[e]);if(gen[e])features["test_"+e]=e!="name"?1:gen[e]}_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.unset("features",features);if(Object.keys(features).length)_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.set("features",features)};E.set_bext_config=function(bext_config){if(!bext_config){if(!(bext_config=_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.get_json("bext_config_last")))return}else _util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.set_json("bext_config_last",bext_config);var hola_conf=_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.get_json("hola_conf")||{};if(hola_conf)bext_config=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.extend_deep(bext_config,hola_conf);update_tests(bext_config);var protect_ui=bext_config.protect_ui2;if(protect_ui&&(!protect_ui.min_version||_util_version_util_js__WEBPACK_IMPORTED_MODULE_13___default.a.cmp(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.version(),protect_ui.min_version)>=0)){var protect_pc_min_ver=protect_ui.protect_pc_min_ver;E.set("protect_pc",_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.os_win()&&(protect_ui.protect_pc||protect_pc_min_ver&&_util_version_util_js__WEBPACK_IMPORTED_MODULE_13___default.a.cmp(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.version(),protect_pc_min_ver)>=0));E.set("protect_browser",protect_ui.protect_browser);E.set("protect_tooltips",protect_ui.tooltips);update_protect_state()}_bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_28___default.a.convert_blob2check(bext_config,"force_premium");_bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_28___default.a.convert_blob2check(bext_config,"get_privacy");for(let site in bext_config.sites||{}){let verify=bext_config.sites[site].verify||{};for(let country in verify)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.convert_url2regex(verify,country);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.convert_url2regex(bext_config.sites[site],"redirect")}_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.set("bext_config",bext_config);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.set("debug.zerr",_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(hola_conf,"debug.zerr",{}));_bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_20__["default"].set_config(bext_config);set_gen_conf_cb()};var config_update_sleep;var config_update_no_cache=false;var config_stats={n:0,err:false,attempt:0};const set_gen_conf_cb=()=>set_gen_conf(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("bext_config"),_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium")?"prem":"free");function bext_config_init(){_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.on_init("change:is_premium",set_gen_conf_cb);var pause;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true,name:"bext_config_init"},[function try_catch$loop(){config_update_sleep=null;var url=conf__WEBPACK_IMPORTED_MODULE_34__.url_ccgi+"/bext_config.json?browser="+_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.browser()+"&ver="+_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.version();if(config_update_no_cache){url+="&ts="+Date.now();config_update_no_cache=false}return _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].ccgi_ajax({timeout:2e4,method:"GET",url:url})},function(e){config_stats.n++;config_stats.attempt++;pause=2*_util_date_js__WEBPACK_IMPORTED_MODULE_21___default.a.ms.HOUR;var err=this.error||e&&e.err,err_info;if(err||!e){if(config_stats.attempt==1)E.set_bext_config();err_info=(err?err.hola_info:undefined)||{};_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_bext_config_err",{n:config_stats.n,after_err:config_stats.err,status:err_info.status,exists:!!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("bext_config"),err_info:err_info,attempt:config_stats.attempt,stamp:CG("stamp")},{err:err});pause=5*_util_date_js__WEBPACK_IMPORTED_MODULE_21___default.a.ms.MIN}else if(e&&e.stamp&&CG("stamp",0)>e.stamp){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_bext_config_old",{n:config_stats.n,after_err:config_stats.err,attempt:config_stats.attempt})}else{E.set_bext_config(e);check_bump(e);config_stats.attempt=0}config_stats.err=!!err;if(!config_stats.attempt)_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_27___default.a.trigger("conf_change");this.set_state("loop");return config_update_sleep=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.sleep(pause)}])}const update_vpn_countries=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_update_vpn_countries(){let retries=0;const retry=e=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_retry(){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_vpn_countries_err",{retries:retries},{err:e});let res=yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_32__["default"].storage_local_get("vpn_countries");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.set("vpn_countries",(res||{}).vpn_countries||[]);if(retries)return;retries++;yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.sleep(_util_date_js__WEBPACK_IMPORTED_MODULE_21___default.a.ms.MIN);return yield load()}));const load=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_load(){let res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__["a"].ccgi_ajax({timeout:2e4,method:"GET",url:conf__WEBPACK_IMPORTED_MODULE_34__.url_ccgi+"/vpn_countries.json?browser="+_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.browser()+"&ver="+_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.version(),no_throw:1});if(!res||res.err||!Array.isArray(res))return yield retry((res||{}).err||"empty_list");if(res.includes("uk"))res.push("gb");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.set("vpn_countries",res);yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_32__["default"].storage_local_set({vpn_countries:res});return res}));return yield load()}));E.force_bext_config_update=function(no_cache){if(!config_update_sleep)return;config_update_no_cache=!!no_cache;config_update_sleep.return()};function status_cb(){var script=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].get("status");var info=E.be_info.get("status");var status=[script,info];if(status.includes("error"))E.set("status","error");else if(status.includes("busy"))E.set("status","busy");else{E.set("status","ready");tabs_update()}if(status.includes("busy")||!E.get("need_recover"))return;if(E.get("status")=="ready")return E.set("need_recover",false);_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.clear_timeout(status_cb.timer);status_cb.timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.set_timeout(()=>{_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.notice("be_vpn try recover");E.set("need_recover",false);if(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].get("status")=="error")_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].recover();if(E.be_info.get("status")=="error")E.be_info.recover()},0,{sp:E.sp})}function active_stop_measure(tab){if(!tab.active_ts)return;tab.active_time+=Date.now()-tab.active_ts;tab.active_ts=0;active_timer_clr(tab)}function active_reset(tab){active_stop_measure(tab);tab.active_time=0}function active_start_measure(tab){if(tab.active_ts)return;tab.active_ts=Date.now();active_timer_add(tab,active_tab_timer_ms)}function active_timer_clr(tab){if(!tab.active_timer)return;tab.active_timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.clear_timeout(tab.active_timer)}function active_timer_add(tab,ms){active_timer_clr(tab);tab.active_timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.set_timeout(()=>{tab.active_timer=null;total_active_report(tab)},ms,{sp:E.sp})}function total_active_report(tab){active_stop_measure(tab);if(tab.active_reported)return;tab.active_reported=true;var rule;var loc_country=(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("location"),"country")||"").toLowerCase();if(rule=tab.rule){var first_per_time=Date.now()-(E.unblocked_urls[tab.root_url]||0)>24*36e5;var stats=assign(underscore__WEBPACK_IMPORTED_MODULE_0___default.a.pick(rule,"name","type"),{proxy_country:(rule.country||"").toLowerCase()});_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_vpn_total_active_time",JSON.stringify(assign(stats,{root_url:tab.root_url,src_country:loc_country,total_active_time:tab.active_time/1e3,first_per_time:first_per_time})),{rate_limit:{count:20}});if(first_per_time)E.unblocked_urls[tab.root_url]=Date.now();return}if(!tab.root_url||tab.had_rule||Math.random()*50>=1)return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_total_active_time",JSON.stringify({root_url:tab.root_url,src_country:loc_country,total_active_time:tab.active_time/1e3}),{rate_limit:{count:20}})}function tab_vpn_add(tab,rule){tab.had_rule=true;tab.rule=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.clone(rule);active_reset(tab);if(E.active_tab_id==tab.id)active_start_measure(tab);set_privacy_conf(true)}function tab_add(tabid,url){var tab=E.tabs[tabid];var rule=E.rule_get(url);if(tab)return;_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.debug("tab:%d add url %s root %s",tabid,url.slice(0,200),_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(url));tab={url:url,root_url:_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(url),active:0,active_time:0,rule:rule,id:tabid};E.tabs[tabid]=tab;if(E.active_tab_id==tabid)active_start_measure(tab);if(rule)tab_vpn_add(tab,rule)}function tab_vpn_del(tab){if(!tab.rule)return;total_active_report(tab);tab.rule=null;set_privacy_conf()}function tab_del(tabid){var tab=E.tabs[tabid];if(!tab)return;total_active_report(tab);tab_vpn_del(tab);delete E.tabs[tabid]}function tab_update(tab){var rule=E.rule_get(tab.url);_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.debug("tab:%d update url %s is_vpn %O",tab.id,tab.root_url,!!rule);if(rule&&!tab.rule)tab_vpn_add(tab,rule);else if(!rule&&tab.rule)tab_vpn_del(tab)}function tabs_update(){for(var tab in E.tabs)tab_update(E.tabs[tab])}E.rule_get=function(url){var rule;if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.is_disabled())return null;if((rule=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].get_rules(url)[0])&&rule.enabled)return rule;return null};var MAX_HISTORY=5;function tab_history_update(id,url,del){var tab=E.history[id];if(!tab){if(del)return;tab=E.history[id]={history:[]}}else if(del)return void delete E.history[id];var host=_util_url_js__WEBPACK_IMPORTED_MODULE_15___default.a.get_host(url);if(!host)return;if(tab.history.length&&host==tab.history[0])return;tab.history.unshift(host);if(tab.history.length>MAX_HISTORY)tab.history.pop()}E.tab_history_get=function(id){if(!(id=id||_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a.get("active.id")))return;var t=E.history[id];if(!t)return;return t.history};function tab_vpn_on_created(o){var tab=o.tab;if(!tab.url)return;tab_history_update(tab.id,tab.url);tab_add(tab.id,tab.url)}function execute_with_params(tab_id,fn,params){const code="("+fn.toString()+")("+params+")";const tabapi=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_32__["default"].tabid2api(tab_id);_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.cb_apply(chrome.tabs,".executeScript",[tabapi,{code:code}])}function tz_spoof_inject(o){var tab=E.tabs[o.id];if(!tab||tab.tz_spoof_inited||!tab.rule||!chrome||!chrome.runtime||!chrome.runtime.getURL){return}var site,url=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(o,"info.url");if(!(site=E.get_site_conf(url))||!site.tz_spoof)return;var fn=function(offset){var script=document.createElement("script");script.src=chrome.runtime.getURL("js/bext/vpn/bg/tz_spoof.js?"+"offset="+offset);document.head.appendChild(script)};execute_with_params(o.id,fn,site.tz_spoof);tab.tz_spoof_inited=true}function update_site_storage(o){const tab=E.tabs[o.id];if(!tab||!tab.rule||tab.storage_updated||!chrome||!chrome.runtime)return;const url=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(o,"info.url"),site=E.get_site_conf(url);if(!site||!site.site_storage)return;const fn=ls=>Object.keys(ls).forEach(key=>{localStorage.setItem(key,ls[key]);sessionStorage.setItem(key,ls[key])});execute_with_params(o.id,fn,JSON.stringify(site.site_storage));tab.storage_updated=true}function tab_vpn_on_comitted(o){tz_spoof_inject(o);update_site_storage(o)}function set_privacy_conf(enabled){set_privacy_conf.n=(set_privacy_conf.n||0)+(enabled?1:-1);if(set_privacy_conf.n<0)set_privacy_conf.n=0;if(!chrome||!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("gen.hide_ip_on")||!_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.get(chrome,"privacy.network.webRTCIPHandlingPolicy")){return}var value=set_privacy_conf.n?"disable_non_proxied_udp":"default";if(set_privacy_conf.value!=value){set_privacy_conf.value=value;chrome.privacy.network.webRTCIPHandlingPolicy.set({value:value,scope:chrome.extension.inIncognitoContext?"incognito_session_only":"regular"},()=>{})}}function tab_vpn_on_updated(o){var id=o.id,info=o.info;var tab=E.tabs[id];if(tab)delete tab.tz_spoof_inited;if(!info||!info.url)return;tab_history_update(id,info.url);var root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(info.url);if(tab&&tab.root_url==root_url){tab.url=info.url;tz_spoof_inject(o);return}if(tab)tab_del(id);tab_add(id,info.url);tz_spoof_inject(o)}function tab_vpn_on_removed(tab){tab_history_update(tab.id,null,true);tab_del(tab.id)}function tab_vpn_on_replaced(o){var added=o.added,removed=o.removed;tab_history_update(removed,null,true);tab_vpn_del(removed);chrome.tabs.get(added,(function(tab){if(!tab||!tab.url)return;tab_history_update(added,tab.url);var root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(tab.url);if(!root_url)return;tab_add(added,tab.url)}))}function tab_vpn_on_change_active(){var id=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a.get("active.id");update_mitm_state();if(!id)return;var tab=E.active_tab_id?E.tabs[E.active_tab_id]:null;if(tab)active_stop_measure(tab);E.active_tab_id=id;if(tab=E.tabs[id])active_start_measure(tab)}function tab_vpn_on_error_occured(o){var info=o.info||{};if(info.http_status_code!=0)return;var last=tab_vpn_on_error_occured.info||{};if(last.error==info.error&&last.url==info.url&&last.tabId==info.tabId)return;tab_vpn_on_error_occured.info=info;var domain=_util_url_js__WEBPACK_IMPORTED_MODULE_15___default.a.get_host(""+info.url);if(!_util_url_js__WEBPACK_IMPORTED_MODULE_15___default.a.is_valid_domain(domain))return;var rule,perr_info={domain:domain,err:info.error||""};if(!(rule=E.rule_get(info.url))||info.error=="net::ERR_ABORTED")return;_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.debug("tab:%d tab_vpn_on_error_occured rule %s error %s url %s",info.tabId,rule.name||"undefined",info.error,info.url);perr_info.proxy_country=rule.country;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_webrequest_error",perr_info,{err:true,rate_limit:{count:5}})}E.set_enabled=function(on){try{on=!!on;get_bg_main().set_enabled(on);if(!!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("ext.active")!=on&&!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("ext.conflict")){var attributes=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.attributes;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_set_enabled_mismatch",{on:on,attributes:attributes},{err:true,rate_limit:{count:1}})}}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_set_enabled_err",{},{err:e});throw e}};E.script_set=(rule,val)=>{_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.debug("set rule %s %d %s",rule.name,+val.enabled,val.root_url);return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"script_set",cancel:true},(function*script_set_(){yield E.set_enabled(true);if(val.enabled&&_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_30__["default"].need_trial(val.root_url)){_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_32__["default"].set_site_storage(val.root_url,"force_trial",{country:val.src=="ui"?null:val.country||rule.country});return this.return()}if(rule&&+val.enabled&&rule.enabled&&val.src=="trial"&&rule.src==val.src&&(!val.country||rule.country==val.country)){return this.return()}const new_rule={name:val.host||val.name||rule.name,enabled:+val.enabled,root_url:val.host||val.root_url,country:(val.country||rule.country||"").toLowerCase(),type:rule.type,mode:val.mode,tab_id:val.tab_id,stub:val.stub};if(val.src)new_rule.src=val.src;_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].trigger("set_rule",new_rule);if(E.get("status")=="ready")return;E.once("change:status",()=>this.continue());return yield this.wait(15*_util_date_js__WEBPACK_IMPORTED_MODULE_21___default.a.ms.SEC)}))};E.enable_root_url=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*enable_root_url(){let rule_ratings,rule,root_url=opt.root_url,enabled=true;if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium")&&_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_26__["default"].get_force_premium_rule(root_url)){return void _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].set_force_tpopup(root_url)}if(opt.rule&&opt.rule.name){rule=opt.rule;if(rule.enabled!==undefined)enabled=rule.enabled}else{if(opt.rule){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_enable_root_url_invalid_rule",assign(opt,{hola_uid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("hola_uid")}))}const _rule_ratings=yield _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].get_rule_ratings({root_url:root_url,src_country:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("country"),limit:20,proxy_country:opt.country,vpn_only:true});let groups;if(_rule_ratings){rule_ratings=_rule_ratings.filter(r=>{const country=r.proxy_country.toUpperCase();return _protocol_pub_countries_js__WEBPACK_IMPORTED_MODULE_29___default.a.proxy_countries.bext.includes(country)});groups=yield _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].get_groups_from_ratings(rule_ratings)}let url="http://"+root_url+"/",host=_util_url_js__WEBPACK_IMPORTED_MODULE_15___default.a.get_host(url);let popular=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.get_popular_country({host:host,rule_ratings:rule_ratings});let proxy_country=(opt.country||popular[0].proxy_country||"").toLowerCase();let all_rules=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_32__["default"].get_all_rules({proxy_country:proxy_country,rules:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].get("rules"),url:url,root_url:root_url,rule_ratings:rule_ratings,groups:groups});rule=all_rules[0]}if(E.is_enabled_for_pc())yield E.set_enabled_for_pc(enabled,{country:rule.country});else if(E.is_enabled_for_browser())yield E.set_enabled_for_browser(enabled,{country:rule.country});else yield E.script_set(rule,{enabled:enabled,root_url:root_url,src:opt.src});_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_enable_root_url",{name:rule.name,root_url:root_url,country:rule.country,hola_uid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("hola_uid"),src_country:(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("country")||"").toLowerCase()});return rule}));E.tpopup_is_connected=(id,tpopup_type)=>E.be_tpopup&&E.be_tpopup.is_connected(id,tpopup_type);E.check_permission=name=>{if(!chrome||!chrome.permissions)return;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"check_permission",cancel:true},(function*check_permission(){try{chrome.permissions.contains({permissions:[name],origins:["<all_urls>"]},res=>this.continue(res));return yield this.wait()}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("check_permission_failed",{},{err:e})}}))};E.grant_permission=function(name){if(!chrome||!chrome.permissions)return;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"grant_permission",cancel:true},(function*grant_permission(){try{chrome.permissions.request({permissions:[name],origins:["<all_urls>"]},res=>this.continue(res));return yield this.wait()}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("grant_permission_failed",{},{err:e})}}))};function on_mitm_inited(){var mitm=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.mitm;E.set("mitm_ext_ui_enabled",mitm&&mitm.is_ext_ui_enabled())}function update_mitm_state(){E.set("mitm_site",E.is_mitm_site());E.set("mitm_active_manual",E.is_mitm_active_manual(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a.get("active.id")))}E.is_mitm_site=function(url){url=url||_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a.get("active.url");var mitm=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.mitm;return url&&mitm&&mitm.should_unblock(url)};E.is_mitm_active_manual=function(tab_id){var mitm=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.mitm;var type=mitm&&mitm._is_mitm_active(tab_id);return type=="manual"||type=="user_choice"};E.mitm_set_unblock=function(url,until){if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium")&&_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_26__["default"].get_force_premium_rule(url))return;_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.notice("mitm set unblock "+url);_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.mitm.user_set_unblock(url,until);update_mitm_state()};E.mitm_set_ignore=function(url,tab_id,until){_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.notice("mitm set ignore "+url);_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.mitm.set_ignore(url,until);if(tab_id)chrome.tabs.reload(tab_id);update_mitm_state()};E.stop_vpn=function(url,tab_id){_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.notice("stop vpn "+url);if(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.is_mitm_active(tab_id))return void E.mitm_set_ignore(url,tab_id);var rule=E.rule_get(url);if(!rule)return;_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].trigger("set_rule",{name:rule.name,root_url:_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(url),enabled:0,country:rule.country,type:rule.type,tab_id:tab_id})};E.mitm_manual_unblock=function(url,tab_id,until,no_reload){if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium")&&_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_26__["default"].get_force_premium_rule(url))return;_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.notice("mitm set rule "+url);var need_reload=!no_reload&&!_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.is_mitm_active(tab_id);_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.mitm.set_manual_tab(tab_id,url,until);if(need_reload)_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a.reload(tab_id);update_mitm_state();E.trigger("mitm_manual_unblock")};E.mitm_manual_stop=(urls,tab_id,no_reload)=>{_util_array_js__WEBPACK_IMPORTED_MODULE_5___default.a.to_array(urls).forEach(url=>{_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.notice("mitm manual stop "+url);_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_16___default.a.mitm.set_ignore(url,null,"manual")});if(!no_reload)chrome.tabs.reload(tab_id);update_mitm_state()};E.get_mitm_unblock_rules=()=>{const mitm=E.be_tab_unblocker.mitm;return mitm?mitm.get_unblock_rules():[]};E.mitm_need_popup=url=>_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_14__["a"].need_mitm_popup(url);E.get_site_conf=url=>{const root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(url);return _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_site_conf(root_url)};E.do_tpopup=tab_id=>{_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_14__["a"].do_tpopup(E.tabs[tab_id])};E.get_url_protected=root_url=>(E.get("protected_ui_state")||{})[root_url];E.set_url_protected=(root_url,active)=>{const state=E.get("protected_ui_state")||{};state[root_url]=active;E.set("protected_ui_state",state);_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.set_json("protected_ui_state",state);if(!active)E.set_default_protect(root_url,false)};E.get_default_protect=root_url=>{const state=E.get("protected_ui_state")||{};return(state.default||{})[root_url]};E.set_default_protect=(root_url,val)=>{const state=E.get("protected_ui_state")||{};state.default=state.default||{};state.default[root_url]=val;E.set("protected_ui_state",state);_util_storage_js__WEBPACK_IMPORTED_MODULE_18___default.a.set_json("protected_ui_state",state);update_protect_state()};function update_protect_state(){if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium"))return E.set("default_protect_ui",false);var state=E.get("protected_ui_state")||{};var defs=state.default||{};var res=false;if(E.is_enabled_for_pc())res=defs.protect_pc;else if(E.is_enabled_for_browser())res=defs.protect_browser;else{var root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a.get("active.url"));res=defs[root_url]}E.set("default_protect_ui",res)}E.is_enabled_for_pc=()=>!!(E.get("protect_pc")&&E.be_svc.get("vpn_country"));E.set_enabled_for_pc=(enable,opt)=>{E.set_default_protect("protect_pc",enable&&opt&&opt.default_protect);if(!E.get("protect_pc"))return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_ui_vpn_protect_pc",{enable:enable});return enable?E.be_svc.vpn_connect(opt):E.be_svc.vpn_disconnect(opt)};function get_all_browser_rule(){const rules=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.get_rules(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].get("rules"));if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.is_disabled())return false;return _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.is_all_browser(rules[0])&&rules[0]}E.is_enabled_for_browser=()=>{if(!E.get("protect_browser"))return false;if(E.is_enabled_for_pc())return true;return!!get_all_browser_rule()};E.set_enabled_for_browser=function(enable,opt){E.set_default_protect("protect_browser",enable&&opt&&opt.default_protect);if(!E.get("protect_browser"))return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.perr("be_ui_vpn_protect_browser",{enable:enable});let rule;if(!enable){if(E.is_enabled_for_pc())E.set_enabled_for_pc(false);if(rule=get_all_browser_rule())return E.script_set(rule,{enabled:false});return}return E.script_set({country:opt.country,type:"url"},{enabled:true,host:"all_browser",mode:"protect"})};E.get_enabled_rule=opt=>{if(!E.get("inited"))return;let{url:url,tab_id:tab_id}=opt;let default_protect=E.get_default_protect(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(url));let is_premium=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium");if(is_premium&&E.is_enabled_for_pc()){return{country:E.be_svc.get("vpn_country"),protect:"pc",default_protect:default_protect}}if(is_premium&&E.is_enabled_for_browser()){return assign({protect:"browser",default_protect:default_protect},get_all_browser_rule())}if(E.is_mitm_active_manual(tab_id))return{country:"us",mitm:true,tab_id:tab_id};let stub_rule=(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].get("tabs_stub_rules")||{})[tab_id];if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.is_stub_rule_enabled(stub_rule,url,is_premium))return assign({default_protect:default_protect},stub_rule);let rules=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.get_rules(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].get("rules"),url);let rule=rules&&rules[0]||{};if(!rule.enabled||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.is_disabled())return null;return assign({default_protect:default_protect,protect:is_premium&&rule.mode=="protect"?"site":undefined},rule)};E.unblock_disable=({url:url,tab_id:tab_id})=>{let rule=E.get_enabled_rule({url:url,tab_id:tab_id});let root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(url);if(_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_30__["default"].get_trial_active(root_url))_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_32__["default"].set_site_storage(root_url,"trial.dont_show_ended",true);if(!rule)return;if(E.get_url_protected(root_url))E.set_url_protected(root_url,false);if(rule.mitm)return void E.mitm_manual_stop([url],tab_id);if(rule.protect=="browser"||rule.protect=="pc")E.set_enabled_for_browser(false);_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].trigger("set_rule",{name:root_url,root_url:root_url,enabled:0,country:rule.country,type:rule.type,tab_id:tab_id,stub:rule.stub})};E.unblock_enable=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*unblock_enable(){let{url:url,tab_id:tab_id,mitm:mitm,protect:protect,default_protect:default_protect,country:country}=opt;let root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(url);let rule=E.get_enabled_rule({url:url,tab_id:tab_id})||{};let is_premium=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium");const set_site_rule=changes=>E.script_set(rule,assign({name:root_url,root_url:root_url,enabled:1,country:country||rule.country,mode:rule.mode,tab_id:tab_id,stub:_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.is_skip_url(url)||!is_premium&&_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.is_google(root_url)},changes));if(!is_premium&&(protect||_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_26__["default"].get_force_premium_rule(root_url))){return _util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()("user not premium")}if(mitm)return E.mitm_manual_unblock(url,tab_id);if(rule.mitm)E.mitm_manual_stop([url],tab_id,true);if(default_protect){E.set_default_protect(root_url,true);if(!rule.protect)protect=protect||"site"}else if(protect===undefined&&E.get_default_protect(root_url))E.set_default_protect(root_url,false);if(country&&protect&&!(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("vpn_countries")||[]).includes(country.toLowerCase())){country="us"}if(protect=="browser"||protect===undefined&&rule.protect=="browser"){if(rule.protect=="pc")E.set_enabled_for_pc(false);if(rule.protect=="site")E.set_url_protected(root_url,false);return yield E.set_enabled_for_browser(true,{default_protect:default_protect||E.get_default_protect(root_url),country:country||rule.country})}if(protect=="pc"||protect===undefined&&rule.protect=="pc"){return yield E.set_enabled_for_pc(true,{default_protect:default_protect||E.get_default_protect(root_url),country:country||rule.country})}if(protect=="site"||protect===undefined&&rule.protect=="site"){if(rule.protect=="pc"||rule.protect=="browser")E.set_enabled_for_browser(false);if(!_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.is_skip_url(url)){E.set_url_protected(root_url,true);yield set_site_rule({mode:"protect",country:country})}return}if(protect===false){if(rule.protect=="pc"||rule.protect=="browser")E.set_enabled_for_browser(false);E.set_url_protected(root_url,false);if(!_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.is_skip_url(url))yield set_site_rule({mode:"unblock",country:country});return}yield set_site_rule({country:country})}));E.unblock_action=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*unblock_action(){let{url:url,tab_id:tab_id}=opt;let redirects,root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(url);let rules_set=new _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_32__["default"].Rules_set(null,opt.disable);if(opt.disable){redirects=new _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_32__["default"].Rules_set(root_url).to_array().map(r=>_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_19___default.a.root2url(r));for(let u of[url,...redirects]){rules_set.add(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(u));E.unblock_disable({url:u,tab_id:tab_id})}if(redirects&&redirects.length)rules_set.save();return}redirects=opt.redirects&&opt.redirects.filter(u=>u!=url)||[];for(let u of[url,...redirects]){rules_set.add(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(u));yield E.unblock_enable(assign({},opt,{url:u}))}if(redirects&&redirects.length)rules_set.save()}));E.get_events=()=>_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.events;E.events_to_str=()=>_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.events_to_str();E.get_event_n=e=>_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_event_n(e);E.reset_events=()=>_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.reset_events();E.push_event=(name,opt)=>_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.push_event(name,opt);function trial_end_cb(root_url){const tabs=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a.get_nav_tabs();Object.keys(tabs).forEach(tab_id=>{const url=tabs[tab_id];if(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_root_url(url)==root_url&&!E.tpopup_is_connected(tab_id)){E.do_tpopup(+tab_id)}})}if(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.is_mocha()){E.t={update_vpn_countries:update_vpn_countries,init_unblocker_lib:init_unblocker_lib,uninit_unblocker_lib:uninit_unblocker_lib,update_site_storage:update_site_storage,execute_with_params:execute_with_params,clean_cookies:clean_cookies}}__webpack_exports__["a"]=E},,,,,function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){var is_node=typeof module=="object"&&module.exports;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(16),__webpack_require__(53)],__WEBPACK_AMD_DEFINE_RESULT__=function(zdate,zcountry){var E={};E.grace=1;function get_end_by_period(membership,opt){opt=opt||{};var end=new Date(membership.start);if(membership.period=="1 M")end.setUTCMonth(end.getUTCMonth()+1);else if(membership.period=="6 M")end.setUTCMonth(end.getUTCMonth()+6);else if(membership.period=="1 Y")end.setUTCFullYear(end.getUTCFullYear()+1);else if(membership.period=="2 Y")end.setUTCFullYear(end.getUTCFullYear()+2);else if(membership.period=="3 Y")end.setUTCFullYear(end.getUTCFullYear()+3);else if(membership.period=="1 D")end.setUTCDate(end.getUTCDate()+1);else if(membership.period=="100 Y")end.setUTCFullYear(end.getUTCFullYear()+100);else{throw"Unexpected period: "+membership.period+" ("+JSON.stringify(membership)+")"}if(!opt.disable_grace)end.setUTCDate(end.getUTCDate()+E.grace);return end}E.get_end_by_period=get_end_by_period;E.get_end_date=function(membership){var end=membership&&(membership.end||membership.trial_end||membership.grace_end||membership.start&&membership.period&&get_end_by_period(membership));return end?new Date(end):null};E.is_active=function(membership){if(!membership)return false;if(membership.trial_end&&Date.now()<=new Date(membership.trial_end))return true;if(membership.grace_end&&Date.now()<=new Date(membership.grace_end))return true;if(membership.end&&Date.now()<=new Date(membership.end))return true;if(membership.start&&membership.period&&Date.now()<=get_end_by_period(membership)&&!E.is_trial(membership)){return!membership.cancelled||!membership.end}return false};E.is_lifetime=function(membership){return membership&&membership.period=="100 Y"};E.is_in_trial=function(membership){return E.is_trial(membership)&&Date.now()<new Date(membership.trial_end||membership.end)};E.is_trial=function(membership,type){return!!membership&&(!!membership.trial_end&&(!type||type==(membership.type||"start"))||!!(membership.plan=="trial")&&!!membership.end)};E.is_in_grace=function(membership){return E.is_grace(membership)&&Date.now()<new Date(membership.grace_end)};E.is_grace=function(membership,type){return!!membership&&!!membership.grace_end&&(!type||type==(membership.type||"start"))};E.had_premium=function(history){return!!history&&history.some((function(h){return!E.is_trial(h)}))};E.had_trial=function(history,type){return!!history&&history.some((function(h){return E.is_trial(h,type)}))};E.had_grace=function(history,type){return!!history&&history.some((function(h){return E.is_grace(h,type)}))};E.trial_forbidden=function(membership,history,type){if(E.is_in_trial(membership))return"trial exists";if(E.is_trial(membership,type))return"trial expired";if(E.is_active(membership))return"already premium";if(E.had_premium(history))return"had premium";if(E.had_trial(history,type))return"had trial";return false};E.grace_period_forbidden=function(membership,history,type){if(E.is_in_grace(membership))return"grace exists";if(E.is_grace(membership,type))return"grace expired";if(E.is_active(membership))return"already premium";if(E.had_grace(history,type))return"had grace";return false};E.is_paid=function(membership){return!!membership&&!!membership.gateway};E.is_expired=function(membership){var end_date=E.get_end_date(membership);return!!end_date&&Date.now()>end_date};E.classify=function(membership){if(E.is_active(membership))return E.is_in_trial(membership)?"trial":"premium";if(E.is_expired(membership))return E.is_trial(membership)?"trial_expired":"premium_expired";return"free"};E.gen_email_hash=function(email,md5){return md5("hola unsubscribe "+email).substr(0,8)};function date2display(d){return d?zdate.strftime("%o %B %Y",zdate(d)):"-"}E.is_ios=function(membership){return membership.gateway=="apple"||membership.product=="ios"};E.is_mobile=function(membership){var gtw=["paypal","paymill","avangate","bluesnap","paypal2","coupon"];return E.is_ios(membership)||membership.gateway&&!gtw.includes(membership.gateway)};E.period_str=function(membership){var show_price=function(name,price,periods,period_name){var currency="USD";if(membership.amount){price=membership.amount;currency=membership.currency}var p=+(price/periods).toFixed(2);return name+", "+zcountry.currency2prefix(currency)+p+"/"+period_name};switch(membership.period){case"1 M":return show_price("Monthly",11.95,1,"month");case"6 M":return show_price("Half-yearly",54,6,"month");case"1 Y":return show_price("Yearly",83.88,1,"year");case"2 Y":return show_price("2-year",95.75,2,"year");case"3 Y":return show_price("3-year",107.55,3,"year");case"1 D":return show_price("1-day",1,1,"day");case"100 Y":return"Lifetime"}if(!membership.end)return membership.grace_end?"updating":"-";return(membership.gateway?"Till ":"Manual till ")+date2display(membership.end)};E.period_start_str=function(membership){return date2display(membership.start)};E.period_end_str=function(membership){if(E.is_in_trial(membership))return"Trial valid until "+date2display(membership.trial_end);var period=membership.cancelled?null:membership.period=="1 D"?{day:1}:membership.period=="1 M"?{month:1}:membership.period=="6 M"?{month:6}:membership.period=="1 Y"?{year:1}:membership.period=="2 Y"?{year:2}:membership.period=="3 Y"?{year:3}:null;if(!period)return membership.grace_end?"updating":"-";return date2display(zdate.add(zdate(membership.start),period))};E.is_unassoc_trial=function(membership){return E.is_trial(membership)&&E.is_ios(membership)};E.payment_label=function(membership){if(E.is_unassoc_trial(membership))return"-";switch(membership.gateway){case"paypal":case"paypal2":return"PayPal";case"coupon":return"Coupon";case"paymill":return"Credit card ************"+(((membership.paymill|{}).payment||{}).last4||"****");case"avangate":case"bluesnap":return"Credit card";case"apple":return"App Store";default:return membership.grace_end?"updating":"Google Play"}};E.get_id=function(m){switch(m.gateway){case"paypal":return m.paypal.subscr_id;case"paypal2":return m.paypal2.subscr_id;case"coupon":return m.coupon.code;case"bluesnap":return m.bluesnap.subscr_id;case"apple":return m.apple_ios.original_transaction_id;case"android":return m.google_apk.purchase_token;case"avangate":return m.avangate.subscr_ref;case"paymill":return m.paymill.subscription_id;default:return"UNKNOWN"}};E.is_cancellable_mobile=function(membership){return E.is_mobile(membership)&&!E.is_unassoc_trial(membership)&&(membership.cancelled||membership.cancellation_reason)};E.is_cancellable=function(membership){return!membership.cancelled&&!E.is_cancellable_mobile(membership)&&!E.is_unassoc_trial(membership)&&!membership.grace_end};E.get_plan_currency=function(plan,currency){if(!currency||!plan)return"USD";currency=currency.toUpperCase();if(currency=="USD")return"USD";if(!plan.currency||!plan.currency[currency.toLowerCase()])return"USD";return currency};E.get_price_plan=function(plan,currency){currency=(""+currency).toLowerCase();return currency=="usd"||!plan.currency||!plan.currency[currency]?plan:plan.currency[currency]};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON ISC
"use strict";(function(){var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(26)],__WEBPACK_AMD_DEFINE_RESULT__=function(array){var E={};var is_jtest=false;var jtest_vals={};var MAX_INT=2147483647;var MIN_INT=-MAX_INT-1;function jtest_pop(s){var elm;if(s===undefined)return null;if((elm=jtest_vals[s])===undefined)return null;return elm.shift()}E.rand=function(s){var ret;if(is_jtest&&(ret=jtest_pop(s))!==null)return ret;return Math.random()};E.rand_int32=function(s){var ret;if(is_jtest&&(ret=jtest_pop(s))!==null)return ret;return Math.floor(Math.random()*(MAX_INT-MIN_INT+1))-MAX_INT};E.rand_range=function(from,to,s){var ret;if(is_jtest&&(ret=jtest_pop(s))!==null)return ret;return Math.floor(Math.random()*(to-from))+from};E.rand_element=function(a,s){if(a.length)return a[E.rand_range(0,a.length,s)]};E.rand_subset=function(a,size,s){var shuffled=a.slice(0);for(var i=0;i<size;i++){var j=E.rand_range(i,shuffled.length,s);var tmp=shuffled[j];shuffled[j]=shuffled[i];shuffled[i]=tmp}return shuffled.slice(0,size)};E.jtest_push=function(s,arr){if(!jtest_vals[s])jtest_vals[s]=[];if(Array.isArray(arr))array.push(jtest_vals[s],arr);else jtest_vals[s].push(arr)};E.jtest_init=function(){is_jtest=true;jtest_vals={}};E.jtest_uninit=function(){is_jtest=false};E.basic_u32=function(v){return 1103515245*v+12345>>>0};E.basic_u31=function(v){return 1103515245*v+12345&2147483647};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function module_fn(){var E={module_fn:module_fn},g_pac_engine={},g_log=[],local_redir;var regex_url2host=/^(?:https?|wss?):\/\/([^\/]+)/;var regex_local_cmd_host=/^__hola__\.set\.(.*)\.local\.hola$/;function reset(){local_redir={rules:{},counter:0}}function log(s){var text=(new Date).toISOString()+" "+s;if(typeof alert!="undefined")alert(text);g_log.push(text);if(g_log.length>256)g_log.splice(0,g_log.length/2)}function pac_dump(){var str="";str+="init_ts: "+g_pac_engine.init_ts+"\n";str+="g_pac_engine:\n";try{str+=JSON.stringify(g_pac_engine)}catch(e){str+=e}str+="\nlocal_redir:\n";str+="  counter: "+local_redir.counter+"\n";str+="  rules:\n";for(var host in local_redir.rules){var rule=local_redir.rules[host];var ttl=rule.deadline_ts-Date.now();if(ttl>0)str+="    "+host+": "+rule.proxy+" (ttl "+(ttl/1e3|0)+"s)\n"}return str}function hex_decode(h){var s="";for(var i=0;i<h.length;i+=2)s+=String.fromCharCode(parseInt(h.substr(i,2),16));return s}function add_local_rule(host,proxy,deadline_ts){var cur_ts=Date.now(),entry=local_redir.rules[host];if(!entry||entry.proxy!=proxy)entry=local_redir.rules[host]={proxy:proxy};entry.deadline_ts=deadline_ts||cur_ts+6e4;local_redir.counter++;if(local_redir.counter>1e3){for(var i in local_redir.rules){var local=local_redir.rules[i];if(local.deadline_ts<cur_ts)delete local_redir.rules[i]}local_redir.counter=0}}function url2host(url){var n=url.match(regex_url2host);return n?n[1]:url}function get_local_rule(url){var host=url2host(url),rule=local_redir.rules[host];if(!rule)return;if(rule.deadline_ts<Date.now())return void delete local_redir.rules[host];return rule.proxy}function local_hola_handler(hex_payload){var msg;try{msg=JSON.parse(hex_decode(hex_payload))}catch(e){}if(!msg||msg.key!=g_pac_engine.key)return"DIRECT";if(msg.unset)delete local_redir.rules[msg.unset];else add_local_rule(msg.set,msg.proxy,msg.d_ts);if(msg.init_ts&&g_pac_engine.init_ts!=msg.init_ts)throw new Error("pac_auto_reload init_ts "+g_pac_engine.init_ts);return"PROXY 127.0.0.1:0"}E.init=function(options){options=options||{};g_pac_engine={init_ts:Date.now(),key:options.key};reset();if(options.set_ts&&options.set_ts+3e3<g_pac_engine.init_ts)throw new Error("pac_auto_reload init ts mismatch")};function handle_debug(host){switch(host){case"__hola__.pac_get_init_ts.local.hola":throw new Error("init_ts "+g_pac_engine.init_ts);case"__hola__.pac_dump.local.hola":throw new Error("pac_dump "+pac_dump());case"__hola__.pac_get_log.local.hola":g_log=[];throw new Error("pac_get_log ["+g_log.join("\n")+"]")}}E.FindProxyForURL=function(url,host){if(host[0]=="_"){var m=host.match(regex_local_cmd_host);if(m)return local_hola_handler(m[1]);else handle_debug(host)}return get_local_rule(url)||"DIRECT"};E.t={local_redir:function(){return local_redir},reset:reset};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){var is_node=typeof module=="object"&&module.exports;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(66),__webpack_require__(15),__webpack_require__(11),__webpack_require__(10),__webpack_require__(47),__webpack_require__(21)],__WEBPACK_AMD_DEFINE_RESULT__=function($,_,etask,zutil,user_agent,storage){var assign=Object.assign;var port_no_load_from_storage=1;function port_get(){var is_dev;try{is_dev=storage.get_json("hola_opts").developer_mode}catch(err){}if(port_no_load_from_storage||is_dev)return;try{return storage.get_int("svc_ipc_port")}catch(err){}}function port_set(port,up,info){if(up)return void(E.port_up=port||undefined);if(!port){try{storage.clr("svc_ipc_port")}catch(err){}delete E.svc_port;return}try{storage.set("svc_ipc_port",port)}catch(err){}E.svc_port=port;E.svc_has_ssl=port&&info&&info.ssl}var ua=user_agent.guess_browser();var is_ie=ua.browser=="ie";var is_firefox=ua.browser=="firefox";var E={svc_ports:[6880,6881,6882,6883,6884,6885,6886,6887,6888,6889],up_ports:[6890,6891,6892,6893,6894,6895,6896,6897,6898,6899]};E.svc_port=port_get();E.svc_has_ssl=false;E.up_port=undefined;E.load_port_from_storage=function(){port_no_load_from_storage=0;E.svc_port=port_get()};function Eport(up){return up?E.up_port:E.svc_port}function Eports(up){return up?E.up_ports:E.svc_ports}function get_url(cmd,opt){opt=opt||{};var https=location.protocol=="https:"&&opt.https;return(https?"https://localhost.h-local.org":"http://127.0.0.1")+":"+(opt.port||Eport(opt.up))+"/"+cmd}function exe2order(e){if(e.os_ver=="NaCl")return 1;if(/^hola_updater/.test(e.exe))return 1;if(/^hola_svc/.test(e.exe))return 2;if(/^hola_plugin/.test(e.exe))return 3;return 0}function cache_str_fn2(fn){var cache={};return function(s1,s2){var cache2=cache[s1]=cache[s1]||{};if(s2 in cache2)return cache2[s2];return cache2[s2]=fn(s1,s2)}}var version_cmp=cache_str_fn2((function(v1,v2){if(!v1||!v2)return+!!v1-+!!v2;var _v1=v1.split("."),_v2=v2.split("."),i;for(i=0;i<_v1.length&&i<_v2.length&&+_v1[i]==+_v2[i];i++);if(_v1.length==i||_v2.length==i)return _v1.length-_v2.length;return+_v1[i]-+_v2[i]}));var sp_find_port;E.find_port=function(up){var opt={dataType:"json",cache:false,no_throw:1,timeout:is_ie||is_firefox?2e3:500};var q=[];return etask({cancel:true},[function(){if(sp_find_port)return this.loop(sp_find_port);sp_find_port=this},function try_catch$(){if(Eport(up))return this.return(Eport(up))},function try_catch$(){var _this=this;_.each(Eports(up),(function(port){var sp;_this.spawn(sp=post(get_url("callback.json?find_port=1",{port:port,up:up}),opt));sp.data=sp.data?sp.data:{};sp.data.port=port;q.push(sp)}));return etask.all(q)},function(arr){var best,port;_.each(arr,(function(e,i){if(!e.ret||e.ret.error)return;if(!best){best=e;port=q[i].data.port;return}var e_order=exe2order(e.ret);var best_order=exe2order(best.ret);if(e_order<best_order||e_order==best_order&&version_cmp(e.ret.ver,best.ret.ver)<=0){return}best=e;port=q[i].data.port}));port_set(port,up,best&&best.ret);if(!best)return this.return(undefined);return this.return(port)},function finally$(){if(this==sp_find_port)sp_find_port=null}])};E.init=function(port){return etask([function(){if(port){port_set(port);return port}return E.find_port()},function(port){if(!port)return-1;return 0}])};function post(url,opt){opt=opt||{};if(typeof url==="object")opt=url;else if(typeof url==="string"){opt=zutil.clone(opt);opt.url=url}var xhr;return etask([function(){return xhr=$.ajax(assign({},opt,{method:"POST"}))},function catch$(err){var error=(xhr||{}).statusText||"no_status";if(opt.no_throw)return this.return({xhr:xhr,ret:{error:error}});throw new Error(error)},function(ret){if(this.error)return this.throw(this.error);return{xhr:xhr,ret:ret}}])}E.ajax=function(_opt){var cmd,timeout=500,up;var opt={dataType:"json",cache:false,no_throw:1};if(typeof _opt=="string")cmd=_opt;else if(typeof _opt=="object"){cmd=_opt.cmd;opt.data=_opt.data;timeout=_opt.timeout||timeout;up=_opt.up}var tested,q=[];if(timeout>-1)opt.timeout=timeout;return etask([function try_catch$ajax(){if(Eport(up))return post(get_url(cmd,{up:up}),opt);return this.goto("find_port")},function(res){var error=res.ret&&res.ret.error;if(error&&tested)throw new Error(error);if(error){port_set(0);return this.goto("find_port")}return this.return(res)},function try_catch$find_port(){return E.find_port(up)},function(port){if(!port)throw new Error("none_found");tested=1;return this.goto("ajax")}])};E.ext={};function test_img(links){return etask([function(){var _this=this,errs=0;_.each(links,(function(e,i){$("<img>").load(function(){this.return()}.bind(_this)).error(function(){errs++;if(errs==links.length)this.throw("ext not found")}.bind(_this)).attr("src",e+"?rc="+Date.now())}));return this.wait(1e3)}])}E.ext.lean_ping=function(){if(!window.chrome){return test_img(["resource://ff_ext-at-hola-dot-org/"+"hola_firefox_ext/data/img/logo.png","resource://jid1-4p0kohsjxu1qgg-at-jetpack/"+"hola_firefox_ext/data/img/logo.png","resource://jid1-4p0kohsjxu1qgg-at-jetpack/icon.png"])}var old="chrome-extension://gkojfkhlekighikafcpjkiklfbnlmeio/icon.png";var _new="chrome-extension://mhcmfkkjmkcfgelgdpndepmimbmkbpfp/icon.png";return etask({name:"lean_check_ext"},[function(){return etask.all({allow_fail:true},{old:test_img([old]),_new:test_img([_new])})},function(e){if(etask.is_err(e.old)&&etask.is_err(e._new))throw e._new.error}])};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},function(module,__webpack_exports__,__webpack_require__){"use strict";var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(29);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_4__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5__);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(28);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_6__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(22);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7__);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(41);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(33);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(40);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_11__);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(37);var _util_util_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_13__);var _util_escape_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(23);var _util_escape_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_util_escape_js__WEBPACK_IMPORTED_MODULE_14__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_15__);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(27);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_util_version_util_js__WEBPACK_IMPORTED_MODULE_16__);var _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(36);var _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(42);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(30);var _bext_vpn_bg_tpopup_script_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(96);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_15___default.a.assert_bg("be_tpopup");const{chrome:chrome}=window,{assign:assign}=Object;const CG=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.CG;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default.a.model.extend({model_name:"tpopup",_defaults:function(){this.on("destroy",()=>this.uninit())}}));const popup_showing=()=>{let views=chrome.extension.getViews({type:"popup"});return views&&views.length>0};const min_suggest_rate=.3;let forced_urls={},connected_tpopups={},loading_tpopups={};let tpopup_windows={};E.is_connected=(tab_id,tpopup_type)=>{if(!_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_6___default.a.tabs.is_connected(tab_id))return false;return tpopup_type?connected_tpopups[tab_id]==tpopup_type:connected_tpopups[tab_id]};const is_never_show_popup=root_url=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.is_google(root_url)||_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.is_youtube(root_url);const get_rule=url=>{const rules=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_15___default.a.get_rules(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_10__["a"].get("rules"),url);return underscore__WEBPACK_IMPORTED_MODULE_0___default.a.first(rules)};const is_protect=url=>{if(_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_17__["default"].get("vpn_country"))return true;let rule=get_rule(url)||{};return rule.enabled&&_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_15___default.a.is_all_browser(rule)||rule.mode=="protect"};const is_tpopup_disabled=()=>{let popup_conf=(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("bext_config")||{}).popup||{};return popup_conf.disable||_util_version_util_js__WEBPACK_IMPORTED_MODULE_16___default.a.cmp(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.version(),popup_conf.disable_max_ver)<0};const mitm_trace=(id,url,s)=>{let mitm=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_8___default.a.mitm;if(mitm)mitm.trace(id,url,s)};E.do_tpopup=tab=>loading_tpopups[tab&&tab.id]||_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*do_tpopup(){let url=tab&&tab.url,tab_id=tab&&tab.id;let root_url=url&&_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_root_url(url);if(!url||!root_url||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.is_disabled()||is_tpopup_disabled())return;loading_tpopups[tab_id]=this;this.finally(()=>{delete loading_tpopups[tab_id];if(false){}});this.catch(err=>{_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_tpopup_err",{},{err:err,with_log:true});delete connected_tpopups[tab_id]});mitm_trace(tab_id,url,"do_tpopup start");let tpopup_opt=yield get_tpopup_opt({tab_id:tab_id,url:url,root_url:root_url});if(!tpopup_opt)return;yield render_tpopup(assign({tab_id:tab_id,root_url:root_url,url:url},tpopup_opt))}));const check_unblockig_rate=root_url=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){let unblocking_rate=yield _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__["default"].get_unblocking_rate(200);if(!unblocking_rate)return false;let rate;for(let i=0,r;!rate&&(r=unblocking_rate[i]);i++){if(r.root_url==root_url&&r.unblocking_rate>min_suggest_rate)rate=r;else if(root_url=="bbc.com"&&r.root_url=="bbc.co.uk"&&r.unblocking_rate>min_suggest_rate){rate=r}}return!!rate}));const get_tpopup_opt=({tab_id:tab_id,url:url,root_url:root_url})=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){let premium_rule=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_12__["default"].get_force_premium_rule(root_url);if(_util_util_js__WEBPACK_IMPORTED_MODULE_13___default.a.get(premium_rule,"blacklist")){_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d no tpopup - blacklist %s",tab_id,root_url);return}if(is_protect(url)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d hide tpopup when protect browser/pc is enabled",tab_id);return}if(E.need_mitm_popup(url,tab_id)){mitm_trace(tab_id,url,"do_tpopup mitm popup should be shown");_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d mitm popup should be shown",tab_id);return{tpopup_type:"mitm_popup"}}if(is_never_show_popup(root_url)){return _util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d tpopup not allowed on %s",tab_id,root_url)}if(!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_12__["default"].is_active()&&premium_rule&&!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__["default"].is_dont_show(root_url)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d force premium - tpopup should be shown",tab_id);return{}}if(need_watermark_popup(tab_id,url)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d need watermark popup",tab_id);return{tpopup_type:"watermark"}}if(need_force_suggestion(tab_id,url)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d need forced suggestion popup",tab_id);_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_4___default.a.set_force_suggestion(tab_id,null);_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_10__["a"].set_stub_rule(tab_id,null);return{tpopup_type:"suggestion"}}if(need_stub_rule_popup(tab_id,url)){let tpopup_country=(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_10__["a"].get_stub_rule(tab_id)||{}).country||"";_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d need last rule popup",tab_id);_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_4___default.a.set_force_suggestion(tab_id,null);_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_10__["a"].set_stub_rule(tab_id,null);return{tpopup_type:"suggestion",tpopup_country:tpopup_country.toUpperCase()}}let forced;if(forced=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__["default"].is_force_tpopup(root_url)){_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__["default"].unset_force_tpopup(root_url);_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d popup was forced",tab_id);if(typeof forced=="string")return{tpopup_type:forced};forced_urls[root_url]=forced;return{}}if(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__["default"].is_dont_show(root_url))return _util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d tab is don't show",tab_id);let smode=get_suggestion_mode(root_url);if(_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].get_trial_active(root_url)||["always","never"].includes(smode)||smode=="by_popular"&&_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__["default"].is_dont_show(root_url,"suggestion")){_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d skip tpopup, site has suggestion conf",tab_id);return}if(forced=forced_urls[root_url]){_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d popup was forced2",tab_id);return typeof forced=="string"?{tpopup_type:forced}:{}}if(premium_rule||is_rule_enabled(url))return;_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d checking if site has high unblocking rate",tab_id);if(!(yield check_unblockig_rate(root_url))){_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d skip tpopup, no unblock by redirect/error",tab_id);return}if(get_suggestion_mode(root_url)=="by_popular"&&!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__["default"].is_dont_show(root_url,"suggestion")){_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d need watermark popup (by_popular)",tab_id);return{tpopup_type:"watermark"}}return{}}));const render_tpopup=({tab_id:tab_id,tpopup_type:tpopup_type,root_url:root_url,tpopup_country:tpopup_country,url:url})=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){if(popup_showing()&&!tpopup_type)return _util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d extension popup is opened",tab_id);let tab=yield _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_4___default.a.get_tab(tab_id);if(!tab)return _util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default()("tab:%d tpopup tab disappeared",tab_id);if(tab.url!=url){_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default()("tab:%d tpopup tab changed url %s -> %s",tab_id,url,tab.url);return}if(E.is_connected(tab_id,tpopup_type))return;let win_id=tpopup_windows[tab_id];if(win_id&&(yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.cb_apply(chrome.windows,".get",[win_id])))return;_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d applying tpopup to tab",tab_id);let opt={tab_id:tab_id,connection_id:tab_id+":tpopup:"+underscore__WEBPACK_IMPORTED_MODULE_0___default.a.random(Number.MAX_SAFE_INTEGER),root_url:root_url,url:url,ext_url:chrome.runtime.getURL("")+"js"};if(tpopup_type)opt.type=tpopup_type;if(tpopup_country)opt.country=tpopup_country;try{yield inject_iframe(tab_id,opt);connected_tpopups[tab_id]=tpopup_type||true}catch(e){if(e.message.match(/(tab was closed)|(no tab)/i))return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_tpopup_inject_err",{tab_url:tab.url,tab_id:tab_id,tpopup_type:tpopup_type,tab:tab},{err:e,with_log:true});let allow_window=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_site_storage(root_url,"force_trial")&&_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.check_min_ver(CG("tpopup_window_min_ver"));if(allow_window){opt.mode="window";let win=yield create_window(opt);if(win)tpopup_windows[tab_id]=win.id}else return}return opt}));const inject_iframe=(tab_id,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){opt=opt||{};let tabapi=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_19__["default"].tabid2api(tab_id);let code=`(${_bext_vpn_bg_tpopup_script_js__WEBPACK_IMPORTED_MODULE_20__["a"].toString()})(${JSON.stringify(opt)})`;_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d inject tpopup iframe",tab_id);yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default.a.cb_apply(chrome.tabs,".executeScript",[tabapi,{code:code,matchAboutBlank:true}]);if(chrome.runtime.lastError)throw new Error(chrome.runtime.lastError.message);else _util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default.a.notice("tab:%d tpopup iframe injected",tab_id)}));const create_window=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){let url=opt.ext_url+"/popup.html?"+_util_escape_js__WEBPACK_IMPORTED_MODULE_14___default.a.qs(opt);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_tpopup_create_window",{opt:opt});return yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_19__["default"].create_window({width:600,height:500,url:url})}));const is_trial_expired=root_url=>_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].is_trial_expired(root_url)&&!!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_12__["default"].get("user")&&!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_12__["default"].is_active()&&!!_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_site_storage(root_url,"trial.country");const need_trial_ended=root_url=>is_trial_expired(root_url)&&!_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_site_storage(root_url,"trial.dont_show_ended");const get_suggestion_mode=root_url=>{const site_conf=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.get_site_conf(root_url);const c=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.get_suggestion_conf(site_conf,_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__["default"].get("country"));return c&&(c.mode||"by_popular")};const is_rule_enabled=url=>(get_rule(url)||{}).enabled;const need_geo_suggestion=(tab_id,url,root_url)=>{if(!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_12__["default"].is_active()&&_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_site_storage(root_url,"force_trial")){return true}return get_suggestion_mode(root_url)=="always"&&!is_rule_enabled(url)&&!_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].get_trial_active(root_url)&&!is_trial_expired(root_url)&&!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__["default"].is_dont_show(root_url,"suggestion")};const need_geo_watermark=(tab_id,url,root_url)=>{const allow_hide=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_12__["default"].is_active()||_util_util_js__WEBPACK_IMPORTED_MODULE_13___default.a.get(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.get("bext_config"),"geo_popup.watermark.allow_hide");return is_rule_enabled(url)&&(!allow_hide||!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__["default"].is_dont_show(root_url,"watermark"))};const need_force_suggestion=(tab_id,url)=>{const root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_root_url(url);let post_install=E.get("post_install_redirect");post_install=post_install&&_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_root_url(post_install);return _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_19__["default"].is_vpn_allowed(url,true)&&!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.is_google(root_url)&&(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_4___default.a.is_force_suggestion(tab_id)||root_url==post_install)&&!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__["default"].is_dont_show(root_url,"suggestion")};const need_proxy_error_dialog=tab_id=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.proxy_error_ui_enabled("dialog")&&!!_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_8___default.a.get_tab_load_err(tab_id);const need_watermark_popup=(tab_id,url)=>{if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.is_disabled())return false;let root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_root_url(url);return!!(need_geo_watermark(tab_id,url,root_url)||need_trial_ended(root_url)||need_geo_suggestion(tab_id,url,root_url))||need_proxy_error_dialog(tab_id)};E.need_mitm_popup=(url,tab_id)=>{const mitm=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_8___default.a.mitm;const root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_root_url(url);return mitm&&mitm.is_popup_needed(url,tab_id)&&(!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_12__["default"].is_active()&&!is_never_show_popup(root_url)||mitm._is_mitm_active(tab_id)=="auto")};const need_stub_rule_popup=(tab_id,url)=>{if(!_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_19__["default"].is_vpn_allowed(url,true)||_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_15___default.a.is_skip_url(url))return false;const rule=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_10__["a"].get_stub_rule(tab_id);const root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_root_url(url);return rule&&!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_9__["default"].is_dont_show(root_url,"suggestion")};const tpopup_on_updated=o=>E.do_tpopup(o.tab);const tpopup_on_replaced=o=>chrome.tabs.get(o.added,tab=>E.do_tpopup(tab));let sent={};const send_trial_perr=(opt,page,re)=>{if(sent[page])return;if(!opt.skip_check&&!re.test(opt.url))return;sent[page]=true;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.perr("be_trial_page",{url:opt.url,root_url:opt.root_url,page:page})};const debug_stats=opt=>{try{const root_url=opt.root_url;if(root_url!="netflix.com")return;if(!_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].get_trial_active(root_url)){send_trial_perr({skip_check:true},"visit_no_trial",/.*/);return}send_trial_perr({skip_check:true},"visit_trial",/.*/);send_trial_perr(opt,"browse",/\/browse/i);send_trial_perr(opt,"watch",/\/watch/i);send_trial_perr(opt,"search",/\/search/i);send_trial_perr(opt,"login",/\/login/i)}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_11___default()("debug_stats error %o",e)}};const tpopup_msg=(c_id,name,opt)=>{let tab_id=+c_id.split(":")[0];chrome.tabs.sendMessage(tab_id,assign({id:"tpopup."+name,_type:"tpopup",_connection_id:c_id},opt))};E.show=c_id=>{tpopup_msg(c_id,"show")};E.hide=c_id=>{tpopup_msg(c_id,"hide")};E.close=c_id=>{tpopup_msg(c_id,"close")};E.pause_videos=c_id=>{tpopup_msg(c_id,"pause_videos")};E.resume_videos=c_id=>{tpopup_msg(c_id,"resume_videos")};E.hide_arrow_anim=c_id=>{tpopup_msg(c_id,"hide_arrow_anim")};E.show_arrow_anim=(c_id,opt)=>{tpopup_msg(c_id,"show_arrow_anim",opt)};let resize_et={};E.resize=(c_id,opt)=>{if(resize_et[c_id])resize_et[c_id].return();return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*resize_(){this.finally(()=>delete resize_et[c_id]);resize_et[c_id]=this;tpopup_msg(c_id,"resize",opt);return yield this.wait()}))};E.close_tab_tpopup=tab_id=>{let connections=_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_6___default.a.tabs.get_tab_connections(tab_id);if(connections)connections.forEach(c_id=>E.close(c_id))};const on_resize_end=e=>{if(resize_et[e.connection_id])resize_et[e.connection_id].continue()};const enabled_cb=()=>{if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a.is_disabled())return;Object.keys(connected_tpopups).forEach(tab_id=>E.close_tab_tpopup(tab_id))};const on_trial_end=root_url=>{Object.keys(connected_tpopups).forEach(tab_id=>{if(root_url!=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_root_url(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_4___default.a.get_url(tab_id)))return;const connections=_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_6___default.a.tabs.get_tab_connections(tab_id);if(connections)connections.forEach(c_id=>E.pause_videos(c_id))})};E.uninit=()=>{if(!E.inited)return;E.inited=0;E.off("resize_end",on_resize_end);E.stopListening()};E.init=()=>{if(E.inited)return;E.inited=1;E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_4___default.a,"updated",tpopup_on_updated);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_4___default.a,"replaced",tpopup_on_replaced);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a,"change:ext.active change:ext.suspended",enabled_cb);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default.a,"trial_end",on_trial_end);E.on("resize_end",on_resize_end)};E.t={need_watermark_popup:need_watermark_popup,need_force_suggestion:need_force_suggestion,get_tpopup_opt:get_tpopup_opt};__webpack_exports__["a"]=E},,,,,,,,,function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){var E={};function dnsResolve(host){return null}E.dnsDomainIs=function(host,domain){return host.length>=domain.length&&host.substring(host.length-domain.length)==domain};E.dnsDomainLevels=function(host){return host.split(".").length-1};E.convert_addr=convert_addr;function convert_addr(ipchars){var bytes=ipchars.split(".");var result=(bytes[0]&255)<<24|(bytes[1]&255)<<16|(bytes[2]&255)<<8|bytes[3]&255;return result>>>0}E.isInNet=function(ipaddr,pattern,maskstr){var test=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/.exec(ipaddr);if(test==null){ipaddr=dnsResolve(ipaddr);if(ipaddr==null)return false}else if(test[1]>255||test[2]>255||test[3]>255||test[4]>255)return false;var host=convert_addr(ipaddr);var pat=convert_addr(pattern);var mask=convert_addr(maskstr);return(host&mask)==(pat&mask)};E.isPlainHostName=function(host){return!host.includes(".")};E.isResolvable=function(host){var ip=dnsResolve(host);return ip!=null};E.localHostOrDomainIs=function(host,hostdom){return host==hostdom||hostdom.lastIndexOf(host+".",0)==0};E.shExpMatch=function(url,pattern){pattern=pattern.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/\?/g,".");var newRe=new RegExp("^"+pattern+"$");return newRe.test(url)};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_1__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(62);var _bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3__);var _util_url_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(18);var _util_url_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_4__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6__);var underscore__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(15);var underscore__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_7__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_8__);var _util_date_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(16);var _util_date_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_9__);var _util_util_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_10__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(21);var _util_storage_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_11__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(22);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12__);var _bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(44);var conf__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(24);var conf__WEBPACK_IMPORTED_MODULE_14___namespace=__webpack_require__.t(24,1);
// LICENSE_CODE ZON
const ff_webext=conf__WEBPACK_IMPORTED_MODULE_14__.firefox_web_ext2;let chrome,is_etask_perf_on,bext_config={};const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default.a.task_model.extend({model_name:"pac",_defaults:function(){this.stats={total:0,slow:{}};this.on("destroy",()=>E.uninit())}}));function update_config(){const prev=bext_config;bext_config=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default.a.get("bext_config")||{};is_etask_perf_on=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default.a.get("gen.is_etask_perf_on");if(is_etask_perf_on&&!_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.perf())_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.perf(true);if(!is_etask_perf_on&&_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.perf())_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.perf(false)}function on_debug_pac(){let on=_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_13__["default"].get("debug_pac");_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.notice("virtual pac %s",on?"on":"off");if(on)_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default.a.init({key:E.pac_key});else _bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default.a.t.reset()}E.init=()=>{if(E.inited)return;chrome=window.chrome;E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.new_etask("be_pac");E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default.a,"change:bext_config",update_config);E.listen_to(_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_13__["default"],"change:debug_pac",on_debug_pac);monitor_init();update_config();E.inited=true};var monitor_init=period=>{var first_reported,prev_slow,start=Date.now();if(E.timer)E.timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.clear_timeout(E.timer);var reset=(cb,keep_stats)=>{if(!keep_stats){if(is_etask_perf_on)_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.perf_stat={};E.stats={total:0,slow:{}}}first_reported=true;start=Date.now();if(cb)E.timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.set_timeout(cb,_util_date_js__WEBPACK_IMPORTED_MODULE_9___default.a.ms.HOUR,{sp:E.sp})};E.timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.set_timeout((function pac_slow(){var ts=_util_storage_js__WEBPACK_IMPORTED_MODULE_11___default.a.get_int("install_ts")||_util_storage_js__WEBPACK_IMPORTED_MODULE_11___default.a.get_int("update_ts");if(!first_reported&&ts!=window.hola.t.l_start)return reset(pac_slow,true);var send;for(var src in E.stats.slow){if(E.stats.slow[src]["100"]||E.stats.slow[src]["1000"]){send=true;break}}if(!prev_slow&&send){var info=Object.assign({period:Date.now()-start},E.stats);if(is_etask_perf_on)info.etask_perf_stat=_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.perf_stat;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5___default.a.perr("be_tab_unblocker_slow",_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.json(info))}prev_slow=send;reset(pac_slow)}),period||5*_util_date_js__WEBPACK_IMPORTED_MODULE_9___default.a.ms.MIN,{sp:E.sp})};E.uninit=()=>{E.inited=false;E.timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default.a.clear_timeout(E.timer);E.sp.return();E.stopListening()};function get_pac_scope(){if(chrome&&chrome.extension&&chrome.extension.inIncognitoContext)return"incognito_session_only";return"regular_only"}function err_cb(err){let{details:details,error:error}=err||{};if(error=="net::ERR_PROXY_CONNECTION_FAILED"&&!details)return;if(error=="net::ERR_PAC_SCRIPT_FAILED"){let m;if(m=(""+details).match(/Uncaught Error: init_ts ([0-9]+)/)){E.pac_engine_init_ts=+m[1];return _util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default.a.notice("pac_engine init_ts %s",E.pac_engine_init_ts)}if(m=(""+details).match(/Uncaught Error: pac_auto_reload init ts mismatch/)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()("pac_engine auto_reloaded detected on init");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default.a.trigger("pac_reload");reset_pac_file();_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.push_event("pac_reload",{init_ts:E.pac_engine_init_ts,new_ts:+m[1]});_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5___default.a.perr("pac_engine_auto_reload_init",{error:error,details:details,init_ts:E.pac_engine_init_ts,new_ts:m[1]},{err:err,rate_limit:{count:3}});return}if(m=(""+details).match(/Uncaught Error: pac_auto_reload init_ts ([0-9]+)/)){if(E.pac_engine_init_ts==m[1])return;_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()("pac_engine auto_reloaded detected init_ts %s -> %s",new Date(E.pac_engine_init_ts),new Date(+m[1]));_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default.a.trigger("pac_reload");_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.push_event("pac_reload",{init_ts:E.pac_engine_init_ts,new_ts:+m[1]});_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5___default.a.perr("pac_engine_auto_reload",{error:error,details:details,init_ts:E.pac_engine_init_ts,new_ts:m[1]},{err:err,rate_limit:{count:3}});E.pac_engine_init_ts=+m[1];if(_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_13__["default"].get("debug_pac"))_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default.a.t.reset();return}if(/Uncaught Error: pac_get_log /.test(details)||/Uncaught Error: pac_dump /.test(details)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()("proxy error %s %o %s",error,err,(""+details).replace(/\\n/g,"\n"));return}}_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()("proxy error %s %o %s",error,err,(""+details).replace(/\\n/g,"\n"));_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5___default.a.perr("proxy_error",{error:error,details:details},{rate_limit:{count:3}})}E.ajax_get_pac_init_ts=()=>{let xhr=new XMLHttpRequest;xhr.open("POST","http://__hola__.pac_get_init_ts.local.hola/?rnd="+Math.random(),true);try{xhr.send(null)}catch(err){}};let set_pac=script=>{E.has_pac=!!script;const scope=get_pac_scope();if(_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.is_mocha())return;return _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*set_pac_(){try{chrome.proxy.onProxyError.removeListener(err_cb);E.pac_engine_init_ts=0;if(script){chrome.proxy.onProxyError.addListener(err_cb);yield _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.cb_apply(chrome.proxy.settings,".set",[{scope:scope,value:{mode:"pac_script",pacScript:{data:script}}}]);E.ajax_get_pac_init_ts()}else{yield _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default.a.cb_apply(chrome.proxy.settings,".clear",[{scope:scope}])}}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5___default.a.perr("set_pac_err",{},{err:e,rate_limit:{count:1}})}}))};function check_need_ext_settings(){return _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default.a.get("ajax_via_proxy_inited")||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default.a.get("has_active_rules")&&!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default.a.is_disabled()}const gen_pac_script_str=options=>"var pac_engine = ("+_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default.a.module_fn+")();\n"+"pac_engine.init("+JSON.stringify(options)+");\n"+"function FindProxyForURL(url, host){\n"+"    return pac_engine.FindProxyForURL(url, host); }\n";const reset_pac_file=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*(){E.has_pac=false;return yield E.update_pac_file_state()}));E.update_pac_file_state=force_tmp_enable=>{if(ff_webext)return;var need_pac=force_tmp_enable||check_need_ext_settings();if(!!E.has_pac==!!need_pac)return;_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default.a.trigger("pac_init");if(!need_pac){if(_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_13__["default"].get("debug_pac"))_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default.a.t.reset();return set_pac(null)}var arr=new Uint8Array(32),key="";window.crypto.getRandomValues(arr);underscore__WEBPACK_IMPORTED_MODULE_7___default.a.each(arr,a=>{key+=a.toString(16)});E.pac_key=key;var options={key:E.pac_key};if(!bext_config.disable_pac_engine_auto_reload_init)options.set_ts=Date.now();var et=set_pac(gen_pac_script_str(options));if(_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_13__["default"].get("debug_pac"))_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default.a.init(options);return et};function hex_encode(s){let h="";for(let i=0;i<s.length;i++)h+=s.charCodeAt(i).toString(16);return h}const set_pac_rule=(rule,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({cancel:true},(function*_set_pac_rule(){this.finally(()=>{if(!xhr)return;xhr.abort();xhr.onload=xhr.onabort=xhr.onerror=null});opt=opt||{};let dur,xhr=new XMLHttpRequest;let prefix=hex_encode(JSON.stringify(rule));let url="http://__hola__.set."+prefix+".local.hola/";xhr.open("POST",url,_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.is_mocha());E.stats.total++;const t0=Date.now();if(opt.async)xhr.onload=xhr.onabort=xhr.onerror=()=>this.continue();try{if(_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_13__["default"].get("debug_pac")){try{_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default.a.FindProxyForURL(url,_util_url_js__WEBPACK_IMPORTED_MODULE_4___default.a.get_host(url))}catch(err){}}xhr.send(null);if(opt.async)yield this.wait(20*_util_date_js__WEBPACK_IMPORTED_MODULE_9___default.a.ms.SEC)}catch(err){}if((dur=Date.now()-t0)>10){let s,src=(opt.async?"async_":"")+(opt.src||"idle");if(!(s=E.stats.slow[src]))s=E.stats.slow[src]={10:0,100:0,1e3:0,max:0};s[dur>1e3?"1000":dur>100?"100":"10"]++;s.max=Math.max(dur,s.max);if(!opt.async&&dur>100){_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default.a.push_event("pac_slow",{url:rule.set,set_url:url,dur:dur})}}}));E.unset_proxy_for_host=(host,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({cancel:true},(function*unset_proxy_for_host(){if(!E.pac_key)return;let rule={unset:host,key:E.pac_key};if(!_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.is_mocha()&&E.pac_engine_init_ts)rule.init_ts=E.pac_engine_init_ts;yield set_pac_rule(rule,opt)}));E.set_proxy_for_host=(host,proxy_str,deadline_ts,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({cancel:true},(function*set_proxy_for_host(){if(!E.pac_key)return;var n=proxy_str.split(" ");if(n.length<2||!{PROXY:1,SOCKS:1,SOCKS5:1,HTTPS:1}[n[0]])proxy_str="DIRECT";let rule={proxy:proxy_str,set:host,key:E.pac_key,d_ts:deadline_ts};if(_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.is_mocha())delete rule.d_ts;if(!_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.is_mocha()&&E.pac_engine_init_ts)rule.init_ts=E.pac_engine_init_ts;yield set_pac_rule(rule,opt)}));__webpack_exports__["default"]=E},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){const is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(11),__webpack_require__(18),__webpack_require__(10),__webpack_require__(27)],__WEBPACK_AMD_DEFINE_RESULT__=function(etask,zurl,zutil,version_util){const E={debug:{}};const assign=Object.assign;let mitm_tabs={},bext_config={},rules=[];let ajax,storage,perr,mitm_discovery,zerr,rnd_id,local;let SEC=1e3,MIN=60*SEC,HOUR=60*MIN,api;const min_rules_ver="1.128.267";const def_api={ajax_via_proxy:()=>{},perr:()=>{},zerr:{notice:()=>{}},add_tab_hook:()=>{},local:null,remove_tab_hook:()=>{},remove_unblock_rule:()=>{},storage:{get:()=>{},set:()=>{},get_json:()=>{},set_json:()=>{},getItem:()=>{}},init_proxy:()=>{},has_geo:()=>{},loc:{country:"us"}};const sim_rules=[{domain:"nako.me",resp:{status:0}},{domain:"keter.co.il",resp:{status:302,headers:{location:"https://facebook.com"}}}];function sim_find(url){return E.enable_sim&&sim_rules.find(r=>{var reg=new RegExp("https?://"+r.domain+"/");return reg.test(url)})}E.sim_filters=type=>{if(!E.inited||!E.enable_sim)return;var ret=[];sim_rules.forEach(r=>{if(type=="before_request"&&!r.resp.status)ret.push("*://"+r.domain+"/");if(type=="headers_received"&&r.resp.status)ret.push("*://"+r.domain+"/")});return ret};function sim_set(resp,url){var sim;if(!E.inited||!E.enable_sim||!(sim=sim_find(url||resp.url)))return;resp.statusCode=sim.resp.status;resp.headers=assign({},resp.headers,sim.resp.headers);resp.redir="/js/bext/vpn/bg/sim_dns_block.html?orig_url="+encodeURIComponent(url);return resp}var mitm_dbg;var ZG=zutil.get;function CG(path,def){return ZG(bext_config,path,def)}function CGM(path,def){return ZG(bext_config.mitm,path,def)}function CGM_includes(path,i,def){return CGM(path,def||[]).length&&CGM(path,def).includes(i)}function CGM_match(path,i,def){return CGM(path,def||[]).some(m=>{var r=new RegExp(m);return r.test(i)})}function CGM_if_includes(path,i){return CGM_includes(path,i,[i])}function trace(tid,turl,s){if(!E.debug.tracer&&!CGM("tracer"))return;if(arguments.length==1){s=tid;tid=null}if(typeof s=="object")s="\n"+JSON.stringify(s);console.log("TRACE "+(new Date).toLocaleTimeString("en-US",{hour12:false})+" "+(tid?"["+tid+":"+get_root_url(turl)+"]":"")+": "+s)}E.trace=trace;function rule_get(url,opt){var host=get_root_url(url),now=Date.now(),ret=[];opt=opt||{};for(var i=0;i<rules.length;i++){var r=rules[i];if(!opt.allow_stale&&r.until&&r.until<now)continue;if(r.name!=host||r.src_country!=local.src_country)continue;if(local.dev=="desktop"||local.conn=="cellular"||r.ips.includes(local.ip)){return r}if((local.dev=="laptop"||local.conn=="wifi")&&opt.all)ret.push(r)}return ret.length?ret:null}function rules_cleanup(){var now=Date.now();var del=rules.filter(r=>r.until&&r.until<now&&r.cmd=="ignore"&&!r.auto_unblock);del.forEach(d=>{rules.splice(rules.indexOf(d),1)});if(del.length)set_rules_to_storage()}function rule_del(url){init_rules_from_storage();var rule=rule_get(url);if(!rule)return;if(rule.type=="unblock"||rule.auto_unblock)rule_invalidate(rule);else rules.splice(rules.indexOf(rule),1);set_rules_to_storage()}function rule_gen(url,opt){opt=opt||{};var r={};var now=Date.now();r.name=get_root_url(url);r.url=url;r.country=opt.country||"us";r.src_country=local.src_country;r.dev=local.dev;r.conn=local.conn;r.cmd=opt.cmd||"unblock";r.type=opt.type;r.ips=[local.ip];r.auto_unblock=r.type=="auto"&&r.cmd=="unblock";if(opt.force)r.force=opt.force;if(opt.until)r.until=now+opt.until;r.ts=now;return r}function init_rules_from_storage(){var o=storage.get_json("mitm_rules");if(!o||!o.ver||!o.rules||version_util.cmp(o.ver,min_rules_ver)<0)rules=[];else{rules=o.rules;rules=rules.map(e=>e.name?e:assign(zutil.omit(e,"host","proxy_country","country"),{name:e.host,src_country:e.country,country:e.proxy_country}))}if(zutil.is_mocha())E.t.rules=rules}function set_rules_to_storage(){storage.set_json("mitm_rules",{ver:min_rules_ver,rules:rules})}function rule_compat(rule){return rule.cmd=="unblock"&&(rule.dev=="desktop"||rule.conn=="cellular")||(rule.cmd=="unblock"||local.dev=="desktop"||local.dev=="cellular")||rule.ips.includes(local.ip)}function rule_invalidate(rule,set){rule.until=Date.now()-10}function rule_set(url,opt){opt=opt||{};opt.cmd=opt.cmd||"unblock";init_rules_from_storage();var r=rule_get(url,{allow_stale:true});if(!r)rules.push(r=rule_gen(url,opt));else if(r.cmd==opt.cmd&&!opt.until&&!r.until&&r.force==opt.force&&r.type==opt.type&&(local.dev=="desktop"||local.conn=="cellular"||r.ips.includes(local.ip))){return r}else{r.cmd=opt.cmd||"unblock";if(r.force||opt.force)r.force=opt.force;delete r.until;if(opt.until)r.until=Date.now()+opt.until;r.type=opt.type;r.auto_unblock=r.auto_unblock||r.type=="auto"&&r.cmd=="unblock";if((local.dev=="laptop"||local.conn=="wifi")&&!r.ips.includes(local.ip)){r.ips.push(local.ip)}}set_rules_to_storage();return r}function rule_valid_ms(url){var rule=rule_get(url);return rule?rule.until-Date.now():0}function has_ignore_rule(tab_url){var rule=rule_get(tab_url);return rule&&rule.cmd=="ignore"}function rule_del_and_cleanup(url){if(!E.inited)return;trace("rule_del_and_cleanup "+get_root_url(url));rule_del(url);api.remove_unblock_rule(url);for(var tab_id in mitm_tabs){var tab=mitm_tabs[tab_id];if(get_root_url(tab.url)!=get_root_url(url))continue;delete tab.manual;delete tab.rule;tab_remove_hooks(tab)}}function is_feature_enabled(feature,extra){var m=feature.split("."),path="";return m.every(f=>{path=path+(path?".":"")+f;var v_path=feature+".min_ver";var d_path=feature+".disable";var e_path=feature+"."+extra;return!CGM(d_path)&&(!CGM(v_path)||version_util.cmp(api.version,CGM(v_path))>=0)&&(!extra||CGM(e_path))})}function is_redir(code){return[300,301,302,303,307].includes(code)}function is_trigger_enabled(feature){return is_feature_enabled(feature,"trigger")}function is_manual_supported(){return is_feature_enabled("manual")}function is_auto_supported(){return is_feature_enabled("auto")}function detect_error(){return is_feature_enabled("auto.error")}function detect_fake_resp(){return is_feature_enabled("auto.fake_resp")}function detect_fake_redirect(){return is_feature_enabled("auto.redirect")}E.user_set_unblock=(url,until)=>E.inited&&rule_set(url,{until:until,type:"user_choice"});E.set_ignore=(url,until,type)=>{if(!E.inited)return;rule_del_and_cleanup(url);rule_set(url,{cmd:"ignore",until:until||7*24*HOUR,type:type||"user_choice"})};E.set_manual_tab=(tab_id,tab_url,until)=>{if(!E.inited||!is_manual_supported())return;E.tabs_add(tab_id,tab_url,"set_manual_tab");var tab;if(!(tab=mitm_tabs[tab_id]))return;tab.manual=true;var rule=rule_set(tab_url,{until:until,type:"manual"});tabs_set_rule(tab_id,rule,"set_manual_tab")};E.is_ignored=url=>{if(!E.inited||CGM("disable")||is_site_blacklisted(url))return false;var rule=rule_get(url);return rule&&rule.cmd=="ignore"&&rule.type};E.get_unblock_rules=()=>{var now=Date.now();return rules.filter(r=>(!r.until||r.until>now)&&r.cmd=="unblock"&&r.type!="auto")};function get_domain_url(url){var m=(url||"").match(/^https?:\/\/([^\/^:]+)\/?.*$/);return m?m[1]:""}function get_root_url(url){return zurl.get_root_domain(get_domain_url(url))}function print_rules_state(){var count=0;zerr.notice("rules dump:");rules.forEach(r=>{zerr.notice(count+") "+r.name+(r.cmd=="unblock"?" UNBLOCK":" IGNORE")+" - cached for "+(r.until-Date.now())/SEC+"sec")})}function send_mitm_err(err){send_mitm_perr(null,{error:err})}function send_mitm_perr(url,info,hc){info=info||{};var cmd=info.rule&&info.rule.cmd||"unknown";info=assign({host:get_root_url(url||""),country:local.src_country,blocked:cmd=="unblock",sb_conf:bext_config.mitm,mitm_dbg:mitm_dbg,uuid:api.uuid,proxy_country:"us"},info);if(!zutil.is_mocha()){perr("mitm_"+(info.err?"err":cmd),info,{filehead:rnd_id<CGM("log.random")||storage.get("mitm_send_log")||CGM_includes("log.uuids",api.uuid)||CGM_includes("log.countries",local.src_country)?zerr.json(last_log):undefined})}log("perr - "+(info.err||(cmd=="unblock"?"blocked --\x3e us":"ignore"))+(info.from_cache?" from cache":""),info,{hc:hc})}function is_tab_manual(id){return mitm_tabs[id]&&mitm_tabs[id].manual}function is_tab_rule_set(id,rule){var tab=mitm_tabs[id];return tab&&tab.rule&&(!rule||rule.cmd==tab.rule.cmd&&rule.type==tab.rule.type)}function is_tab_completed(id){return mitm_tabs[id]&&mitm_tabs[id].completed}function is_rule_active(o){var rule=typeof o=="object"?o:rule_get(o);return rule&&rule.cmd=="unblock"&&(rule.type=="manual"&&is_manual_supported()&&is_trigger_enabled("manual")||rule.type=="auto"&&is_auto_supported()&&is_trigger_enabled("auto")||rule.type=="user_choice")&&!is_trigger_blacklisted(rule.url)&&rule.type}E._is_mitm_active=tab_id=>{var tab=mitm_tabs[tab_id];return E.inited&&tab&&tab.hook&&tab.rule&&(is_rule_active(tab.url)||tab.rule.type)};E.is_mitm_active=tab_url=>{var ret=E.inited&&is_rule_active(tab_url);if(!ret){for(var tab_id in mitm_tabs){var tab=mitm_tabs[tab_id];if(tab.url==tab_url&&(ret=E._is_mitm_active(tab.id)))break}}trace("any",tab_url,"is_mitm_active "+ret);return ret};E.is_ext_ui_enabled=()=>E.inited&&is_manual_supported()&&rnd_id<CGM("enable_ext_ui",0)*100;E.is_popup_needed=(tab_url,tab_id)=>{var o=CGM("popup");var ret=E.inited&&E._is_mitm_active(tab_id)&&api&&o&&o.enable&&(!o.min_version||version_util.cmp(api.version,o.min_version)>=0);trace(tab_id,tab_url,"is_popup_needed "+ret);return ret};var last_tab_id;E.get_active_tab_rule=(tab_id,tab_url)=>{if(!E.inited||tab_id==-1)return;var rule=E.get_tab_rule(tab_id,tab_url);return is_rule_active(rule)&&rule};E.get_tab_rule=(tab_id,tab_url)=>{if(!E.inited||tab_id==-1)return;var tab=mitm_tabs[tab_id];tab_url=tab_url||tab&&tab.url;return tab&&tab.rule||tab_url&&tabs_set_rule(tab_id,tab_url,"get_tab_rule")};function tabs_set_rule(tab_id,o,caller){var rule=typeof o=="object"?o:rule_get(o);var tab_url=typeof o=="object"?o.url:o;trace(tab_id,tab_url,"tabs_set_rule by "+caller);E.tabs_add(tab_id,tab_url,"tabs_set_rule");var tab=mitm_tabs[tab_id];if(!E.inited||!rule||!tab||tab.rule&&tab.rule.cmd==rule.cmd&&tab.rule.type==rule.type){return tab&&tab.rule}tab.rule=rule;if(is_rule_active(rule)){tab_add_hooks(tab);if(rule.type=="auto"){rule_invalidate(rule);set_rules_to_storage()}}else if(tab.rule.cmd=="ignore")tab_remove_hooks(tab);return tab.rule}function tab_add_hooks(tab,type){if(tab.hook)return;tab.hook=api.add_tab_hook(tab.id);tab.hook_ts=Date.now();trace(tab.id,tab.url,"tab_add_hooks")}function tab_remove_hooks(tab){if(!tab.hook)return;trace(tab.id,tab.url,"tab_remove_hooks");api.remove_tab_hook(tab.hook);delete tab.hook;delete tab.hook_ts}function tab_rule_cleanup(tab){if(!tab.rule||tab.rule.type!="auto"||tab.rule.cmd!="unblock")return;delete tab.manual;delete tab.rule;api.remove_unblock_rule(tab.url);tab_remove_hooks(tab)}E.tabs_del=(tab_id,caller)=>{var tab;if(!E.inited||!(tab=mitm_tabs[tab_id]))return;trace(tab_id,tab.url,"tabs_del by "+(caller||"ext"));tab_rule_cleanup(tab);delete mitm_tabs[tab_id]};E.tabs_add=(tab_id,tab_url,caller)=>{if(!E.inited||!mitm_tabs[tab_id]&&!tab_url||/chrome:\/\/newtab\//.test(tab_url)){return}trace(tab_id,tab_url,"tabs_add by "+caller);if(tab_url&&mitm_tabs[tab_id]&&mitm_tabs[tab_id].url!=tab_url){trace(tab_id,tab_url,"tabs_add url mismatch "+mitm_tabs[tab_id].url+"!="+tab_url);E.tabs_del(tab_id,"tabs_add")}else if(mitm_tabs[tab_id]&&caller=="on_before_navigate"){tab_rule_cleanup(mitm_tabs[tab_id]);tabs_set_rule(tab_id,tab_url,"tabs_add")}if(!mitm_tabs[tab_id])mitm_tabs[tab_id]={url:tab_url,method:"root",id:tab_id};last_tab_id=tab_id};E.tabs_set_complete=tab_id=>{if(E.inited&&mitm_tabs[tab_id])mitm_tabs[tab_id].completed=true};E.tab_set_req_info=(tab_id,info)=>{if(E.inited&&mitm_tabs[tab_id])mitm_tabs[tab_id].req_info=info};E.tab_get_req_info=tab_id=>{if(E.inited&&mitm_tabs[tab_id])return mitm_tabs[tab_id].req_info};E.strategy_wrapper=(strategy,req,tab_url)=>{var tab_id=req.tab_id,rule;if(!E.inited||!(rule=E.get_active_tab_rule(tab_id,tab_url)))return strategy;return(direct_resp,proxy_resp)=>{var error;if(req.mitm_rewrite){error=proxy_resp&&proxy_resp.error;direct_resp=proxy_resp;proxy_resp=null}var ret=strategy(direct_resp,proxy_resp)||{};var has_direct=Object.keys(ret.direct||{}).length;var has_proxy=Object.keys(ret.proxy||{}).length;if(!(req.mitm_rewrite=!!rule.force||!error&&has_direct&&!has_proxy)){return ret}ret={proxy:ret.direct,direct:ret.proxy,src:"mitm_route"};ret.proxy=assign({country:rule.country},ret.proxy);return ret}};function is_valid_resp(details){var headers=details&&details.headers||{};var code=details&&details.statusCode||0;var url=details&&details.url;if(!code)return!detect_error();if(/cloudflare/.test(headers.server))return true;if(get_protocol(url)=="https")return true;if(is_redir(code)){return!detect_fake_redirect()||(headers.location&&(!/^https?:\/\//.test(headers.location)||get_root_url(url)==get_root_url(headers.location))||check_redirect_filter(url,headers.location))}if(!detect_fake_resp())return true;if([200,404].includes(code)&&(headers.connection=="close"||headers["content-length"]<1e4)){return false}return true}function handle_mitm_block(hc){trace(hc.tab_id,hc.tab_url,"mitm.handle_mitm_block start");if(is_tab_rule_set(hc.tab_id,hc.rule))return void trace(hc.tab_id,hc.tab_url,"tab rule already set");hc.handle=E.inited&&is_rule_active(hc.tab_url);if(!hc.info.in_parallel)send_mitm_perr(hc.tab_url,assign({rule:hc.rule},hc.info),hc);if(sim_find(hc.tab_url))hc.sim={url:hc.tab_url};return hc}function get_agent_min_fmt(a){return zutil.pick(a,"host","port","ip")}var last_log=[];function log(short,long,opt){opt=opt||{};if(opt.init)last_log=[];var lopt;if(lopt=long&&long.opt){lopt=long.opt=assign({},lopt);if(lopt.agent)lopt.agent=get_agent_min_fmt(lopt.agent);if(lopt.agents)lopt.agents=lopt.agents.map(get_agent_min_fmt);if(lopt.hc)lopt.hc=zutil.omit(lopt.hc,"detect_log")}trace(opt.hc&&opt.hc.tab_id,opt.hc&&opt.hc.tab_url,short||long);return last_log.push({short:short,long:long})}function get_protocol(url){var m=url&&url.match(/(https?):\/\//);return m&&m[1]}function check_redirect_filter(url,redir){return!!CGM("redirect_filter",[]).find(r=>r.domain?get_domain_url(redir)==r.domain:r.url==url&&r.redir==redir)}function check_response_filter(resp,response_filter){return CGM("response_filter",[]).find(r=>Object.keys(r).every(k=>r[k]==resp[k]))}function etask_sleep(t){return zutil.is_mocha()?null:etask.sleep(t)}function triple_check(url,opt){function send_next(){if(agents[next])delete agents[next].timeout;if(agents[++next])_this.spawn(send_ajax());else et_timeout=setTimeout(()=>{et.return(ret)},3e3)}function send_ajax(){var _url={url:url,type:"GET"};var agent=opt.force=="proxy"?agents[next]:null;var _opt=assign({},{always:true,hdrs_abort:true,ignore_redir:true,hdrs:{"Cache-Control":"no-cache,"+"no-store,must-revalidate,max-age=-1"},force_headers:true,fix_307:true,agent:agent},opt);log("ajax "+(opt.replace||opt.force)+(opt.force=="proxy"&&!opt.replace?" --\x3e "+opt.country:""),{url:_url,opt:_opt},{hc:opt.hc});ts=Date.now();var state={};var et=api.ajax_via_proxy(_url,_opt,state);if(agent){agent.state=state;agent.timeout=setTimeout(send_next,3e3);agent.et=et}else{et_timeout=setTimeout(()=>{et.return({orig_res:{error:"timeout"}})},2e4)}return et}var ret={error:"all agents failed"},ts,agents=opt.agents||[];var next=0,et_timeout,_this;var et=etask("triple_check",(function*triple_check_(){_this=this;this.finally(()=>{clearTimeout(et_timeout);agents.forEach(a=>clearTimeout(a.timeout))});this.spawn(send_ajax());yield this.wait_child("any",resp=>{clearTimeout(et_timeout);var _ret=resp&&resp.orig_res||{error:"ajax failed"};_ret.statusCode=_ret.statusCode!=undefined?_ret.statusCode:_ret.code;delete _ret.body;if(resp&&resp.agent&&resp.agent.timeout)clearTimeout(resp.agent.timeout);var proxy_err=opt.force=="proxy"&&/ERR_PROXY_CONNECTION_FAILED/.test(_ret.error);var ajax_err=_ret.error=="ajax failed";log("resp "+(_ret.error||_ret.statusCode)+" after "+(Date.now()-ts)+"ms",null,{hc:opt.hc});if(opt.country&&_ret.error&&!proxy_err&&!ajax_err||!opt.country&&!ajax_err||!agents[next+1]||_ret.statusCode){ret=_ret;return true}send_next()});return ret}));return et}function mitm_ret(hc,rule,info){hc.rule=rule;if(rule.cmd=="unblock"){hc.blocked=rule.type;hc.country=rule.country}hc.info=assign({},hc.info,info);return hc.test?hc:handle_mitm_block(hc)}function set_temp_ignore(url,opt){var feature=opt.hook=="error"?"error":is_redir(opt.prev_code)?"redirect":"fake_resp";var rule_opt={force:opt.force_peer,type:"auto",cmd:"ignore",until:rule_get(url)?HOUR:5*MIN};var rule;if(opt.hook!="test"&&is_trigger_enabled("auto."+feature))rule=rule_set(url,rule_opt);else rule=rule_gen(url,rule_opt);return rule}var running_tests={},SLEEP=100;function is_western(country){return["us","ca","gb","fr","it","es","de","se"].includes(country)}E.check_mitm_blocking=function(opt){if(!E.inited)return;var url=opt.url,tab_id=opt.tab_id,tab_url=opt.tab_url;var prev_code=opt.prev_code||0,root_url=get_root_url(url);var hc={name:root_url,tab_url:tab_url,url:opt.url,tab_id:tab_id,info:{timing:{tab_url:get_url_timing(tab_url),ts:Date.now()}},test:opt.hook=="test",redir:opt.redir};var rule=!hc.test&&E.get_tab_rule(tab_id,hc.tab_url);var country=opt.country||"us",timing=hc.info.timing;var in_progress=running_tests[root_url];var feature=opt.hook=="error"?"error":is_redir(prev_code)?"redirect":"fake_resp";function _ltrace(s){trace(tab_id,tab_url,"check_mitm_blocking(running "+Object.keys(running_tests).length+") "+s)}var ltrace=E.tracer?_ltrace:()=>{};ltrace("start");if(opt.headers){hc.info.headers=assign({url:tab_url,country:local.src_country,status:prev_code},opt.headers)}else if(opt.err_str)hc.info.headers={status:0,error:opt.err_str};if(in_progress&&in_progress.tab_id==tab_id)return void ltrace("abort in progress");if(!opt.ignore_rule&&rule){ltrace("rule in cache");return mitm_ret(hc,rule,{from_cache:true})}in_progress=running_tests[root_url];if(!in_progress)in_progress=running_tests[root_url]={tab_id:tab_id};log("init "+tab_url+" status code "+prev_code,"",{init:true,hc:hc});var proto=get_protocol(url);var test_url=!prev_code?proto=="http"?url.replace("http","https"):url:"https://"+get_domain_url(url)+"/does_not_exist_"+(zutil.is_mocha()?"11111":Math.round(Math.random()*1e5));return etask("check_mitm_blocking",[function(){if(hc.test)return this.goto("test");if(in_progress.et)return this.wait_ext(in_progress.et);in_progress.et=this;return this.goto("test")},function(){hc.info.from_cache=true;hc.info.in_parallel=true;rule=rule_get(url);hc.blocked=rule&&rule.cmd=="unblock";return this.goto("ret",rule)},function test(){if(proto=="https"||!is_western(local.src_country))return this.goto("proxy");return triple_check(test_url,opt.force_peer?{force:"proxy",country:opt.force_peer,hc:hc}:{force:"direct",hc:hc})},function(resp){resp.statusCode=resp.status!==undefined?resp.status:resp.statusCode;timing.pre_direct=Date.now()-timing.ts;hc.info.pre_direct_resp=assign({url:url,test_url:test_url},zutil.pick(resp,"statusCode","headers","error"));if(resp.error=="ajax failed"||resp.statusCode){hc.blocked=false;return this.goto("ret")}},function proxy(){return triple_check(test_url,{force:"proxy",country:country,agents:opt.agents,hc:hc})},function(resp){timing.proxy=Date.now()-(timing.pre_direct||timing.ts);var r=hc.info.proxy_resp={url:url};if(r.url!=test_url)r.test_url=test_url;r=assign(r,zutil.pick(resp,"statusCode","headers","error"));log("proxy resp "+r.statusCode,r,{hc:hc});if(!r.statusCode){rule=set_temp_ignore(url,opt);log("proxy request failed "+r.statusCode,"",{hc:hc});return this.return(mitm_ret(hc,rule,{proxy_fail:true}))}if(is_redir(prev_code)&&is_redir(r.statusCode)&&get_domain_url(opt.headers.location)==get_domain_url(r.headers.location)){hc.blocked=false;return this.goto("ret")}return etask_sleep(SLEEP)},function(){if(prev_code)test_url+="1";if(sim_find(url))return sim_set({},url);if(!opt.force_peer&&ajax)return ajax({url:test_url,no_throw:true});return triple_check(test_url,opt.force_peer?{force:"proxy",country:opt.force_peer,hc:hc}:{force:"direct",hc:hc})},function(resp){timing.direct=Date.now()-timing.proxy;resp.statusCode=resp.status!==undefined?resp.status:resp.statusCode;var r=hc.info.direct_resp=assign({url:url,test_url:test_url},zutil.pick(resp,"statusCode","headers","error"));if(r.error=="ajax failed"||resp.statusCode){hc.blocked=false;return this.goto("ret")}log("direct resp "+r.statusCode,r,{hc:hc});hc.detect_log=E.debug.last_log=last_log;hc.info.reason="direct https failed";hc.blocked=true},function ret(_rule){hc.info.reason=_rule?"in parallel":hc.blocked?"trigger: "+prev_code+(opt.err_str?" "+opt.err_str:"")+" -> blocked due to "+hc.info.reason:"";var geo_rule=api.has_geo(tab_url);if(geo_rule){log("geo rule enabled before detection complete",geo_rule);return}var rule_opt={force:opt.force_peer,type:"auto",cmd:hc.blocked?"unblock":"ignore",until:!hc.blocked?HOUR:5*MIN};if(hc.test||!is_trigger_enabled("auto."+feature))rule=_rule||rule_gen(url,rule_opt);else{rule=_rule||rule_set(url,rule_opt);if(!hc.info.in_parallel){zerr.notice("MITM: "+hc.name+" on tab "+tab_url+"("+tab_id+")"+(hc.blocked?" BLOCKED":" OK"))}}return mitm_ret(hc,rule)},function finally$(){delete running_tests[root_url];timing.total=Date.now()-timing.ts;if(!hc.info.in_parallel)print_rules_state()}])};function is_trigger_blacklisted(url){return CGM_match("trigger_blacklist",get_root_url(url))}function is_site_blacklisted(url){return CGM_match("site_blacklist",get_root_url(url))}function set_config(conf){bext_config=conf||{}}function is_method_all(tab_id){return is_method_allowed(tab_id,"all")}function is_method_root(tab_id){return is_method_allowed(tab_id,"root")}function is_method_allowed(tab_id,method){var tab=mitm_tabs[tab_id];if(!E.inited||!tab||tab.method!=method)return;return E.is_auto_discovery()||is_tab_manual(tab_id)}E.is_mitm_allowed=(tab_id,tab_url,url,details)=>E.inited&&!is_valid_resp(details)&&(is_method_root(tab_id)&&url==tab_url||is_method_all(tab_id)&&get_root_url(url)==get_root_url(tab_url))&&!has_ignore_rule(tab_url)&&!is_site_blacklisted(tab_url);E.is_auto_discovery=()=>E.inited&&mitm_discovery=="auto"&&is_auto_supported();E.should_unblock=tab_url=>{var rule=rule_get(tab_url,{allow_stale:true});return rule&&rule.auto_unblock};E.debug.get_debug_info=tab_id=>{var tab=mitm_tabs[tab_id||last_tab_id];return{host:get_root_url(tab?tab.url:""),sb_conf:bext_config.mitm,mitm_dbg:mitm_dbg,url:tab&&tab.ur,filehead:zerr.json(last_log)}};E.debug.bug_report=(tab_id,info)=>{if(isNaN(tab_id))info=tab_id;info=assign({uuid:api.uuid,proxy_country:"us"},E.debug.get_debug_info(tab_id),info);if(!zutil.is_mocha())perr("mitm_bug_report",info,{filehead:zerr.json(last_log)})};E.debug.rules_dump=print_rules_state;E.debug.running_tests=running_tests;E.debug.reset=()=>{rules=[];set_rules_to_storage();Object.keys(running_tests).forEach(r=>{if(running_tests[r].et)running_tests[r].et.return()});for(var tab_id in mitm_tabs){var tab=mitm_tabs[tab_id];delete tab.manual;delete tab.rule;tab_remove_hooks(tab)}};E.debug.mitm_test=(url,prev_code,force_peer)=>etask((function*mitm_test_(){console.log("Starting check_mitm_blocking test on "+url);yield api.init_proxy();const hc=yield E.check_mitm_blocking({url:url,force_peer:force_peer,tab_url:url,hook:"test",prev_code:prev_code||0});console.log("RESPONSE "+(hc.blocked?"blocked "+hc.blocked+" "+hc.reason:"not blocked"));console.log("log:",hc.detect_log);console.log("direct resp:",hc.info.direct_resp);console.log("proxy resp:",hc.info.proxy_resp);console.log("RESULT: "+(hc.blocked?"BLOCKED":"NOT BLOCKED"))}));function get_url_timing(url){var e;if(typeof window!=="undefined"&&window.performance&&window.performance.getEntriesByName&&(e=window.performance.getEntriesByName(url))&&e.length==1){e=e[e.length-1];if(e.responseEnd&&e.responseStart)return Math.round(e.responseEnd-e.responseStart)}}E.init=function(_api){api=assign({},def_api,_api);E.inited=false;if(!api.loc||!api.loc.country)return;local={src_country:api.loc.country.toLowerCase(),ip:api.loc.ip,conn:api.connection_type,dev:api.device_type};if(zutil.is_mocha())E.t.local=local;storage=api.storage;perr=api.perr;zerr=api.zerr;mitm_dbg=storage.get_json("mitm_debug");if(mitm_dbg&&!Object.keys(mitm_dbg).length){mitm_dbg={disable:false,discovery:"auto",popup:{enable:1},enable_ext_ui:1,manual:{trigger:true,disable:false},auto:{trigger:true,disable:false,error:{disable:false,trigger:true},fake_resp:{disable:false,trigger:true},redirect:{disable:false,trigger:true}},detect_geo_rules:true};storage.set_json("mitm_debug",mitm_dbg)}set_config(zutil.extend_deep({},api.bext_config,mitm_dbg?{mitm:mitm_dbg}:null));if(CGM("disable")||!CGM_if_includes("country_whitelist",local.src_country)||CGM_includes("country_blacklist",local.src_country)||CGM("min_version")&&version_util.cmp(api.version,CGM("min_version"))<0){return}E.enable_sim=storage.get("mitm_enable_sim");init_rules_from_storage();rules_cleanup();mitm_discovery=CGM("discovery","manual");rnd_id=storage.get("be_rnd");if(rnd_id==null||isNaN(rnd_id))storage.set("be_rnd",rnd_id=Math.round(Math.random()*100));E.debug.mitm_tabs=mitm_tabs;window.mitm=E.debug;return E.inited=true};E.uninit=function(){Object.keys(running_tests).forEach(r=>{if(running_tests[r].et)running_tests[r].et.return()});delete window.mitm;api=def_api;mitm_dbg=local=ajax=rnd_id=undefined;bext_config={};rules=[];perr=api.perr;zerr=api.zerr;storage=api.storage;mitm_discovery="manual";mitm_tabs={};E.inited=false};if(zutil.is_mocha()){E.t={rule_set:rule_set,rule_get:rule_get,rules:rules,local:local,running_tests:running_tests,is_valid_resp:is_valid_resp}}return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){const is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(11),__webpack_require__(18),__webpack_require__(10)],__WEBPACK_AMD_DEFINE_RESULT__=((etask,zurl,zutil)=>{const E={},assign=Object.assign;const is_force_rule_for_country=(rule,country)=>{if(!country)return true;if(rule.countries)return rule.countries.includes(country);if(rule.exclude_countries)return!rule.exclude_countries.includes(country);return true};E.convert_blob2check=(conf,name)=>{const rules=conf&&conf[name]&&conf[name].rules;if(!rules)return;conf[name].rules=rules.map(rule=>assign({},rule,{domain:new RegExp("^"+zurl.http_glob_host(rule.domain)+"$")}))};E.find_rule=(root_url,conf,name,src_country)=>{const rules=conf&&conf[name]&&conf[name].rules;if(!rules||!root_url)return;return rules.find(rule=>{if(!rule.domain.test(root_url))return false;return is_force_rule_for_country(rule,src_country)})};return E}).apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},,,,,,,,,,,,,function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"0.bundle.worker.js"},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){var E={};function imul64h(a,b){var ah=a>>>16&65535;var al=a&65535;var bh=b>>>16&65535;var bl=b&65535;return ah*bh+(ah*bl+al*bh)>>16|0}E.hash_int=function(val){var xh=imul64h(val,1103515245);var xl=Math.imul(val,1103515245);return xl-xh>>>0};E.hash_string=function(s){if(!s.length)return 0;var hash=E.hash_int(s.length);for(var i=0;i<s.length;i+=2){hash=E.hash_int(hash+(s.charCodeAt(i)<<16)+(s.charCodeAt(i+1)|0)>>>0)}return hash};E.sum_parse=function(str){var parts=/([0-9a-f]+)\s+([ *]?)(.*)/i.exec(str);if(!parts)return null;return{hash:parts[1],type:parts[2]=="*"?"binary":"text",file:parts[3]}};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},function(module,__webpack_exports__,__webpack_require__){"use strict";var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_5__);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(40);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(41);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7__);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(29);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(28);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_10__);var _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(55);var _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(36);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(30);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.assert_bg("be_icon");const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default.a.task_model.extend({model_name:"icon"}));const chrome=window.chrome,assign=Object.assign;let icons={},cache_icons={};E.uninit=()=>{if(!E.get("inited"))return;cache_icons={};E.off("destroy",E.uninit);E.off("refresh",on_refresh);E.stopListening();E.sp.return();E.clear()};E.init=()=>{if(E.get("inited"))return;cache_icons={};E.set("inited",true);E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.new_etask("be_icon");E.on("destroy",E.uninit);E.on("refresh",on_refresh);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a,"change:enabled",refresh_all);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a,"change:ext.conflict",refresh_all);E.listenTo(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_6__["a"],"change:stamp",refresh_active);E.listenTo(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_6__["a"],"change:rules",refresh_active);E.listenTo(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_6__["a"],"change:tabs_stub_rules",refresh_active);E.listenTo(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default.a,"change:tab_load_err",refresh_active);E.listenTo(_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_11__["a"],"change:mitm_ext_ui_enabled",refresh_active);E.listenTo(_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_11__["a"],"change:mitm_active_manual",refresh_active);E.listenTo(_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_12__["default"],"change:vpn_country",refresh_active);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_8___default.a,"change:active.url change:active.id",refresh_active);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_8___default.a,"updated",o=>{if(!o.info.url&&!o.info.status)return;E.refresh({tab:o.tab})});E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_8___default.a,"completed",o=>{if(!o.frameId&&o.tabId>=0)E.refresh({tabId:o.tabId})});refresh_all()};function refresh_active(){E.refresh({retry:1})}function refresh_all(){icons={};refresh(null);chrome.tabs.query({},tabs=>tabs.forEach(tab=>{var url=tab&&tab.url||"",rule=get_rule(url,tab&&tab.id);if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("enabled")&&(!rule||!rule.enabled||!rule.country))return;refresh(tab)}))}function tab_opt(tab,opt){return assign(opt,tab?{tabId:tab.id}:{})}function set_icon_cb(retry){return function(){if(!_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9___default.a.runtime.last_error)return;var err=_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9___default.a.runtime.last_error.message||_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_9___default.a.runtime.last_error;_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default()("set_icon_err: ",err);if(!underscore__WEBPACK_IMPORTED_MODULE_0___default.a.isNumber(retry))return;if(retry>0)return E.refresh({retry:retry-1});_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("set_icon_err",{retry:retry},{rate_limit:{count:1},err:err})}}function is_path_eq(a,b){if(!a||!b)return;if(typeof a=="string"||typeof b=="string")return a==b;var keys=Object.keys(a);if(keys.length!=Object.keys(b).length)return;for(var i=0;i<keys.length;i++){if(a[keys[i]]!=b[keys[i]])return}return true}function set_icon(opt,cb){var id=opt.tabId!==undefined?opt.tabId:"global";if(is_path_eq(icons[id],opt.path)&&is_path_eq(icons.global,opt.path))return cb&&cb();icons[id]=opt.path;if(opt.imageData)opt=underscore__WEBPACK_IMPORTED_MODULE_0___default.a.omit(opt,["path"]);chrome.browserAction.setIcon(opt,cb)}function get_rule(url,tab_id){var vpn_country;if(vpn_country=_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_12__["default"].get("vpn_country")){return _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_13__["default"].is_vpn_allowed(url,true)&&{country:vpn_country,enabled:true,type:"protect_pc"}}var stub_rule=tab_id&&_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_6__["a"].get_stub_rule(tab_id);if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.is_stub_rule_enabled(stub_rule,url,_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("is_premium")))return stub_rule;var rule=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_6__["a"].get_rules(url)[0];if(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.is_all_browser(rule)&&!_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_13__["default"].is_vpn_allowed(url,true,undefined,rule)){return}return rule}const load_image=url=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_load_image_(){const img=new Image;img.onload=()=>this.return(img);img.src=url;yield this.wait()}));function smooth_image(image,max_size){var steps=Math.max(image.width,image.height)/max_size>>1;var canvas=document.createElement("canvas");var ctx=canvas.getContext("2d");canvas.width=image.width;canvas.height=image.height;ctx.filter="blur("+steps+"px)";ctx.drawImage(image,0,0);return canvas}function refresh(tab,retry){const cb=set_icon_cb(retry);const images={gray:{19:"bext/vpn/ui/img/icon19_gray.png",38:"bext/vpn/ui/img/icon38_gray.png"},ok:{19:"bext/vpn/ui/img/icon19.png",38:"bext/vpn/ui/img/icon38.png"},mitm_icon:{19:"bext/vpn/ui/img/ic_unblock19.png",38:"bext/vpn/ui/img/ic_unblock38.png"},protect_icon:{19:"bext/vpn/ui/img/ic_protect19.png",38:"bext/vpn/ui/img/ic_protect38.png"},error_icon:{19:"bext/vpn/ui/img/ic_error_19.png",38:"bext/vpn/ui/img/ic_error_38.png"}};if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("enabled")||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("ext.conflict")||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("ext.suspended")){set_icon(tab_opt(tab,{path:images.gray}),cb);chrome.browserAction.setBadgeText(tab_opt(tab,{text:"off"}));chrome.browserAction.setBadgeBackgroundColor(tab_opt(tab,{color:"#FF8800"}));return}const url=tab&&tab.url||"",tab_id=tab&&tab.id;chrome.browserAction.setBadgeText(tab_opt(tab,{text:""}));if(_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_11__["a"].get("default_protect_ui"))return void set_icon(tab_opt(tab,{path:images.protect_icon}),cb);if(_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_11__["a"].get("mitm_ext_ui_enabled")&&_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_11__["a"].get("mitm_active_manual"))return void set_icon(tab_opt(tab,{path:images.mitm_icon}),cb);if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.proxy_error_ui_enabled("icon")&&tab_id&&_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default.a.get_tab_load_err(tab_id)){set_icon(tab_opt(tab,{path:images.error_icon}),cb);return}const rule=get_rule(url,tab_id);if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.get("enabled")||!rule||!rule.enabled||!rule.country){set_icon(tab_opt(tab,{path:images.ok}),cb);if(rule&&!rule.country){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("icon_no_country_err",{url:url,rule:rule},{rate_limit:{count:1}})}return}const img=rule.country.toLowerCase()+".svg";const path=chrome.runtime.getURL("js/svc/vpn/pub/img/flag/svg_4x3/"+img);return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"_refresh",cancel:true},(function*refresh_(){if(!cache_icons[path]){let image=yield load_image(path);const size=(window.devicePixelRatio||1)*32;const canvas=document.createElement("canvas");const ctx=canvas.getContext("2d");if(typeof ctx.filter!="undefined")image=smooth_image(image,size);canvas.width=canvas.height=size;let dwidth=size,dheight=size;if(image.width>=image.height)dheight*=image.height/image.width;else dwidth*=image.width/image.height;ctx.drawImage(image,(size-dwidth)/2,(size-dheight)/2,dwidth,dheight);cache_icons[path]={path:path,imageData:ctx.getImageData(0,0,size,size)}}set_icon(tab_opt(tab,cache_icons[path]),cb)}))}E.refresh=o=>E.trigger("refresh",o);function on_refresh(o){if(!E.get("inited"))return;E.sp.spawn({name:"refresh",cancel:true},_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*on_r_(){try{const tab=o&&o.tab?o.tab:o&&o.tabId?yield _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_8___default.a.get_tab(o.tabId):yield _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_8___default.a.active();if(!tab)return;return yield refresh(tab,o&&o.retry)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_icon_refresh_err",{},{err:e})}})))}__webpack_exports__["a"]=E},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){var is_node=typeof module=="object"&&module.exports;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(12),__webpack_require__(11),__webpack_require__(10),__webpack_require__(16),__webpack_require__(93),__webpack_require__(43),__webpack_require__(46),__webpack_require__(23),__webpack_require__(63),__webpack_require__(27)],__WEBPACK_AMD_DEFINE_RESULT__=function(zerr,etask,zutil,date,zws,zevents,rate_limit,zescape,svc_ipc,version_util){const E={},assign=Object.assign,noop=()=>{};class State_machine{constructor(){}start(opt){if(this.et)return;this.rl_ctx={};this.events=new zevents.EventEmitter;this.events.on("data",data=>{if(zutil.equal_deep(this.svc_info,data))return;this.svc_info=data;if(data)this.last_svc_info=data;if(opt.watch)opt.watch(data)});this.events.on("datapart",part=>this.events.emit("data",assign({},this.last_svc_info,part)));this.opt=assign({components:["client"]},opt,{log:this.proxy_log(opt.log),perr:this.proxy_perr(opt.perr),events:this.events});this.state={name:"polling",opt:assign({startup:true},this.opt)};this.states={polling:this.state_polling,listening:this.state_listening};this.opt.log("starting svc detection");this.et=etask({cancel:true,state0_args:[this]},(function*(_this){this.on("uncaught",e=>_this.opt.log("exception in main etask:"+zerr.e2s(e)));while(true){let r=yield _this.states[_this.state.name](_this.state.opt);_this.state=_this.change_state(r)}}));return this.et}stop(){if(!this.et)return;this.opt.log("svc detection shutdown");this.state.opt.shutdown=true;this.et.return();this.et=this.events=this.opt=this.state=this.rl_ctx=this.svc_info=this.last_svc_info=undefined}proxy_log(fn){fn=fn||noop;this.log_tail=[];return str=>{this.log_tail.push(str);this.log_tail.splice(0,this.log_tail.length-100);return fn(str)}}proxy_perr(fn){fn=fn||noop;return(id,info)=>{info=assign({log_tail:this.log_tail.join("\n")},info);return fn(id,info)}}reconf(opt){let changes=zutil.pick(opt,"monitoring_interval","detecting_interval","state_toggle_rl_n","state_toggle_rl_sec");if(!Object.keys(changes).find(k=>changes[k]!=this.opt[k]))return;assign(this.opt,changes);assign(this.state.opt,changes);setTimeout(()=>this.events.emit("wakeup"),0)}change_state(res){if(this.state.name=="listening"&&res.next=="polling"){let rl_n=this.opt.state_toggle_rl_n||5;let rl_ms=(this.opt.state_toggle_rl_sec||60)*date.ms.SEC;if(!rate_limit(this.rl_ctx,rl_ms,rl_n)){this.opt.log("reconnect loop detected, disabling ws");this.opt.perr("svc_monitor_reconnect_loop");assign(res,{next:"polling",ignore_ws:true})}}this.opt.log(`changing state to ${res.next}`);this.opt.perr("svc_monitor_changeto_"+res.next);return{name:res.next,opt:zutil.omit(res,"next")}}state_polling(opt){return etask({cancel:true},(function*state_polling(){this.on("uncaught",e=>{opt.log("exception in polling state: "+zerr.e2s(e));opt.perr("svc_monitor_etask_err",{err:zerr.e2s(e),source:"state_polling"})});let data,waiting_sec,fail_count=0;let qs=opt.components.includes("vpn")?"?vpn=1":"";let on_wakeup=()=>waiting_sec&&this.continue();opt.events.on("wakeup",on_wakeup);this.finally(()=>opt.events.off("wakeup",on_wakeup));while(true){try{data=(yield svc_ipc.ajax("callback.json"+qs)).ret}catch(e){data=undefined}if(data&&!opt.is_connected||!data&&opt.is_connected){opt.startup=false;opt.is_connected=!!data;opt.log(`svc ${opt.is_connected?"found":"disappeared"}`)}if(data){opt.events.emit("data",data);if(!opt.ignore_ws&&data.ws_port_js)break}else{fail_count++;opt.events.emit("data",undefined)}let is_start=opt.startup&&opt.detecting_start_retries&&fail_count<opt.detecting_start_retries;waiting_sec=opt.is_connected?opt.monitoring_interval:is_start?opt.detecting_start_interval:opt.detecting_interval;opt.events.emit("sleep");try{yield this.wait(waiting_sec*date.ms.SEC)}catch(e){}waiting_sec=0}opt.log(`detected ws server on port ${data.ws_port_js}, switching to `+`listening mode`);return assign(opt,{next:"listening",ws_port:data.ws_port_js,svc_ver:data.ver})}))}state_listening(opt){return etask({cancel:true},(function*state_listening(){let _this=this;this.on("uncaught",e=>{opt.log("exception in listening state: "+zerr.e2s(e));opt.perr("svc_monitor_etask_err",{err:zerr.e2s(e),source:"state_listening"})});this.finally(()=>client.close());let ws_url=version_util.cmp(opt.svc_ver,"1.155.300")<=0?`wss://localhost.h-local.org:${opt.ws_port}`:`ws://127.0.0.1:${opt.ws_port}`;let client=opt.client=new zws.Client(ws_url,{ipc_client:{vpn_connect:"post",vpn_disconnect:"post",vpn_change_agent:"post",vpn_status:"call",push_subscribe:"call"},ipc_server:{push_notify:msg=>{opt.log(msg.init?"received initial status update":"received status update"+((msg.changed||[]).length?" for "+msg.changed.join(","):""));opt.log(JSON.stringify(msg.data));opt.events.emit("datapart",msg.data)}},mux:true});opt.log(`connecting to ${ws_url}`);client.on("connected",()=>etask((function*on_connected(){opt.log(`connected to ${ws_url}`);let sub_res={},sub_opt={components:opt.components};try{sub_res=yield client.ipc.push_subscribe(sub_opt)}catch(e){}if(sub_res.status!="success"){opt.log("failed to subscribe for svc push notifications, "+"switching back to polling mode");opt.perr("svc_monitor_subscribe_failed",{ret:sub_res});return _this.continue({next:"polling",ignore_ws:true})}opt.log("svc push notifications enabled");opt.ws_client=client})));client.on("disconnected",()=>{opt.ws_client=null;if(opt.shutdown)return;opt.log(`disconnected from ${ws_url}, switching to polling mode`);this.continue({next:"polling"})});return assign(opt,yield this.wait())}))}exec(cmd,params){return etask({state0_args:[this]},(function*exec(_this){if(cmd=="callback"){let data=yield _this.refresh_info();return data?{ret:data}:undefined}let ws_client;if((ws_client=_this.state.opt.ws_client)&&ws_client.ipc[cmd]&&!_this.opt.prefer_http_exec){try{return{ret:yield ws_client.ipc[cmd](params)}}catch(e){_this.opt.perr("svc_monitor_ws_err",{err:zerr.e2s(e),cmd:cmd})}}params=params?`?${zescape.qs(params)}`:"";return svc_ipc.ajax(`${cmd}.json${params}`)}))}get_info(){return this.svc_info}get_last_info(){return this.last_svc_info}refresh_info(){if(!this.et)return;if(this.state.name=="listening")return this.get_info();let _this=this;return etask((function*refresh_info(){this.on("uncaught",e=>{_this.opt.log("refresh_info exception: "+zerr.e2s(e));_this.opt.perr("svc_monitor_etask_err",{err:zerr.e2s(e),source:"refresh_info"})});let continue_fn=()=>this.continue();_this.events.on("data",continue_fn);_this.events.on("sleep",continue_fn);setTimeout(()=>_this.events.emit("wakeup"),0);yield this.wait(60*date.ms.SEC);_this.events.off("data",continue_fn);_this.events.off("sleep",continue_fn);return _this.get_info()}))}}let sm=new State_machine;E.init=sm.start.bind(sm);E.exec=sm.exec.bind(sm);E.reconf=sm.reconf.bind(sm);E.uninit=sm.stop.bind(sm);E.get_info=sm.get_info.bind(sm);E.get_last_info=sm.get_last_info.bind(sm);E.refresh_info=sm.refresh_info.bind(sm);E.t={State_machine:State_machine};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){let next_tick;let is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";if(is_rn){}else if(!is_node){next_tick=function(){var can_set_immediate=typeof window!=="undefined"&&window.setImmediate;var can_post=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(can_set_immediate)return function(f){return window.setImmediate(f)};if(can_post){var queue=[];window.addEventListener("message",(function(ev){var source=ev.source;if((source===window||source===null)&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}}),true);return function(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function(fn){setTimeout(fn,0)}}()}else;next_tick=next_tick||process.nextTick;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(65),__webpack_require__(11),__webpack_require__(43),__webpack_require__(31),__webpack_require__(12)],__WEBPACK_AMD_DEFINE_RESULT__=function(conv,etask,events,string,zerr){const ef=etask.ef;const{assign:assign}=Object;const zjson_opt={func:false,date:true,re:true};const is_win=/^win/.test((is_node||is_rn)&&process.platform);const is_darwin=/^darwin/.test((is_node||is_rn)&&process.platform);const default_user_agent=is_node?(()=>{const zconf=require("./config.js");const conf=require("./conf.js");return`Hola ${conf.app}/${zconf.ZON_VERSION}`})():undefined;const debug_str_len=4096;const default_win_size=1048576;const SEC=1e3,MIN=6e4,vfd_sz=8;let zcounter;function noop(){}class WS extends events.EventEmitter{constructor(opt){super();this.ws=undefined;this.data=opt.data;this.connected=false;this.reason=undefined;this.zc_rx=opt.zcounter=="rx"||opt.zcounter=="all";this.zc_tx=opt.zcounter=="tx"||opt.zcounter=="all";this.zc=opt.zcounter?opt.label?`${opt.label}_ws`:"ws":undefined;this.zjson_opt=assign({},zjson_opt,opt.zjson_opt);this.label=opt.label;this.remote_label=undefined;this.local_addr=undefined;this.local_port=undefined;this.remote_addr=undefined;this.remote_port=undefined;this.remote_forwarded=false;this.status="disconnected";this.ping=is_node&&opt.ping!=false;this.ping_interval=typeof opt.ping_interval=="function"?opt.ping_interval():opt.ping_interval||6e4;this.ping_timeout=typeof opt.ping_timeout=="function"?opt.ping_timeout():opt.ping_timeout||1e4;this.ping_timer=undefined;this.ping_last=undefined;this.idle_timeout=opt.idle_timeout;this.idle_timer=undefined;this.ipc=opt.ipc_client?new IPC_client(this,opt.ipc_client,{zjson:opt.ipc_zjson}):undefined;this.time_parse=opt.time_parse;if(opt.ipc_server){new IPC_server(this,opt.ipc_server,{zjson:opt.ipc_zjson,sync:opt.ipc_sync})}this.mux=opt.mux?new Mux(this,opt.backpressuring):undefined;if(this.zc&&!zcounter)zcounter=require("./zcounter.js")}send(msg){if(zerr.is.debug()){zerr.debug(typeof msg=="string"?`${this}> str: ${string.trunc(msg,debug_str_len)}`:`${this}> buf: ${msg.length} bytes`)}if(!this.connected){if(zerr.is.info())zerr.info(`${this}: sending failed: disconnected`);return false}if(this.ws.readyState==2){if(zerr.is.info())zerr.info(`${this}: sending failed: socket closing`);return false}this._update_idle();this.ws.send(msg);if(this.zc_tx){zcounter.inc(`${this.zc}_tx_msg`);zcounter.inc(`${this.zc}_tx_bytes`,msg.length);zcounter.avg(`${this.zc}_tx_bytes_per_msg`,msg.length)}return true}json(data){return this.send(JSON.stringify(data))}zjson(data,ttl){return this.send(conv.JSON_stringify(data,this.zjson_opt))}_check_status(){let prev=this.status;this.status=this.ws?this.connected?"connected":"connecting":"disconnected";if(this.status!=prev){this.emit(this.status);this.emit("status",this.status);if(this.status=="disconnected")this._on_disconnected()}}_on_disconnected(){this.emit("destroyed")}_assign(ws){this.ws=ws;this.ws.onopen=this._on_open.bind(this);this.ws.onclose=this._on_close.bind(this);this.ws.onmessage=this._on_message.bind(this);this.ws.onerror=this._on_error.bind(this);if(is_node){this.ws.on("upgrade",this._on_upgrade.bind(this));this.ws.on("unexpected-response",this._on_unexpected_response.bind(this))}if(this.ping)this.ws.on("pong",this._on_pong.bind(this))}abort(code,reason){this.reason=reason||code;let msg=`${this}: closed locally`;if(this.reason)msg+=` (${this.reason})`;if(!is_node&&!is_rn&&!(code==1e3||code>=3e3&&code<5e3))code+=3e3;this._close(true,code,reason);zerr.warn(msg);if(this.zc&&code)zcounter.inc(`${this.zc}_err_${code}`);this._check_status()}_close(close,code,reason){if(!this.ws)return;if(this.ping){clearTimeout(this.ping_timer);this.ping_timer=undefined;this.ping_last=undefined;this.ws.removeAllListeners("pong")}this.ws.onopen=undefined;this.ws.onclose=undefined;this.ws.onmessage=undefined;this.ws.onerror=noop;if(is_node){this.ws.removeAllListeners("unexpected-response");this.ws.removeAllListeners("upgrade")}this.local_addr=undefined;this.local_port=undefined;this.remote_addr=undefined;this.remote_port=undefined;if(close){if(this.ws.terminate&&(!this.connected||code==-2)){zerr.notice(`${this}: ws.terminate`);this.ws.terminate()}else{zerr.notice(`${this}: ws.close`);this.ws.close(code,reason)}}this.ws=undefined;this.connected=false}toString(){let res=this.label?`${this.label} WS`:"WS";if(this.remote_label||this.remote_addr)res+=" (";if(this.remote_label)res+=this.remote_label;if(this.remote_label&&this.remote_addr)res+=" ";if(this.remote_addr)res+=this.remote_addr;if(this.remote_label||this.remote_addr)res+=")";return res}_on_open(){if(this.connected)return;this.connected=true;let sock=this.ws._socket||{};this.local_addr=sock.localAddress;this.local_port=sock.localPort;if(this.remote_addr==sock.remoteAddress)this.remote_forwarded=false;if(!this.remote_forwarded){this.remote_addr=sock.remoteAddress;this.remote_port=sock.remotePort}zerr.notice(`${this}: connected`);if(this.ping){this.ping_timer=setTimeout(this._ping.bind(this),this.ping_interval)}this._check_status()}_on_close(event){this.reason=event.reason||event.code;zerr.notice(`${this}: closed by remote (${this.reason})`);this._close();this._check_status()}_on_error(event){this.reason=event.message||"Network error";zerr(`${this}: ${this.reason}`);if(this.zc)zcounter.inc(`${this.zc}_err`);this._close();this._check_status()}_on_unexpected_response(req,resp){this._on_error({message:"unexpected response"})}_on_upgrade(resp){zerr.notice(`${this}: upgrade conn`)}_on_message(event){let msg=event.data,handled=false;if(msg instanceof ArrayBuffer)msg=Buffer.from(Buffer.from(msg));if(zerr.is.debug()){zerr.debug(typeof msg=="string"?`${this}< str: ${string.trunc(msg,debug_str_len)}`:`${this}< buf: ${msg.length} bytes`)}if(this.zc_rx){zcounter.inc(`${this.zc}_rx_msg`);zcounter.inc(`${this.zc}_rx_bytes`,msg.length);zcounter.avg(`${this.zc}_rx_bytes_per_msg`,msg.length)}try{if(typeof msg=="string"){if(this._events.zjson){let parsed;if(this.zc&&this.time_parse){let started=Date.now();parsed=conv.JSON_parse_unsafe(msg,this.zjson_opt);zcounter.inc(`${this.zc}_parse_zjson_ms`,Date.now()-started)}else parsed=conv.JSON_parse_unsafe(msg,this.zjson_opt);this.emit("zjson",parsed);handled=true}if(this._events.json){let parsed,started;if(this.zc&&this.time_parse)started=Date.now();parsed=JSON.parse(msg);if(this.zc&&this.time_parse){zcounter.inc(`${this.zc}_parse_json_ms`,Date.now()-started)}this.emit("json",parsed);handled=true}if(this._events.text){this.emit("text",msg);handled=true}}else{if(this._events.bin){this.emit("bin",msg);handled=true}}if(this._events.raw){this.emit("raw",msg);handled=true}}catch(e){ef(e);zerr(`${this}: ${zerr.e2s(e)}`);return this.abort(1011,e.message)}if(!handled)this.abort(1003,"Unexpected message");this._update_idle();if(this.ping_last){clearTimeout(this.ping_timer);this.ping_timer=setTimeout(this._ping_expire.bind(this),this.ping_timeout)}}_on_pong(){clearTimeout(this.ping_timer);let rtt=Date.now()-this.ping_last;this.ping_last=undefined;this.ping_timer=setTimeout(this._ping.bind(this),Math.max(this.ping_interval-rtt,0));if(zerr.is.debug())zerr.debug(`${this}< pong (rtt ${rtt}ms)`);if(this.zc)zcounter.avg(`${this.zc}_ping_ms`,rtt)}_ping(){if(this.ws.readyState==2)return;this.ws.ping();this.ping_timer=setTimeout(this._ping_expire.bind(this),this.ping_timeout);this.ping_last=Date.now();if(zerr.is.debug())zerr.debug(`${this}> ping (max ${this.ping_timeout}ms)`)}_ping_expire(){this.abort(1002,"Ping timeout")}_idle(){if(this.zc)zcounter.inc(`${this.zc}_idle_timeout`);this.emit("idle_timeout");this.abort(1002,"Idle timeout")}_update_idle(){this.idle_since=Date.now();if(this.idle_timeout){clearTimeout(this.idle_timer);this.idle_timer=setTimeout(this._idle.bind(this),this.idle_timeout)}}close(code,reason){if(!this.ws)return;let msg=`${this}: closed locally`;if(reason||code)msg+=` (${reason||code})`;this._close(true,code,reason);zerr.notice(msg);if(this.zc&&code)zcounter.inc(`${this.zc}_err_${code}`);this._check_status()}inspect(){return{class:this.constructor.name,label:this.toString(),status:this.status,reason:this.reason,local_addr:this.local_addr,local_port:this.local_port,remote_addr:this.remote_addr,remote_port:this.remote_port}}}class Client extends WS{constructor(url,opt={}){super(opt);this.status="connecting";this.impl=client_impl(opt);this.url=url;this.retry_interval=opt.retry_interval||1e4;this.retry_max=opt.retry_max||this.retry_interval;this.next_retry=this.retry_interval;this.no_retry=opt.no_retry;if(is_node){this.headers=assign({"User-Agent":opt.user_agent||default_user_agent},opt.headers)}this.deflate=!!opt.deflate;if(opt.proxy){let _lib=require("https-proxy-agent");this.agent=new _lib(opt.proxy)}else this.agent=opt.agent;this.reconnect_timer=undefined;this.handshake_timeout=opt.handshake_timeout===undefined?1e4:opt.handshake_timeout;this.handshake_timer=undefined;if(this.zc)zcounter.inc_level(`level_${this.zc}_online`,0,"sum");this._connect()}_on_disconnected(){}_assign(ws){super._assign(ws);if(this.zc)zcounter.inc_level(`level_${this.zc}_online`,1,"sum")}_close(close,code,reason){if(this.zc&&this.ws)zcounter.inc_level(`level_${this.zc}_online`,-1,"sum");if(this.handshake_timer)this.handshake_timer=clearTimeout(this.handshake_timer);super._close(close,code,reason)}_connect(){this.reason=undefined;this.reconnect_timer=undefined;let opt={headers:this.headers};if(!is_rn){opt.agent=this.agent;opt.perMessageDeflate=this.deflate}zerr.notice(`${this}: connecting to ${this.url}`);this._assign(new this.impl(this.url,undefined,opt));if(this.handshake_timeout){this.handshake_timer=setTimeout(()=>this.abort(1002,"Handshake timeout"),this.handshake_timeout)}this._check_status()}_reconnect(){if(this.no_retry)return false;let delay=this.next_retry;if(typeof delay=="function")delay=delay();else{this.next_retry=Math.min(delay*2,typeof this.retry_max=="function"?this.retry_max():this.retry_max)}if(zerr.is.info())zerr.info(`${this}: will retry in ${delay}ms`);this.reconnect_timer=setTimeout(()=>this._connect(),delay)}_on_open(){if(this.handshake_timer)this.handshake_timer=clearTimeout(this.handshake_timer);this.next_retry=this.retry_interval;super._on_open()}_on_close(event){this._reconnect();super._on_close(event)}_on_error(event){this._reconnect();super._on_error(event)}abort(code,reason){this._reconnect();super.abort(code,reason)}close(code,reason){if(this.ws)this.emit("destroyed");super.close(code,reason);if(this.reconnect_timer){clearTimeout(this.reconnect_timer);this.reconnect_timer=undefined;this.emit("destroyed")}}inspect(){return assign(super.inspect(),{url:this.url,retry_interval:this.retry_interval,retry_max:this.retry_max,next_retry:this.next_retry,handshake_timeout:this.handshake_timeout,deflate:this.deflate,reconnecting:!!this.reconnect_timer})}}class Server{constructor(opt={},handler=undefined){this.handler=handler;let ws_opt={server:opt.http_server,host:opt.host||"0.0.0.0",port:opt.port,noServer:!opt.http_server&&!opt.port,path:opt.path,clientTracking:false,perMessageDeflate:!!opt.deflate};if(opt.max_payload)ws_opt.maxPayload=opt.max_payload;if(opt.verify)ws_opt.verifyClient=opt.verify;this.ws_server=new(server_impl(opt))(ws_opt);this.opt=opt;this.label=opt.label;this.connections=new Set;this.zc=opt.label?`${opt.label}_ws`:"ws";this.ws_server.addListener("connection",this.accept.bind(this));if(opt.port)zerr.notice(`${this}: listening on port ${opt.port}`);if(!zcounter)zcounter=require("./zcounter.js");zcounter.inc_level(`level_${this.zc}_conn`,0,"sum")}toString(){return this.label?`${this.label} WS server`:"WS server"}upgrade(req,socket,head){this.ws_server.handleUpgrade(req,socket,head,ws=>this.accept(ws,req))}accept(ws,req=ws.upgradeReq){if(!ws._socket.remoteAddress){ws.onerror=noop;return zerr.warn(`${this}: dead incoming connection`)}let headers=req&&req.headers||{};if(this.opt.origin_whitelist){if(!this.opt.origin_whitelist.includes(headers.origin)){if(ws._socket.destroy)ws._socket.destroy();else if(ws.terminate)ws.terminate();return zerr.notice("incoming conn from %s rejected",headers.origin||"unknown origin")}zerr.notice("incoming conn from %s",headers.origin)}let zws=new WS(this.opt);if(this.opt.trust_forwarded){let forwarded=headers["x-real-ip"];if(!forwarded){forwarded=headers["x-forwarded-for"];if(forwarded){let ips=forwarded.split(",");forwarded=ips[ips.length-1]}}if(forwarded){zws.remote_addr=forwarded;zws.remote_forwarded=true}}let ua=headers["user-agent"];let m=/^Hola (.+)$/.exec(ua);zws.remote_label=m?m[1]:ua?"web":undefined;zws._assign(ws);zws._on_open();this.connections.add(zws);zcounter.inc(`${this.zc}_conn`);zcounter.inc_level(`level_${this.zc}_conn`,1,"sum");zws.addListener("disconnected",()=>{this.connections.delete(zws);zcounter.inc_level(`level_${this.zc}_conn`,-1,"sum")});if(this.handler){try{zws.data=this.handler(zws,req)}catch(e){ef(e);zerr(zerr.e2s(e));return zws.close(1011,String(e))}}return zws}broadcast(msg){if(zerr.is.debug()){zerr.debug(typeof msg=="string"?`${this}> broadcast str: ${string.trunc(msg,debug_str_len)}`:`${this}> broadcast buf: ${msg.length} bytes`)}for(let zws of this.connections)zws.send(msg)}broadcast_json(data){if(this.connections.size)this.broadcast(JSON.stringify(data))}broadcast_zjson(data){if(this.connections.size)this.broadcast(conv.JSON_stringify(data,zjson_opt))}close(code,reason){zerr.notice(`${this}: closed`);this.ws_server.close();for(let zws of this.connections)zws.close(code,reason)}inspect(){let connections=[];for(let c of this.connections)connections.push(c.inspect());return{class:this.constructor.name,label:this.toString(),opt:this.opt,connections:connections}}}class IPC_client{constructor(zws,names,opt={}){this._ws=zws;this._pending=new Map;this._ws.addListener(opt.zjson?"zjson":"json",this._on_resp.bind(this));this._ws.addListener("status",this._on_status.bind(this));this._ws.addListener("destroyed",this._on_status.bind(this,"destroyed"));if(Array.isArray(names)){for(let name of names)this[name]=this._call.bind(this,opt,name)}else{for(let name in names){let spec=names[name];if(typeof spec=="string")spec={type:spec};let _opt=assign({},opt,spec);switch(_opt.type||"call"){case"call":this[name]=this._call.bind(this,_opt,name);break;case"post":this[name]=this._post.bind(this,_opt,name);break;default:zerr.zexit(`${this._ws}: ${name}: Invalid IPC client spec`)}}}}_call(opt,cmd,...arg){let _this=this;let timeout=opt.timeout||5*MIN;let send_retry_timeout=3*SEC;return etask((function*IPC_client_call(){let req={type:"ipc_call",cmd:cmd,cookie:++IPC_client._cookie};if(arg.length==1)req.msg=arg[0];else if(arg)req.arg=arg;this.info.label=()=>_this._ws.toString();this.info.cmd=cmd;this.info.cookie=req.cookie;_this._pending.set(req.cookie,this);this.finally(()=>_this._pending.delete(req.cookie));this.alarm(timeout,()=>this.throw(new Error(`${cmd} timeout`)));let res={status:_this._ws.status},prev;let send=_this._ws[opt.zjson?"zjson":"json"].bind(_this._ws);while(res.status){switch(res.status){case"disconnected":if(opt.retry==false||!_this._ws.reconnect_timer)throw new Error(_this._ws.reason||"Connection closed");break;case"connecting":if(opt.retry==false)throw new Error("Connection not ready");break;case"destroyed":throw new Error(_this._ws.reason||"Connection closed");case"connected":while(!send(req))yield etask.sleep(send_retry_timeout);break}do{prev=res.status;res=yield this.wait()}while(prev==res.status)}return res.value}))}_post(opt,cmd,...arg){let req={type:"ipc_post",cmd:cmd};if(arg.length==1)req.msg=arg[0];else if(arg)req.arg=arg;if(opt.zjson)this._ws.zjson(req);else this._ws.json(req)}_on_resp(msg){if(!msg||msg.type!="ipc_result"&&msg.type!="ipc_error")return;let task=this._pending.get(msg.cookie);if(!task){return zerr.info(`${this._ws}: `+`unexpected IPC cookie ${msg.cookie}`)}if(msg.type=="ipc_result")task.continue({value:msg.msg});else task.throw(new Error(msg.msg))}_on_status(status){for(let task of this._pending.values())task.continue({status:status})}}IPC_client._cookie=0;class IPC_server{constructor(zws,methods,opt={}){this.ws=zws;if(Array.isArray(methods)){this.methods={};for(let m of methods)this.methods[m]=true}else this.methods=methods;this.zjson=!!opt.zjson;this.sync=!!opt.sync;this.pending=this.sync?undefined:new Set;this.ws.addListener(this.zjson?"zjson":"json",this._on_call.bind(this));if(!this.sync){this.ws.addListener("disconnected",this._on_disconnected.bind(this))}}_on_call(msg){if(!msg||!msg.cmd)return;let type=msg.type||"ipc_call",cmd=msg.cmd;if(type!="ipc_call"&&type!="ipc_post")return;let method=this.methods.hasOwnProperty(cmd)&&this.methods[cmd];if(method==true)method=this.ws.data[cmd];if(!method){let err=`Method ${cmd} not defined`;if(type=="ipc_post")return zerr(`${this.ws}: ${err}`);return this.ws.json({type:"ipc_error",cmd:cmd,cookie:msg.cookie,msg:err})}let arg=msg.arg||[msg.msg];let _this=this;etask((function*IPC_server_on_call(){if(!_this.sync&&type=="ipc_post"){_this.pending.add(this);this.finally(()=>_this.pending.delete(this))}this.info.label=()=>_this.ws.toString();this.info.cmd=cmd;this.info.cookie=msg.cookie;try{let rv=method.apply(_this.ws.data||_this.ws,arg);if(!_this.sync)rv=yield rv;if(type=="ipc_post")return;let res={type:"ipc_result",cmd:cmd,cookie:msg.cookie,msg:rv};if(_this.zjson)_this.ws.zjson(res);else _this.ws.json(res)}catch(e){if(type=="ipc_post")return zerr(`${_this.ws}: ${cmd}: ${zerr.e2s(e)}`);_this.ws.json({type:"ipc_error",cmd:cmd,cookie:msg.cookie,msg:e.message||String(e)})}}))}_on_disconnected(){for(let task of this.pending)task.return()}}class Mux{constructor(zws,backpressuring=false){this.ws=zws;this.backpressuring=backpressuring;this.streams=new Map;this.ws.on("bin",this._on_bin.bind(this));this.ws.on("json",this._on_json.bind(this));this.ws.on("disconnected",this._on_disconnected.bind(this))}open(vfd,bytes_allowed=Infinity,opt={}){this.ignore_unexpected_acks=opt.ignore_unexpected_acks;return this.streams.get(vfd)||(opt.use_ack?this.open_ack(vfd,opt):this.open_bp(vfd,bytes_allowed,opt))}open_bp(vfd,bytes_allowed,opt={}){const _lib=require("stream");let _this=this,suspended;const stream=new _lib.Duplex(assign({read(size){},write(data,encoding,cb){if(bytes_allowed<=0){suspended=()=>this._write(data,encoding,cb);return}if(zerr.is.debug())zerr.debug(`${_this.ws}> vfd ${vfd}`);bytes_allowed-=data.length;let buf=Buffer.allocUnsafe(data.length+vfd_sz);buf.writeUInt32BE(vfd,0);buf.writeUInt32BE(0,4);data.copy(buf,vfd_sz);cb(_this.ws.send(buf)?undefined:new Error(_this.ws.reason||_this.ws.status));this.last_use_ts=Date.now()},destroy(err,cb){try{stream.push(null)}catch(e){zerr.notice("DEBUG RECURSIVE DESTROY "+e)}stream.end();this.emit("_close");next_tick(cb,err)}},opt));let _stacktrace=(new Error).stack;stream.create_ts=Date.now();stream.prependListener("data",(function(chunk){if(_this.backpressuring&&this.readableLength<=this.readableHighWaterMark>>1){_this.remote_write_resume(vfd)}this.last_use_ts=Date.now();if(!this._httpMessage||this.parser&&this.parser.socket===this||is_rn){return}const{parsers:parsers}=require("_http_common");zcounter.inc(`mux_no_parser`);zerr("\n--- assert failed, socketinfo:\n"+`DEBUG HEADER: ${this._httpMessage._header}\n`+`DEBUG mux.open(): ${_stacktrace}\n`+`DEBUG WS: ${_this.ws.remote_addr}:${_this.ws.remote_port}`);const old_parser=this.parser;const parser=this.parser=parsers.alloc();const old_execute=parser.execute;parser.socket=this;parser.execute=buf=>{parser.execute=old_execute;this.parser=old_parser;return new Error("Mux Duplex parser removed before data "+"consumed")}}));stream.allow=(bytes=Infinity)=>{bytes_allowed=bytes;if(bytes_allowed>0&&suspended){suspended();suspended=undefined}if(_this.ws.zc)zcounter.inc("mux_write_"+(bytes>0?"allow":"disallow"))};stream.on("_close",()=>{if(this.streams.delete(vfd)){zerr.info(`${this.ws}: vfd ${vfd} closed`);if(this.ws.zc)zcounter.inc_level(`level_${this.ws.zc}_mux_vfd`,-1)}});this.streams.set(vfd,stream);zerr.info(`${this.ws}: vfd ${vfd} open`);if(this.ws.zc)zcounter.inc_level(`level_${this.ws.zc}_mux_vfd`,1);return stream}open_ack(vfd,opt={}){const _lib=require("stream");const _this=this;opt.fin_timeout=opt.fin_timeout||10*SEC;const w_log=(e,str)=>zerr.warn(`${_this.ws}: ${str}: ${vfd}-${zerr.e2s(e)}`);let pending,zfin_pending,send_ack_timeout,send_ack_ts=0;const stream=new _lib.Duplex(assign({read(size){},write(data,encoding,cb){const{buf:buf,buf_pending:buf_pending}=stream.process_data(data);if(buf){if(!_this.ws.send(buf))return cb(new Error(_this.ws.reason||_this.ws.status));stream.sent+=buf.length-vfd_sz;stream.last_use_ts=Date.now()}if(zerr.is.debug()){zerr.debug(`${_this.ws}> vfd ${vfd} sent ${stream.sent}`+` ack ${stream.ack} win_size ${stream.win_size}`)}if(!buf_pending)return void cb();pending=etask((function*_ws_mux_pending(){yield this.wait();pending=null;stream._write(buf_pending,encoding,cb)}))},destroy(err,cb){return etask((function*_ws_mux_destroy(){if(stream.zdestroy){yield this.wait_ext(stream.zdestroy);return next_tick(cb,err)}stream.zdestroy=this;stream.prependListener("error",()=>{if(stream._writableState)stream._writableState.errorEmitted=true});yield zfinish(true,false);try{stream.push(null)}catch(e){zerr.notice("DEBUG RECURSIVE DESTROY "+e)}stream.emit("_close");next_tick(cb,err)}))}},opt));stream.allow=size=>{if(stream.win_size_got)return;stream.win_size=size||Infinity;if(!size&&_this.ws.zc)zcounter.inc("mux_legacy_allow_call")};stream.process_data=data=>{let bytes=Math.min(stream.win_size-(stream.sent-stream.ack),data.length);if(bytes<=0)return{buf_pending:data};const buf=Buffer.allocUnsafe(bytes+vfd_sz);buf.writeUInt32BE(vfd,0);buf.writeUInt32BE(0,4);data.copy(buf,vfd_sz,0,bytes);if(bytes==data.length)return{buf:buf};const buf_pending=Buffer.allocUnsafe(data.length-bytes);data.copy(buf_pending,0,bytes);return{buf:buf,buf_pending:buf_pending}};const zfinish=(end_write,wait_rmt)=>etask((function*_zfinish(){if(stream.zfin)return yield this.wait_ext(stream.zfin);stream.zfin=this;zerr.info(`${_this.ws}:vfd:${vfd}:zfin:${end_write}:${wait_rmt}`);if(end_write&&(!stream._writableState||!stream._writableState.finished)){if(pending)pending.continue();stream.once("finish",this.continue_fn());try{yield this.wait(opt.fin_timeout/2)}catch(e){w_log(e,"fin_wait");stream.end();try{yield this.wait(opt.fin_timeout/2)}catch(e2){w_log(e2,"fin_wait2")}}}if(pending&&!etask.is_final(pending)){try{pending.return();pending=null}catch(e){w_log(e,"destroy write pending")}stream.emit("error",new Error("Fail to write pending data"))}stream.send_fin();if(wait_rmt){try{yield zfin_pending=this.wait(opt.fin_timeout)}catch(e){w_log(e,"zfin_pending")}}if(stream.destroy)stream.destroy()}));stream.create_ts=Date.now();stream.win_size=default_win_size;stream.sent=stream.ack=stream.zread=0;stream.prependListener("finish",()=>zfinish(false,true));stream.prependListener("data",(function(chunk){this.zread+=chunk.length;this.send_ack();this.last_use_ts=Date.now();if(!this._httpMessage||this.parser&&this.parser.socket===this||is_rn){return}const{parsers:parsers}=require("_http_common");const _stacktrace=(new Error).stack;zcounter.inc(`mux_ack_no_parser`);zerr("\n--- assert failed, socketinfo:\n"+`DEBUG HEADER: ${this._httpMessage._header}\n`+`DEBUG mux.open(): ${_stacktrace}\n`+`DEBUG WS: ${_this.ws.remote_addr}:${_this.ws.remote_port}`);const old_parser=this.parser;const parser=this.parser=parsers.alloc();const old_execute=parser.execute;parser.socket=this;parser.execute=buf=>{parser.execute=old_execute;this.parser=old_parser;return new Error("Mux Duplex parser removed before data "+"consumed")}}));const throttle_ack=+opt.throttle_ack;const _send_ack=()=>{_this.ws.json({vfd:vfd,ack:stream.zread});send_ack_ts=Date.now()};stream.send_ack=!throttle_ack?_send_ack:()=>{if(send_ack_timeout)return;const delta=Date.now()-send_ack_ts;if(delta>=throttle_ack)return _send_ack();send_ack_timeout=setTimeout(()=>{send_ack_timeout=null;_send_ack()},throttle_ack-delta)};stream.on_ack=ack=>{stream.ack=ack;if(pending)pending.continue()};stream.send_win_size=()=>{if(stream.win_size_sent)return;_this.ws.json({vfd:vfd,win_size:opt.win_size||default_win_size});stream.win_size_sent=true};stream.on_win_size=size=>{stream.win_size=size;stream.win_size_got=true;if(pending)pending.continue()};stream.send_fin=()=>{_this.ws.json({vfd:vfd,fin:1})};stream.on_fin=()=>{const fn=()=>next_tick(()=>zfin_pending?zfin_pending.continue():zfinish(true,false));etask((function*_ws_mux_stream_destroy(){stream.once("end",this.continue_fn());try{stream.push(null);if(stream._readableState&&stream._readableState.ended)return fn();yield this.wait(opt.fin_timeout)}catch(e){w_log(e,"ending")}fn()}))};stream.on("_close",()=>{if(!this.streams.delete(vfd))return;zerr.info(`${this.ws}: vfd ${vfd} closed`);if(this.ws.zc)zcounter.inc_level(`level_${this.ws.zc}_mux_ack_vfd`,-1)});this.streams.set(vfd,stream);zerr.info(`${this.ws}: vfd ${vfd} open`);if(this.ws.zc)zcounter.inc_level(`level_${this.ws.zc}_mux_ack_vfd`,1);return stream}close(vfd){let stream=this.streams.get(vfd);if(!stream)return false;if(stream.destroy)stream.destroy();else{stream.push(null);stream.end();stream.emit("_close")}return true}remote_write_pause(id){const stream=this.streams.get(id);if(!stream||stream.remote_write_paused)return;this.ws.json({stream_id:id,backpressure_cmd:"write_pause",log:this.backpressuring.log});stream.remote_write_paused=true;if(this.ws.zc)zcounter.inc("mux_remote_write_pause")}remote_write_resume(id){const stream=this.streams.get(id);if(!stream||!stream.remote_write_paused)return;this.ws.json({stream_id:id,backpressure_cmd:"write_resume",log:this.backpressuring.log});stream.remote_write_paused=false;if(this.ws.zc)zcounter.inc("mux_remote_write_resume")}_on_bin(buf){if(buf.length<vfd_sz)return zerr(`${this.ws}: malformed binary message`);let vfd=buf.readUInt32BE(0);if(zerr.is.debug())zerr.debug(`${this.ws}< vfd ${vfd}`);let stream=this.streams.get(vfd);if(!stream)return zerr(`${this.ws}: unexpected stream vfd ${vfd}`);if(stream.on_ack)this._on_bin_ack(stream,buf);else this._on_bin_bp(stream,buf,vfd)}_on_bin_bp(stream,buf,vfd){if(!stream.push(buf.slice(vfd_sz))&&this.backpressuring)this.remote_write_pause(vfd)}_on_bin_ack(stream,buf){stream.send_win_size();stream.push(buf.slice(vfd_sz))}_on_json(msg){if(msg&&msg.backpressure_cmd)this._on_json_bp(msg);else this._on_json_ack(msg)}_on_json_bp(msg){const stream=this.streams.get(msg.stream_id);if(!stream||!msg.backpressure_cmd)return;if(msg.log)zerr.notice(`${this.ws}: ${msg.backpressure_cmd}`);switch(msg.backpressure_cmd){case"write_pause":return stream.allow(0);case"write_resume":return stream.allow()}}_on_json_ack(msg){if(!msg||msg.vfd===undefined)return;const stream=this.streams.get(msg.vfd);if(!stream)return zerr.info(`${this.ws}: unexpected stream ID %O`,msg);if(msg.ack&&stream.on_ack)return void stream.on_ack(msg.ack);if(msg.win_size&&stream.on_win_size)return void stream.on_win_size(msg.win_size);if(msg.fin&&stream.on_fin)return void stream.on_fin();stream.emit("unexpected_ack",msg);zerr(`${this.ws}: unexpected json_ack %O`,msg);if(this.ws.zc)zcounter.inc("mux_unexpected_ack")}_on_disconnected(){let err=new Error(this.ws.reason||"disconnected");for(let stream of this.streams.values()){if(stream.destroy)stream.destroy(err);else{stream.emit("error",err);stream.emit("_close")}}this.streams.clear()}}function lib(impl){if(impl=="ws")return require("ws");if(impl=="uws"&&!is_win&&!is_darwin)return require("uws");zerr.zexit(`WS library ${impl} is not available`)}function client_impl(opt){if(is_rn)return WebSocket;if(!is_node&&!opt.impl)return self.WebSocket;return lib(opt.impl||"ws")}function server_impl(opt){if(!is_node)throw new Error(`WS server is not available`);return lib(opt.impl||(is_win||is_darwin?"ws":"uws")).Server}return{Client:Client,Server:Server,IPC_client:IPC_client,IPC_server:IPC_server,Mux:Mux,t:{WS:WS}}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON ISC
"use strict";(function(){var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(31)],__WEBPACK_AMD_DEFINE_RESULT__=function(string){var E={};E.from_str=function(s,opt){return E.from_lines(string.split_crlf(s),opt)};E.from_lines=function(l,opt){var last_pos=0,attrib=[],i,m,invalid=false,line;opt=opt||{};for(i=0;i<l.length;i++){if(!(line=l[i])){invalid=true;continue}if(/^\s+/.test(line)){if(!last_pos){invalid=true;continue}attrib[last_pos-1][1]+="\n"+line.trim();continue}if(!(m=line.match(/^([^:]+):([^\n]*)$/))){invalid=true;continue}attrib[last_pos++]=[m[1].trim(),m[2].trim()]}if(invalid&&!opt.allow_invalid)attrib=null;return attrib};E.to_str=function(attrib){var s="",i;for(i=0;i<attrib.length;i++)s+=attrib[i][0]+": "+(""+attrib[i][1]).replace(/\n/,"\n  ")+"\n";return s};E.from_obj=function(obj){var attrib=[],i;for(i in obj)attrib.push([i,""+obj[i]]);return attrib};E.to_obj=function(attrib){var obj={},i;for(i=0;i<attrib.length;i++)obj[attrib[i][0]]=attrib[i][1];return obj};E.to_obj_lower=function(attrib){var obj={},i;for(i=0;i<attrib.length;i++)obj[attrib[i][0].toLowerCase()]=attrib[i][1];return obj};E.to_lower=function(attrib){var a=[];for(var i=0;i<attrib.length;i++)a.push([attrib[i][0].toLowerCase(),attrib[i][1]]);return a};E.get_index=function(attrib,field){for(var i=0;i<attrib.length;i++){if(attrib[i][0]==field)return i}return-1};E.get=function(attrib,field,opt){var res="",sep=opt&&opt.sep,_null=opt&&opt.null?null:"";for(var i=0;i<attrib.length;i++){if(attrib[i][0]==field){if(!sep)return attrib[i][1];res+=(res?sep:"")+attrib[i][1]}}return res||_null};E.get_arr=function(attrib,field){var i,ret=[];for(i=0;i<attrib.length;i++){if(attrib[i][0]==field)ret.push(attrib[i][1])}return ret};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON ISC
"use strict";(function(){var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(23),__webpack_require__(10)],__WEBPACK_AMD_DEFINE_RESULT__=function(zescape,zutil){var E={};E.glob_to_regex_str=function(glob){return"^("+glob.replace(/(\?|\*\*|\*)|([^?*]+)/g,(function(m){return m=="?"?"[^/]":m=="**"?".*":m=="*"?"[^/]*":zescape.regex(m)}))+")$"};E.glob_to_regex=function(glob){return new RegExp(E.glob_to_regex_str(glob))};E.glob_fn=function(glob){var re=E.glob_to_regex(glob);return function(s){return re.test(s)}};E.glob=function(glob,value){return E.glob_fn(glob)(value)};function eat_group(arr,start){for(var c=0,i=start;i<arr.length;i++){if(arr[i].depth)c+=arr[i].depth;if(!c)return arr.splice(start,i-start+1).slice(1,-1)}throw new Error("unbalanced group")}function parse_arr_to_tree(arr,join){function is_join(el){return el.join&&Object.keys(el).length==1}function clean(el){if(!Array.isArray(el.elm))delete el.join;return el}function pass(fn){for(var i=0;i<arr.length;i++){var change;if(change=fn(arr[i],arr[i+1],i))i+=change}}pass((function(el,next,i){if(el.depth)arr.splice(i,0,parse_arr_to_tree(eat_group(arr,i),join))}));pass((function(el,next,i){if(el.fn&&!el.elm)el.elm=arr.splice(i+1,1)[0]}));pass((function(el,next,i){if(is_join(el)){arr[i-1]={join:el.join,elm:[arr[i-1],next].map(clean)};arr.splice(i,2);return-1}if(next&&next.join=="&&"&&!is_join(next)){arr[i]={join:"&&",elm:[el,next].map(clean)};arr.splice(i+1,1)}}));if(arr.length<=1)return arr[0];return{join:join,elm:[arr[0],parse_arr_to_tree(arr.slice(1),join)].map(clean)}}E.match_parse=function(filter,opt){var res=[],o={s:filter},cmp=[],match,i,_plugin;var eat_token=zescape.parse.eat_token;opt=opt||{};var plugin=opt.plugin||[];var join=opt.join||"||";var logical=opt.logical===undefined||opt.logical;token:while(o.s.length){if(opt.eat_white!==false&&eat_token(o,/^\s+/))continue;for(i=0;i<plugin.length;i++){_plugin=plugin[i];if(match=eat_token(o,_plugin.re)){cmp.push({plugin:_plugin,m:match});continue token}}if(match=eat_token(o,/^\/((\\.|[^\\/])+)\/([i]?)(\s|$)/)){cmp.push({re:match[1],re_opt:match[3]});continue}if(match=eat_token(o,/^\S+/)){var m=match[0],l;var _logical={"&&":{join:"&&"},"||":{join:"||"},"!":{fn:"!"},"+":{join:"||"},"-":{fn:"!",join:"&&",wrap_join:true},"(":{fn:"(",depth:1},")":{fn:")",depth:-1,join:""}};if(logical&&(l=_logical[m])){if(l.wrap_join){var depth=0;for(i=cmp.length;i>=0&&depth>=0;i--)depth+=-(l.depth||0);i++;if(i<cmp.length){cmp.splice(i,0,_logical["("]);cmp.push(_logical[")"])}delete l.wrap_join}cmp.push(l)}else if(opt.glob&&/[\[\]*?{}]/.test(m)){cmp.push(opt.glob=="re"?{re:E.glob_to_regex_str(m)}:{glob:m})}else cmp.push({eq:m});continue}E.match_last_error=new Error("invalid token "+o.s)}var have_val=false;cmp.forEach((function(c){var _join=have_val&&join;if(c.eq!==undefined||c.re!==undefined||c.glob!==undefined||c.plugin){have_val=true}else{if(c.join!==undefined)_join=c.join;have_val=false}if(_join)c.join=_join;else delete c.join}));return opt.tree?parse_arr_to_tree(cmp,join):cmp};E.match_fn=function(filter,opt){opt=opt||{};var cmp=E.match_parse(filter,opt),func="return ",i;for(i=0;i<cmp.length;i++){var c=cmp[i];if(c.join)func+=c.join+" ";if(c.re!==undefined){try{var re=new RegExp(c.re,c.re_opt);c=function(s){return this.test(s)}.bind(re)}catch(e){c=function(){return false};E.match_last_error=e}}else if(c.glob!==undefined)c=E.glob_fn(c.glob);else if(c.eq!==undefined)c=function(s){return s===this}.bind(c.eq);else if(c.plugin){c=c.plugin.cmp?c.plugin.cmp.bind(null,c.m):c.plugin.cmp_fn(c.m)}cmp[i]=c;if(typeof c=="function")func+="cmp["+i+"](s, extra) ";else if(c instanceof Object)func+=c.fn?c.fn+" ":"";else throw new Error}if(!cmp.length)func+="false ";func+=";";return new Function(["cmp","s","extra"],func).bind(null,cmp)};E.match=function(filter,value,opt){return E.match_fn(filter,opt)(value,opt&&opt.extra)};E.cmp_norm=function(cmp){return cmp>0?1:cmp<0?-1:0};E.strcmp=function(a,b){return a>b?1:a<b?-1:0};E.strverscmp=function(a,b){var _a,_b,diff,skip_digit=0;for(_a=0,_b=0;_a<a.length&&_b<b.length;_a++,_b++){if(a[_a]==b[_b]&&!zutil.isdigit(a[_b]))continue;if(skip_digit)skip_digit--;if(zutil.isdigit(a[_a])&&zutil.isdigit(b[_b])){var ma=a.substr(_a).match(/\d+/)[0];var mb=b.substr(_b).match(/\d+/)[0];if(diff=+ma-+mb)return diff;skip_digit=ma.length}if(diff=a[_a].charCodeAt()-b[_b].charCodeAt())return diff}return a.length-b.length};E.regexp_merge=function(a){var re=[],i;for(i=0;i<a.length;i++)re.push(a[i]instanceof RegExp?a[i].source:zescape.regex(""+a[i]));return new RegExp("("+re.join(")|(")+")")};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},function(module,__webpack_exports__,__webpack_require__){"use strict";
// LICENSE_CODE ZON
__webpack_exports__["a"]=tpopup_opt=>{const b=window.chrome||typeof browser!="undefined"&&browser;const assign=Object.assign;let port,inited=false;let frame,fade,arrow_anim;let{url:url,type:type,root_url:root_url,connection_id:connection_id,ext_url:ext_url,tab_id:tab_id,country:country}=tpopup_opt;const auto_px={width:1,height:1,top:1,left:1,right:1,bottom:1,"max-width":1,"max-height":1,"min-width":1,"min-height":1};const is_number=n=>!isNaN(parseFloat(n))&&isFinite(n);const set_css=(el,css_styles)=>{Object.entries(css_styles).forEach(prop=>{let name=prop[0],value=prop[1];if(value&&is_number(value)&&auto_px[name])value+="px";el.style.setProperty(name,value,"important")});return el};const rm_element=el=>el&&el.parentNode&&el.parentNode.removeChild(el);const append_element=el=>frame&&frame.parentNode&&frame.parentNode.appendChild(el);const rm_fade=()=>{rm_element(fade);fade=undefined};const set_fade=show=>{if(!show){if(!fade)return;if(fade.animate){fade.animate([{opacity:"1"},{opacity:"0"}],{duration:300,easing:"ease-in"}).addEventListener("finish",rm_fade)}else rm_fade();return}if(fade)return;fade=set_css(document.createElement("div"),{position:"fixed",border:"none",top:"0",left:"0",width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.3)",visibility:"visibile","z-index":2147483646});append_element(fade);if(fade.animate){fade.animate([{opacity:"0"},{opacity:"1"}],{duration:300,easing:"ease-in"})}};const animate=(el,css,time,cb)=>{if(!el.animate){set_css(el,css);if(cb)cb();return}let first=el.getBoundingClientRect();set_css(el,assign({"transform-origin":"top left"},css));let last=el.getBoundingClientRect();let scale_x=first.width/last.width;let scale_y=first.height/last.height;let dx=first.left-last.left;let dy=first.top-last.top;if(!dx&&!dy&&scale_x==1&&scale_y==1)return void cb&&cb();let translate="translate("+dx+"px, "+dy+"px)";let scale="scale("+scale_x+", "+scale_y+")";el.animate([{transform:translate+" "+scale},{transform:"translate(0, 0) scale(1, 1)"}],{duration:time||200,easing:"ease-in"}).addEventListener("finish",()=>{if(cb)cb()})};const resize_iframe=opt=>{if(!frame)return;let css={width:opt.width,height:opt.height,margin:opt.margin||""};if(opt.top!==undefined)css.top=opt.top;if(opt.left!==undefined)css.left=opt.left;if(opt.right!==undefined)css.right=opt.right;if(opt.bottom!==undefined)css.bottom=opt.bottom;if(opt.animate)animate(frame,css,opt.animation_time);else set_css(frame,opt);if(opt.fade!==undefined)set_fade(opt.fade)};const show_arrow_anim=opt=>{rm_element(arrow_anim);arrow_anim=set_css(document.createElement("iframe"),assign({position:"fixed",border:"none",overflow:"hidden",visibility:"visibile","z-index":2147483647,"pointer-events":"none"},opt.css));arrow_anim.setAttribute("src",opt.url);append_element(arrow_anim)};const hide_arrow_anim=()=>{rm_element(arrow_anim);arrow_anim=undefined};const rm_iframe=()=>{try{if(!frame)return;rm_fade();rm_element(frame);frame=undefined;hide_arrow_anim()}catch(e){console.error("rm_iframe error: "+e)}};const script_exec=func=>{let script=document.createElement("script");script.textContent="("+func.toString()+")();";(document.head||document.documentElement).appendChild(script);script.remove()};const get_iframe_parent=()=>{const el=document.fullscreenElement;return(type=="mitm_popup"||type=="watermark")&&el&&!["VIDEO","IMG","IFRAME"].includes(el.tagName)?el:document.body};const get_itv_flash=()=>root_url=="itv.com"&&document.querySelector("#video object");const must_exit_fullscreen=()=>{let fs_el=document.fullscreenElement;return fs_el&&fs_el.tagName=="IFRAME"||root_url=="itv.com"&&document.body.classList.contains("is-fullscreen")&&!!get_itv_flash()};const exit_fullscreen=()=>{let itv=get_itv_flash();if(!itv)return void document.exitFullscreen();try{script_exec(()=>document.querySelector("#video object").callBackPlayer("toggleFullscreen"))}catch(e){perr("tpopup_exit_fullscreen_err",{err:e.message})}};const is_playing=video=>{if(video.tagName=="VIDEO")return!video.paused&&!video.ended;if(root_url=="itv.com"&&video.tagName=="OBJECT"){let el=document.querySelector("#video");return el&&el.getAttribute("state")=="playing"}};const is_paused=video=>{if(video.tagName=="VIDEO")return video.paused&&!video.ended;if(root_url=="itv.com"&&video.tagName=="OBJECT"){let el=document.querySelector("#video");return el&&el.getAttribute("state")=="paused"}};const play_video=video=>{if(video.tagName=="VIDEO")return void video.play();if(root_url=="itv.com"&&video.tagName=="OBJECT"){script_exec(()=>document.querySelector("#video object").callBackPlayer("play"))}};const pause_video=video=>{if(video.tagName=="VIDEO")return void video.pause();if(root_url=="itv.com"&&video.tagName=="OBJECT"){script_exec(()=>document.querySelector("#video object").callBackPlayer("pause"))}};const get_icon=()=>{let res=`https://${root_url}/favicon.ico`;const q='link[rel="apple-touch-icon"], link[rel="shortcut icon"], '+'link[rel="icon"]';try{const arr=Array.from(document.querySelectorAll(q)).map(el=>{const{rel:rel,href:href,sizes:sizes}=el;let size=+(sizes&&sizes[0]&&sizes[0].split("x")[0])||(rel=="apple-touch-icon"?57:rel=="icon"?32:48);return{href:href,size:size}}).sort((i,j)=>i.size-j.size);let icon=arr.find(item=>item.size>=48)||arr[arr.length-1];res=icon&&icon.href||res}catch(e){console.error("get_icon error: "+e)}return res};const add_iframe=()=>{if(frame)return;if(document.getElementById("_hola_popup_iframe__"))return void console.error("frame already exists");if(!document.body)return void console.error("document not ready");let styles={position:"fixed",top:"5px",right:"20px",width:"274px",height:"377px","max-width":"100%","max-height":"100%","background-color":"transparent","z-index":2147483647,overflow:"hidden",visibility:"hidden",border:"none",display:"block"};if(type)assign(styles,{top:"0",right:"0",width:"0",height:"0"});frame=set_css(document.createElement("iframe"),styles);get_iframe_parent().appendChild(frame);frame.setAttribute("src",ext_url+"/popup.html?tab_id="+tab_id+"&connection_id="+connection_id);frame.setAttribute("id","_hola_popup_iframe__")};const trigger=(name,data)=>b.runtime.sendMessage({type:"be_msg_req",_type:"tpopup",_tab_id:tab_id,context:{rmt:true},msg:{msg:"call_api",obj:"tpopup",func:"trigger",args:[name,assign({tab_id:tab_id,connection_id:connection_id},data)]}});const ext_send_msg=msg=>b.runtime.sendMessage({type:"be_msg_req",_type:"tpopup",_tab_id:tab_id,context:{rmt:true},msg:{msg:"call_api",obj:"tpopup",func:"send_tpopup_msg",args:[tab_id,msg]}});const perr=(id,info,perr_opt)=>b.runtime.sendMessage({type:"be_msg_req",_type:"tpopup",_tab_id:tab_id,context:{rmt:true},msg:{msg:"call_api",obj:"tpopup",func:"perr",args:[tab_id,id,assign({root_url:root_url,url:url},info),perr_opt]}});const on_ext_msg=msg=>{if(msg._connection_id!=connection_id)return;switch(msg.id){case"tpopup.init":ext_send_msg({id:"cs_tpopup.init",_type:"tpopup",_connection_id:connection_id,data:{tab_id:tab_id,connection_id:connection_id,url:url,country:country,type:type,icon:get_icon()}});break;case"tpopup.show":set_css(frame,{visibility:"visible"});break;case"tpopup.hide":set_css(frame,{visibility:"hidden"});break;case"tpopup.resize":if(parseInt(msg.width,10)>200&&parseInt(msg.height,10)>200&&must_exit_fullscreen()){exit_fullscreen()}resize_iframe({width:msg.width,height:msg.height,top:msg.top,left:msg.left,right:msg.right,bottom:msg.bottom,fade:msg.fade,animate:msg.animate,animation_time:msg.animation_time,margin:msg.margin});trigger("resize_end");break;case"tpopup.show_arrow_anim":show_arrow_anim({url:ext_url+"/animation_arrow.html?direction="+msg.direction+"&logo_pos="+msg.logo_pos+"&width="+msg.size.width+"&height="+msg.size.height,css:msg.css});break;case"tpopup.hide_arrow_anim":hide_arrow_anim();break;case"tpopup.pause_videos":pause_videos();break;case"tpopup.resume_videos":resume_videos();break;case"tpopup.close":uninit();break}};let paused_videos=[];const pause_videos=()=>{const paused=[];const videos=Array.from(document.querySelectorAll("video"));const itv=get_itv_flash();if(itv)videos.push(itv);videos.forEach(v=>{try{if(!is_playing(v))return;pause_video(v);paused.push(v)}catch(e){perr("geo_trial_ended_pause_video_err",{err:e.message});console.error("pause video error: "+e)}});if(paused.length)perr("geo_trial_ended_pause_video",{count:paused.length});paused_videos=paused_videos.concat(paused)};const resume_videos=()=>{const resumed=[];paused_videos.forEach(v=>{try{if(!is_paused(v))return;play_video(v);resumed.push(v)}catch(e){perr("geo_trial_ended_resume_video_err",{err:e.message});console.error("play video error: "+e)}});if(resumed.length)perr("geo_trial_ended_resume_video",{count:resumed.length});paused_videos=[]};const on_fullscreen=e=>{const parent=get_iframe_parent();if(!frame||frame.parentElement===parent)return;parent.appendChild(frame);set_css(frame,{visibility:"hidden"})};const on_body_mousedown=()=>trigger("body_click");const on_mouseleave=()=>trigger("mouseleave");const init=()=>{if(inited)return;if(url!=location.href){console.error("expected url: "+url+" actual: "+location.href);return}inited=true;add_iframe();if(!frame)return;if(document.body)document.body.addEventListener("mousedown",on_body_mousedown);frame.addEventListener("mouseleave",on_mouseleave);document.addEventListener("fullscreenchange",on_fullscreen);document.addEventListener("webkitfullscreenchange",on_fullscreen);document.addEventListener("mozfullscreenchange",on_fullscreen);port=b.runtime.connect({name:connection_id});b.runtime.onMessage.addListener(on_ext_msg);port.onDisconnect.addListener(uninit);window.addEventListener("unload",uninit)};const uninit=()=>{if(!inited)return;paused_videos=[];if(frame)frame.removeEventListener("mouseleave",on_mouseleave);if(document.body)document.body.removeEventListener("mousedown",on_body_mousedown);rm_iframe();document.removeEventListener("fullscreenchange",on_fullscreen);document.removeEventListener("webkitfullscreenchange",on_fullscreen);document.removeEventListener("mozfullscreenchange",on_fullscreen);b.runtime.onMessage.removeListener(on_ext_msg);port.onDisconnect.removeListener(uninit);port.disconnect();port=null;inited=false};init()}},function(module,__webpack_exports__,__webpack_require__){"use strict";var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(29);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(38);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_5__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_6__);var _util_url_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(18);var _util_url_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_7__);var _util_util_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_8__);
// LICENSE_CODE ZON
const chrome=window.chrome;_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_2___default.a.assert_bg("be_tab_perr");const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default.a.model.extend({_defaults:function(){this.on("destroy",()=>E.uninit())}}));const cb_wrapper=_util_zerr_js__WEBPACK_IMPORTED_MODULE_6___default.a.catch_unhandled_exception;const google_host=hostname=>{var host_split=hostname.split(".").reverse();return host_split[1]=="google"||host_split[2]=="google"};const enabled_google_rule=()=>_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_5___default.a.has_rule(r=>google_host(r.name));const google_captcha_send_perr=_url=>{if(!E.inited)return;let url=_util_url_js__WEBPACK_IMPORTED_MODULE_7___default.a.parse(_url),id;if(!google_host(url.hostname))return;if(/\/sorry\//.test(url.pathname))id="google_cap_sorry";else if(/\/websearch\/answer\/86640$/.test(url.pathname))id="google_cap_support";else if(/\/recaptcha$/.test(url.pathname))id="google_cap_support2";else return;if(enabled_google_rule())id+="_enabled_google_rule";if(be_vpn.be_mode.get("svc.detected"))id+="_svc";_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr(id,{url:_url},{err:true,rate_limit:{count:1,disable_drop_count:true}})};const on_tab_created=cb_wrapper(o=>{const tab=o.tab;if(!tab.url)return;google_captcha_send_perr(tab.url)});const on_tab_updated=cb_wrapper(o=>{const info=o.info;if(!_util_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get(info,"url"))return;google_captcha_send_perr(info.url)});const on_tab_replaced=cb_wrapper(o=>{const added=o.added;chrome.tabs.get(added,tab=>{if(!_util_util_js__WEBPACK_IMPORTED_MODULE_8___default.a.get(tab,"url"))return;google_captcha_send_perr(tab.url)})});const update_state=()=>{const is_active=!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a.is_disabled();if(is_active==E.is_active)return;E.is_active=is_active;E.stopListening(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1___default.a);if(!E.is_active)return;E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1___default.a,"created",on_tab_created);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1___default.a,"updated",on_tab_updated);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1___default.a,"replaced",on_tab_replaced)};E.uninit=()=>{if(!E.inited)return;E.inited=0;E.stopListening();be_vpn=null};let be_vpn;E.init=_be_vpn=>{if(E.inited)return;be_vpn=_be_vpn;E.inited=1;E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default.a,"change:ext.active change:ext.suspended",update_state)};__webpack_exports__["a"]=E},function(module,__webpack_exports__,__webpack_require__){"use strict";var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(30);var _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(36);var _bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(54);var _util_storage_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(21);var _util_storage_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(40);var _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(55);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(29);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(33);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(37);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_14__);var zon_config__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(51);var zon_config__WEBPACK_IMPORTED_MODULE_15___namespace=__webpack_require__.t(51,1);var conf__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(24);var conf__WEBPACK_IMPORTED_MODULE_16___namespace=__webpack_require__.t(24,1);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_14___default.a.assert_bg("be_ccgi");const E=new _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default.a.model,chrome=window.chrome;E.init=be_ext=>{if(E.inited)return;E.inited=true;E.init_ts=Date.now();E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_14___default.a.new_etask("be_ccgi");E.be_ext=be_ext;E.be_mode=_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_7__["a"];E.listening=false;start_listen();E.on("destroy",E.uninit)};E.uninit=()=>{E.sp.return();stop_listen()};function start_listen(){if(E.listening)return;chrome.runtime.onMessage.addListener(ccgi_ipc_handler);E.listening=true}function stop_listen(){if(!E.listening)return;chrome.runtime.onMessage.removeListener(ccgi_ipc_handler);E.listening=false}function send_msg(msg,resp_cb){try{return resp_cb(msg)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr("be_ccgi_send_err",msg.id,{err:e,filehead:_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.json(msg)})}}function ccgi_resp(msg,resp_cb){underscore__WEBPACK_IMPORTED_MODULE_0___default.a.defer(send_msg,msg,resp_cb);return true}function ccgi_ipc_handler(msg,sender,resp_cb){if(msg._type&&msg._type!="ccgi")return;switch(msg.id){case"callback":msg.data={init_ts:E.init_ts,install_ts:_util_storage_js__WEBPACK_IMPORTED_MODULE_8___default.a.get_int("install_ts"),connected:E.be_ext.get("enabled"),disable:!E.be_ext.get("enabled"),uuid:E.be_ext.get("uuid"),session_key:E.be_ext.get("session_key")||0,ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.version(),mode:E.be_mode.get("mode"),mode_duration:Date.now()-E.be_mode.get("ts"),pending:E.be_mode.get("pending"),type:conf__WEBPACK_IMPORTED_MODULE_16__.type,browser:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.browser(),release:zon_config__WEBPACK_IMPORTED_MODULE_15__._RELEASE,svc_mode:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_7__["a"].get("mode"),svc_mode_pending:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_7__["a"].get("pending"),svc_info:E.be_mode.get("svc.info"),build_info:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.build_info()};return ccgi_resp(msg,resp_cb);case"enable":E.be_ext.set("enabled",!!msg.data);break;case"ping":msg.data={uuid:E.get("uuid"),session_key:E.get("session_key")||0,ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.version(),type:conf__WEBPACK_IMPORTED_MODULE_16__.type,browser:E.get("browser")};return ccgi_resp(msg,resp_cb);case"open_be_tab":_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_5__["default"].open_be_tab(msg.opt);break}if(!_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_10__["a"].get("inited")){_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.notice("skip msg.id %s, be_vpn not inited",msg.id);return}switch(msg.id){case"svc_callback":msg.data=null;E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"svc_callback",cancel:true},(function*(){try{const r=yield _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_6__["default"].callback({raw:1});r.from_be=true;msg.data=r;ccgi_resp(msg,resp_cb)}catch(e){ccgi_resp(msg,resp_cb)}})));return true;case"update_rules":msg.data={};try{_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].trigger("fetch_rules",false)}catch(e){}return ccgi_resp(msg,resp_cb);case"vpn_enable":msg.data={};E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"vpn_enable",cancel:true},[function(){},function catch$(err){return msg.data.err=""+err},function finally$(){return ccgi_resp(msg,resp_cb)}]));return true;case"perr":_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default.a.perr(msg.perr_id,JSON.parse(msg.info));break;case"set_rule":msg.data={};E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"set_rule",cancel:true},(function*(){try{return yield _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].set_rule(msg.opt)}catch(err){return msg.data.err=""+err}finally{if(!msg.no_resp)ccgi_resp(msg,resp_cb)}})));return!msg.no_resp;case"fetch_rules":msg.data={};E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"fetch_rules",cancel:true},(function*(){try{yield _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].update_rules();return msg.data.rules=yield _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__["a"].get("rules")}catch(err){return msg.data.err=""+err}finally{if(!msg.no_resp)ccgi_resp(msg,resp_cb)}})));return!msg.no_resp;case"enable_root_url":msg.data={};E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"enable_root_url",cancel:true},(function*(){try{return msg.data.rule=yield _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_10__["a"].enable_root_url(msg.opt)}catch(e){return msg.data.err=""+e}finally{if(!msg.no_resp)ccgi_resp(msg,resp_cb)}})));return!msg.no_resp;case"refresh_membership":_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_13__["default"].schedule_refresh_user(Object.assign({force_premium:true,reason:"ccgi_call"},msg.data));break;case"get_log":break;case"set_dont_show_again":try{E.sp.spawn(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_12__["default"].set_dont_show_again(msg.data))}catch(e){}break;case"is_dont_show":E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function(){try{msg.data={is_dont_show:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_12__["default"].is_dont_show(msg.data.root_url)};ccgi_resp(msg,resp_cb)}catch(e){ccgi_resp(msg,resp_cb)}})));return true;case"set_enabled_for_browser":try{E.sp.spawn(_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_10__["a"].set_enabled_for_browser(msg.data.enable,{country:"us"}))}catch(e){}break;case"is_enabled_for_browser":E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function(){try{msg.data={enable:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_10__["a"].is_enabled_for_browser()};ccgi_resp(msg,resp_cb)}catch(e){ccgi_resp(msg,resp_cb)}})));return true;case"force_suggestion":E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"force_suggestion",cancel:true},(function*(){try{return yield _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default.a.set_force_suggestion(msg.tab_id||sender.tab.id,true)}catch(e){return msg.data.err=""+e}finally{if(!msg.no_resp)ccgi_resp(msg,resp_cb)}})));return!msg.no_resp;default:_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default()("unknown ccgi message "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default.a.json(msg))}}__webpack_exports__["a"]=E},function(module,exports,__webpack_require__){"use strict";var __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return{debug_hooks:true,disable_reset_busy:true,disable_agent_js4:true,disable_rules_js2:true,bump:1,bw_perr:[{id:"bbc",url:["**.bbc.co.uk","**.bbci.co.uk","**.bbc.com","**.bbcfmt.hs","**.bbcdotcom.2cnt.net","**.bbcfmt.hs.llnwd.net"],error_code:[403]},{id:"netflix",url:["**.nflxvideo.net"],error_code:[420]},{id:"youtube",url:["**.googlevideo.com"],error_code:[403]},{id:"cbs",url:["**.cbsaavideo.com"],error_code:[403]}],load_perr:[{id:"netflix",domain:"netflix.com",paths:["login","signin","clearcookies","search","browse","watch"]}],force_premium:{rules:[{id:"bbc",domain:"bbc.co.uk"},{id:"bbc_com",domain:"bbc.com"},{id:"netflix",domain:"netflix.com",test:{name:"trial",on:0,on2:0,period:36e5,debug:1}},{id:"hulu",domain:"hulu.com",test:{name:"trial",on2:0,period:36e5}},{id:"itv",domain:"itv.com"},{id:"vueling_com",domain:"vueling.com"}]},sites:{itv_com:{min_ver:"1.136.635",root_url:["itv.com"],suggestion_popup:{GB:null,"*":{proxy:["GB"]}},require_plus:true,trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}},verify:{gb:[{url:"https://mediaplayer.itv.com/flash/playlists/ukonly/itv1.xml",ret:{status:403}},{url:"*://*.itv.com/playlist/*",ret:{status:403,client_only:true}}]}},hulu_com:{min_ver:"1.136.635",root_url:["hulu.com"],suggestion_popup:{US:null,"*":{proxy:["US"]}},require_plus:true,trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}},verify:{us:[{url:"*://play.hulu.com/*/playlist",ret:{status:403,client_only:true}}]}},france_tv:{min_ver:"1.136.635",root_url:["france.tv"],suggestion_popup:{FR:null,"*":{proxy:["FR"]}},require_plus:true,trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},channel4_com:{min_ver:"1.145.764",root_url:["channel4.com"],require_plus:true,suggestion_popup:{GB:null,"*":{proxy:["GB"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}},tz_spoof:-60,verify:{gb:[{url:"https://ais.channel4.com/asset/4783100?client=c4&uuid=f50b297e-16a2-4bf2-8da2-a2fdae951c24&rand=1564415364",ret:{data:{}}}]}},vk_com:{min_ver:"1.145.764",root_url:["vk.com"],tz_spoof:-180,keep_cookies:true},tvnz_co_nz:{min_ver:"1.145.764",root_url:["tvnz.co.nz"],tz_spoof:-780},roblox_com:{min_ver:"1.145.764",root_url:["roblox.com"],tz_spoof:300},hbogo_pl:{min_ver:"1.158.502",root_url:["hbogo.pl"],site_storage:{"go-geostate":""},local_storage:{"go-geostate":""}},vod_pl:{min_ver:"1.158.502",root_url:["vod.pl"],site_storage:{insiderTimeOnSiteData:"",insUserPermissionGranted:""}},hbogo_ro:{min_ver:"1.158.502",root_url:["hbogo.ro"],site_storage:{"go-geostate":""},local_storage:{"go-geostate":""}},investopedia_com:{min_ver:"1.158.502",root_url:["investopedia.com"],site_storage:{tg_accessDeny_timeStamp:"",tg_accessDeny:"",tg_redirectURLremembered:"",tg_reaction:"",tg_redirectURL:"",tg_accessEntry:"",tg_ipInfosArray:""}},espn_com_co:{min_ver:"1.160.842",root_url:["espn.com.co"],site_storage:{geo:""}},ome_tv:{min_ver:"1.160.842",root_url:["ome.tv"],site_storage:{selected_country:""}},joyn_de:{min_ver:"1.160.842",root_url:["joyn.de"],site_storage:{deviceId:""}},hbogo_com:{min_ver:"1.136.635",root_url:["hbogo.com","loginprodx.att.net"]},vueling_com:{min_ver:"0.0.0",root_url:["vueling.com"]},cwtv_com:{min_ver:"1.136.635",root_url:["cwtv.com"],require_plus:true,suggestion_popup:{US:null,"*":{proxy:["US"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}},verify:{us:[{url:"https://www.cwtv.com/",ret:{status:403}}]}},netflix_com:{min_ver:"1.136.635",root_url:["netflix.com"],require_plus:true,suggestion_popup:{US:{proxy:["US","GB","CA","NL","FR","DE","SE","ES","IE","BE","PL","IT","RU","JP","HK","BR","AR","KR","SK","IS","CH","GR","HU","MX","RO","IL","SG","IN","UA"]},GB:{proxy:["US","GB","CA","NL","FR","DE","SE","ES","IE","BE","PL","IT","RU","JP","HK","BR","AR","KR","SK","IS","CH","GR","HU","MX","RO","IL","SG","IN","UA"]},"*":{proxy:["US","GB","CA","NL","FR","DE","SE","ES","IE","BE","PL","IT","RU","JP","HK","BR","AR","KR","SK","IS","CH","GR","HU","MX","RO","IL","SG","IN","UA"]}},trial:{trial_redirect:"https://www.netflix.com/clearcookies",trial_force_redirect:"https://www.netflix.com/login",period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}},verify:{ca:[{url:"https://www.netflix.com",ret:{headers:{location:{}}}},{url:"*://*.nflxvideo.net/*",ret:{status:420,client_only:true}}],us:[{url:"https://www.netflix.com",ret:{headers:{location:null}}}],gb:[{url:"https://www.netflix.com",ret:{headers:{location:{}}}},{url:"*://*.nflxvideo.net/*",ret:{status:420,client_only:true}}],"*":[{url:"*://*.nflxvideo.net/*",ret:{status:420,client_only:true}}]}},bbc:{min_ver:"1.144.716",root_url:["bbc.com","bbc.co.uk"],verify:{gb:[{url:"https://fig.bbc.co.uk/frameworks/fig/2/fig.js",ret:{data:{}}},{url:"**.bbc.co.uk",ret:{status:403,client_only:true}},{url:"**.bbci.co.uk",ret:{status:403,client_only:true}},{url:"**.bbc.com",ret:{status:403,client_only:true}},{url:"**.bbcfmt.hs",ret:{status:403,client_only:true}},{url:"**.bbcdotcom.2cnt.net",ret:{status:403,client_only:true}},{url:"**.bbcfmt.hs.llnwd.net",ret:{status:403,client_only:true}}]},suggestion_popup:{GB:null,"*":{proxy:["GB"]}},require_plus:true,trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},google_com:{min_ver:"1.158.502",root_url:["google.com"],keep_cookies:true},facebook_com:{min_ver:"1.158.502",root_url:["facebook.com"],keep_cookies:true},youtube_com:{min_ver:"1.158.502",root_url:["youtube.com"],verify:{"*":[{url:"**.googlevideo.com",ret:{status:403,client_only:true}}]},keep_cookies:true,redirect:[{url:"https://www.google.com/sorry/",action:"change_agent"}]},iplocation_com:{min_ver:"9.999.999",root_url:["iplocation.com"],suggestion_popup:{"*":{proxy:["US"]}},require_plus:true,trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},disney_com:{min_ver:"1.144.716",root_url:["disney.com","go.com"]},cbs_com:{min_ver:"1.144.716",root_url:["cbs.com"],require_plus:true,suggestion_popup:{US:null,"*":{proxy:["US"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}},verify:{"*":[{url:"**.cbsaavideo.com",ret:{status:403,client_only:true}}]}},pornhub_com:{min_ver:"1.144.716",root_url:["pornhub.com","pornhubpremium.com"],verify:{"*":[{url:"**.phncdn.com/videos",ret:{status:403,client_only:true}},{url:"**.phncdn.com/hls/videos",ret:{status:403,client_only:true}}]}},line_me:{min_ver:"1.144.716",root_url:["line.me","linetv.tw"]},"9now_com_au":{min_ver:"1.144.716",root_url:["9now.com.au","nine.com.au"]},globaltv_com:{min_ver:"1.144.716",root_url:["globaltv.com"],require_plus:true,suggestion_popup:{CA:null,"*":{proxy:["CA"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}},verify:{ca:[{url:"https://www.globaltv.com/favicon.ico",ret:{status:403}},{url:"https://global.corusappservices.com/location/getiprecord?format=json",ret:{data:{}}}]}},noovo_ca:{min_ver:"1.144.716",root_url:["noovo.ca"],verify:{ca:[{url:"https://edge.api.brightcove.com/playback/*",ret:{status:403,client_only:true}},{url:"https://edge.api.brightcove.com/playback/v1/accounts/618566855001/videos/6096502206001",ret:{data:{}}}]}},ondemandkorea_com:{min_ver:"1.158.340",root_url:["ondemandkorea.com"],verify:{us:[{url:"https://www.ondemandkorea.com/",ret:{status:403}}]}},sprint_com:{min_ver:"1.158.340",root_url:["sprint.com"],verify:{us:[{url:"https://www.sprint.com/",ret:{status:403}}]}},fastpeoplesearch_com:{min_ver:"1.158.340",root_url:["fastpeoplesearch.com"],verify:{us:[{url:"https://www.fastpeoplesearch.com/",ret:{status:403}}]}},disneyplus_com:{min_ver:"1.157.668",root_url:["disneyplus.com"],suggestion_popup:{US:null,"*":{proxy:["US","GB","CA","NL","AU","NZ","PR","AT","DE","IE","IT","ES","CH","FR"]}},require_plus:true,trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},hbonow_com:{min_ver:"1.157.668",root_url:["hbonow.com"],suggestion_popup:{US:null,"*":{proxy:["US"]}},require_plus:true,trial:{trial_redirect:"https://play.hbonow.com/",period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},criteo_com:{min_ver:"1.157.668",root_url:["criteo.com"],suggestion_popup:{US:null,"*":{proxy:["US"]}},require_plus:true,trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},vseinstrumenti_ru:{min_ver:"1.163.892",root_url:["vseinstrumenti.ru"],suggestion_popup:{RU:null,"*":{proxy:["RU"]}},require_plus:true,trial:{period:864e5,wait2:5e3,wait:0,grace_time:6048e5,limits:{count:1,period:864e5}}},twitch_tv:{min_ver:"1.163.892",root_url:["twitch.tv"],suggestion_popup:{US:{proxy:["GB"]},"*":{proxy:["US"]}},require_plus:true,trial:{period:864e5,wait2:5e3,wait:0,grace_time:6048e5,limits:{count:1,period:864e5}}},hotstar_com:{min_ver:"1.163.892",root_url:["hotstar.com"],suggestion_popup:{IN:null,"*":{proxy:["IN"]}},require_plus:true,trial:{period:864e5,wait2:5e3,wait:0,grace_time:6048e5,limits:{count:1,period:864e5}}},player_pl:{min_ver:"1.163.892",root_url:["player.pl"],require_plus:true,suggestion_popup:{PL:null,"*":{proxy:["PL"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},cc_com:{min_ver:"1.163.892",root_url:["cc.com"],require_plus:true,suggestion_popup:{US:null,"*":{proxy:["US"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},globo_com:{min_ver:"1.163.892",root_url:["globo.com"],require_plus:true,suggestion_popup:{BR:null,"*":{proxy:["BR"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},tv4play_se:{min_ver:"1.163.892",root_url:["tv4play.se"],require_plus:true,suggestion_popup:{SE:null,"*":{proxy:["SE"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},crunchyroll_com:{min_ver:"1.163.892",root_url:["crunchyroll.com"],require_plus:true,suggestion_popup:{US:null,"*":{proxy:["US"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},mediaset_it:{min_ver:"1.163.892",root_url:["mediaset.it"],require_plus:true,suggestion_popup:{IT:null,"*":{proxy:["IT"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},raiplay_it:{min_ver:"1.163.892",root_url:["raiplay.it"],require_plus:true,suggestion_popup:{IT:null,"*":{proxy:["IT"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},nrk_no:{min_ver:"1.163.892",root_url:["nrk.no"],require_plus:true,suggestion_popup:{NO:null,"*":{proxy:["NO"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},indavideo_hu:{min_ver:"1.163.892",root_url:["indavideo.hu"],require_plus:true,suggestion_popup:{HU:null,"*":{proxy:["HU"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},tv2_hu:{min_ver:"1.163.892",root_url:["tv2.hu"],require_plus:true,suggestion_popup:{HU:null,"*":{proxy:["HU"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},rtlmost_hu:{min_ver:"1.163.892",root_url:["rtlmost.hu"],require_plus:true,suggestion_popup:{HU:null,"*":{proxy:["HU"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},dmdamedia_hu:{min_ver:"1.163.892",root_url:["dmdamedia.hu"],require_plus:true,suggestion_popup:{HU:null,"*":{proxy:["HU"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},filmorias_com:{min_ver:"1.163.892",root_url:["filmorias.com"],require_plus:true,suggestion_popup:{HU:null,"*":{proxy:["HU"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},dark_ro_com:{min_ver:"1.163.892",root_url:["dark-ro.com"],require_plus:true,suggestion_popup:{HU:null,"*":{proxy:["HU"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},tv2_no:{min_ver:"1.163.892",root_url:["tv2.no"],require_plus:true,suggestion_popup:{NO:null,"*":{proxy:["NO"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},rte_ie:{min_ver:"1.163.892",root_url:["rte.ie"],require_plus:true,suggestion_popup:{IE:null,"*":{proxy:["IE"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},svtplay_se:{min_ver:"1.163.892",root_url:["svtplay.se"],require_plus:true,suggestion_popup:{SE:null,"*":{proxy:["SE"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},livestream_com:{min_ver:"1.163.892",root_url:["livestream.com"],require_plus:true,suggestion_popup:{DE:{proxy:["US","*"]},"*":{proxy:["DE","US","*"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},textnow_com:{min_ver:"1.163.892",root_url:["textnow.com"],require_plus:true,suggestion_popup:{US:null,"*":{proxy:["US"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}},scor_dk:{min_ver:"1.163.892",root_url:["scor.dk"],require_plus:true,suggestion_popup:{DK:null,"*":{proxy:["DK"]}},trial:{period:36e5,reduced_wait:{time:5e3,period:6048e5},wait2:3e4,wait:0,grace_time:6048e5,limits:{count:24,period:864e5}}}},pool:{min_ver:"1.149.460"},require_show_price:0,plus_on_install:{on:0,debug:true,period:864e5},debug_logs:{enabled_perc:100,domains:["bbc.co.uk","bbc.com","cbs.com","channel4.com","espn.com","facebook.com","globo.com","hotstar.com","hulu.com","mitele.es","mtv.ca","netflix.com","omegle.com","tvp.pl","vk.com","yahoo.com","itv.com","disneyplus.com","pornhub.com","pornhubpremium.com"],all_domains_perc:20,screenshot_conflict_rate:0},user_message:[],mitm:{disable:false,discovery:"auto",manual:{min_ver:"1.130.62",trigger:true,disable:false},auto:{disable:true,min_ver:"1.136.280",trigger:true,error:{trigger:true,disable:false},fake_resp:{min_ver:"1.138.399",trigger:true,disable:false},redirect:{min_ver:"1.138.399",trigger:true,disable:false}},min_version:"1.129.426",enable_ext_ui:1,popup:{enable:true,min_version:"1.131.310"},site_blacklist:["twitter.com","adpop.club","google.com","youtube.com"],send_dbg_log:10,log:{random:10,countries:["us"],uuids:["c07b61feb81ecc8a857c57874b166756"]},redirect_filter:[{domain:"accounts.google.com"},{domain:"www.google.com"},{domain:"login.live.com"},{domain:"login.microsoftonline.com"},{domain:"outlook.live.com"},{domain:"www.facebook.com"},{domain:"www.bing.com"}],response_filter:[{statusCode:503,server:"cloudflare","cache-control":"no-cache"}]},protect_ui2:{enable:true,enable_ratio:1,protect_browser:true,protect_pc_min_ver:"1.134.588",tooltips:true,test_name:"test_protect_ui2"},react_ui:{min_ver:"1.151.732"},geo_popup:{watermark:{enabled:true,min_ver:"1.130.774",new_dialog:true,position:"bottom_right",allow_hide:false,banner:{min_ver:"1.166.473"},xxx_promo_text:"Protect your connection",xxx_promo_link:"https://hola.org/plus?ref=watermark_promo_protect"}},popup:{disable:false,disable_max_ver:"1.130.481",dont_show_def_period:"30d"},disable_popup:true,perr_sample:{be_verify_proxy_ok:.01,be_bext_config_success:.01,be_mitm_ignore:.01,be_new_unblocker_api_init:.01,be_debug_no_agents:.01},media_failure:{disable:false,disable_set_err:false,types:["xmlhttprequest","media"],extensions:["mp4","m3u8","ts","mpd","dash","m4s","m4v"],rules:[{domain:"bbc.com",set_err:true,max_retry:3},{domain:"bbc.co.uk",set_err:true,max_retry:3},{domain:"hulu.com",urls:["*://play.hulu.com/*/playlist"],set_err:true},{domain:"itv.com",urls:["*://*.itv.com/playlist/*"]},{domain:"netflix.com",urls:["*://*.nflxvideo.net/*"],set_err:true}],set_err_rate_limit:{ms:36e5,count:10}},browse_failure:{disable:false,types:["main_frame"],rules:[{domain:"netflix.com",urls:["*://*.netflix.com/login*","*://*.netflix.com/browse*"]}]},request_errors:{handle:["net::ERR_PROXY_CONNECTION_FAILED","net::ERR_CONNECTION_CLOSED","net::ERR_CONNECTION_RESET","net::ERR_TIMED_OUT","net:ERR_CONNECTION_TIMED_OUT"],retry:{disable_media_failure:false,sporadic_perc:5,max:5}},bg_ajax:{on:1,min_version:"1.167.61",disable_agents:0,client_uri:"/client_cgi/ver.json"},force_protect_mode:{min_ver:"1.148.186",countries:["us","ca","na"],period:31536e7},payment:{all_plans:[{period:"3 Y",id:"3y_143_64",bluesnap_id:3505426,price:143.64,is_active:false},{period:"2 Y",id:"2y_119_76",bluesnap_id:3505430,price:119.76,is_active:false},{period:"1 Y",id:"1y_95_88",bluesnap_id:3249287,price:95.88,is_active:false},{period:"3 Y",id:"3y",price:107.55,is_active:true,avangate_id:16241620,avangate_product:"3BD3FAB3F1",bluesnap_id:3497134,bluesnap_test_id:2425795},{period:"2 Y",id:"2y",price:95.75,is_active:true,avangate_id:14166685,avangate_product:"36C9499C3A",bluesnap_id:3497132,bluesnap_test_id:2425793},{period:"1 Y",id:"1y",price:83.88,is_active:true,avangate_id:4621810,avangate_product:"90134D1BB0",bluesnap_id:3497130,bluesnap_test_id:2425791,paypal_id:"P-5GP12483RR459984DLWYVPHI",paypal_test_id:"P-88U39284PA049131WLWSMYJI"},{period:"1 Y",id:"1y_studentbeans",price:35.88,is_active:true,req_coupon:["studentbeans"],payment_methods:["cc"],bluesnap_id:3797176,bluesnap_test_id:2577865,currency:{eur:{price:32.04,bluesnap_id:3797174,bluesnap_test_id:2577867},gbp:{price:28.48,bluesnap_id:3797172,bluesnap_test_id:2577869},cad:{price:49.88,bluesnap_id:3797166,bluesnap_test_id:2577873},aud:{price:57.05,bluesnap_id:3797164,bluesnap_test_id:2577875}}},{period:"6 M",id:"6m",price:54,is_active:true,avangate_id:4731595,avangate_product:"3C1B1BD89A",bluesnap_id:3497128,bluesnap_test_id:2425789,paypal_id:"P-3KN103492F659032ALWYVO4I",paypal_test_id:"P-8CM77782KL3463515LWSJMTQ"},{period:"1 M",id:"1m",price:11.95,is_active:true,avangate_id:4615369,avangate_product:"6618ECCBE1",bluesnap_id:3497126,bluesnap_test_id:2425771,paypal_id:"P-4RN722846R664340TLWYVOHY",paypal_test_id:"P-76B29810MG184263NLWSJNVA"},{period:"1 D",id:"1d",price:1,is_active:true,avangate_id:22237051,avangate_product:"4340487765",bluesnap_id:3553444,bluesnap_test_id:2464767},{id:"josh_1m",period:"1 M",avangate_product:"6618ECCBE2",avangate_id:28995007,bluesnap_test_id:2581507,bluesnap_id:3815032,paypal_id:"P-6F4516657S045682JL2C3ZGI",paypal_test_id:"P-4EU92055YR171322KL2C3XVA",price:11.99,is_active:true,currency:{aud:{bluesnap_test_id:2584265,bluesnap_id:3820848,price:19.26,paypal_test_id:"P-6SL32543ST0376730L2HDXSA",paypal_id:"P-5E73168851440900BL2HEBWA",discount:0},gbp:{bluesnap_test_id:2584267,bluesnap_id:3820850,price:9.68,paypal_test_id:"P-6G0581649V659161ML2HDXSA",paypal_id:"P-68V06036XR064552YL2HEBWI",discount:0},cad:{bluesnap_test_id:2584269,bluesnap_id:3820852,price:16.81,paypal_test_id:"P-81M73586KH5759030L2HDXSI",paypal_id:"P-13B76040YA743443NL2HEBWQ",discount:0},eur:{bluesnap_test_id:2584271,bluesnap_id:3820854,price:11.04,paypal_test_id:"P-3RJ49928HL578635SL2HDXSI",paypal_id:"P-8G684228H66734216L2HEBAQ",discount:0},jpy:{bluesnap_test_id:2584273,bluesnap_id:3820856,price:1305,paypal_test_id:"P-9R202291AN659000AL2HDXSI",paypal_id:"P-53B962694T339600BL2HEBWY",discount:0},nzd:{bluesnap_test_id:2584275,bluesnap_id:3820858,price:19.97,paypal_test_id:"P-6T749386AS7867059L2HDXSQ",paypal_id:"P-27A46153MP341020LL2HEBWY",discount:0},sgd:{bluesnap_test_id:2584277,bluesnap_id:3820860,price:17.09,paypal_test_id:"P-7EP52909N3614930VL2HDXSQ",paypal_id:"P-13U887020P3608246L2HEBXA",discount:0},chf:{bluesnap_test_id:2584279,bluesnap_id:3820862,price:11.65,paypal_test_id:"P-7988627665141001ML2HDXSY",paypal_id:"P-7XB1053827361784NL2HEBXQ",discount:0},ils:{bluesnap_test_id:2581629,bluesnap_id:3815050,price:43,paypal_test_id:"P-2B442437UR0615013L2HDXSY",paypal_id:"P-0XB473656S8340414L2HEBXQ",discount:0},pab:{bluesnap_test_id:2584281,bluesnap_id:3820864,price:11.99,discount:0},sek:{bluesnap_test_id:2584283,bluesnap_id:3820866,price:120.83,paypal_test_id:"P-03639493GY1961230L2HDXSY",paypal_id:"P-6DT04127CJ246291ML2HEBXY",discount:0},nok:{bluesnap_test_id:2584285,bluesnap_id:3820868,price:122.93,paypal_test_id:"P-52E85524NF280091LL2HDXTA",paypal_id:"P-5JU52520AR872440YL2HEBYA",discount:0},twd:{bluesnap_test_id:2584287,bluesnap_id:3820870,price:361,paypal_test_id:"P-9MM84511E5697132BL2HDXTA",paypal_id:"P-82997341X3868230JL2HEBYA",discount:0},isk:{bluesnap_test_id:2584289,bluesnap_id:3820872,price:1721.17,discount:0},hkd:{bluesnap_test_id:2584291,bluesnap_id:3820874,price:92.95,paypal_test_id:"P-75538330N6350551UL2HDXTA",paypal_id:"P-98B88585U52132241L2HEBYI",discount:0},rub:{bluesnap_test_id:2584293,bluesnap_id:3820876,price:449.9,paypal_test_id:"P-7EW03840SA5169113L2HDXTI",paypal_id:"P-8K275847N9360461RL2HEBYQ",discount:50},mxn:{bluesnap_test_id:2584295,bluesnap_id:3820878,price:144.3,paypal_test_id:"P-9CR74833WS903554DL2HDXTI",paypal_id:"P-6J519873XA720304DL2HEBYQ",discount:50},brl:{bluesnap_test_id:2584297,bluesnap_id:3820880,price:30.72,paypal_test_id:"P-8CL75865438277335L2HDXTQ",paypal_id:"P-1LC64628X6996901GL2HEBYY",discount:50},lkr:{bluesnap_test_id:2584299,bluesnap_id:3820882,price:348.13,discount:85},inr:{bluesnap_test_id:2584301,bluesnap_id:3820884,price:136.58,discount:85},zar:{bluesnap_test_id:2584303,bluesnap_id:3820886,price:118.43,discount:50},ars:{bluesnap_test_id:2584305,bluesnap_id:3820888,price:390.23,discount:50},cop:{bluesnap_test_id:2583557,bluesnap_id:3819388,price:23866},try:{bluesnap_test_id:2584307,bluesnap_id:3820890,price:40.62,discount:50},php:{bluesnap_test_id:2584309,bluesnap_id:3820892,price:90.97,paypal_test_id:"P-1BJ59436U52283816L2HDXTY",paypal_id:"P-97002909A0126862BL2HEBZA",discount:85},krw:{bluesnap_test_id:2584311,bluesnap_id:3820894,price:14584,discount:0},pkr:{bluesnap_test_id:2584313,bluesnap_id:3820896,price:301.27,discount:85},myr:{bluesnap_test_id:2584315,bluesnap_id:3820898,price:7.82,discount:85},xof:{bluesnap_test_id:2584317,bluesnap_id:3820900,price:1182,discount:85},dzd:{bluesnap_test_id:2584319,bluesnap_id:3820902,price:760.44,discount:50},idr:{bluesnap_test_id:2584321,bluesnap_id:3820904,price:28939.75,discount:85},mad:{bluesnap_test_id:2584323,bluesnap_id:3820906,price:61.53,discount:50},uah:{bluesnap_test_id:2584325,bluesnap_id:3820908,price:163.54,discount:50},cny:{bluesnap_test_id:2584327,bluesnap_id:3820910,price:42.36,discount:50},vnd:{bluesnap_test_id:2584329,bluesnap_id:3820912,price:46154,discount:85},aed:{price:30.83,bluesnap_test_id:2584331,bluesnap_id:3820914,discount:30},afn:{price:137.14,bluesnap_test_id:2584333,bluesnap_id:3820916,discount:85},all:{price:976.16,bluesnap_test_id:2584335,bluesnap_id:3820918,discount:30},amd:{price:4167.8,bluesnap_test_id:2584337,bluesnap_id:3820920,discount:30},ang:{price:15.03,bluesnap_test_id:2584339,bluesnap_id:3820922,discount:30},awg:{price:15.11,bluesnap_test_id:2584341,bluesnap_id:3820924,discount:30},bam:{price:15.1,bluesnap_test_id:2584343,bluesnap_id:3820926,discount:30},bbd:{price:16.95,bluesnap_test_id:2584345,bluesnap_id:3820928,discount:30},bgn:{price:15.11,bluesnap_test_id:2584347,bluesnap_id:3820930,discount:30},bhd:{price:3.17,bluesnap_test_id:2584349,bluesnap_id:3820932,discount:30},bmd:{price:11.99,bluesnap_test_id:2584351,bluesnap_id:3820934,discount:0},bnd:{price:11.98,bluesnap_test_id:2584353,bluesnap_id:3820936,discount:30},bob:{price:41.34,bluesnap_test_id:2584355,bluesnap_id:3820938,discount:50},bsd:{price:8.39,bluesnap_test_id:2584357,bluesnap_id:3820940,discount:30},bwp:{price:21.69,bluesnap_test_id:2584359,bluesnap_id:3820942,discount:85},byr:{price:164503,bluesnap_test_id:2584361,bluesnap_id:3820944,discount:30},clp:{price:7085,bluesnap_test_id:2584363,bluesnap_id:3820946,discount:30},crc:{price:4805.93,bluesnap_test_id:2584365,bluesnap_id:3820948,discount:30},czk:{paypal_test_id:"P-6MG20935F9776151CL2HDXUA",price:299.99,paypal_id:"P-91W56553NR437312UL2HEBZQ",bluesnap_test_id:2584367,bluesnap_id:3820950,discount:0},dkk:{paypal_test_id:"P-73336988R4088070UL2HDXUI",price:82.44,paypal_id:"P-3XE955281N255045FL2HEBZY",bluesnap_test_id:2584369,bluesnap_id:3820952,discount:0},dop:{price:326.16,bluesnap_test_id:2584371,bluesnap_id:3820954,discount:50},egp:{price:94.43,bluesnap_test_id:2584373,bluesnap_id:3820956,discount:50},fjd:{price:13.81,bluesnap_test_id:2584375,bluesnap_id:3820958,discount:50},gel:{price:26.65,bluesnap_test_id:2584377,bluesnap_id:3820960,discount:30},gip:{price:9.68,bluesnap_test_id:2584379,bluesnap_id:3820962,discount:0},gtq:{price:13.89,bluesnap_test_id:2584381,bluesnap_id:3820964,discount:85},hrk:{price:67.36,bluesnap_test_id:2584383,bluesnap_id:3820966,discount:20},huf:{paypal_test_id:"P-6UV042279K367641AL2HDXUI",price:3159,paypal_id:"P-8DM07436GF812863EL2HEBZY",bluesnap_test_id:2584385,bluesnap_id:3820968,discount:20},jmd:{price:1136.35,bluesnap_test_id:2584387,bluesnap_id:3820970,discount:30},jod:{price:5.95,bluesnap_test_id:2584389,bluesnap_id:3820972,discount:30},kes:{price:190.8,bluesnap_test_id:2584391,bluesnap_id:3820974,discount:85},khr:{price:7310.9,bluesnap_test_id:2584393,bluesnap_id:3820976,discount:85},kwd:{price:2.62,bluesnap_test_id:2584395,bluesnap_id:3820978,discount:30},kyd:{price:7,bluesnap_test_id:2584397,bluesnap_id:3820980,discount:30},kzt:{price:3659.04,bluesnap_test_id:2584399,bluesnap_id:3820982,discount:30},lbp:{price:12693.79,bluesnap_test_id:2584401,bluesnap_id:3820984,discount:30},mdl:{price:154.46,bluesnap_test_id:2584403,bluesnap_id:3820986,discount:30},mkd:{price:476.11,bluesnap_test_id:2584405,bluesnap_id:3820988,discount:30},mro:{price:642.07,bluesnap_test_id:2584407,bluesnap_id:3820990,discount:85},mur:{price:70.68,bluesnap_test_id:2584409,bluesnap_id:3820992,discount:85},mwk:{price:1321.9,bluesnap_test_id:2584411,bluesnap_id:3820994,discount:85},nad:{price:32.7,bluesnap_test_id:2584413,bluesnap_id:3820996,discount:85},ngn:{price:660.05,bluesnap_test_id:2584415,bluesnap_id:3820998,discount:85},npr:{price:219.33,bluesnap_test_id:2584417,bluesnap_id:3821e3,discount:85},omr:{price:3.23,bluesnap_test_id:2584419,bluesnap_id:3821002,discount:30},pen:{price:20.21,bluesnap_test_id:2584421,bluesnap_id:3821004,discount:50},pgk:{price:6.14,bluesnap_test_id:2584423,bluesnap_id:3821006,discount:85},pln:{paypal_test_id:"P-8UJ52441BX999751LL2HDXUI",price:50.01,paypal_id:"P-54A28836YV492735GL2HEB2A",bluesnap_test_id:2584425,bluesnap_id:3821008,discount:0},qar:{price:43.65,bluesnap_test_id:2584427,bluesnap_id:3821010,discount:0},ron:{price:37.36,bluesnap_test_id:2584429,bluesnap_id:3821012,discount:30},rsd:{price:908.71,bluesnap_test_id:2584431,bluesnap_id:3821014,discount:30},sar:{price:31.57,bluesnap_test_id:2584433,bluesnap_id:3821016,discount:30},scr:{price:26.45,bluesnap_test_id:2584435,bluesnap_id:3821018,discount:85},sdg:{price:99.37,bluesnap_test_id:2584437,bluesnap_id:3821020,discount:85},thb:{paypal_test_id:"P-5K520883VF272223XL2HDXUQ",price:58.85,paypal_id:"P-2E4667658B0481319L2HEB2A",bluesnap_test_id:2584439,bluesnap_id:3821022,discount:85},tnd:{price:17.44,bluesnap_test_id:2584441,bluesnap_id:3821024,discount:50},ttd:{price:56.72,bluesnap_test_id:2584443,bluesnap_id:3821026,discount:30},tzs:{price:4160.83,bluesnap_test_id:2584445,bluesnap_id:3821028,discount:85},uyu:{price:284.19,bluesnap_test_id:2584447,bluesnap_id:3821030,discount:50},uzs:{price:62430.44,bluesnap_test_id:2584449,bluesnap_id:3821032,discount:50},vef:{price:65.02,bluesnap_test_id:2584451,discount:50},xcd:{price:17.59,bluesnap_test_id:2584453,bluesnap_id:3821034,discount:50}}},{id:"josh_1y",period:"1 Y",bluesnap_test_id:2581791,bluesnap_id:3815114,avangate_id:29086022,avangate_product:"90134D1BB1",paypal_id:"P-5GP12483RR459984DLWYVPHI",paypal_test_id:"P-88U39284PA049131WLWSMYJI",price:83.88,is_active:true,currency:{vnd:{bluesnap_test_id:2584457,bluesnap_id:3821040,price:322885,discount:85},aud:{bluesnap_test_id:2584459,bluesnap_id:3821042,price:134.72,paypal_test_id:"P-9XS39574R3777915NL2HEE6I",paypal_id:"P-9V455107NE568414CL2HEGHA",discount:0},gbp:{bluesnap_test_id:2584461,bluesnap_id:3821044,price:67.74,paypal_test_id:"P-92U284034Y539442PL2HEE6Y",paypal_id:"P-8BJ83808Y9400721BL2HEGHQ",discount:0},cad:{bluesnap_test_id:2584463,bluesnap_id:3821046,price:117.57,paypal_test_id:"P-1J067827EY252530CL2HEE7A",paypal_id:"P-4JL41990R8704151BL2HEGIA",discount:0},eur:{bluesnap_test_id:2584465,bluesnap_id:3821048,price:77.24,paypal_test_id:"P-5VX36528P0103035YL2HEE7I",paypal_id:"P-6KC918281A4057523L2HEGII",discount:0},jpy:{bluesnap_test_id:2584467,bluesnap_id:3821050,price:9129,paypal_test_id:"P-825792800U563260KL2HEE7Y",paypal_id:"P-62N61220MS602823FL2HEGIY",discount:0},nzd:{bluesnap_test_id:2584469,bluesnap_id:3821052,price:139.71,paypal_test_id:"P-1KX09281JV8848729L2HEFAA",paypal_id:"P-21G65150VM739444YL2HEGJA",discount:0},sgd:{bluesnap_test_id:2584471,bluesnap_id:3821054,price:119.57,paypal_test_id:"P-1SJ91791AJ497192GL2HEFAQ",paypal_id:"P-9T454093TF0195614L2HEGJQ",discount:0},chf:{bluesnap_test_id:2584473,bluesnap_id:3821056,price:81.51,paypal_test_id:"P-5CX45493T3215215VL2HEFAY",paypal_id:"P-5EF93552VD784563GL2HEGJY",discount:0},ils:{bluesnap_test_id:2584475,bluesnap_id:3821058,price:301,paypal_test_id:"P-96H05255J90890326L2HEFBA",paypal_id:"P-3FS45971WS3778620L2HEGKI",discount:0},pab:{bluesnap_test_id:2584477,price:83.89,bluesnap_id:3821060,discount:0},sek:{bluesnap_test_id:2584479,bluesnap_id:3821062,price:845.29,paypal_test_id:"P-6CK57000MW495892FL2HEFBY",paypal_id:"P-2XN19433KF9062435L2HEGLA",discount:0},nok:{bluesnap_id:3821064,price:859.97,bluesnap_test_id:2584481,paypal_test_id:"P-6H121403MF748600WL2HEFCA",paypal_id:"P-8V685363CK660631BL2HEGLI",discount:0},twd:{bluesnap_test_id:2584483,bluesnap_id:3821066,price:2526,paypal_test_id:"P-9EB85117UL350804AL2HEFCI",paypal_id:"P-6BJ43864JF314171RL2HEGLY",discount:0},isk:{bluesnap_test_id:2584485,bluesnap_id:3821068,price:12040.99,discount:0},hkd:{bluesnap_test_id:2584487,bluesnap_id:3821070,price:650.23,paypal_test_id:"P-32A58936Y08979541L2HEFDA",paypal_id:"P-95972848130934848L2HEGMI",discount:0},rub:{bluesnap_test_id:2584489,bluesnap_id:3821072,price:3147.4,paypal_test_id:"P-3Y737333KF0172400L2HEFDI",paypal_id:"P-6WE219858U2009224L2HEGMY",discount:50},mxn:{bluesnap_test_id:2584491,bluesnap_id:3821074,price:1009.5,paypal_test_id:"P-5E251280JB6993155L2HEFDQ",paypal_id:"P-08G1467019954060VL2HEGNA",discount:50},brl:{bluesnap_test_id:2584493,bluesnap_id:3821076,price:214.92,paypal_test_id:"P-3YK28714PG1816623L2HEFEA",paypal_id:"P-4H208028UV283913DL2HEGNQ",discount:50},lkr:{bluesnap_test_id:2584495,bluesnap_id:3821078,price:2435.42,discount:85},inr:{bluesnap_test_id:2584497,bluesnap_id:3821080,price:955.46,discount:85},zar:{bluesnap_test_id:2584499,bluesnap_id:3821082,price:828.52,discount:50},ars:{bluesnap_test_id:2584501,bluesnap_id:3821084,price:2729.98,discount:50},cop:{bluesnap_test_id:2583559,bluesnap_id:3819390,price:166963},try:{bluesnap_test_id:2584503,bluesnap_id:3821086,price:284.15,discount:50},php:{bluesnap_test_id:2584505,bluesnap_id:3821088,price:636.43,paypal_test_id:"P-58902303TF833405VL2HEFFQ",paypal_id:"P-3AJ89115V0198572FL2HEGPI",discount:85},krw:{bluesnap_test_id:2584507,bluesnap_id:3821090,price:102025,discount:0},cny:{bluesnap_test_id:2584509,bluesnap_id:3821092,price:296.35,discount:50},pkr:{bluesnap_test_id:2584511,bluesnap_id:3821094,price:2107.65,discount:85},myr:{bluesnap_test_id:2584513,bluesnap_id:3821096,price:54.7,discount:85},xof:{bluesnap_test_id:2584515,bluesnap_id:3821098,price:8266,discount:85},dzd:{bluesnap_test_id:2584517,bluesnap_id:3821100,price:5319.92,discount:50},idr:{bluesnap_test_id:2584519,bluesnap_id:3821102,price:202457.58,discount:85},mad:{bluesnap_test_id:2584521,bluesnap_id:3821104,price:430.43,discount:50},uah:{bluesnap_test_id:2584523,bluesnap_id:3821106,price:1144.1,discount:50},aed:{bluesnap_test_id:2584525,price:215.66,bluesnap_id:3821108,discount:30},afn:{bluesnap_test_id:2584527,price:959.38,bluesnap_id:3821110,discount:85},all:{bluesnap_test_id:2584529,price:6829.05,bluesnap_id:3821112,discount:30},amd:{bluesnap_test_id:2584531,price:29157.21,bluesnap_id:3821114,discount:30},ang:{bluesnap_test_id:2584533,price:105.12,bluesnap_id:3821116,discount:30},awg:{bluesnap_test_id:2584535,price:105.69,bluesnap_id:3821118,discount:30},bam:{bluesnap_test_id:2584537,price:105.65,bluesnap_id:3821120,discount:30},bbd:{bluesnap_test_id:2584539,price:118.58,bluesnap_id:3821122,discount:30},bgn:{bluesnap_test_id:2584541,price:105.74,bluesnap_id:3821124,discount:30},bhd:{bluesnap_test_id:2584543,price:22.17,bluesnap_id:3821126,discount:30},bmd:{bluesnap_test_id:2584545,price:83.88,bluesnap_id:3821128,discount:0},bnd:{bluesnap_test_id:2584547,price:83.81,bluesnap_id:3821130,discount:30},bob:{bluesnap_test_id:2584549,price:289.23,bluesnap_id:3821132,discount:50},bsd:{bluesnap_test_id:2584551,price:58.73,bluesnap_id:3821134,discount:30},bwp:{bluesnap_test_id:2584553,price:151.71,bluesnap_id:3821136,discount:85},byr:{bluesnap_test_id:2584555,price:1150834,bluesnap_id:3821138,discount:30},clp:{bluesnap_test_id:2584557,price:49562,bluesnap_id:3821140,discount:30},crc:{bluesnap_test_id:2584559,price:33621.45,bluesnap_id:3821142,discount:30},czk:{bluesnap_test_id:2584561,paypal_test_id:"P-6X522905V11708422L2HEFLQ",price:2098.67,bluesnap_id:3821144,paypal_id:"P-80E54968RJ5864125L2HEGVI",discount:0},dkk:{bluesnap_test_id:2584563,paypal_test_id:"P-58X35999UB881570NL2HEFMA",price:576.73,bluesnap_id:3821146,paypal_id:"P-29872903BC242213FL2HEGVY",discount:0},dop:{bluesnap_test_id:2584565,price:2281.74,bluesnap_id:3821148,discount:50},egp:{bluesnap_test_id:2584567,price:660.63,bluesnap_id:3821150,discount:50},fjd:{bluesnap_test_id:2584569,price:96.58,bluesnap_id:3821152,discount:50},gel:{bluesnap_test_id:2584571,price:186.42,bluesnap_id:3821154,discount:30},gip:{bluesnap_test_id:2584573,price:67.73,bluesnap_id:3821156,discount:0},gtq:{bluesnap_test_id:2584575,price:97.15,bluesnap_id:3821158,discount:85},hrk:{bluesnap_test_id:2584577,price:471.26,bluesnap_id:3821160,discount:20},huf:{bluesnap_test_id:2584579,paypal_test_id:"P-78727277RD1188441L2HEFNA",price:22100,bluesnap_id:3821162,paypal_id:"P-5W369045G7442522CL2HEGXA",discount:20},jmd:{bluesnap_test_id:2584581,price:7949.71,bluesnap_id:3821164,discount:30},jod:{bluesnap_test_id:2584583,price:41.63,bluesnap_id:3821166,discount:30},kes:{bluesnap_test_id:2584585,price:1334.82,bluesnap_id:3821168,discount:85},khr:{bluesnap_test_id:2584587,price:51145.83,bluesnap_id:3821170,discount:85},kwd:{bluesnap_test_id:2584589,price:18.3,bluesnap_id:3821172,discount:30},kyd:{bluesnap_test_id:2584591,price:48.94,bluesnap_id:3821174,discount:30},kzt:{bluesnap_test_id:2584593,price:25598,bluesnap_id:3821176,discount:30},lbp:{bluesnap_test_id:2584595,price:88803.63,bluesnap_id:3821178,discount:30},mdl:{bluesnap_test_id:2584597,price:1080.59,bluesnap_id:3821180,discount:30},mkd:{bluesnap_test_id:2584599,price:3330.77,bluesnap_id:3821182,discount:30},mro:{bluesnap_test_id:2584601,price:4491.78,bluesnap_id:3821184,discount:85},mur:{bluesnap_test_id:2584603,price:494.45,bluesnap_id:3821186,discount:85},mwk:{bluesnap_test_id:2584605,price:9247.77,bluesnap_id:3821188,discount:85},nad:{bluesnap_test_id:2584607,price:228.74,bluesnap_id:3821190,discount:85},ngn:{bluesnap_test_id:2584609,price:4617.6,bluesnap_id:3821192,discount:85},npr:{bluesnap_test_id:2584611,price:1534.37,bluesnap_id:3821194,discount:85},omr:{bluesnap_test_id:2584613,price:22.6,bluesnap_id:3821196,discount:30},pen:{bluesnap_test_id:2584615,price:141.36,bluesnap_id:3821198,discount:50},pgk:{bluesnap_test_id:2584617,price:42.97,bluesnap_id:3821200,discount:85},pln:{bluesnap_test_id:2584619,paypal_test_id:"P-9GF78599DB3834605L2HEFPQ",price:349.84,bluesnap_id:3821202,paypal_id:"P-33978592NE9033330L2HEGZY",discount:0},qar:{bluesnap_test_id:2584621,price:305.36,bluesnap_id:3821204,discount:0},ron:{bluesnap_test_id:2584623,price:261.36,bluesnap_id:3821206,discount:30},rsd:{bluesnap_test_id:2584625,price:6357.18,bluesnap_id:3821208,discount:30},sar:{bluesnap_test_id:2584627,price:220.83,bluesnap_id:3821210,discount:30},scr:{bluesnap_test_id:2584629,price:185.02,bluesnap_id:3821212,discount:85},sdg:{bluesnap_test_id:2584631,price:695.16,bluesnap_id:3821214,discount:85},thb:{bluesnap_test_id:2584633,paypal_test_id:"P-56P77226ED692794WL2HEFQQ",price:411.68,bluesnap_id:3821216,paypal_id:"P-2RN19163WD690984VL2HEG2Q",discount:85},tnd:{bluesnap_test_id:2584635,price:121.99,bluesnap_id:3821218,discount:50},ttd:{bluesnap_test_id:2584637,price:396.81,bluesnap_id:3821220,discount:30},tzs:{bluesnap_test_id:2584639,price:29108.45,bluesnap_id:3821222,discount:85},uyu:{bluesnap_test_id:2584641,price:1988.13,bluesnap_id:3821224,discount:50},uzs:{bluesnap_test_id:2584643,price:436752.77,bluesnap_id:3821226,discount:50},vef:{bluesnap_test_id:2584645,price:454.86,discount:50},xcd:{bluesnap_test_id:2584647,price:123.08,bluesnap_id:3821228,discount:50}}},{id:"josh_3y",period:"3 Y",bluesnap_test_id:2581795,bluesnap_id:3815118,avangate_id:29086061,avangate_product:"3BD3FAB3F3",price:107.55,is_active:true,currency:{vnd:{bluesnap_test_id:2584649,bluesnap_id:3821234,price:414e3,discount:85},aud:{bluesnap_test_id:2584651,bluesnap_id:3821236,price:172.74,discount:0},gbp:{bluesnap_test_id:2584653,bluesnap_id:3821238,price:86.86,discount:0},cad:{bluesnap_test_id:2584655,bluesnap_id:3821240,price:150.75,discount:0},eur:{bluesnap_test_id:2584657,bluesnap_id:3821242,price:99.04,discount:0},jpy:{bluesnap_test_id:2584659,bluesnap_id:3821244,price:11706,discount:0},nzd:{bluesnap_test_id:2584661,bluesnap_id:3821246,price:179.14,discount:0},sgd:{bluesnap_test_id:2584663,bluesnap_id:3821248,price:153.31,discount:0},chf:{bluesnap_test_id:2584665,bluesnap_id:3821250,price:104.52,discount:0},ils:{bluesnap_test_id:2584667,bluesnap_id:3821252,price:386,discount:0},pab:{bluesnap_test_id:2584669,bluesnap_id:3821254,price:107.56,discount:0},sek:{bluesnap_test_id:2584671,bluesnap_id:3821256,price:1083.82,discount:0},nok:{bluesnap_test_id:2584673,bluesnap_id:3821258,price:1102.65,discount:0},twd:{bluesnap_test_id:2584675,bluesnap_id:3821260,price:3239,discount:0},isk:{bluesnap_test_id:2584677,bluesnap_id:3821262,price:15438.82,discount:0},hkd:{bluesnap_test_id:2584679,bluesnap_id:3821264,price:833.71,discount:0},rub:{bluesnap_test_id:2584681,bluesnap_id:3821266,price:4035.56,discount:50},mxn:{bluesnap_test_id:2584683,bluesnap_id:3821268,price:1294.37,discount:50},brl:{bluesnap_test_id:2584685,bluesnap_id:3821270,price:275.56,discount:50},lkr:{bluesnap_test_id:2584687,bluesnap_id:3821272,price:3122.67,discount:85},inr:{bluesnap_test_id:2584689,bluesnap_id:3821274,price:1225.09,discount:85},zar:{bluesnap_test_id:2584691,bluesnap_id:3821276,price:1062.32,discount:50},ars:{bluesnap_test_id:2584693,bluesnap_id:3821278,price:3500.35,discount:50},cop:{bluesnap_test_id:2583561,bluesnap_id:3819396,price:214078},try:{bluesnap_test_id:2584695,bluesnap_id:3821280,price:364.34,discount:50},php:{bluesnap_test_id:2584697,bluesnap_id:3821282,price:816.02,discount:85},krw:{bluesnap_test_id:2584699,bluesnap_id:3821284,price:130815,discount:0},cny:{bluesnap_test_id:2584701,bluesnap_id:3821286,price:379.97,discount:50},pkr:{bluesnap_test_id:2584703,bluesnap_id:3821288,price:2702.4,discount:85},myr:{bluesnap_test_id:2584705,bluesnap_id:3821290,price:70.14,discount:85},xof:{bluesnap_test_id:2584707,bluesnap_id:3821292,price:10599,discount:85},dzd:{bluesnap_test_id:2584709,bluesnap_id:3821294,price:6821.14,discount:50},idr:{bluesnap_test_id:2584711,bluesnap_id:3821296,price:259588.85,discount:85},mad:{bluesnap_test_id:2584713,bluesnap_id:3821298,price:551.89,discount:50},uah:{bluesnap_test_id:2584715,bluesnap_id:3821300,price:1466.96,discount:50},aed:{bluesnap_test_id:2584717,price:276.52,bluesnap_id:3821302,discount:30},afn:{bluesnap_test_id:2584719,price:1230.1,bluesnap_id:3821304,discount:85},all:{bluesnap_test_id:2584721,price:8756.14,bluesnap_id:3821306,discount:30},amd:{bluesnap_test_id:2584723,price:37385.05,bluesnap_id:3821308,discount:30},ang:{bluesnap_test_id:2584725,price:134.79,bluesnap_id:3821310,discount:30},awg:{bluesnap_test_id:2584727,price:135.51,bluesnap_id:3821312,discount:30},bam:{bluesnap_test_id:2584729,price:135.47,bluesnap_id:3821314,discount:30},bbd:{bluesnap_test_id:2584731,price:152.04,bluesnap_id:3821316,discount:30},bgn:{bluesnap_test_id:2584733,price:135.57,bluesnap_id:3821318,discount:30},bhd:{bluesnap_test_id:2584735,price:28.43,bluesnap_id:3821320,discount:30},bmd:{bluesnap_test_id:2584737,price:107.55,bluesnap_id:3821322,discount:0},bnd:{bluesnap_test_id:2584739,price:107.45,bluesnap_id:3821324,discount:30},bob:{bluesnap_test_id:2584741,price:370.85,bluesnap_id:3821326,discount:50},bsd:{bluesnap_test_id:2584743,price:75.3,bluesnap_id:3821328,discount:30},bwp:{bluesnap_test_id:2584745,price:194.53,bluesnap_id:3821330,discount:85},byr:{bluesnap_test_id:2584747,price:1475586,bluesnap_id:3821332,discount:30},clp:{bluesnap_test_id:2584749,price:63548,bluesnap_id:3821334,discount:30},crc:{bluesnap_test_id:2584751,price:43109.05,bluesnap_id:3821336,discount:30},czk:{bluesnap_test_id:2584753,price:2690.89,bluesnap_id:3821338,discount:0},dkk:{bluesnap_test_id:2584755,price:739.47,bluesnap_id:3821340,discount:0},dop:{bluesnap_test_id:2584757,price:2925.62,bluesnap_id:3821342,discount:50},egp:{bluesnap_test_id:2584759,price:847.05,bluesnap_id:3821344,discount:50},fjd:{bluesnap_test_id:2584761,price:123.84,bluesnap_id:3821346,discount:50},gel:{bluesnap_test_id:2584763,price:239.03,bluesnap_id:3821348,discount:30},gip:{bluesnap_test_id:2584765,price:86.85,bluesnap_id:3821350,discount:0},gtq:{bluesnap_test_id:2584767,price:124.57,bluesnap_id:3821352,discount:85},hrk:{bluesnap_test_id:2584769,price:604.24,bluesnap_id:3821354,discount:20},huf:{bluesnap_test_id:2584771,price:28336,bluesnap_id:3821356,discount:20},jmd:{bluesnap_test_id:2584773,price:10193.03,bluesnap_id:3821358,discount:30},jod:{bluesnap_test_id:2584775,price:53.37,bluesnap_id:3821360,discount:30},kes:{bluesnap_test_id:2584777,price:1711.49,bluesnap_id:3821362,discount:85},khr:{bluesnap_test_id:2584779,price:65578.61,bluesnap_id:3821364,discount:85},kwd:{bluesnap_test_id:2584781,price:23.46,bluesnap_id:3821366,discount:30},kyd:{bluesnap_test_id:2584783,price:62.74,bluesnap_id:3821368,discount:30},kzt:{bluesnap_test_id:2584785,price:32821.47,bluesnap_id:3821370,discount:30},lbp:{bluesnap_test_id:2584787,price:113863.02,bluesnap_id:3821372,discount:30},mdl:{bluesnap_test_id:2584789,price:1385.52,bluesnap_id:3821374,discount:30},mkd:{bluesnap_test_id:2584791,price:4270.68,bluesnap_id:3821376,discount:30},mro:{bluesnap_test_id:2584793,price:5759.31,bluesnap_id:3821378,discount:85},mur:{bluesnap_test_id:2584795,price:633.98,bluesnap_id:3821380,discount:85},mwk:{bluesnap_test_id:2584797,price:11857.39,bluesnap_id:3821382,discount:85},nad:{bluesnap_test_id:2584799,price:293.28,bluesnap_id:3821384,discount:85},ngn:{bluesnap_test_id:2584801,price:5920.63,bluesnap_id:3821386,discount:85},npr:{bluesnap_test_id:2584803,price:1967.35,bluesnap_id:3821388,discount:85},omr:{bluesnap_test_id:2584805,price:28.98,bluesnap_id:3821390,discount:30},pen:{bluesnap_test_id:2584807,price:181.25,bluesnap_id:3821392,discount:50},pgk:{bluesnap_test_id:2584809,price:55.09,bluesnap_id:3821394,discount:85},pln:{bluesnap_test_id:2584811,price:448.56,bluesnap_id:3821396,discount:0},qar:{bluesnap_test_id:2584813,price:391.54,bluesnap_id:3821398,discount:0},ron:{bluesnap_test_id:2584815,price:335.11,bluesnap_id:3821400,discount:30},rsd:{bluesnap_test_id:2584817,price:8151.11,bluesnap_id:3821402,discount:30},sar:{bluesnap_test_id:2584819,price:283.15,bluesnap_id:3821404,discount:30},scr:{bluesnap_test_id:2584821,price:237.22,bluesnap_id:3821406,discount:85},sdg:{bluesnap_test_id:2584823,price:891.32,bluesnap_id:3821408,discount:85},thb:{bluesnap_test_id:2584825,price:527.86,bluesnap_id:3821410,discount:85},tnd:{bluesnap_test_id:2584827,price:156.42,bluesnap_id:3821412,discount:50},ttd:{bluesnap_test_id:2584829,price:508.78,bluesnap_id:3821414,discount:30},tzs:{bluesnap_test_id:2584831,price:37322.53,bluesnap_id:3821416,discount:85},uyu:{bluesnap_test_id:2584833,price:2549.15,bluesnap_id:3821418,discount:50},uzs:{bluesnap_test_id:2584835,price:559999.53,bluesnap_id:3821420,discount:50},vef:{bluesnap_test_id:2584837,price:583.21,discount:50},xcd:{bluesnap_test_id:2584839,price:157.81,bluesnap_id:3821422,discount:50}}}],plan_ids:["free","josh_1m","josh_3y"],watermark_plan_ids:["josh_1m","josh_1y","josh_3y"],trial_plan_ids:["josh_1m","josh_1y","josh_3y"]},signin_redirect_back_to_site_min_ver:"1.145.963",ws2:{min_version:"1.155.325",agent:{enabled_on:0},ccgi:{enabled_on:0,fallback_on:0,conf:{handshake_timeout:3e3}}},stub_selection_for_skip_urls:false,agent_auth2:{min_ver:"1.148.123",urls:["^https?://play\\.hulu\\.com/.*/playlist","^https?://discover\\.hulu\\.com/content/.*/(deeplink|home|genres|browse)\\?","^https?://[^.]*\\.itv\\.com/playlist/","^https?://ais\\.channel4\\.com/asset/\\d+\\?","^https?://ais\\.channel4\\.com/simulcast/","^https?://playback-api\\.b17g\\.net/media/\\d+\\?service=tv4"],new_agent:1},proxy_auth3:1,verify_period_ms:864e5,verify_proxy:{min_ver:"1.156.341",period_ms:864e5,disable_verify:false,verify_err:{period:864e5,count:1e4}},fix_vpn_set_err:{max:0},proxy_error_ui:{min_ver:"9.999.999",icon:true,popup:true,dialog:false},new_trial_ui_min_ver:"1.157.597",disable_peer_agents:1,trial_rules_disable_min_ver:"1.158.319",reauth:{period:9e5},upgrade_link:{enabled:true,position:"right"},ip_check_min_ver:"1.160.558",is_zgettunnels_post2:0,is_zgettunnels_post3:1,is_zgettunnels_post4:1,rate_us:{urls:[{url:"https://www.trustpilot.com/evaluate/hola.org",rand:.1,countries:["US","GB"]},{url:"store",rand:.9}]},no_log_for_plus:false,no_log_for_uid:{},no_log_perrs:["be_install","be_update","be_vpn_ok","be_ui_vpn_click_no_fix_it","be_ui_vpn_click_no_fix_it_multi","be_report_problem","be_issue_report","be_etask_typeerror_known","be_etask_typeerror_unknown"],tpopup_window_min_ver:"1.168.477",disable_slow_load_monitor:true,proxy_rules:{exceptions:{dynamic:["netflix.com","hulu.com","hulu.jp","itv.com","channel4.com","rte.ie"],peer:["netflix.com","hulu.com","hulu.jp","itv.com","channel4.com","rte.ie"],pairs:[["bbc.com","bbc.co.uk"]],limited:[]},blacklist:{"equinix.com":true,"digitalocean.com":true,"oceanconservancy.org":true,"mail.yahoo.com":true,"mail.yahoo.co.jp":true,"mail.aol.com":true,"mail.aol.fr":true,"mail.com":true,"gmx.com":true,"couponcabin.com":true,"outlook.live.com":true,"hotmail.live.com":true,"outlook.com":true,"mailto.space":true,"e.mail.ru":true,"login.sso.bluewin.ch":true,"secure.centurylink.net":true,"secureserver.net":true,"webmail.usfamily.net":true,"webmail.skymesh.net.au":true,"hanmail.net":true,"mail.rambler.ru":true,"freeola.co.uk":true,"webmail-04.datacenter.cha.cantv.net":true,"linustechtips.com":true,"3capp-mailcom-lxa01.server.lan":true,"noiholiday.com":true,"hostedemail.com":true,"heyholla.com":true,"hellixeducation.com":true,"unisalento.it":true,"secrel.com.br":true,"mailorama.fr":true,"kiwiirc.com":true,"derpibooru.org":true,"trixiebooru.org":true,"derpiboo.ru":true,"derpicdn.net":true,"alice.it":true,"vcwebmail.ocn.ad.jp":true,"tentaciones18.com":true,"ocn.ad.jp":true,"ocn.ne.jp":true,"webmail.numericable.fr":true,"webmail.scarlet.be":true,"webmailer.de":true,"mail.uk.tiscali.com":true,"elisa.fi":true,"saunalahti.fi":true,"globalgiving.org":true,"synacor.com":true,"knology.net":true,"netmail.pipex.net":true,"sony.com":true,"playstation.com":true,"playstation.net":true,"playstationnetwork.com":true,"sonymusic.com":true,"sonypictures.com":true,"sonyentertainmentnetwork.com":true,"perfora.net":true,"hmail.com":true,"gigablast.com":true,"126.com":true,"ono.com":true,"funded.today":true,"manenetheoffnewconne.ru":true,"dlfeed.com":true,"odbnfhbyagyz4.net":true,"pinformationbwarranties.ru":true,"musttthewithoutalsothas.ru":true,"bjkaolp4ds4z.com":true,"advseeking.com":true,"companolo.com":true,"mijnbankering-nl-server.com":true,"froekuge.com":true,"updateacces.org":true,"sophisticatiretaj.net":true,"soap4.me":true,"boriel.com":true,"ebb.mtn.co.za":true,"osbservices.vodacom.co.za":true,"apps.telkom.co.za":true,"holadebug.com":true,"fretebras.com.br":true,"megacupons.online":true,"vitacostapi.bbhosted.com":true,"mobilepayca.com":true,"mobilepayusa.org":true,"mobilepayusa.mobi":true,"mobilepayusa.net":true,"mobilepay-web.gaiareply.eu":true,"puffin.com":true,"miosmsclub.com":true,"linkedin.com":true,"ticketsnow.com":true,"playerline.com":true,"ticketmaster.com":true,"ticketmaster.com.mx":true,"livenation.com":true,"stubhub.com":true,"tickets.com":true,"craigslist.org":true,"btc4you.com":true,"elbitcoingratis.es":true,"btcmine.net":true,"virtualfaucet.net":true,"rawbitcoins.net":true,"freebitcoins4u.com":true,"canhasbitcoin.com":true,"bitcats.net":true,"faucetbtc.com":true,"bitcoins4free.me":true,"thefreebitcoins.net":true,"freebitcoins.me":true,"5mindoge.com":true,"freedoge.co.in":true,"moondoge.co.in":true,"moonbit.co.in":true,"bonusbitcoin.co":true,"bitcoinspace.net":true,"btc-faucet.co":true,"treebitcoin.com":true,"flatcoin.net":true,"baglitecoin.com":true,"moonliteco.in":true,"freebitco.in":true,"github.com":true,"smartadvices.com":true,"generictadalafilusa.com":true,"getitllc.com":true,"createyourownteeshirtonline.com":true,"mondino.it":true,"daum.net":true,"workbooks.com":true,"forum.qt.io":true,"radicalexploits.com":true,"craigslist.ca":true,"craigslist.co.uk":true,"bisaboard.de":true,"criusenergy.com":true,"arenagroup.com":true,"truqueira.com":true,"cratejoy.com":true,"gaynext.ca":true,"hispachan.org":true,"freenode.net":true,"exigent.com.au":true,"au.edu":true,"runsignup.com":true,"thegreekbookstore.com":true,"arriveonline.com.au":true,"reimageplus.com":true,"goso.info":true,"checkip.dyndns.org":true,"warezshare.org":true,"blocklist.de":true,"twiki.org":true,"intherooms.com":true,"globalinnovationexchange.org":true,"portal.webgods.de":true,"postfinance.ch":true,"gvtc.com":true,"cantv.net":true,"homepage-baukasten.de":true,"paginawebgratis.es":true,"own-free-website.com":true,"sitowebfaidate.it":true,"ma-page.fr":true,"homepage-konstruktor.ru":true,"bedava-sitem.com":true,"stronygratis.pl":true,"news.ycombinator.com":true,"tdchosting.dk":true,"infusionsoft.com":true,"puregaming.es":true,"blogalizate.com":true,"teftv.com":true,"porticolegal.com":true,"physicalmed.es":true,"www.htcmania.com":true,"www.tebeosfera.com":true,"grupopuntacana.rubypanel.com":true,"www.fansdeapple.com":true,"cerebriti.com":true,"educaciontrespuntocero.com":true,"pymescomercial.com":true,"creativat.com":true,"financiacionparaempresas.net":true,"moon.rightdns.com":true,"uptodate.com":true,"judoprincast.com":true,"office365.com":true},enable:true,stamp:0,unblocker_plus:{all_browser:{match:{root_urls:["all_browser"],rules:[{proxy_country:["ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["all_browser"],then:"PROXY XX.POOL",if:[]}]},{cmds:[{root_urls:["all_browser"],then:"PROXY XX"}]}]}},br_default:{cmds:[{proxy_country:["BR"],then:"PROXY BR.POOL",if:[]}]},atresplayer_com:{match:{root_urls:["atresplayer.com"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["atresplayer.com"],then:"PROXY ES.POOL",if:[]},{hosts:["api.atresplayer.com"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["atresplayer.com"],then:"PROXY ES.POOL",if:[]},{hosts:["api.atresplayer.com"],then:"PROXY ES.PEER",if:[]}]},cbs_com:{match:{root_urls:["cbs.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["cbs.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["cbs.com"],then:"PROXY US.POOL",if:[]}]},footlocker_co_uk:{match:{root_urls:["footlocker.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["footlocker.co.uk"],then:"PROXY GB.POOL",if:[]}]}]},cmds:[{root_urls:["footlocker.co.uk"],then:"PROXY GB.POOL",if:[]}]},pxg_co_kr:{match:{root_urls:["pxg.co.kr"],rules:[{proxy_country:["US"],cmds:[{root_urls:["pxg.co.kr"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["pxg.co.kr"],then:"PROXY US.POOL",if:[]}]},hpjav_tv:{match:{root_urls:["hpjav.tv"],rules:[{proxy_country:["US"],cmds:[{root_urls:["hpjav.tv"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["hpjav.tv"],then:"PROXY US.POOL",if:[]}]},popjav_tv:{match:{root_urls:["popjav.tv"],rules:[{proxy_country:["US"],cmds:[{root_urls:["popjav.tv"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["popjav.tv"],then:"PROXY US.POOL",if:[]}]},anybunny_tv:{match:{root_urls:["anybunny.tv"],rules:[{proxy_country:["US"],cmds:[{root_urls:["anybunny.tv"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["anybunny.tv"],then:"PROXY US.POOL",if:[]}]},udemy_com:{match:{root_urls:["udemy.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["udemy.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["udemy.com"],then:"PROXY US.POOL",if:[]}]},gamovideo_com:{match:{root_urls:["gamovideo.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["gamovideo.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["gamovideo.com"],then:"PROXY US.POOL",if:[]}]},yellowpages_com:{match:{root_urls:["yellowpages.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["yellowpages.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["yellowpages.com"],then:"PROXY US.POOL",if:[]}]},lawyers_com:{match:{root_urls:["lawyers.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["lawyers.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["lawyers.com"],then:"PROXY US.POOL",if:[]}]},filmizlesene_pw:{match:{root_urls:["filmizlesene.pw"],rules:[{proxy_country:["US"],cmds:[{root_urls:["filmizlesene.pw"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["filmizlesene.pw"],then:"PROXY US.PEER",if:[]}]},dizibox_pw:{match:{root_urls:["dizibox.pw"],rules:[{proxy_country:["US"],cmds:[{root_urls:["dizibox.pw"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["dizibox.pw"],then:"PROXY US.PEER",if:[]}]},skynews_com_au:{match:{root_urls:["skynews.com.au"],rules:[{proxy_country:["AU"],cmds:[{hosts:["www.skynews.com.au"],then:"PROXY AU.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU"}],then:"PROXY AU.PEER"}]}]},cmds:[{hosts:["www.skynews.com.au"],then:"PROXY AU.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU"}],then:"PROXY AU.PEER"}]},sbt_com_br:{match:{root_urls:["sbt.com.br"],rules:[{proxy_country:["BR"],cmds:[{root_urls:["sbt.com.br"],then:"PROXY BR.PEER",if:[]}]}]},cmds:[{root_urls:["sbt.com.br"],then:"PROXY BR.PEER",if:[]}]},bfi_org_uk:{match:{root_urls:["bfi.org.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["bfi.org.uk"],then:"PROXY GB.POOL",if:[]}]}]},cmds:[{root_urls:["bfi.org.uk"],then:"PROXY GB.POOL",if:[]}]},ocs_fr:{match:{root_urls:["ocs.fr"],rules:[{proxy_country:["FR"],cmds:[{root_urls:["ocs.fr"],then:"PROXY FR.POOL",if:[]},{hosts:["www.ocs.fr","statics.ocs.fr","api.ocs.fr"],then:"PROXY FR.POOL",if:[]}]}]},cmds:[{root_urls:["ocs.fr"],then:"PROXY FR.POOL",if:[]},{hosts:["www.ocs.fr","statics.ocs.fr","api.ocs.fr"],then:"PROXY FR.POOL",if:[]}]},line_me:{match:{root_urls:["line.me"],rules:[{cmds:[{proxy_country:["TW"],root_urls:["line.me"],then:"PROXY TW.PEER",if:[]}]}]},cmds:[{proxy_country:["TW"],root_urls:["line.me"],then:"PROXY TW.PEER",if:[]}]},cbc_ca:{match:{root_urls:["cbc.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["cbc.ca"],then:"PROXY CA.POOL",if:[]}]}]},cmds:[{root_urls:["cbc.ca"],then:"PROXY CA.POOL",if:[]}]},tving_com:{match:{root_urls:["tving.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["tving.com"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["tving.com"],then:"PROXY KR.POOL",if:[]}]},afreecatv_com:{match:{root_urls:["afreecatv.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["afreecatv.com"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["afreecatv.com"],then:"PROXY KR.POOL",if:[]}]},vlive_tv:{match:{root_urls:["vlive.tv"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["vlive.tv"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["vlive.tv"],then:"PROXY KR.POOL",if:[]}]},warning_or_kr:{match:{root_urls:["warning.or.kr"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["warning.or.kr"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["warning.or.kr"],then:"PROXY KR.POOL",if:[]}]},viki_com:{match:{root_urls:["viki.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["viki.com"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["viki.com"],then:"PROXY XX.POOL",if:[]}]},ruliweb_com:{match:{root_urls:["ruliweb.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["ruliweb.com"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["ruliweb.com"],then:"PROXY KR.POOL",if:[]}]},nexon_com:{match:{root_urls:["nexon.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["nexon.com"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["nexon.com"],then:"PROXY KR.POOL",if:[]}]},cmd368_com:{match:{root_urls:["cmd368.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["cmd368.com"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["cmd368.com"],then:"PROXY KR.POOL",if:[]}]},dcinside_com:{match:{root_urls:["dcinside.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["dcinside.com"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["dcinside.com"],then:"PROXY KR.POOL",if:[]}]},licindia_in:{match:{root_urls:["licindia.in"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["licindia_in"],then:"PROXY IN.PEER",if:[]}]}]},cmds:[{root_urls:["licindia_in"],then:"PROXY IN.PEER",if:[]}]},yupptv_com:{match:{root_urls:["yupptv.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["yupptv.com"],then:"PROXY IN.PEER",if:[]}]}]},cmds:[{root_urls:["yupptv.com"],then:"PROXY IN.PEER",if:[]}]},sunnxt_com:{match:{root_urls:["sunnxt.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["sunnxt.com"],then:"PROXY IN.PEER",if:[]}]}]},cmds:[{root_urls:["sunnxt.com"],then:"PROXY IN.PEER",if:[]}]},primevideo_com:{match:{root_urls:["primevideo.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["primevideo.com"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["primevideo.com"],then:"PROXY XX.POOL",if:[]}]},zee5_com:{match:{root_urls:["zee5.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["zee5.com"],then:"PROXY IN.PEER",if:[]}]}]},cmds:[{root_urls:["zee5.com"],then:"PROXY IN.PEER",if:[]}]},voot_com:{match:{root_urls:["voot.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["voot.com"],then:"PROXY IN.PEER",if:[]}]}]},cmds:[{root_urls:["voot.com"],then:"PROXY IN.PEER",if:[]}]},mxplayer_in:{match:{root_urls:["mxplayer.in"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["mxplayer.in"],then:"PROXY IN.PEER",if:[]}]}]},cmds:[{root_urls:["mxplayer.in"],then:"PROXY IN.PEER",if:[]}]},huurwoningen_nl:{match:{root_urls:["huurwoningen.nl"],rules:[{proxy_country:["NL"],cmds:[{root_urls:["huurwoningen.nl"],then:"PROXY NL.POOL",if:[]}]}]},cmds:[{root_urls:["huurwoningen.nl"],then:"PROXY NL.POOL",if:[]}]},videoland_com:{match:{root_urls:["videoland.com"],rules:[{proxy_country:["NL"],cmds:[{root_urls:["videoland.com"],then:"PROXY NL.POOL",if:[]}]}]},cmds:[{root_urls:["videoland.com"],then:"PROXY NL.POOL",if:[]}]},nos_nl:{match:{root_urls:["nos.nl"],rules:[{proxy_country:["NL"],cmds:[{root_urls:["nos.nl"],then:"PROXY NL.POOL",if:[]}]}]},cmds:[{root_urls:["nos.nl"],then:"PROXY NL.POOL",if:[]}]},kakao_com:{match:{root_urls:["kakao.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["kakao.com"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["kakao.com"],then:"PROXY XX.POOL",if:[]}]},npostart_nl:{match:{root_urls:["npostart.nl"],rules:[{proxy_country:["NL"],cmds:[{root_urls:["npostart.nl"],then:"PROXY NL.POOL",if:[]}]}]},cmds:[{root_urls:["npostart.nl"],then:"PROXY NL.POOL",if:[]}]},steampowered_com:{match:{root_urls:["steampowered.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["steampowered.com"],then:"PROXY XX.POOL",if:[]}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","HK","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ"],cmds:[{hosts:["steampowered.com"],then:"PROXY XX.PEER"}]}]},cmds:[{root_urls:["steampowered.com"],then:"PROXY XX.POOL",if:[]}]},wormate_io:{match:{root_urls:["wormate.io"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["wormate.io"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["wormate.io"],then:"PROXY XX.POOL",if:[]}]},uol_com_br:{match:{root_urls:["uol.com.br"],rules:[{proxy_country:["BR"],cmds:[{root_urls:["uol.com.br"],then:"PROXY BR.POOL",if:[]}]}]},cmds:[{root_urls:["uol.com.br"],then:"PROXY BR.POOL",if:[]}]},metamask_io:{match:{root_urls:["metamask.io"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["metamask.io"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["metamask.io"],then:"PROXY XX.POOL",if:[]}]},globo_com:{match:{root_urls:["globo.com"],rules:[{proxy_country:["BR"],cmds:[{root_urls:["globo.com"],then:"PROXY BR.POOL",if:[]}]}]},cmds:[{root_urls:["globo.com"],then:"PROXY BR.POOL",if:[]}]},borderlands_com:{match:{root_urls:["borderlands.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["borderlands.com"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["borderlands.com"],then:"PROXY XX.POOL",if:[]}]},bet365_com:{match:{root_urls:["bet365.com"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["bet365.com"],then:"PROXY GB.POOL_serversget_gb",if:[]}]}]},cmds:[{root_urls:["bet365.com"],then:"PROXY GB.POOL_serversget_gb",if:[]}]},pornhub_com:{match:{root_urls:["pornhub.com"],rules:[{proxy_country:["IT"],cmds:[{hosts:["www.pornhub.com"],if:[],then:"PROXY IT.PEER"}]}]},cmds:[{root_urls:["pornhub.com"],if:[],then:"PROXY XX"}]},totalwine_com:{match:{root_urls:["totalwine.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["www.totalwine.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{hosts:["www.totalwine.com"],then:"PROXY US.POOL",if:[]}]},lasestrellas_tv:{match:{root_urls:["lasestrellas_tv"],rules:[{proxy_country:["MX"],cmds:[{hosts:["onlymex-auth.televisa.com"],then:"PROXY MX.PEER",if:[]}]}]},cmds:[{hosts:["onlymex-auth.televisa.com"],then:"PROXY MX.PEER",if:[]}]},criteo_com:{match:{root_urls:["criteo.com"],rules:[{cmds:[{hosts:["criteo.com"],then:"PROXY XX",if:[]}]}]},cmds:[{hosts:["criteo.com"],then:"PROXY XX",if:[]}]},target_com:{match:{root_urls:["target.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["gsp.target.com","login.target.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["gsp.target.com","login.target.com"],then:"PROXY US.PEER",if:[]}]},atv_at:{match:{root_urls:["atv.at"],rules:[{proxy_country:["AT"],cmds:[{hosts:["blocked-multiscreen.atv.cdn.tvnext.tv"],then:"PROXY AT.PEER",if:[]}]}]},cmds:[{hosts:["blocked-multiscreen.atv.cdn.tvnext.tv"],then:"PROXY AT.PEER",if:[]}]},williams_sonoma_com:{match:{root_urls:["williams-sonoma.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["williams-sonoma.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["williams-sonoma.com"],then:"PROXY US.PEER",if:[]}]},player_pl:{match:{root_urls:["player.pl"],rules:[{proxy_country:["PL"],cmds:[{hosts:["player.pl"],if:[{url:"\\/playerapi\\/product\\/.*\\/player\\/configuration.*",type:"!~",then:"PROXY PL"}],then:"PROXY PL.PEER"}]}]},cmds:[{hosts:["player.pl"],if:[{url:"\\/playerapi\\/product\\/.*\\/player\\/configuration.*",type:"!~",then:"PROXY PL"}],then:"PROXY PL.PEER"}]},bigbrothercanada_ca:{match:{root_urls:["bigbrothercanada.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["livestream.com"],then:"PROXY CA.PEER",if:[]},{hosts:["global.corusappservices.com"],then:"PROXY CA.POOL_serversget_ca",if:[]},{root_urls:["bigbrothercanada.ca"],then:"PROXY CA.POOL",if:[]}]}]},cmds:[{root_urls:["livestream.com"],then:"PROXY CA.PEER",if:[]},{hosts:["global.corusappservices.com"],then:"PROXY CA.POOL_serversget_ca",if:[]},{root_urls:["bigbrothercanada.ca"],then:"PROXY CA.POOL",if:[]}]},backcountry_com:{match:{root_urls:["backcountry.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["backcountry.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["backcountry.com"],then:"PROXY US.POOL",if:[]}]},eclinicalweb_com:{match:{root_urls:["eclinicalweb.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["eclinicalweb.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["eclinicalweb.com"],then:"PROXY US.PEER",if:[]}]},carvana_com:{proxy_country:["US"],cmds:[{root_urls:["carvana.com"],then:"PROXY US.POOL",if:[]}]},investopedia_com:{match:{root_urls:["investopedia.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["trafficguardapp.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{hosts:["trafficguardapp.com"],then:"PROXY US.POOL",if:[]}]},orf_at:{match:{root_urls:["orf.at"],rules:[{proxy_country:["AT"],cmds:[{hosts:["apasfiis.sf.apa.at","apasfpd.sf.apa.at"],then:"PROXY AT.PEER",if:[]}]}]},cmds:[{hosts:["apasfiis.sf.apa.at","apasfpd.sf.apa.at"],then:"PROXY AT.PEER",if:[]}]},mol_gov_sa:{match:{root_urls:["mol.gov.sa"],rules:[{proxy_country:["SA"],cmds:[{hosts:["mol.gov.sa"],then:"PROXY SA.PEER",if:[]}]}]},cmds:[{hosts:["mol.gov.sa"],then:"PROXY SA.PEER",if:[]}]},lsm_lv:{match:{root_urls:["lsm.lv"],rules:[{proxy_country:["LV"],cmds:[{hosts:["ltv.lsm.lv","embed.cloudycdn.services","ltv1060.cloudycdn.services","ltv2060.cloudycdn.services"],then:"PROXY LV.PEER",if:[]}]}]},cmds:[{hosts:["ltv.lsm.lv","embed.cloudycdn.services","ltv1060.cloudycdn.services","ltv2060.cloudycdn.services"],then:"PROXY LV.PEER",if:[]}]},eidf_co_kr:{match:{root_urls:["eidf.co.kr"],rules:[{proxy_country:["KR"],cmds:[{hosts:["www.eidf.co.kr"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{hosts:["www.eidf.co.kr"],then:"PROXY KR.POOL",if:[]}]},abercrombie_com:{proxy_country:["US"],cmds:[{root_urls:["abercrombie.com"],then:"PROXY US.POOL",if:[]}]},amazon_com:{match:{root_urls:["amazon.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["amazon.com"],then:"PROXY US.PEER",if:[]},{hosts:["amazon.com","api.amazonvideo.com","atv-ps.amazon.com","api.eu-west-1.aiv-delivery.net"],then:"PROXY US.PEER",if:[]}]}]}},amazon_co_uk:{match:{root_urls:["amazon.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["amazon.co.uk"],then:"PROXY GB.POOL_cogentco_gb",if:[]},{hosts:["amazon.com","api.amazonvideo.com"],then:"PROXY GB.POOL_cogentco_gb",if:[]}]}]},cmds:[{root_urls:["amazon.co.uk"],then:"PROXY GB.POOL_cogentco_gb",if:[]},{hosts:["amazon.com","api.amazonvideo.com"],then:"PROXY GB.POOL_cogentco_gb",if:[]}]},ondemandkorea_com:{proxy_country:["US"],cmds:[{root_urls:["ondemandkorea.com"],then:"PROXY US.POOL",if:[]}]},eastbay_com:{proxy_country:["US"],cmds:[{root_urls:["eastbay.com"],then:"PROXY US.POOL",if:[]}]},origin_com:{proxy_country:["US"],cmds:[{root_urls:["origin.com"],then:"PROXY US.POOL",if:[]}]},disneyplus_com:{match:{root_urls:["disneyplus.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{hosts:["global.edge.bamgrid.com"],then:"PROXY XX.PEER",if:[]},{root_urls:["disneyplus.com"],then:"PROXY XX.POOL",if:[]},{hosts:["disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY XX.POOL",if:[]}]},{cmds:[{hosts:["global.edge.bamgrid.com"],then:"PROXY XX.PEER"}]}]}},hbonow_com:{match:{root_urls:["hbonow.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["comet.api.hbo.com","play.hbonow.com"],then:"PROXY US.PEER",if:[]},{root_urls:["hbonow.com"],then:"PROXY US.POOL",if:[]}]}]}},canalplus_com:{proxy_country:["FR"],cmds:[{root_urls:["canalplus.com"],then:"PROXY FR.POOL",if:[]}]},javhd_pro:{proxy_country:["US"],cmds:[{root_urls:["javhd.pro"],then:"PROXY US.POOL",if:[]}]},zagonka_tv:{proxy_country:["GB"],cmds:[{root_urls:["zagonka.tv"],then:"PROXY GB.PEER",if:[]}]},angieslist_com:{proxy_country:["US"],cmds:[{root_urls:["angieslist.com"],then:"PROXY US.POOL",if:[]}]},areena_yle_fi:{match:{root_urls:["areena.yle.fi"],rules:[{proxy_country:["FI"],cmds:[{hosts:["locations.api.yle.fi"],then:"PROXY FI.PEER",if:[]}]}]},cmds:[{hosts:["locations.api.yle.fi"],then:"PROXY FI.PEER",if:[]}]},bbc_co_uk:{proxy_country:["GB"],cmds:[{hosts:["fig.bbc.co.uk","open.live.bbc.co.uk"],then:"PROXY GB.PEER",if:[]},{root_urls:["bbc.co.uk","bbc.com"],then:"PROXY GB.POOL_serversget_gb",if:[]},{hosts:["bidi.bbc.co.uk","bidi.live.bbc.co.uk","live.bidi.net.uk","vs-dash-uk.live.cf.md.bbci.co.uk","a.files.bbci.co.uk","account.bbc.com","ibl.api.bbc.co.uk","ssl.bbc.co.uk","vod-dash-uk-live.bbcfmt.hs.llnwd.net","vod-thumb-uk-live.bbcfmt.hs.llnwd.net","vs-dash-uk-live.bbcfmt.hs.llnwd.net","vod-sub-uk-live.bbcfmt.hs.llnwd.net","bbcfmt.hs.llnwd.net","vod-thumb-uk-live.akamaized.net","vs-dash-uk-live.akamaized.net","aod-dash-uk-live.akamaized.net","cf.md.bbci.co.uk","www.bbc.co.uk","vod-dash-uk-live.akamaized.net","as-dash-uk-live.akamaized.net"],then:"PROXY GB.POOL_serversget_gb",if:[]}],error_codes:[403]},bergdorfgoodman_com:{proxy_country:["US"],cmds:[{root_urls:["bergdorfgoodman.com"],then:"PROXY US.POOL",if:[]}]},channel4_com:{match:{root_urls:["channel4.com"],rules:[{proxy_country:["GB"],cmds:[{hosts:["ais.channel4.com"],then:"PROXY GB.PEER",if:[]},{root_urls:["channel4.com"],then:"PROXY GB.POOL",if:[]}]}]},cmds:[{hosts:["ais.channel4.com"],then:"PROXY GB.PEER",if:[]},{root_urls:["channel4.com"],then:"PROXY GB.POOL",if:[]}]},criterionchannel_com:{proxy_country:["US"],cmds:[{root_urls:["criterionchannel.com"],then:"PROXY US.POOL",if:[]}]},crunchyroll_com:{match:{root_urls:["crunchyroll.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["crunchyroll.com"],then:"PROXY US.POOL_cogentco_us",if:[]}]}]},cmds:[{root_urls:["crunchyroll.com"],then:"PROXY US.POOL_cogentco_us",if:[]}]},dazn_com:{match:{root_urls:["dazn.com"],rules:[{cmds:[{hosts:["isl.dazn.com","isl-ca.dazn.com","isl-eu.dazn.com","isl-jp.dazn.com","isl-us.dazn.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["isl.dazn.com","isl-ca.dazn.com","isl-eu.dazn.com","isl-jp.dazn.com","isl-us.dazn.com"],then:"PROXY XX.PEER",if:[]}]},dazn_jp:{match:{root_urls:["dazn.jp"],rules:[{proxy_country:["JP"],cmds:[{root_urls:["dazn.jp"],then:"PROXY JP.POOL",if:[]}]}]},cmds:[{root_urls:["dazn.jp"],then:"PROXY JP.POOL",if:[]}]},dr_dk:{proxy_country:["DK"],cmds:[{hosts:["www.dr.dk"],then:"PROXY DK.PEER",if:[]}]},eversource_com:{proxy_country:["US"],cmds:[{root_urls:["eversource.com"],then:"PROXY US.POOL",if:[]},{hosts:["i-doxs.net"],then:"PROXY US.POOL",if:[]}]},espn_com_co:{match:{root_urls:["espn.com.co"],rules:[{proxy_country:["CO"],cmds:[{hosts:["tredir.espn.com"],then:"PROXY CO.POOL",if:[]},{root_urls:["espn.com.co"],then:"PROXY CO.POOL",if:[]}]}]},cmds:[{hosts:["tredir.espn.com"],then:"PROXY CO.POOL",if:[]},{root_urls:["espn.com.co"],then:"PROXY CO.POOL",if:[]}]},fastpeoplesearch_com:{proxy_country:["US"],cmds:[{root_urls:["fastpeoplesearch.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},ffsng_com:{proxy_country:["US"],cmds:[{hosts:["ffsng.com"],if:[{url:"ffsng\\.com\\/ajax\\.php",type:"!~",then:"PROXY US"}],then:"PROXY US.PEER"}]},finishline_com:{proxy_country:["US"],cmds:[{hosts:["finishline.com"],then:"PROXY US.PEER",if:[]}]},footlocker_com:{proxy_country:["US"],cmds:[{root_urls:["footlocker.com"],then:"PROXY US.POOL",if:[]}]},ulta_com:{proxy_country:["US"],cmds:[{root_urls:["ulta.com"],then:"PROXY US.POOL",if:[]}]},jsnx_net:{proxy_country:["US"],cmds:[{root_urls:["jsnx.net"],then:"PROXY US.PEER",if:[]}]},cwtv_com:{proxy_country:["US"],cmds:[{root_urls:["cwtv.com"],then:"PROXY US.POOL_serversget_us",if:[]}]},france_tv:{proxy_country:["FR"],cmds:[{root_urls:["france.tv"],then:"PROXY FR.POOL",if:[]}]},francetvinfo_fr:{proxy_country:["FR"],cmds:[{root_urls:["francetvinfo.fr"],then:"PROXY FR.POOL",if:[]}]},gamestop_com:{proxy_country:["US"],cmds:[{root_urls:["gamestop.com"],then:"PROXY US.POOL",if:[]}]},globaltv_ca:{proxy_country:["CA"],cmds:[{root_urls:["globaltv.com"],then:"PROXY CA.POOL",if:[]},{hosts:["global.corusappservices.com"],then:"PROXY CA.POOL_serversget_ca",if:[]}]},go_com:{match:{root_urls:["go.com"],rules:[{cmds:[{root_urls:["go.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{root_urls:["go.com"],then:"PROXY XX.PEER",if:[]}]},go_us:{proxy_country:["US"],cmds:[{hosts:["prod.gatekeeper.us-abc.symphony.edgedatg.go.com","prod.gatekeeper.us-abc.symphony.edgedatg.com"],then:"PROXY US.PEER",if:[]}]},hbogo:{match:{root_urls:["hbogo.pl","hbogo.ro"],rules:[{cmds:[{hosts:["api.ugw.hbogo.eu"],if:[{url:"api\\.ugw\\.hbogo\\.eu\\/v3\\.0\\/(GeoCheck|Authentication\\/(POL|ROU))\\/(json|JSON).*",type:"!~",then:"PROXY XX"}],then:"PROXY XX.PEER"}]}]},cmds:[{hosts:["api.ugw.hbogo.eu"],if:[{url:"api\\.ugw\\.hbogo\\.eu\\/v3\\.0\\/(GeoCheck|Authentication\\/(POL|ROU))\\/(json|JSON).*",type:"!~",then:"PROXY XX"}],then:"PROXY XX.PEER"}]},hollisterco_com:{proxy_country:["US"],cmds:[{root_urls:["hollisterco.com"],then:"PROXY US.POOL",if:[]}]},hotstar_com:{proxy_country:["IN"],cmds:[{root_urls:["hotstar.com"],then:"PROXY IN.PEER",if:[]},{hosts:["www.hotstar.com","services.hotstar.com","segment.hotstar.com","api.hotstar.com","geoip.hotstar.com"],then:"PROXY IN.PEER",if:[]},{hosts:["hses1.akamaized.net","hses.akamaized.net","hses2.akamaized.net","ds-aksb-a.akamaihd.net","hesads.akamaized.net","hsdesinova.akamaized.net","hses3.akamaized.net","hses4.akamaized.net"],then:"PROXY IN.PEER",if:[]}]},sevenplus_com_au:{proxy_country:["AU"],cmds:[{hosts:["sevennetwork.akamaized.net","live-sevennetwork.akamaized.net","7plus-sevennetwork.akamaized.net"],then:"PROXY AU.PEER",if:[]},{root_urls:["7plus.com.au"],then:"PROXY AU.POOL",if:[]}]},hulu_com:{match:{root_urls:["hulu.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["play.hulu.com"],if:[{url:".*(\\.)?play\\.hulu\\.com\\/.*\\/playlist",type:"!~",then:"PROXY US.POOL"}],then:"PROXY US.PEER"},{hosts:["discover.hulu.com"],if:[{url:"discover\\.hulu\\.com\\/content\\/",type:"!~",then:"PROXY US.POOL"}],then:"PROXY US.PEER"},{root_urls:["hulu.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{hosts:["play.hulu.com"],if:[{url:".*(\\.)?play\\.hulu\\.com\\/.*\\/playlist",type:"!~",then:"PROXY US.POOL"}],then:"PROXY US.PEER"},{hosts:["discover.hulu.com"],if:[{url:"discover\\.hulu\\.com\\/content\\/",type:"!~",then:"PROXY US.POOL"}],then:"PROXY US.PEER"},{root_urls:["hulu.com"],then:"PROXY US.POOL",if:[]}]},hulu_jp:{match:{root_urls:["hulu.jp"],rules:[{proxy_country:["JP"],cmds:[{hosts:["api.happyon.jp"],if:[{url:"api\\.happyon\\.jp\\/v1\\/(auth\\/token|playback\\/video)",type:"!~",then:"PROXY JP.POOL"}],then:"PROXY JP.PEER"},{hosts:["hulu.jp"],if:[{url:"hulu\\.jp\\/(account|signup).*",type:"!~",then:"PROXY JP.POOL"}],then:"PROXY JP.PEER"}]}]},cmds:[{hosts:["api.happyon.jp"],if:[{url:"api\\.happyon\\.jp\\/v1\\/(auth\\/token|playback\\/video)",type:"!~",then:"PROXY JP.POOL"}],then:"PROXY JP.PEER"},{hosts:["hulu.jp"],if:[{url:"hulu\\.jp\\/(account|signup).*",type:"!~",then:"PROXY JP.POOL"}],then:"PROXY JP.PEER"}]},itv_com:{proxy_country:["GB"],cmds:[{root_urls:["itv.com"],then:"PROXY GB.POOL_cogentco_gb",if:[]},{hosts:["magni.itv.com","edge.api.brightcove.com"],then:"PROXY XX.PEER",if:[]},{hosts:["itv.com","itvpnp.live.ott.irdeto.com","itvstatic.com","itvpnpdotcom-a.akamaihd.net","ssl-itvdotcom.2cnt.net"],then:"PROXY GB.POOL_cogentco_gb",if:[]}],error_codes:[403]},iqiyi_com:{proxy_country:["CN"],cmds:[{hosts:["cache.video.iqiyi.com"],if:[{url:".*cache\\.video\\.iqiyi\\.com\\/dash.*",type:"!~",then:"PROXY CN"}],then:"PROXY CN.PEER"}]},iview_abc_net_au:{cmds:[{hosts:["api.iview.abc.net.au"],if:[{url:"api\\.iview\\.abc\\.net\\.au\\/v2\\/(video|token\\/drm)\\/.*",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"},{hosts:["abc-iview-mediapackagestreams-1.akamaized.net"],if:[{url:"abc-iview-mediapackagestreams-1\\.akamaized\\.net\\/out\\/v1\\/\\w+\\/index\\.mpd",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"},{hosts:["iview-vod.akamaized.net"],if:[{url:"iview-vod\\.akamaized\\.net\\/prod\\/ck1\\/\\w+\\/\\w+\\/mpegdash\\/master\\.mpd",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"}]},kaltura_com:{proxy_country:["FI"],cmds:[{hosts:["cdnapisec.kaltura.com","cdnsecakmi.kaltura.com"],then:"PROXY FI.PEER",if:[]}]},kbs_kr:{proxy_country:["KR"],cmds:[{hosts:["onair.kbs.co.kr"],then:"PROXY KR.POOL",if:[]}]},manga_line_me:{proxy_country:["JP"],cmds:[{hosts:["manga.line.me"],then:"PROXY JP.PEER",if:[]}]},mangago_me:{proxy_country:["US"],cmds:[{root_urls:["mangago.me"],then:"PROXY US.POOL",if:[]}]},marcus_com:{proxy_country:["US"],cmds:[{root_urls:["marcus.com"],then:"PROXY US.POOL",if:[]}]},meiliboxi_fi:{proxy_country:["FI"],cmds:[{hosts:["meiliboxi.fi"],then:"PROXY FI.PEER",if:[]}]},mitele_es:{match:{root_urls:["mitele.es"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["mitele.es"],then:"PROXY ES.POOL",if:[]},{hosts:["miteleooyala-vh.akamaihd.net","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","vod.mitele.es"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["mitele.es"],then:"PROXY ES.POOL",if:[]},{hosts:["miteleooyala-vh.akamaihd.net","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","vod.mitele.es"],then:"PROXY ES.PEER",if:[]}]},my5_tv:{proxy_country:["GB"],cmds:[{root_urls:["my5.tv"],then:"PROXY GB.POOL",if:[]}]},naver_com:{cmds:[{root_urls:["naver.com"],if:[{url:"(smartmediarep.com|pstatic.net|vrixon.com).*.(mp4|m3u8|ts)",type:"=~",then:"DIRECT"}],then:"PROXY XX"}]},netflix_com:{match:{min_ver:"1.155.76",root_urls:["netflix.com"],rules:[{proxy_country:["IT","GB","US","KR","BR","NL"],cmds:[{root_urls:["netflix.com"],if:[],then:"PROXY XX.POOL"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY XX.POOL",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["netflix.com"],if:[],then:"PROXY CA.POOL_serversget_ca"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY CA.POOL_serversget_ca"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","HK","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","JP","FR","ES","CO","IN","AU"],cmds:[{root_urls:["netflix.com"],if:[],then:"PROXY XX.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY XX.PEER"}]}]},error_codes:[420]},ome_tv:{match:{root_urls:["ome.tv"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["ome.tv"],then:"PROXY XX.POOL",if:[]},{hosts:["roulette.apps-host.com"],then:"PROXY XX.POOL",if:[]}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","HK","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ"],cmds:[{hosts:["roulette.apps-host.com"],then:"PROXY XX.PEER"}]}]},cmds:[{root_urls:["ome.tv"],then:"PROXY XX.POOL",if:[]},{hosts:["roulette.apps-host.com"],then:"PROXY XX.POOL",if:[]}]},omegle_com:{cmds:[{hosts:["omegle.com"],if:[{url:".*front\\d+\\.omegle\\.com\\/(start|status|events)",type:"!~",then:"PROXY XX"}],then:"PROXY XX.PEER"}]},raiplay_it:{match:{min_ver:"1.155.77",root_urls:["raiplay.it"],rules:[{proxy_country:["IT"],cmds:[{hosts:["akamaihd.net"],if:[{url:"\\.akamaihd\\.net\\/.*(\\.m3u8|\\.ts)",type:"=~",then:"PROXY IT"}],then:"PROXY IT"},{hosts:["mediapolisvod.rai.it","mediapolis.rai.it","mediapolisgs.rai.it"],then:"PROXY IT.PEER",if:[]}]}]}},rte_ie:{cmds:[{root_urls:["rte.ie"],then:"PROXY XX.PEER",if:[]}]},rtlplay_be:{match:{root_urls:["rtlplay.be"],rules:[{proxy_country:["BE"],cmds:[{hosts:["6play.fr","m6web.fr"],then:"PROXY BE.PEER",if:[]}]}]},cmds:[{hosts:["6play.fr","m6web.fr"],then:"PROXY BE.PEER",if:[]}]},sixplay_fr:{match:{root_urls:["6play.fr"],rules:[{proxy_country:["FR"],cmds:[{hosts:["6play.fr"],then:"PROXY FR.PEER",if:[]}]}]},cmds:[{hosts:["6play.fr"],then:"PROXY FR.PEER",if:[]}]},sonyliv_com:{match:{root_urls:["sonyliv.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["sonyliv.com"],then:"PROXY IN.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY IN"}],then:"PROXY IN.PEER"}]}]},cmds:[{root_urls:["sonyliv.com"],then:"PROXY IN.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY IN"}],then:"PROXY IN.PEER"}]},sprint_com:{proxy_country:["US"],cmds:[{root_urls:["sprint.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},stan_com_au:{cmds:[{hosts:["api.stan.com.au"],then:"PROXY AU.PEER",if:[]}]},tenplay_com_au:{match:{root_urls:["tenplay.com.au"],rules:[{proxy_country:["AU"],cmds:[{root_urls:["tenplay.com.au"],then:"PROXY AU.POOL",if:[]},{hosts:["10play.com.au","manifest.prod.boltdns.net","bcboltnet10tp.akamaized.net","10play-vod.global.ssl.fastly.net","10-selector.global.ssl.fastly.net"],then:"PROXY AU.POOL",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"}]}]},cmds:[{root_urls:["tenplay.com.au"],then:"PROXY AU.POOL",if:[]},{hosts:["10play.com.au","manifest.prod.boltdns.net","bcboltnet10tp.akamaized.net","10play-vod.global.ssl.fastly.net","10-selector.global.ssl.fastly.net"],then:"PROXY AU.POOL",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"}]},bfmtv_com:{match:{root_urls:["bfmtv.com"],rules:[{proxy_country:["FR"],cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY FR"}],then:"PROXY FR.PEER"}]}]},cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY FR"}],then:"PROXY FR.PEER"}]},tvnz_co_nz:{match:{root_urls:["tvnz.co.nz"],rules:[{proxy_country:["NZ"],cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY NZ"}],then:"PROXY NZ.PEER"},{hosts:["bcbolttvnz3-a.akamaihd.net"],then:"PROXY NZ.PEER",if:[]}]}]},cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY NZ"}],then:"PROXY NZ.PEER"},{hosts:["bcbolttvnz3-a.akamaihd.net"],then:"PROXY NZ.PEER",if:[]}]},textnow_com:{match:{root_urls:["textnow.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["textnow.com"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["textnow.com"],then:"PROXY XX.POOL",if:[]}]},toggle_sg:{match:{root_urls:["toggle.sg"],rules:[{proxy_country:["SG"],cmds:[{hosts:["player-as.ott.kaltura.com"],if:[{url:".*player-as\\.ott\\.kaltura\\.com\\/.*\\/mwEmbed\\/mwEmbedFrame\\.php.*",type:"!~",then:"PROXY SG"}],then:"PROXY SG.PEER"}]}]},cmds:[{hosts:["player-as.ott.kaltura.com"],if:[{url:".*player-as\\.ott\\.kaltura\\.com\\/.*\\/mwEmbed\\/mwEmbedFrame\\.php.*",type:"!~",then:"PROXY SG"}],then:"PROXY SG.PEER"}]},tv4play_se:{match:{root_urls:["tv4play.se"],rules:[{proxy_country:["SE"],cmds:[{hosts:["playback-api.b17g.net"],then:"PROXY SE.PEER",if:[]}]}]},cmds:[{hosts:["playback-api.b17g.net"],then:"PROXY SE.PEER",if:[]}]},telecinco_es:{match:{root_urls:["telecinco.es"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["telecinco.es"],then:"PROXY ES.POOL",if:[]},{hosts:["gatekeeper.mediaset.es","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","telecinco1-vh.akamaihd.net"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["telecinco.es"],then:"PROXY ES.POOL",if:[]},{hosts:["gatekeeper.mediaset.es","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","telecinco1-vh.akamaihd.net"],then:"PROXY ES.PEER",if:[]}]},energytv_es:{match:{root_urls:["energytv.es"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["energytv.es"],then:"PROXY ES.POOL",if:[]},{hosts:["mdslivehlsb-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["energytv.es"],then:"PROXY ES.POOL",if:[]},{hosts:["mdslivehlsb-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es"],then:"PROXY ES.PEER",if:[]}]},mediaset_it:{match:{root_urls:["mediaset.it"],rules:[{proxy_country:["IT"],cmds:[{hosts:["api-ott-prod-fe.mediaset.net","link.theplatform.eu"],then:"PROXY IT.PEER",if:[]}]}]},cmds:[{hosts:["api-ott-prod-fe.mediaset.net","link.theplatform.eu"],then:"PROXY IT.PEER",if:[]}]},tva_ca:{match:{root_urls:["tva.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["tva.ca","chainetvauls-lh.akamaihd.net"],then:"PROXY CA.POOL_serversget_ca",if:[]},{hosts:["videos.tva.ca","video.tva.ca"],then:"PROXY CA.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_serversget_ca"}],then:"PROXY CA.PEER"}]}]},cmds:[{root_urls:["tva.ca","chainetvauls-lh.akamaihd.net"],then:"PROXY CA.POOL_serversget_ca",if:[]},{hosts:["videos.tva.ca","video.tva.ca"],then:"PROXY CA.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_serversget_ca"}],then:"PROXY CA.PEER"}]},aptnlumi_ca:{match:{root_urls:["aptnlumi.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["aptnlumi.ca"],then:"PROXY CA.POOL",if:[]},{hosts:["cdnapisec.kaltura.com","cdnsecakmi.kaltura.com","cfvod.kaltura.com","analytics.kaltura.com"],then:"PROXY CA.POOL_serversget_ca",if:[]}]}]},cmds:[{root_urls:["aptnlumi.ca"],then:"PROXY CA.POOL",if:[]},{hosts:["cdnapisec.kaltura.com","cdnsecakmi.kaltura.com","cfvod.kaltura.com","analytics.kaltura.com"],then:"PROXY CA.POOL_serversget_ca",if:[]}]},noovo_ca:{match:{root_urls:["noovo.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["noovo.ca"],then:"PROXY CA.POOL_serversget_ca",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_serversget_ca"}],then:"PROXY CA.PEER"}]}]},cmds:[{root_urls:["noovo.ca"],then:"PROXY CA.POOL_serversget_ca",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_serversget_ca"}],then:"PROXY CA.PEER"}]},tvnow_de:{match:{root_urls:["tvnow.de"],rules:[{proxy_country:["DE"],cmds:[{hosts:["widevine.tvnow.de"],if:[{url:".*widevine\\.tvnow\\.de\\/index\\/proxy",type:"!~",then:"PROXY DE"}],then:"PROXY DE.PEER"}]}]},cmds:[{hosts:["widevine.tvnow.de"],if:[{url:".*widevine\\.tvnow\\.de\\/index\\/proxy",type:"!~",then:"PROXY DE"}],then:"PROXY DE.PEER"}]},youtube_com:{match:{root_urls:["youtube.com"],rules:[{proxy_country:["JP"],cmds:[{root_urls:["youtube.com"],if:[],then:"PROXY JP.POOL_virt_pool_jp"}]}]},cmds:[{root_urls:["youtube.com"],if:[],then:"PROXY XX"}]},cloudvideo_co:{proxy_country:["CO"],cmds:[{hosts:["rcnhd.cloudvideo.com.co"],if:[{url:"(/html5/.*/mwEmbedFrame.php/|playManifest|\\.m3u8)",type:"!~",then:"PROXY CO"}],then:"PROXY CO.PEER"}]},tvp_pl:{proxy_country:["PL"],cmds:[{hosts:["vod.tvp.pl"],if:[{url:"\\/sess\\/tvplayer\\.php",type:"!~",then:"PROXY PL"}],then:"PROXY PL.PEER"}]},vod_pl:{match:{root_urls:["vod.pl"],rules:[{proxy_country:["PL"],cmds:[{hosts:["useinsider.com","player-api.dreamlab.pl"],then:"PROXY PL.PEER",if:[]}]}]},cmds:[{hosts:["useinsider.com","player-api.dreamlab.pl"],then:"PROXY PL.PEER",if:[]}]},tvp_info:{match:{root_urls:["tvp.info"],rules:[{proxy_country:["PL"],cmds:[{hosts:["www.tvp.info"],then:"PROXY PL.PEER",if:[]}]}]},cmds:[{hosts:["www.tvp.info"],then:"PROXY PL.PEER",if:[]}]},abc:{proxy_country:["US"],cmds:[{hosts:["edgedatg.com","edgedatg.go.com"],if:[{host:"[^.]\\.?edgedatg(\\.go)?\\.com",type:"!~",then:"PROXY XX"}],then:"PROXY US.PEER"}]},stb_ua:{country:{list:["UA"],type:"in"},cmds:[{hosts:["vcms-api2.starlight.digital","vcms-api.starlight.digital"],then:"PROXY UA.PEER",if:[]}]},mediaklikk:{cmds:[{hosts:["connectmedia.hu"],if:[{url:".*cdn\\.connectmedia\\.hu\\/.*\\.m3u8",type:"=~",then:"PROXY XX"}],then:"PROXY XX"}]},zdf_de:{cmds:[{hosts:["zdfvodde-vh.akamaihd.net"],if:[{url:".*zdfvodde-vh\\.akamaihd\\.net\\/i\\/zdf\\/.*\\.m3u8",type:"=~",then:"PROXY XX"}],then:"PROXY XX"}]}},unblocker_globals:{all_browser:{match:{root_urls:["all_browser"],rules:[{proxy_country:["ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["all_browser"],then:"PROXY XX.POOL",if:[]}]},{cmds:[{root_urls:["all_browser"],then:"PROXY XX"}]}]}},br_default:{cmds:[{proxy_country:["BR"],then:"PROXY BR.POOL",if:[]}]},atresplayer_com:{match:{root_urls:["atresplayer.com"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["atresplayer.com"],then:"PROXY ES.POOL",if:[]},{hosts:["api.atresplayer.com"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["atresplayer.com"],then:"PROXY ES.POOL",if:[]},{hosts:["api.atresplayer.com"],then:"PROXY ES.PEER",if:[]}]},cbs_com:{match:{root_urls:["cbs.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["cbs.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["cbs.com"],then:"PROXY US.POOL",if:[]}]},footlocker_co_uk:{match:{root_urls:["footlocker.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["footlocker.co.uk"],then:"PROXY GB.POOL",if:[]}]}]},cmds:[{root_urls:["footlocker.co.uk"],then:"PROXY GB.POOL",if:[]}]},pxg_co_kr:{match:{root_urls:["pxg.co.kr"],rules:[{proxy_country:["US"],cmds:[{root_urls:["pxg.co.kr"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["pxg.co.kr"],then:"PROXY US.POOL",if:[]}]},hpjav_tv:{match:{root_urls:["hpjav.tv"],rules:[{proxy_country:["US"],cmds:[{root_urls:["hpjav.tv"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["hpjav.tv"],then:"PROXY US.POOL",if:[]}]},popjav_tv:{match:{root_urls:["popjav.tv"],rules:[{proxy_country:["US"],cmds:[{root_urls:["popjav.tv"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["popjav.tv"],then:"PROXY US.POOL",if:[]}]},anybunny_tv:{match:{root_urls:["anybunny.tv"],rules:[{proxy_country:["US"],cmds:[{root_urls:["anybunny.tv"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["anybunny.tv"],then:"PROXY US.POOL",if:[]}]},udemy_com:{match:{root_urls:["udemy.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["udemy.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["udemy.com"],then:"PROXY US.POOL",if:[]}]},gamovideo_com:{match:{root_urls:["gamovideo.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["gamovideo.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["gamovideo.com"],then:"PROXY US.POOL",if:[]}]},yellowpages_com:{match:{root_urls:["yellowpages.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["yellowpages.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["yellowpages.com"],then:"PROXY US.POOL",if:[]}]},lawyers_com:{match:{root_urls:["lawyers.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["lawyers.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["lawyers.com"],then:"PROXY US.POOL",if:[]}]},filmizlesene_pw:{match:{root_urls:["filmizlesene.pw"],rules:[{proxy_country:["US"],cmds:[{root_urls:["filmizlesene.pw"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["filmizlesene.pw"],then:"PROXY US.PEER",if:[]}]},dizibox_pw:{match:{root_urls:["dizibox.pw"],rules:[{proxy_country:["US"],cmds:[{root_urls:["dizibox.pw"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["dizibox.pw"],then:"PROXY US.PEER",if:[]}]},skynews_com_au:{match:{root_urls:["skynews.com.au"],rules:[{proxy_country:["AU"],cmds:[{hosts:["www.skynews.com.au"],then:"PROXY AU.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU"}],then:"PROXY AU.PEER"}]}]},cmds:[{hosts:["www.skynews.com.au"],then:"PROXY AU.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU"}],then:"PROXY AU.PEER"}]},sbt_com_br:{match:{root_urls:["sbt.com.br"],rules:[{proxy_country:["BR"],cmds:[{root_urls:["sbt.com.br"],then:"PROXY BR.PEER",if:[]}]}]},cmds:[{root_urls:["sbt.com.br"],then:"PROXY BR.PEER",if:[]}]},bfi_org_uk:{match:{root_urls:["bfi.org.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["bfi.org.uk"],then:"PROXY GB.POOL",if:[]}]}]},cmds:[{root_urls:["bfi.org.uk"],then:"PROXY GB.POOL",if:[]}]},ocs_fr:{match:{root_urls:["ocs.fr"],rules:[{proxy_country:["FR"],cmds:[{root_urls:["ocs.fr"],then:"PROXY FR.POOL",if:[]},{hosts:["www.ocs.fr","statics.ocs.fr","api.ocs.fr"],then:"PROXY FR.POOL",if:[]}]}]},cmds:[{root_urls:["ocs.fr"],then:"PROXY FR.POOL",if:[]},{hosts:["www.ocs.fr","statics.ocs.fr","api.ocs.fr"],then:"PROXY FR.POOL",if:[]}]},line_me:{match:{root_urls:["line.me"],rules:[{cmds:[{proxy_country:["TW"],root_urls:["line.me"],then:"PROXY TW.PEER",if:[]}]}]},cmds:[{proxy_country:["TW"],root_urls:["line.me"],then:"PROXY TW.PEER",if:[]}]},cbc_ca:{match:{root_urls:["cbc.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["cbc.ca"],then:"PROXY CA.POOL",if:[]}]}]},cmds:[{root_urls:["cbc.ca"],then:"PROXY CA.POOL",if:[]}]},tving_com:{match:{root_urls:["tving.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["tving.com"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["tving.com"],then:"PROXY KR.POOL",if:[]}]},afreecatv_com:{match:{root_urls:["afreecatv.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["afreecatv.com"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["afreecatv.com"],then:"PROXY KR.POOL",if:[]}]},vlive_tv:{match:{root_urls:["vlive.tv"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["vlive.tv"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["vlive.tv"],then:"PROXY KR.POOL",if:[]}]},warning_or_kr:{match:{root_urls:["warning.or.kr"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["warning.or.kr"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["warning.or.kr"],then:"PROXY KR.POOL",if:[]}]},viki_com:{match:{root_urls:["viki.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["viki.com"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["viki.com"],then:"PROXY XX.POOL",if:[]}]},ruliweb_com:{match:{root_urls:["ruliweb.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["ruliweb.com"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["ruliweb.com"],then:"PROXY KR.POOL",if:[]}]},nexon_com:{match:{root_urls:["nexon.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["nexon.com"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["nexon.com"],then:"PROXY KR.POOL",if:[]}]},cmd368_com:{match:{root_urls:["cmd368.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["cmd368.com"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["cmd368.com"],then:"PROXY KR.POOL",if:[]}]},dcinside_com:{match:{root_urls:["dcinside.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["dcinside.com"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{root_urls:["dcinside.com"],then:"PROXY KR.POOL",if:[]}]},licindia_in:{match:{root_urls:["licindia.in"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["licindia_in"],then:"PROXY IN.PEER",if:[]}]}]},cmds:[{root_urls:["licindia_in"],then:"PROXY IN.PEER",if:[]}]},yupptv_com:{match:{root_urls:["yupptv.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["yupptv.com"],then:"PROXY IN.PEER",if:[]}]}]},cmds:[{root_urls:["yupptv.com"],then:"PROXY IN.PEER",if:[]}]},sunnxt_com:{match:{root_urls:["sunnxt.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["sunnxt.com"],then:"PROXY IN.PEER",if:[]}]}]},cmds:[{root_urls:["sunnxt.com"],then:"PROXY IN.PEER",if:[]}]},primevideo_com:{match:{root_urls:["primevideo.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["primevideo.com"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["primevideo.com"],then:"PROXY XX.POOL",if:[]}]},zee5_com:{match:{root_urls:["zee5.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["zee5.com"],then:"PROXY IN.PEER",if:[]}]}]},cmds:[{root_urls:["zee5.com"],then:"PROXY IN.PEER",if:[]}]},voot_com:{match:{root_urls:["voot.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["voot.com"],then:"PROXY IN.PEER",if:[]}]}]},cmds:[{root_urls:["voot.com"],then:"PROXY IN.PEER",if:[]}]},mxplayer_in:{match:{root_urls:["mxplayer.in"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["mxplayer.in"],then:"PROXY IN.PEER",if:[]}]}]},cmds:[{root_urls:["mxplayer.in"],then:"PROXY IN.PEER",if:[]}]},huurwoningen_nl:{match:{root_urls:["huurwoningen.nl"],rules:[{proxy_country:["NL"],cmds:[{root_urls:["huurwoningen.nl"],then:"PROXY NL.POOL",if:[]}]}]},cmds:[{root_urls:["huurwoningen.nl"],then:"PROXY NL.POOL",if:[]}]},videoland_com:{match:{root_urls:["videoland.com"],rules:[{proxy_country:["NL"],cmds:[{root_urls:["videoland.com"],then:"PROXY NL.POOL",if:[]}]}]},cmds:[{root_urls:["videoland.com"],then:"PROXY NL.POOL",if:[]}]},nos_nl:{match:{root_urls:["nos.nl"],rules:[{proxy_country:["NL"],cmds:[{root_urls:["nos.nl"],then:"PROXY NL.POOL",if:[]}]}]},cmds:[{root_urls:["nos.nl"],then:"PROXY NL.POOL",if:[]}]},kakao_com:{match:{root_urls:["kakao.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["kakao.com"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["kakao.com"],then:"PROXY XX.POOL",if:[]}]},npostart_nl:{match:{root_urls:["npostart.nl"],rules:[{proxy_country:["NL"],cmds:[{root_urls:["npostart.nl"],then:"PROXY NL.POOL",if:[]}]}]},cmds:[{root_urls:["npostart.nl"],then:"PROXY NL.POOL",if:[]}]},steampowered_com:{match:{root_urls:["steampowered.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["steampowered.com"],then:"PROXY XX.POOL",if:[]}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","HK","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ"],cmds:[{hosts:["steampowered.com"],then:"PROXY XX.PEER"}]}]},cmds:[{root_urls:["steampowered.com"],then:"PROXY XX.POOL",if:[]}]},wormate_io:{match:{root_urls:["wormate.io"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["wormate.io"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["wormate.io"],then:"PROXY XX.POOL",if:[]}]},uol_com_br:{match:{root_urls:["uol.com.br"],rules:[{proxy_country:["BR"],cmds:[{root_urls:["uol.com.br"],then:"PROXY BR.POOL",if:[]}]}]},cmds:[{root_urls:["uol.com.br"],then:"PROXY BR.POOL",if:[]}]},metamask_io:{match:{root_urls:["metamask.io"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["metamask.io"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["metamask.io"],then:"PROXY XX.POOL",if:[]}]},globo_com:{match:{root_urls:["globo.com"],rules:[{proxy_country:["BR"],cmds:[{root_urls:["globo.com"],then:"PROXY BR.POOL",if:[]}]}]},cmds:[{root_urls:["globo.com"],then:"PROXY BR.POOL",if:[]}]},borderlands_com:{match:{root_urls:["borderlands.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["borderlands.com"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["borderlands.com"],then:"PROXY XX.POOL",if:[]}]},bet365_com:{match:{root_urls:["bet365.com"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["bet365.com"],then:"PROXY GB.POOL_serversget_gb",if:[]}]}]},cmds:[{root_urls:["bet365.com"],then:"PROXY GB.POOL_serversget_gb",if:[]}]},pornhub_com:{match:{root_urls:["pornhub.com"],rules:[{proxy_country:["IT"],cmds:[{hosts:["www.pornhub.com"],if:[],then:"PROXY IT.PEER"}]}]},cmds:[{root_urls:["pornhub.com"],if:[],then:"PROXY XX"}]},totalwine_com:{match:{root_urls:["totalwine.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["www.totalwine.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{hosts:["www.totalwine.com"],then:"PROXY US.POOL",if:[]}]},lasestrellas_tv:{match:{root_urls:["lasestrellas_tv"],rules:[{proxy_country:["MX"],cmds:[{hosts:["onlymex-auth.televisa.com"],then:"PROXY MX.PEER",if:[]}]}]},cmds:[{hosts:["onlymex-auth.televisa.com"],then:"PROXY MX.PEER",if:[]}]},criteo_com:{match:{root_urls:["criteo.com"],rules:[{cmds:[{hosts:["criteo.com"],then:"PROXY XX",if:[]}]}]},cmds:[{hosts:["criteo.com"],then:"PROXY XX",if:[]}]},target_com:{match:{root_urls:["target.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["gsp.target.com","login.target.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["gsp.target.com","login.target.com"],then:"PROXY US.PEER",if:[]}]},atv_at:{match:{root_urls:["atv.at"],rules:[{proxy_country:["AT"],cmds:[{hosts:["blocked-multiscreen.atv.cdn.tvnext.tv"],then:"PROXY AT.PEER",if:[]}]}]},cmds:[{hosts:["blocked-multiscreen.atv.cdn.tvnext.tv"],then:"PROXY AT.PEER",if:[]}]},williams_sonoma_com:{match:{root_urls:["williams-sonoma.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["williams-sonoma.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["williams-sonoma.com"],then:"PROXY US.PEER",if:[]}]},player_pl:{match:{root_urls:["player.pl"],rules:[{proxy_country:["PL"],cmds:[{hosts:["player.pl"],if:[{url:"\\/playerapi\\/product\\/.*\\/player\\/configuration.*",type:"!~",then:"PROXY PL"}],then:"PROXY PL.PEER"}]}]},cmds:[{hosts:["player.pl"],if:[{url:"\\/playerapi\\/product\\/.*\\/player\\/configuration.*",type:"!~",then:"PROXY PL"}],then:"PROXY PL.PEER"}]},bigbrothercanada_ca:{match:{root_urls:["bigbrothercanada.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["livestream.com"],then:"PROXY CA.PEER",if:[]},{hosts:["global.corusappservices.com"],then:"PROXY CA.POOL_serversget_ca",if:[]},{root_urls:["bigbrothercanada.ca"],then:"PROXY CA.POOL",if:[]}]}]},cmds:[{root_urls:["livestream.com"],then:"PROXY CA.PEER",if:[]},{hosts:["global.corusappservices.com"],then:"PROXY CA.POOL_serversget_ca",if:[]},{root_urls:["bigbrothercanada.ca"],then:"PROXY CA.POOL",if:[]}]},backcountry_com:{match:{root_urls:["backcountry.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["backcountry.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{root_urls:["backcountry.com"],then:"PROXY US.POOL",if:[]}]},eclinicalweb_com:{match:{root_urls:["eclinicalweb.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["eclinicalweb.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["eclinicalweb.com"],then:"PROXY US.PEER",if:[]}]},carvana_com:{proxy_country:["US"],cmds:[{root_urls:["carvana.com"],then:"PROXY US.POOL",if:[]}]},investopedia_com:{match:{root_urls:["investopedia.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["trafficguardapp.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{hosts:["trafficguardapp.com"],then:"PROXY US.POOL",if:[]}]},orf_at:{match:{root_urls:["orf.at"],rules:[{proxy_country:["AT"],cmds:[{hosts:["apasfiis.sf.apa.at","apasfpd.sf.apa.at"],then:"PROXY AT.PEER",if:[]}]}]},cmds:[{hosts:["apasfiis.sf.apa.at","apasfpd.sf.apa.at"],then:"PROXY AT.PEER",if:[]}]},mol_gov_sa:{match:{root_urls:["mol.gov.sa"],rules:[{proxy_country:["SA"],cmds:[{hosts:["mol.gov.sa"],then:"PROXY SA.PEER",if:[]}]}]},cmds:[{hosts:["mol.gov.sa"],then:"PROXY SA.PEER",if:[]}]},lsm_lv:{match:{root_urls:["lsm.lv"],rules:[{proxy_country:["LV"],cmds:[{hosts:["ltv.lsm.lv","embed.cloudycdn.services","ltv1060.cloudycdn.services","ltv2060.cloudycdn.services"],then:"PROXY LV.PEER",if:[]}]}]},cmds:[{hosts:["ltv.lsm.lv","embed.cloudycdn.services","ltv1060.cloudycdn.services","ltv2060.cloudycdn.services"],then:"PROXY LV.PEER",if:[]}]},eidf_co_kr:{match:{root_urls:["eidf.co.kr"],rules:[{proxy_country:["KR"],cmds:[{hosts:["www.eidf.co.kr"],then:"PROXY KR.POOL",if:[]}]}]},cmds:[{hosts:["www.eidf.co.kr"],then:"PROXY KR.POOL",if:[]}]},abercrombie_com:{proxy_country:["US"],cmds:[{root_urls:["abercrombie.com"],then:"PROXY US.POOL",if:[]}]},amazon_com:{match:{root_urls:["amazon.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["amazon.com"],then:"PROXY US.PEER",if:[]},{hosts:["amazon.com","api.amazonvideo.com","atv-ps.amazon.com","api.eu-west-1.aiv-delivery.net"],then:"PROXY US.PEER",if:[]}]}]}},amazon_co_uk:{match:{root_urls:["amazon.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["amazon.co.uk"],then:"PROXY GB.POOL_cogentco_gb",if:[]},{hosts:["amazon.com","api.amazonvideo.com"],then:"PROXY GB.POOL_cogentco_gb",if:[]}]}]},cmds:[{root_urls:["amazon.co.uk"],then:"PROXY GB.POOL_cogentco_gb",if:[]},{hosts:["amazon.com","api.amazonvideo.com"],then:"PROXY GB.POOL_cogentco_gb",if:[]}]},ondemandkorea_com:{proxy_country:["US"],cmds:[{root_urls:["ondemandkorea.com"],then:"PROXY US.POOL",if:[]}]},eastbay_com:{proxy_country:["US"],cmds:[{root_urls:["eastbay.com"],then:"PROXY US.POOL",if:[]}]},origin_com:{proxy_country:["US"],cmds:[{root_urls:["origin.com"],then:"PROXY US.POOL",if:[]}]},disneyplus_com:{match:{root_urls:["disneyplus.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{hosts:["global.edge.bamgrid.com"],then:"PROXY XX.PEER",if:[]},{root_urls:["disneyplus.com"],then:"PROXY XX.POOL",if:[]},{hosts:["disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY XX.POOL",if:[]}]},{cmds:[{hosts:["global.edge.bamgrid.com"],then:"PROXY XX.PEER"}]}]}},hbonow_com:{match:{root_urls:["hbonow.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["comet.api.hbo.com","play.hbonow.com"],then:"PROXY US.PEER",if:[]},{root_urls:["hbonow.com"],then:"PROXY US.POOL",if:[]}]}]}},canalplus_com:{proxy_country:["FR"],cmds:[{root_urls:["canalplus.com"],then:"PROXY FR.POOL",if:[]}]},javhd_pro:{proxy_country:["US"],cmds:[{root_urls:["javhd.pro"],then:"PROXY US.POOL",if:[]}]},zagonka_tv:{proxy_country:["GB"],cmds:[{root_urls:["zagonka.tv"],then:"PROXY GB.PEER",if:[]}]},angieslist_com:{proxy_country:["US"],cmds:[{root_urls:["angieslist.com"],then:"PROXY US.POOL",if:[]}]},areena_yle_fi:{match:{root_urls:["areena.yle.fi"],rules:[{proxy_country:["FI"],cmds:[{hosts:["locations.api.yle.fi"],then:"PROXY FI.PEER",if:[]}]}]},cmds:[{hosts:["locations.api.yle.fi"],then:"PROXY FI.PEER",if:[]}]},bbc_co_uk:{proxy_country:["GB"],cmds:[{hosts:["fig.bbc.co.uk","open.live.bbc.co.uk"],then:"PROXY GB.PEER",if:[]},{root_urls:["bbc.co.uk","bbc.com"],then:"PROXY GB.POOL_serversget_gb",if:[]},{hosts:["bidi.bbc.co.uk","bidi.live.bbc.co.uk","live.bidi.net.uk","vs-dash-uk.live.cf.md.bbci.co.uk","a.files.bbci.co.uk","account.bbc.com","ibl.api.bbc.co.uk","ssl.bbc.co.uk","vod-dash-uk-live.bbcfmt.hs.llnwd.net","vod-thumb-uk-live.bbcfmt.hs.llnwd.net","vs-dash-uk-live.bbcfmt.hs.llnwd.net","vod-sub-uk-live.bbcfmt.hs.llnwd.net","bbcfmt.hs.llnwd.net","vod-thumb-uk-live.akamaized.net","vs-dash-uk-live.akamaized.net","aod-dash-uk-live.akamaized.net","cf.md.bbci.co.uk","www.bbc.co.uk","vod-dash-uk-live.akamaized.net","as-dash-uk-live.akamaized.net"],then:"PROXY GB.POOL_serversget_gb",if:[]}],error_codes:[403]},bergdorfgoodman_com:{proxy_country:["US"],cmds:[{root_urls:["bergdorfgoodman.com"],then:"PROXY US.POOL",if:[]}]},channel4_com:{match:{root_urls:["channel4.com"],rules:[{proxy_country:["GB"],cmds:[{hosts:["ais.channel4.com"],then:"PROXY GB.PEER",if:[]},{root_urls:["channel4.com"],then:"PROXY GB.POOL",if:[]}]}]},cmds:[{hosts:["ais.channel4.com"],then:"PROXY GB.PEER",if:[]},{root_urls:["channel4.com"],then:"PROXY GB.POOL",if:[]}]},criterionchannel_com:{proxy_country:["US"],cmds:[{root_urls:["criterionchannel.com"],then:"PROXY US.POOL",if:[]}]},crunchyroll_com:{match:{root_urls:["crunchyroll.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["crunchyroll.com"],then:"PROXY US.POOL_cogentco_us",if:[]}]}]},cmds:[{root_urls:["crunchyroll.com"],then:"PROXY US.POOL_cogentco_us",if:[]}]},dazn_com:{match:{root_urls:["dazn.com"],rules:[{cmds:[{hosts:["isl.dazn.com","isl-ca.dazn.com","isl-eu.dazn.com","isl-jp.dazn.com","isl-us.dazn.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["isl.dazn.com","isl-ca.dazn.com","isl-eu.dazn.com","isl-jp.dazn.com","isl-us.dazn.com"],then:"PROXY XX.PEER",if:[]}]},dazn_jp:{match:{root_urls:["dazn.jp"],rules:[{proxy_country:["JP"],cmds:[{root_urls:["dazn.jp"],then:"PROXY JP.POOL",if:[]}]}]},cmds:[{root_urls:["dazn.jp"],then:"PROXY JP.POOL",if:[]}]},dr_dk:{proxy_country:["DK"],cmds:[{hosts:["www.dr.dk"],then:"PROXY DK.PEER",if:[]}]},eversource_com:{proxy_country:["US"],cmds:[{root_urls:["eversource.com"],then:"PROXY US.POOL",if:[]},{hosts:["i-doxs.net"],then:"PROXY US.POOL",if:[]}]},espn_com_co:{match:{root_urls:["espn.com.co"],rules:[{proxy_country:["CO"],cmds:[{hosts:["tredir.espn.com"],then:"PROXY CO.POOL",if:[]},{root_urls:["espn.com.co"],then:"PROXY CO.POOL",if:[]}]}]},cmds:[{hosts:["tredir.espn.com"],then:"PROXY CO.POOL",if:[]},{root_urls:["espn.com.co"],then:"PROXY CO.POOL",if:[]}]},fastpeoplesearch_com:{proxy_country:["US"],cmds:[{root_urls:["fastpeoplesearch.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},ffsng_com:{proxy_country:["US"],cmds:[{hosts:["ffsng.com"],if:[{url:"ffsng\\.com\\/ajax\\.php",type:"!~",then:"PROXY US"}],then:"PROXY US.PEER"}]},finishline_com:{proxy_country:["US"],cmds:[{hosts:["finishline.com"],then:"PROXY US.PEER",if:[]}]},footlocker_com:{proxy_country:["US"],cmds:[{root_urls:["footlocker.com"],then:"PROXY US.POOL",if:[]}]},ulta_com:{proxy_country:["US"],cmds:[{root_urls:["ulta.com"],then:"PROXY US.POOL",if:[]}]},jsnx_net:{proxy_country:["US"],cmds:[{root_urls:["jsnx.net"],then:"PROXY US.PEER",if:[]}]},cwtv_com:{proxy_country:["US"],cmds:[{root_urls:["cwtv.com"],then:"PROXY US.POOL_serversget_us",if:[]}]},france_tv:{proxy_country:["FR"],cmds:[{root_urls:["france.tv"],then:"PROXY FR.POOL",if:[]}]},francetvinfo_fr:{proxy_country:["FR"],cmds:[{root_urls:["francetvinfo.fr"],then:"PROXY FR.POOL",if:[]}]},gamestop_com:{proxy_country:["US"],cmds:[{root_urls:["gamestop.com"],then:"PROXY US.POOL",if:[]}]},globaltv_ca:{proxy_country:["CA"],cmds:[{root_urls:["globaltv.com"],then:"PROXY CA.POOL",if:[]},{hosts:["global.corusappservices.com"],then:"PROXY CA.POOL_serversget_ca",if:[]}]},go_com:{match:{root_urls:["go.com"],rules:[{cmds:[{root_urls:["go.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{root_urls:["go.com"],then:"PROXY XX.PEER",if:[]}]},go_us:{proxy_country:["US"],cmds:[{hosts:["prod.gatekeeper.us-abc.symphony.edgedatg.go.com","prod.gatekeeper.us-abc.symphony.edgedatg.com"],then:"PROXY US.PEER",if:[]}]},hbogo:{match:{root_urls:["hbogo.pl","hbogo.ro"],rules:[{cmds:[{hosts:["api.ugw.hbogo.eu"],if:[{url:"api\\.ugw\\.hbogo\\.eu\\/v3\\.0\\/(GeoCheck|Authentication\\/(POL|ROU))\\/(json|JSON).*",type:"!~",then:"PROXY XX"}],then:"PROXY XX.PEER"}]}]},cmds:[{hosts:["api.ugw.hbogo.eu"],if:[{url:"api\\.ugw\\.hbogo\\.eu\\/v3\\.0\\/(GeoCheck|Authentication\\/(POL|ROU))\\/(json|JSON).*",type:"!~",then:"PROXY XX"}],then:"PROXY XX.PEER"}]},hollisterco_com:{proxy_country:["US"],cmds:[{root_urls:["hollisterco.com"],then:"PROXY US.POOL",if:[]}]},hotstar_com:{proxy_country:["IN"],cmds:[{root_urls:["hotstar.com"],then:"PROXY IN.PEER",if:[]},{hosts:["www.hotstar.com","services.hotstar.com","segment.hotstar.com","api.hotstar.com","geoip.hotstar.com"],then:"PROXY IN.PEER",if:[]},{hosts:["hses1.akamaized.net","hses.akamaized.net","hses2.akamaized.net","ds-aksb-a.akamaihd.net","hesads.akamaized.net","hsdesinova.akamaized.net","hses3.akamaized.net","hses4.akamaized.net"],then:"PROXY IN.PEER",if:[]}]},sevenplus_com_au:{proxy_country:["AU"],cmds:[{hosts:["sevennetwork.akamaized.net","live-sevennetwork.akamaized.net","7plus-sevennetwork.akamaized.net"],then:"PROXY AU.PEER",if:[]},{root_urls:["7plus.com.au"],then:"PROXY AU.POOL",if:[]}]},hulu_com:{match:{root_urls:["hulu.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["play.hulu.com"],if:[{url:".*(\\.)?play\\.hulu\\.com\\/.*\\/playlist",type:"!~",then:"PROXY US.POOL"}],then:"PROXY US.PEER"},{hosts:["discover.hulu.com"],if:[{url:"discover\\.hulu\\.com\\/content\\/",type:"!~",then:"PROXY US.POOL"}],then:"PROXY US.PEER"},{root_urls:["hulu.com"],then:"PROXY US.POOL",if:[]}]}]},cmds:[{hosts:["play.hulu.com"],if:[{url:".*(\\.)?play\\.hulu\\.com\\/.*\\/playlist",type:"!~",then:"PROXY US.POOL"}],then:"PROXY US.PEER"},{hosts:["discover.hulu.com"],if:[{url:"discover\\.hulu\\.com\\/content\\/",type:"!~",then:"PROXY US.POOL"}],then:"PROXY US.PEER"},{root_urls:["hulu.com"],then:"PROXY US.POOL",if:[]}]},hulu_jp:{match:{root_urls:["hulu.jp"],rules:[{proxy_country:["JP"],cmds:[{hosts:["api.happyon.jp"],if:[{url:"api\\.happyon\\.jp\\/v1\\/(auth\\/token|playback\\/video)",type:"!~",then:"PROXY JP.POOL"}],then:"PROXY JP.PEER"},{hosts:["hulu.jp"],if:[{url:"hulu\\.jp\\/(account|signup).*",type:"!~",then:"PROXY JP.POOL"}],then:"PROXY JP.PEER"}]}]},cmds:[{hosts:["api.happyon.jp"],if:[{url:"api\\.happyon\\.jp\\/v1\\/(auth\\/token|playback\\/video)",type:"!~",then:"PROXY JP.POOL"}],then:"PROXY JP.PEER"},{hosts:["hulu.jp"],if:[{url:"hulu\\.jp\\/(account|signup).*",type:"!~",then:"PROXY JP.POOL"}],then:"PROXY JP.PEER"}]},itv_com:{proxy_country:["GB"],cmds:[{root_urls:["itv.com"],then:"PROXY GB.POOL_cogentco_gb",if:[]},{hosts:["magni.itv.com","edge.api.brightcove.com"],then:"PROXY XX.PEER",if:[]},{hosts:["itv.com","itvpnp.live.ott.irdeto.com","itvstatic.com","itvpnpdotcom-a.akamaihd.net","ssl-itvdotcom.2cnt.net"],then:"PROXY GB.POOL_cogentco_gb",if:[]}],error_codes:[403]},iqiyi_com:{proxy_country:["CN"],cmds:[{hosts:["cache.video.iqiyi.com"],if:[{url:".*cache\\.video\\.iqiyi\\.com\\/dash.*",type:"!~",then:"PROXY CN"}],then:"PROXY CN.PEER"}]},iview_abc_net_au:{cmds:[{hosts:["api.iview.abc.net.au"],if:[{url:"api\\.iview\\.abc\\.net\\.au\\/v2\\/(video|token\\/drm)\\/.*",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"},{hosts:["abc-iview-mediapackagestreams-1.akamaized.net"],if:[{url:"abc-iview-mediapackagestreams-1\\.akamaized\\.net\\/out\\/v1\\/\\w+\\/index\\.mpd",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"},{hosts:["iview-vod.akamaized.net"],if:[{url:"iview-vod\\.akamaized\\.net\\/prod\\/ck1\\/\\w+\\/\\w+\\/mpegdash\\/master\\.mpd",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"}]},kaltura_com:{proxy_country:["FI"],cmds:[{hosts:["cdnapisec.kaltura.com","cdnsecakmi.kaltura.com"],then:"PROXY FI.PEER",if:[]}]},kbs_kr:{proxy_country:["KR"],cmds:[{hosts:["onair.kbs.co.kr"],then:"PROXY KR.POOL",if:[]}]},manga_line_me:{proxy_country:["JP"],cmds:[{hosts:["manga.line.me"],then:"PROXY JP.PEER",if:[]}]},mangago_me:{proxy_country:["US"],cmds:[{root_urls:["mangago.me"],then:"PROXY US.POOL",if:[]}]},marcus_com:{proxy_country:["US"],cmds:[{root_urls:["marcus.com"],then:"PROXY US.POOL",if:[]}]},meiliboxi_fi:{proxy_country:["FI"],cmds:[{hosts:["meiliboxi.fi"],then:"PROXY FI.PEER",if:[]}]},mitele_es:{match:{root_urls:["mitele.es"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["mitele.es"],then:"PROXY ES.POOL",if:[]},{hosts:["miteleooyala-vh.akamaihd.net","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","vod.mitele.es"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["mitele.es"],then:"PROXY ES.POOL",if:[]},{hosts:["miteleooyala-vh.akamaihd.net","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","vod.mitele.es"],then:"PROXY ES.PEER",if:[]}]},my5_tv:{proxy_country:["GB"],cmds:[{root_urls:["my5.tv"],then:"PROXY GB.POOL",if:[]}]},naver_com:{cmds:[{root_urls:["naver.com"],if:[{url:"(smartmediarep.com|pstatic.net|vrixon.com).*.(mp4|m3u8|ts)",type:"=~",then:"DIRECT"}],then:"PROXY XX"}]},netflix_com:{match:{min_ver:"1.155.76",root_urls:["netflix.com"],rules:[{proxy_country:["IT","GB","US","KR","BR","NL"],cmds:[{root_urls:["netflix.com"],if:[],then:"PROXY XX.POOL"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY XX.POOL",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["netflix.com"],if:[],then:"PROXY CA.POOL_serversget_ca"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY CA.POOL_serversget_ca"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","HK","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","JP","FR","ES","CO","IN","AU"],cmds:[{root_urls:["netflix.com"],if:[],then:"PROXY XX.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY XX.PEER"}]}]},error_codes:[420]},ome_tv:{match:{root_urls:["ome.tv"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["ome.tv"],then:"PROXY XX.POOL",if:[]},{hosts:["roulette.apps-host.com"],then:"PROXY XX.POOL",if:[]}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","HK","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ"],cmds:[{hosts:["roulette.apps-host.com"],then:"PROXY XX.PEER"}]}]},cmds:[{root_urls:["ome.tv"],then:"PROXY XX.POOL",if:[]},{hosts:["roulette.apps-host.com"],then:"PROXY XX.POOL",if:[]}]},omegle_com:{cmds:[{hosts:["omegle.com"],if:[{url:".*front\\d+\\.omegle\\.com\\/(start|status|events)",type:"!~",then:"PROXY XX"}],then:"PROXY XX.PEER"}]},raiplay_it:{match:{min_ver:"1.155.77",root_urls:["raiplay.it"],rules:[{proxy_country:["IT"],cmds:[{hosts:["akamaihd.net"],if:[{url:"\\.akamaihd\\.net\\/.*(\\.m3u8|\\.ts)",type:"=~",then:"PROXY IT"}],then:"PROXY IT"},{hosts:["mediapolisvod.rai.it","mediapolis.rai.it","mediapolisgs.rai.it"],then:"PROXY IT.PEER",if:[]}]}]}},rte_ie:{cmds:[{root_urls:["rte.ie"],then:"PROXY XX.PEER",if:[]}]},rtlplay_be:{match:{root_urls:["rtlplay.be"],rules:[{proxy_country:["BE"],cmds:[{hosts:["6play.fr","m6web.fr"],then:"PROXY BE.PEER",if:[]}]}]},cmds:[{hosts:["6play.fr","m6web.fr"],then:"PROXY BE.PEER",if:[]}]},sixplay_fr:{match:{root_urls:["6play.fr"],rules:[{proxy_country:["FR"],cmds:[{hosts:["6play.fr"],then:"PROXY FR.PEER",if:[]}]}]},cmds:[{hosts:["6play.fr"],then:"PROXY FR.PEER",if:[]}]},sonyliv_com:{match:{root_urls:["sonyliv.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["sonyliv.com"],then:"PROXY IN.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY IN"}],then:"PROXY IN.PEER"}]}]},cmds:[{root_urls:["sonyliv.com"],then:"PROXY IN.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY IN"}],then:"PROXY IN.PEER"}]},sprint_com:{proxy_country:["US"],cmds:[{root_urls:["sprint.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},stan_com_au:{cmds:[{hosts:["api.stan.com.au"],then:"PROXY AU.PEER",if:[]}]},tenplay_com_au:{match:{root_urls:["tenplay.com.au"],rules:[{proxy_country:["AU"],cmds:[{root_urls:["tenplay.com.au"],then:"PROXY AU.POOL",if:[]},{hosts:["10play.com.au","manifest.prod.boltdns.net","bcboltnet10tp.akamaized.net","10play-vod.global.ssl.fastly.net","10-selector.global.ssl.fastly.net"],then:"PROXY AU.POOL",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"}]}]},cmds:[{root_urls:["tenplay.com.au"],then:"PROXY AU.POOL",if:[]},{hosts:["10play.com.au","manifest.prod.boltdns.net","bcboltnet10tp.akamaized.net","10play-vod.global.ssl.fastly.net","10-selector.global.ssl.fastly.net"],then:"PROXY AU.POOL",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"}]},bfmtv_com:{match:{root_urls:["bfmtv.com"],rules:[{proxy_country:["FR"],cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY FR"}],then:"PROXY FR.PEER"}]}]},cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY FR"}],then:"PROXY FR.PEER"}]},tvnz_co_nz:{match:{root_urls:["tvnz.co.nz"],rules:[{proxy_country:["NZ"],cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY NZ"}],then:"PROXY NZ.PEER"},{hosts:["bcbolttvnz3-a.akamaihd.net"],then:"PROXY NZ.PEER",if:[]}]}]},cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY NZ"}],then:"PROXY NZ.PEER"},{hosts:["bcbolttvnz3-a.akamaihd.net"],then:"PROXY NZ.PEER",if:[]}]},textnow_com:{match:{root_urls:["textnow.com"],rules:[{proxy_country:["AU","CO","JP","IT","ES","FR","GB","US","CA","IN","KR","BR","NL"],cmds:[{root_urls:["textnow.com"],then:"PROXY XX.POOL",if:[]}]}]},cmds:[{root_urls:["textnow.com"],then:"PROXY XX.POOL",if:[]}]},toggle_sg:{match:{root_urls:["toggle.sg"],rules:[{proxy_country:["SG"],cmds:[{hosts:["player-as.ott.kaltura.com"],if:[{url:".*player-as\\.ott\\.kaltura\\.com\\/.*\\/mwEmbed\\/mwEmbedFrame\\.php.*",type:"!~",then:"PROXY SG"}],then:"PROXY SG.PEER"}]}]},cmds:[{hosts:["player-as.ott.kaltura.com"],if:[{url:".*player-as\\.ott\\.kaltura\\.com\\/.*\\/mwEmbed\\/mwEmbedFrame\\.php.*",type:"!~",then:"PROXY SG"}],then:"PROXY SG.PEER"}]},tv4play_se:{match:{root_urls:["tv4play.se"],rules:[{proxy_country:["SE"],cmds:[{hosts:["playback-api.b17g.net"],then:"PROXY SE.PEER",if:[]}]}]},cmds:[{hosts:["playback-api.b17g.net"],then:"PROXY SE.PEER",if:[]}]},telecinco_es:{match:{root_urls:["telecinco.es"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["telecinco.es"],then:"PROXY ES.POOL",if:[]},{hosts:["gatekeeper.mediaset.es","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","telecinco1-vh.akamaihd.net"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["telecinco.es"],then:"PROXY ES.POOL",if:[]},{hosts:["gatekeeper.mediaset.es","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","telecinco1-vh.akamaihd.net"],then:"PROXY ES.PEER",if:[]}]},energytv_es:{match:{root_urls:["energytv.es"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["energytv.es"],then:"PROXY ES.POOL",if:[]},{hosts:["mdslivehlsb-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["energytv.es"],then:"PROXY ES.POOL",if:[]},{hosts:["mdslivehlsb-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es"],then:"PROXY ES.PEER",if:[]}]},mediaset_it:{match:{root_urls:["mediaset.it"],rules:[{proxy_country:["IT"],cmds:[{hosts:["api-ott-prod-fe.mediaset.net","link.theplatform.eu"],then:"PROXY IT.PEER",if:[]}]}]},cmds:[{hosts:["api-ott-prod-fe.mediaset.net","link.theplatform.eu"],then:"PROXY IT.PEER",if:[]}]},tva_ca:{match:{root_urls:["tva.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["tva.ca","chainetvauls-lh.akamaihd.net"],then:"PROXY CA.POOL_serversget_ca",if:[]},{hosts:["videos.tva.ca","video.tva.ca"],then:"PROXY CA.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_serversget_ca"}],then:"PROXY CA.PEER"}]}]},cmds:[{root_urls:["tva.ca","chainetvauls-lh.akamaihd.net"],then:"PROXY CA.POOL_serversget_ca",if:[]},{hosts:["videos.tva.ca","video.tva.ca"],then:"PROXY CA.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_serversget_ca"}],then:"PROXY CA.PEER"}]},aptnlumi_ca:{match:{root_urls:["aptnlumi.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["aptnlumi.ca"],then:"PROXY CA.POOL",if:[]},{hosts:["cdnapisec.kaltura.com","cdnsecakmi.kaltura.com","cfvod.kaltura.com","analytics.kaltura.com"],then:"PROXY CA.POOL_serversget_ca",if:[]}]}]},cmds:[{root_urls:["aptnlumi.ca"],then:"PROXY CA.POOL",if:[]},{hosts:["cdnapisec.kaltura.com","cdnsecakmi.kaltura.com","cfvod.kaltura.com","analytics.kaltura.com"],then:"PROXY CA.POOL_serversget_ca",if:[]}]},noovo_ca:{match:{root_urls:["noovo.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["noovo.ca"],then:"PROXY CA.POOL_serversget_ca",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_serversget_ca"}],then:"PROXY CA.PEER"}]}]},cmds:[{root_urls:["noovo.ca"],then:"PROXY CA.POOL_serversget_ca",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_serversget_ca"}],then:"PROXY CA.PEER"}]},tvnow_de:{match:{root_urls:["tvnow.de"],rules:[{proxy_country:["DE"],cmds:[{hosts:["widevine.tvnow.de"],if:[{url:".*widevine\\.tvnow\\.de\\/index\\/proxy",type:"!~",then:"PROXY DE"}],then:"PROXY DE.PEER"}]}]},cmds:[{hosts:["widevine.tvnow.de"],if:[{url:".*widevine\\.tvnow\\.de\\/index\\/proxy",type:"!~",then:"PROXY DE"}],then:"PROXY DE.PEER"}]},youtube_com:{match:{root_urls:["youtube.com"],rules:[{proxy_country:["JP"],cmds:[{root_urls:["youtube.com"],if:[],then:"PROXY JP.POOL_virt_pool_jp"}]}]},cmds:[{root_urls:["youtube.com"],if:[],then:"PROXY XX"}]},cloudvideo_co:{proxy_country:["CO"],cmds:[{hosts:["rcnhd.cloudvideo.com.co"],if:[{url:"(/html5/.*/mwEmbedFrame.php/|playManifest|\\.m3u8)",type:"!~",then:"PROXY CO"}],then:"PROXY CO.PEER"}]},tvp_pl:{proxy_country:["PL"],cmds:[{hosts:["vod.tvp.pl"],if:[{url:"\\/sess\\/tvplayer\\.php",type:"!~",then:"PROXY PL"}],then:"PROXY PL.PEER"}]},vod_pl:{match:{root_urls:["vod.pl"],rules:[{proxy_country:["PL"],cmds:[{hosts:["useinsider.com","player-api.dreamlab.pl"],then:"PROXY PL.PEER",if:[]}]}]},cmds:[{hosts:["useinsider.com","player-api.dreamlab.pl"],then:"PROXY PL.PEER",if:[]}]},tvp_info:{match:{root_urls:["tvp.info"],rules:[{proxy_country:["PL"],cmds:[{hosts:["www.tvp.info"],then:"PROXY PL.PEER",if:[]}]}]},cmds:[{hosts:["www.tvp.info"],then:"PROXY PL.PEER",if:[]}]},abc:{proxy_country:["US"],cmds:[{hosts:["edgedatg.com","edgedatg.go.com"],if:[{host:"[^.]\\.?edgedatg(\\.go)?\\.com",type:"!~",then:"PROXY XX"}],then:"PROXY US.PEER"}]},stb_ua:{country:{list:["UA"],type:"in"},cmds:[{hosts:["vcms-api2.starlight.digital","vcms-api.starlight.digital"],then:"PROXY UA.PEER",if:[]}]},mediaklikk:{cmds:[{hosts:["connectmedia.hu"],if:[{url:".*cdn\\.connectmedia\\.hu\\/.*\\.m3u8",type:"=~",then:"PROXY XX"}],then:"PROXY XX"}]},zdf_de:{cmds:[{hosts:["zdfvodde-vh.akamaihd.net"],if:[{url:".*zdfvodde-vh\\.akamaihd\\.net\\/i\\/zdf\\/.*\\.m3u8",type:"=~",then:"PROXY XX"}],then:"PROXY XX"}]},google:{cmds:[{hosts:["google.com"],then:"DIRECT",if:[]}]}}}}}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,__webpack_exports__,__webpack_require__){"use strict";var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var conf__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(24);var conf__WEBPACK_IMPORTED_MODULE_1___namespace=__webpack_require__.t(24,1);var zon_config__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(51);var zon_config__WEBPACK_IMPORTED_MODULE_2___namespace=__webpack_require__.t(51,1);var _util_util_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(10);var _util_util_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_3__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(12);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_4__);var _util_date_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(16);var _util_date_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_5__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(21);var _util_storage_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_6__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(11);var _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_7__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(17);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(13);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(14);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(30);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(29);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(35);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(20);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14__);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(40);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(37);var _bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(44);var _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(42);var _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(55);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(41);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_20___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_20__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(33);var _bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(64);var _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(36);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(28);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_24___default=__webpack_require__.n(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_24__);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9___default.a.assert_bg("bg_ui_api");const chrome=window.chrome;const{CG:CG}=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_8___default.a.task_model.extend({model_name:"bg_ui_api",_defaults:function(){this.on("destroy",()=>E.uninit())}}));E.init=be_bg_main=>{if(E.inited)return;E.set_enabled=be_bg_main.set_enabled;E.ga_send=be_bg_main.ga_send;E.set_agree_ts=be_bg_main.set_agree_ts;E.bg_main_recover=()=>void be_bg_main.trigger("recover");_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default.a.set("ui_popup_render_count",0);const attributes={ext_active:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a,key:"ext.active"},ext_suspended:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a,key:"ext.suspended"},ext_conflict:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a,key:"ext.conflict"},is_premium:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a},bext_config:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a},vpn_countries:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a},uuid:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a},user_id:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a},active_tab_url:{model:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default.a,key:"active.url"},active_tab_id:{model:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default.a,key:"active.id"},rules:{model:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"]},rule_status:{model:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"],key:"status"},rule_status_opt:{model:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"],key:"status_opt"},user:{model:_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"]},membership:{model:_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"]},vpn_last_rating:{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"]},rate_on_store:{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"]},country:{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"]},location:{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"]},vpn_work_yes:{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"]},rate_us_count:{model:E},info_status:{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"],key:"status"},dev_mode:{model:_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_17__["default"]},vpn_country:{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_23__["default"]},svc_info:{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_23__["default"],key:"info"},svc_version:{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_23__["default"],key:"version"},svc_status:{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_23__["default"],key:"status"},mitm_ext_ui_enabled:{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"]},protect_pc:{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"]},protect_browser:{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"]},protect_tooltips:{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"]},vpn_status:{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"],key:"status"},bg_main_status:{model:be_bg_main,key:"status"},bg_main_inited:{model:be_bg_main,key:"inited"},enabled:{model:be_bg_main},agree_ts:{model:be_bg_main}};Object.keys(attributes).forEach(attr=>{const model=attributes[attr].model;const model_key=attributes[attr].key||attr;E.listen_to(model,"change:"+model_key,()=>E.set(attr,model.get(model_key)))});const events=[{model:_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_22__["a"],event:"body_click"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a,event:"trial_end"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a,event:"trial_start"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a,event:"trial_change"},{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"],event:"storage_debug_change"},{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"],event:"force_trial"},{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"],event:"mitm_manual_unblock"},{model:_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_22__["a"],event:"mouseleave"},{model:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default.a,event:"change:active.url",name:"url_changed"},{model:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default.a,event:"change:active.id",name:"tab_id_changed"},{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"],event:"change:country",name:"country_changed"},{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"],event:"change:location",name:"location_changed"},{model:be_bg_main,event:"change:enabled",name:"enabled_changed"},{model:be_bg_main,event:"change:inited",name:"bg_main_inited"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a,event:"change:is_premium",name:"user_changed"},{model:_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"],event:"change:user",name:"user_changed"},{model:_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"],event:"change:membership",name:"membership_changed"},{model:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"],event:"change:rules change:tabs_stub_rules",name:"rule_changed"},{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"],event:"change:protect_pc change:mitm_active_manual",name:"rule_changed"},{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_23__["default"],event:"change:vpn_country",name:"rule_changed"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a,event:"change:ext.active",name:"ext_active_changed"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a,event:"change:ext.suspended",name:"ext_suspended_changed"},{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"],event:"change:mitm_site",name:"mitm_site_changed"},{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"],event:"change:status",name:"status_changed"},{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"],event:"change:settings",name:"settings_changed"},{model:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"],event:"change:status set_tab_state",name:"status_changed"},{model:_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_20___default.a,event:"change:tab_load_err",name:"tab_load_err"},{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_23__["default"],event:"change:status",name:"status_changed"},{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"],event:"change:status",name:"vpn_status_changed"},{model:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"],event:"set_tab_state"},{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_23__["default"],event:"change:info",name:"svc_info_changed"},{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_23__["default"],event:"change:version",name:"svc_version_changed"},{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"],event:"change:protect_pc change:protect_browser "+"change:protect_tooltip",name:"protect_changed"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a,event:"change:ext.conflict",name:"ext_conflict_changed"},{model:be_bg_main,event:"change:agree_ts",name:"agree_ts_changed"},{model:_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_17__["default"],event:"change:dev_mode",name:"dev_mode_changed"}];events.forEach(v=>{E.listenTo(v.model,v.event,(...args)=>{if(v.event.startsWith("change:"))args=[];E.trigger(v.name||v.event,...args)})});E.on("popup_open",on_popup_open);_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_24___default.a.backbone.server.start(E,"bg_ui_api");E.inited=true};E.uninit=()=>{if(!E.inited)return;E.inited=false;_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_24___default.a.backbone.server.stop("bg_ui_api");E.stopListening();E.off("popup_open",on_popup_open)};const store_urls={chrome:"https://chrome.google.com/webstore/detail/"+"hola-free-vpn-proxy-unblo/gkojfkhlekighikafcpjkiklfbnlmeio",opera:"https://addons.opera.com/en/extensions/details/"+"hola-better-internet/",firefox:"https://addons.mozilla.org/en-US/firefox/addon/hola-unblocker/",edge:"https://microsoftedge.microsoft.com/addons/detail/"+"nfjgmgjhcihmkobljembcfodkajehoej"};const review_urls={chrome:store_urls.chrome+"/reviews",opera:store_urls.opera,firefox:store_urls.firefox+"reviews/",edge:store_urls.edge};const get_rate_us_url=()=>{let urls=CG("rate_us.urls");let src_country=(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].get("country")||"").toUpperCase();if(urls&&urls.length){urls=urls.sort((a,b)=>a.rand-b.rand);let random=Math.random();for(let item of urls){if(item.countries&&!item.countries.includes(src_country))continue;if(random>item.rand){random-=item.rand;continue}if(item.url=="store")break;return item.url}}return review_urls[_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.browser()]};E.open_rate_us=()=>{let url=get_rate_us_url();if(!url)return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.perr("be_open_rate_us",{url:url});_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].set_rate_on_store(Date.now());E.open_new_tab({url:url,force_active:true})};E.open_web_store=()=>E.open_new_tab({url:store_urls[_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.browser()],force_active:true});E.set_rate_us_count=count=>E.set("rate_us_count",count);E.reset_rate_us=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].reset_rate_us;const on_popup_open=rule=>{_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_20___default.a.reauth_rule_agents(rule);_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_20___default.a.reverify_rule_agents(rule)};const dev_info=()=>{const ext_type=(()=>{const types=underscore__WEBPACK_IMPORTED_MODULE_0___default.a.invert(conf__WEBPACK_IMPORTED_MODULE_1__.ids);return id=>types[id]})();try{var a=[],manifest;if(chrome&&!(manifest=chrome.runtime.getManifest()).update_url&&!_util_util_js__WEBPACK_IMPORTED_MODULE_3___default.a.get(manifest,"applications.gecko.update_url")){a.push("no update")}if(chrome&&!conf__WEBPACK_IMPORTED_MODULE_1__.browser.firefox&&!ext_type(chrome.runtime.id))a.push("unknown id");if(zon_config__WEBPACK_IMPORTED_MODULE_2__._RELEASE_LEVEL!=2){if(zon_config__WEBPACK_IMPORTED_MODULE_2__._RELEASE_LEVEL==1)a.push("rel1");if(zon_config__WEBPACK_IMPORTED_MODULE_2__.BUILDTYPE_DEBUG)a.push("debug")}if(conf__WEBPACK_IMPORTED_MODULE_1__.arch)a.push(conf__WEBPACK_IMPORTED_MODULE_1__.arch);return a.join(",")}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default()("dev_info %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default.a.e2s(e))}return""};E.get_product_info=()=>{const build=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.build_info(),dev=dev_info();const res=[];const add=(name,value)=>{if(value)res.push({name:name,value:value})};add("Ext version",build.ext_version||_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.version());add("WWW version",build.server_version);add("Service",build.svc_version);if(build.svc_mode){let mode=build.svc_mode+" active";if(build.svc_mode_pending)mode+=", "+build.svc_mode_pending+" pending";add("Mode",mode)}add("Product",build.product_type);add("Browser",build.browser);add("Platform",build.platform);add("CID",_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_23__["default"].get("cid_js"));add("UUID",_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a.get("uuid"));add("Dev info",dev);return res};E.get_popup_rating_cache=root_url=>{let cache=_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default.a.get_json("popup_rating_cache");return cache&&root_url==cache.root_url&&cache.rule_ratings||null};E.set_popup_rating_cache=(root_url,rule_ratings)=>_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default.a.set_json("popup_rating_cache",{rule_ratings:rule_ratings,root_url:root_url});E.need_upgrade_msg=()=>{if(Date.now()-_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default.a.get_int("upgrade_msg_ts")<_util_date_js__WEBPACK_IMPORTED_MODULE_5___default.a.ms.DAY)return false;let browser=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.browser();let min_ver_all=CG("upgrade_msg.min_ver.all");let min_ver_browser=CG(`upgrade_msg.min_ver.${browser}`);return!!min_ver_all&&!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.check_min_ver(min_ver_all)||!!min_ver_browser&&!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.check_min_ver(min_ver_browser)};E.click_upgrade=upgrade=>{_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default.a.set("upgrade_msg_ts",Date.now());if(upgrade)E.open_web_store()};E.init_monitor_active=()=>{let data=_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default.a.get_json("monitor_active")||{};data.ui_open_ts=Date.now();_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default.a.set_json("monitor_active",data)};E.uninit_monitor_active=()=>{let data=_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default.a.get_json("monitor_active")||{};data.ui_close_ts=Date.now();_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default.a.set_json("monitor_active",data)};E.set_dbg_conf=(path,value)=>{_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].set_dbg_conf(path,value);E.force_bext_config_update();_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].trigger("storage_debug_change")};E.get_dbg_conf=path=>_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].get_dbg_conf(path);E.get_storage_locale=()=>_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default.a.get("locale");E.set_storage_locale=locale=>_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default.a.set("locale",locale);E.trigger_not_working=opt=>void _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default.a.trigger("not_working",opt);E.fetch_rules=()=>void _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"].trigger("fetch_rules");E.trigger_force_trial=opt=>void _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].trigger("force_trial",opt);E.bg_vpn_recover=()=>void _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].trigger("recover");E.open_new_tab=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].open_new_tab;E.open_be_tab=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].open_be_tab;E.update_tab=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].update_tab;E.perr=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.perr;E.get_log=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default.a.get_log;E.get_tab_load_err=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_20___default.a.get_tab_load_err;E.get_enabled_rule=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].get_enabled_rule;E.send_vpn_work_report=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"].send_vpn_work_report;E.send_fix_it_report=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"].send_fix_it_report;E.set_dont_show_again=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].set_dont_show_again;E.get_dont_show_rules=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].get_dont_show_rules;E.is_dont_show=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].is_dont_show;E.get_rule_ratings=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"].get_rule_ratings;E.fix_vpn=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"].fix_vpn;E.set_rule=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"].set_rule;E.rule_task_cancel_all=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"].task_cancel_all;E.force_bext_config_update=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].force_bext_config_update;E.enable_root_url=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].enable_root_url;E.stop_vpn=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].stop_vpn;E.pause_videos=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_22__["a"].pause_videos;E.resume_videos=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_22__["a"].resume_videos;E.hide_arrow_anim=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_22__["a"].hide_arrow_anim;E.show_arrow_anim=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_22__["a"].show_arrow_anim;E.close_tab_tpopup=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_22__["a"].close_tab_tpopup;E.get_trial_active=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].get_trial_active;E.set_trial=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].set_trial;E.set_time_left=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].set_time_left;E.is_trial_grace_period=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].is_trial_grace_period;E.get_next_trial_ts=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].get_next_trial_ts;E.is_trial_expired=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].is_trial_expired;E.is_trial_expired=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].is_trial_expired;E.get_trial_wait=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].get_trial_wait;E.refresh_user=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].refresh_user;E.refresh_anonymous=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].refresh_anonymous;E.logout=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].logout_user;E.resend_verification_email=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].resend_verification_email;E.open_login_popup=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].open_login_popup;E.is_verified=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].is_verified;E.set_vpn_last_rating=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].set_vpn_last_rating;E.get_redirect_list=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default.a.get_redirect_list;E.mitm_set_ignore=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].mitm_set_ignore;E.mitm_set_unblock=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].mitm_set_unblock;E.is_mitm_active_manual=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].is_mitm_active_manual;E.mitm_need_popup=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].mitm_need_popup;E.set_login_redirect=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].set_login_redirect;E.set_email_verify_url=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].set_email_verify_url;E.get_unblocking_rate_url=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].get_unblocking_rate_url;E.get_unblocking_rate=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].get_unblocking_rate;E.set_dev_mode=_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_17__["default"].enable;E.update_svc_info=_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_23__["default"].update_info;E.is_paid=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].is_paid;E.is_mitm_site=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].is_mitm_site;E.get_mitm_unblock_rules=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].get_mitm_unblock_rules;E.set_enabled_for_browser=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].set_enabled_for_browser;E.set_enabled_for_pc=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].set_enabled_for_pc;E.tpopup_is_connected=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].tpopup_is_connected;E.hola_api_call=_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_13__["a"].hola_api_call;E.perr_ajax=_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_13__["a"].perr_ajax;E.show_tpopup=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_22__["a"].show;E.close_tpopup=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_22__["a"].close;E.resize_tpopup=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_22__["a"].resize;E.set_force_suggestion=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default.a.set_force_suggestion;E.do_tpopup=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].do_tpopup;E.vpn_change_agent=_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_23__["default"].vpn_change_agent;E.need_trial=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].need_trial;E.reset_trial=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].reset;E.unblock_action=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].unblock_action;E.get_force_premium_rules=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].get_force_premium_rules;E.increment_vpn_work_yes=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_21__["default"].increment_vpn_work_yes;E.get_tab_state=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__["a"].get_tab_state;E.get_force_premium_rule=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].get_force_premium_rule;E.is_incognito_allowed=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_7___default.a.cb_apply(chrome.extension,".isAllowedIncognitoAccess",[]);E.push_event=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_19__["a"].push_event;E.get_site_storage=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].get_site_storage;E.set_site_storage=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].set_site_storage;E.t={get_rate_us_url:get_rate_us_url,review_urls:review_urls};__webpack_exports__["a"]=E}]]);
//# sourceMappingURL=https://hola.org/be_source_map/1.168.667/11.js.map